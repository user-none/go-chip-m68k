package m68k

import "testing"

func TestBTST(t *testing.T) {
	tests := []struct {
		name string
		init cpuState
		want cpuState
	}{
		{
			name: "000 BTST D5, (A6)+ 0b1e",
			init: cpuState{
				D:   [8]uint32{2523688281, 1363789769, 1188369638, 2993727786, 279620357, 3573410688, 2527466190, 1477735605},
				A:   [7]uint32{1530248351, 1247542487, 1509796885, 974589700, 2585694170, 2885404392, 4082466426},
				PC:  5490290,
				SR:  9247,
				USP: 13634230,
				SSP: 14137736,
				RAM: [][2]uint32{{5490286, 11}, {5490287, 30}, {5490288, 242}, {5490289, 204}, {5602938, 124}, {5602939, 189}, {5490290, 170}, {5490291, 155}},
			},
			want: cpuState{
				D:   [8]uint32{2523688281, 1363789769, 1188369638, 2993727786, 279620357, 3573410688, 2527466190, 1477735605},
				A:   [7]uint32{1530248351, 1247542487, 1509796885, 974589700, 2585694170, 2885404392, 4082466427},
				PC:  5490292,
				SR:  9247,
				USP: 13634230,
				SSP: 14137736,
				RAM: [][2]uint32{{5490286, 11}, {5490287, 30}, {5490288, 242}, {5490289, 204}, {5602938, 124}, {5602939, 189}, {5490290, 170}, {5490291, 155}},
				Cycles: 8,
			},
		},
		{
			name: "500 BTST D2, # 053c",
			init: cpuState{
				D:   [8]uint32{3437135205, 285366979, 1082831774, 3764772155, 1611330715, 896167455, 334523576, 2837236113},
				A:   [7]uint32{817191152, 1057135609, 56802253, 1273955084, 554115357, 2546653039, 3999752289},
				PC:  11132660,
				SR:  33032,
				USP: 16183904,
				SSP: 14538846,
				RAM: [][2]uint32{{11132656, 5}, {11132657, 60}, {11132658, 90}, {11132659, 242}, {11132660, 214}, {11132661, 128}, {11132662, 105}, {11132663, 131}},
			},
			want: cpuState{
				D:   [8]uint32{3437135205, 285366979, 1082831774, 3764772155, 1611330715, 896167455, 334523576, 2837236113},
				A:   [7]uint32{817191152, 1057135609, 56802253, 1273955084, 554115357, 2546653039, 3999752289},
				PC:  11132664,
				SR:  33032,
				USP: 16183904,
				SSP: 14538846,
				RAM: [][2]uint32{{11132656, 5}, {11132657, 60}, {11132658, 90}, {11132659, 242}, {11132660, 214}, {11132661, 128}, {11132662, 105}, {11132663, 131}},
				// PRM says 4 + 4(#imm EA) = 8 cycles, but hardware-verified
				// tests (SingleStepTests/m68000) show 10. We use the PRM value.
				// Cycles: 10,
			},
		},
		{
			name: "1000 BTST D5, -(A4) 0b24",
			init: cpuState{
				D:   [8]uint32{858662442, 3811139277, 693093767, 4059356825, 3416713382, 770114126, 1502493360, 1097935509},
				A:   [7]uint32{3673230735, 1362427554, 456384243, 1987871144, 585774134, 1829482816, 2683564335},
				PC:  2807240,
				SR:  9491,
				USP: 6309652,
				SSP: 2354916,
				RAM: [][2]uint32{{2807236, 11}, {2807237, 36}, {2807238, 18}, {2807239, 42}, {15348788, 133}, {15348789, 53}, {2807240, 62}, {2807241, 178}},
			},
			want: cpuState{
				D:   [8]uint32{858662442, 3811139277, 693093767, 4059356825, 3416713382, 770114126, 1502493360, 1097935509},
				A:   [7]uint32{3673230735, 1362427554, 456384243, 1987871144, 585774133, 1829482816, 2683564335},
				PC:  2807242,
				SR:  9495,
				USP: 6309652,
				SSP: 2354916,
				RAM: [][2]uint32{{2807236, 11}, {2807237, 36}, {2807238, 18}, {2807239, 42}, {15348788, 133}, {15348789, 53}, {2807240, 62}, {2807241, 178}},
				Cycles: 10,
			},
		},
		{
			name: "1500 BTST #, (d8, A1, Xn) 0831",
			init: cpuState{
				D:   [8]uint32{348646209, 2155092383, 3011363204, 1224719401, 1190032872, 1207609741, 3983700586, 3350011111},
				A:   [7]uint32{4244475223, 3024349265, 2572905160, 2324492518, 1364537629, 1792869405, 1067342020},
				PC:  10082426,
				SR:  34306,
				USP: 7696442,
				SSP: 9339710,
				RAM: [][2]uint32{{10082422, 8}, {10082423, 49}, {10082424, 181}, {10082425, 225}, {10082426, 162}, {10082427, 36}, {10082428, 131}, {10082429, 249}, {4477756, 251}, {4477757, 168}, {10082430, 157}, {10082431, 81}},
			},
			want: cpuState{
				D:   [8]uint32{348646209, 2155092383, 3011363204, 1224719401, 1190032872, 1207609741, 3983700586, 3350011111},
				A:   [7]uint32{4244475223, 3024349265, 2572905160, 2324492518, 1364537629, 1792869405, 1067342020},
				PC:  10082432,
				SR:  34310,
				USP: 7696442,
				SSP: 9339710,
				RAM: [][2]uint32{{10082422, 8}, {10082423, 49}, {10082424, 181}, {10082425, 225}, {10082426, 162}, {10082427, 36}, {10082428, 131}, {10082429, 249}, {4477756, 251}, {4477757, 168}, {10082430, 157}, {10082431, 81}},
				Cycles: 18,
			},
		},
		{
			name: "2000 BTST D6, (d16, A2) 0d2a",
			init: cpuState{
				D:   [8]uint32{2144677726, 1549021567, 843524671, 2162785550, 1763786776, 202084892, 956781815, 4059650179},
				A:   [7]uint32{3267741218, 1269448265, 726883173, 4002392491, 641146437, 4102403277, 1275631743},
				PC:  13582278,
				SR:  34073,
				USP: 2763820,
				SSP: 14414588,
				RAM: [][2]uint32{{13582274, 13}, {13582275, 42}, {13582276, 36}, {13582277, 135}, {13582278, 152}, {13582279, 82}, {5472236, 88}, {5472237, 36}, {13582280, 217}, {13582281, 200}},
			},
			want: cpuState{
				D:   [8]uint32{2144677726, 1549021567, 843524671, 2162785550, 1763786776, 202084892, 956781815, 4059650179},
				A:   [7]uint32{3267741218, 1269448265, 726883173, 4002392491, 641146437, 4102403277, 1275631743},
				PC:  13582282,
				SR:  34077,
				USP: 2763820,
				SSP: 14414588,
				RAM: [][2]uint32{{13582274, 13}, {13582275, 42}, {13582276, 36}, {13582277, 135}, {13582278, 152}, {13582279, 82}, {5472236, 88}, {5472237, 36}, {13582280, 217}, {13582281, 200}},
				Cycles: 12,
			},
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			runTest(t, tt.init, tt.want)
		})
	}
}

func TestBCHG(t *testing.T) {
	tests := []struct {
		name string
		init cpuState
		want cpuState
	}{
		{
			name: "000 BCHG D0, -(A1) 0161",
			init: cpuState{
				D:   [8]uint32{1013149314, 2079776874, 2628387610, 3093919338, 1212947663, 1187050979, 2884907894, 163182458},
				A:   [7]uint32{763790839, 270851509, 1306710656, 466495534, 3398793354, 2050585928, 1615290214},
				PC:  6160198,
				SR:  42511,
				USP: 4945676,
				SSP: 13782418,
				RAM: [][2]uint32{{6160194, 1}, {6160195, 97}, {6160196, 70}, {6160197, 131}, {2416052, 153}, {2416053, 62}, {6160198, 105}, {6160199, 97}},
			},
			want: cpuState{
				D:   [8]uint32{1013149314, 2079776874, 2628387610, 3093919338, 1212947663, 1187050979, 2884907894, 163182458},
				A:   [7]uint32{763790839, 270851508, 1306710656, 466495534, 3398793354, 2050585928, 1615290214},
				PC:  6160200,
				SR:  42511,
				USP: 4945676,
				SSP: 13782418,
				RAM: [][2]uint32{{6160194, 1}, {6160195, 97}, {6160196, 70}, {6160197, 131}, {2416052, 157}, {2416053, 62}, {6160198, 105}, {6160199, 97}},
				Cycles: 14,
			},
		},
		{
			name: "500 BCHG D4, (d8, A7, Xn) 0977",
			init: cpuState{
				D:   [8]uint32{808236924, 2328309522, 4006163875, 813290448, 3202836185, 3045121448, 2733207687, 439060841},
				A:   [7]uint32{3249204345, 377314703, 1803743614, 2711889006, 1584701408, 2674474966, 1377407662},
				PC:  4908434,
				SR:  9490,
				USP: 13813410,
				SSP: 8220026,
				RAM: [][2]uint32{{4908430, 9}, {4908431, 119}, {4908432, 159}, {4908433, 22}, {4908434, 192}, {4908435, 171}, {16435998, 31}, {16435999, 184}, {4908436, 146}, {4908437, 29}},
			},
			want: cpuState{
				D:   [8]uint32{808236924, 2328309522, 4006163875, 813290448, 3202836185, 3045121448, 2733207687, 439060841},
				A:   [7]uint32{3249204345, 377314703, 1803743614, 2711889006, 1584701408, 2674474966, 1377407662},
				PC:  4908438,
				SR:  9494,
				USP: 13813410,
				SSP: 8220026,
				RAM: [][2]uint32{{4908430, 9}, {4908431, 119}, {4908432, 159}, {4908433, 22}, {4908434, 192}, {4908435, 171}, {16435998, 31}, {16435999, 186}, {4908436, 146}, {4908437, 29}},
				Cycles: 18,
			},
		},
		{
			name: "1000 BCHG D3, (A7)+ 075f",
			init: cpuState{
				D:   [8]uint32{700922681, 3874535131, 2486380144, 2677974426, 2416354843, 841056110, 3440692154, 1034725783},
				A:   [7]uint32{2260597330, 2608247250, 2840774464, 447053563, 1403604809, 1819632202, 3566286970},
				PC:  5080404,
				SR:  42760,
				USP: 14551000,
				SSP: 6495492,
				RAM: [][2]uint32{{5080400, 7}, {5080401, 95}, {5080402, 130}, {5080403, 49}, {6495492, 135}, {6495493, 89}, {5080404, 153}, {5080405, 125}},
			},
			want: cpuState{
				D:   [8]uint32{700922681, 3874535131, 2486380144, 2677974426, 2416354843, 841056110, 3440692154, 1034725783},
				A:   [7]uint32{2260597330, 2608247250, 2840774464, 447053563, 1403604809, 1819632202, 3566286970},
				PC:  5080406,
				SR:  42760,
				USP: 14551000,
				SSP: 6495494,
				RAM: [][2]uint32{{5080400, 7}, {5080401, 95}, {5080402, 130}, {5080403, 49}, {6495492, 131}, {6495493, 89}, {5080404, 153}, {5080405, 125}},
				Cycles: 12,
			},
		},
		{
			name: "1500 BCHG D7, (A0)+ 0f58",
			init: cpuState{
				D:   [8]uint32{568928637, 268764371, 3946055634, 985097300, 2885766718, 398433026, 3441768164, 419646532},
				A:   [7]uint32{4236316965, 638460657, 1012734653, 1336325808, 3664237971, 2725359060, 2672044719},
				PC:  4203456,
				SR:  42523,
				USP: 4626072,
				SSP: 7408210,
				RAM: [][2]uint32{{4203452, 15}, {4203453, 88}, {4203454, 244}, {4203455, 204}, {8458532, 240}, {8458533, 196}, {4203456, 84}, {4203457, 13}},
			},
			want: cpuState{
				D:   [8]uint32{568928637, 268764371, 3946055634, 985097300, 2885766718, 398433026, 3441768164, 419646532},
				A:   [7]uint32{4236316966, 638460657, 1012734653, 1336325808, 3664237971, 2725359060, 2672044719},
				PC:  4203458,
				SR:  42527,
				USP: 4626072,
				SSP: 7408210,
				RAM: [][2]uint32{{4203452, 15}, {4203453, 88}, {4203454, 244}, {4203455, 204}, {8458532, 240}, {8458533, 212}, {4203456, 84}, {4203457, 13}},
				Cycles: 12,
			},
		},
		{
			name: "2000 BCHG D3, (d8, A4, Xn) 0774",
			init: cpuState{
				D:   [8]uint32{2807613405, 2204341079, 1160617903, 752021421, 3736986899, 2490761581, 1133764129, 2494292840},
				A:   [7]uint32{4284152489, 1169147781, 2398293448, 2640753339, 3775910918, 4276569533, 2957227910},
				PC:  8989368,
				SR:  42763,
				USP: 1538348,
				SSP: 16454714,
				RAM: [][2]uint32{{8989364, 7}, {8989365, 116}, {8989366, 248}, {8989367, 174}, {8989368, 66}, {8989369, 129}, {714734, 58}, {714735, 215}, {8989370, 19}, {8989371, 111}},
			},
			want: cpuState{
				D:   [8]uint32{2807613405, 2204341079, 1160617903, 752021421, 3736986899, 2490761581, 1133764129, 2494292840},
				A:   [7]uint32{4284152489, 1169147781, 2398293448, 2640753339, 3775910918, 4276569533, 2957227910},
				PC:  8989372,
				SR:  42763,
				USP: 1538348,
				SSP: 16454714,
				RAM: [][2]uint32{{8989364, 7}, {8989365, 116}, {8989366, 248}, {8989367, 174}, {8989368, 66}, {8989369, 129}, {714734, 26}, {714735, 215}, {8989370, 19}, {8989371, 111}},
				Cycles: 18,
			},
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			runTest(t, tt.init, tt.want)
		})
	}
}

func TestBCLR(t *testing.T) {
	tests := []struct {
		name string
		init cpuState
		want cpuState
	}{
		{
			name: "000 BCLR D3, (A1)+ 0799",
			init: cpuState{
				D:   [8]uint32{1846080252, 3858376002, 3133883255, 3257995552, 3880319835, 3116722484, 751787456, 1185313225},
				A:   [7]uint32{1206991703, 847336910, 963978686, 1089955452, 734752850, 2028511002, 3551725147},
				PC:  10354148,
				SR:  8991,
				USP: 11588256,
				SSP: 8161968,
				RAM: [][2]uint32{{10354144, 7}, {10354145, 153}, {10354146, 230}, {10354147, 183}, {8476110, 249}, {8476111, 195}, {10354148, 61}, {10354149, 223}},
			},
			want: cpuState{
				D:   [8]uint32{1846080252, 3858376002, 3133883255, 3257995552, 3880319835, 3116722484, 751787456, 1185313225},
				A:   [7]uint32{1206991703, 847336911, 963978686, 1089955452, 734752850, 2028511002, 3551725147},
				PC:  10354150,
				SR:  8987,
				USP: 11588256,
				SSP: 8161968,
				RAM: [][2]uint32{{10354144, 7}, {10354145, 153}, {10354146, 230}, {10354147, 183}, {8476110, 248}, {8476111, 195}, {10354148, 61}, {10354149, 223}},
				Cycles: 12,
			},
		},
		{
			name: "500 BCLR D1, (A4) 0394",
			init: cpuState{
				D:   [8]uint32{924779116, 1354656134, 965052202, 3749788472, 433086925, 4090553060, 2311661032, 3534978670},
				A:   [7]uint32{1195758221, 2224595464, 1780513037, 2875327096, 2305747679, 950932814, 3971200180},
				PC:  6280390,
				SR:  40964,
				USP: 8385408,
				SSP: 13286398,
				RAM: [][2]uint32{{6280386, 3}, {6280387, 148}, {6280388, 144}, {6280389, 247}, {7269086, 85}, {7269087, 175}, {6280390, 242}, {6280391, 81}},
			},
			want: cpuState{
				D:   [8]uint32{924779116, 1354656134, 965052202, 3749788472, 433086925, 4090553060, 2311661032, 3534978670},
				A:   [7]uint32{1195758221, 2224595464, 1780513037, 2875327096, 2305747679, 950932814, 3971200180},
				PC:  6280392,
				SR:  40964,
				USP: 8385408,
				SSP: 13286398,
				RAM: [][2]uint32{{6280386, 3}, {6280387, 148}, {6280388, 144}, {6280389, 247}, {7269086, 85}, {7269087, 175}, {6280390, 242}, {6280391, 81}},
				Cycles: 12,
			},
		},
		{
			name: "1000 BCLR D6, -(A4) 0da4",
			init: cpuState{
				D:   [8]uint32{3988890443, 4241621861, 3659192164, 2270234259, 4099245621, 3746345387, 1685194632, 1565095028},
				A:   [7]uint32{3452661473, 1289207620, 2938261569, 2753517800, 1101485566, 2096393758, 93126641},
				PC:  3689194,
				SR:  41755,
				USP: 16319248,
				SSP: 5975912,
				RAM: [][2]uint32{{3689190, 13}, {3689191, 164}, {3689192, 84}, {3689193, 19}, {10966524, 221}, {10966525, 147}, {3689194, 122}, {3689195, 184}},
			},
			want: cpuState{
				D:   [8]uint32{3988890443, 4241621861, 3659192164, 2270234259, 4099245621, 3746345387, 1685194632, 1565095028},
				A:   [7]uint32{3452661473, 1289207620, 2938261569, 2753517800, 1101485565, 2096393758, 93126641},
				PC:  3689196,
				SR:  41755,
				USP: 16319248,
				SSP: 5975912,
				RAM: [][2]uint32{{3689190, 13}, {3689191, 164}, {3689192, 84}, {3689193, 19}, {10966524, 221}, {10966525, 146}, {3689194, 122}, {3689195, 184}},
				Cycles: 14,
			},
		},
		{
			name: "1500 BCLR D3, D1 0781",
			init: cpuState{
				D:   [8]uint32{934098513, 2960310304, 2380172950, 3249224116, 3534651940, 2672829662, 3060292789, 884605936},
				A:   [7]uint32{1360848417, 2960323537, 877969487, 1438447333, 2982199743, 2341082898, 910399416},
				PC:  8810362,
				SR:  40981,
				USP: 4622832,
				SSP: 758064,
				RAM: [][2]uint32{{8810358, 7}, {8810359, 129}, {8810360, 50}, {8810361, 81}, {8810362, 62}, {8810363, 96}},
			},
			want: cpuState{
				D:   [8]uint32{934098513, 2959261728, 2380172950, 3249224116, 3534651940, 2672829662, 3060292789, 884605936},
				A:   [7]uint32{1360848417, 2960323537, 877969487, 1438447333, 2982199743, 2341082898, 910399416},
				PC:  8810364,
				SR:  40977,
				USP: 4622832,
				SSP: 758064,
				RAM: [][2]uint32{{8810358, 7}, {8810359, 129}, {8810360, 50}, {8810361, 81}, {8810362, 62}, {8810363, 96}},
				Cycles: 10,
			},
		},
		{
			name: "2000 BCLR D0, D3 0183",
			init: cpuState{
				D:   [8]uint32{3950236385, 1284323536, 2682172682, 84965637, 2550654512, 2988662606, 3447995926, 784319453},
				A:   [7]uint32{3182303238, 1404712716, 1636464048, 3718023400, 1957730729, 1323827978, 257669311},
				PC:  11791478,
				SR:  1822,
				USP: 14077216,
				SSP: 3375564,
				RAM: [][2]uint32{{11791474, 1}, {11791475, 131}, {11791476, 241}, {11791477, 193}, {11791478, 127}, {11791479, 213}},
			},
			want: cpuState{
				D:   [8]uint32{3950236385, 1284323536, 2682172682, 84965637, 2550654512, 2988662606, 3447995926, 784319453},
				A:   [7]uint32{3182303238, 1404712716, 1636464048, 3718023400, 1957730729, 1323827978, 257669311},
				PC:  11791480,
				SR:  1822,
				USP: 14077216,
				SSP: 3375564,
				RAM: [][2]uint32{{11791474, 1}, {11791475, 131}, {11791476, 241}, {11791477, 193}, {11791478, 127}, {11791479, 213}},
				Cycles: 8,
			},
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			runTest(t, tt.init, tt.want)
		})
	}
}

func TestBSET(t *testing.T) {
	tests := []struct {
		name string
		init cpuState
		want cpuState
	}{
		{
			name: "000 BSET D3, (d8, A0, Xn) 07f0",
			init: cpuState{
				D:   [8]uint32{2962023366, 2482580210, 932863521, 2287903684, 3334633517, 2329412468, 2679143256, 1584390542},
				A:   [7]uint32{1651939397, 2364158735, 25350572, 1616996840, 3261310075, 3663937633, 2461090985},
				PC:  16528236,
				SR:  41218,
				USP: 10269570,
				SSP: 15175068,
				RAM: [][2]uint32{{16528232, 7}, {16528233, 240}, {16528234, 138}, {16528235, 168}, {16528236, 120}, {16528237, 22}, {15544370, 62}, {15544371, 117}, {16528238, 117}, {16528239, 4}},
			},
			want: cpuState{
				D:   [8]uint32{2962023366, 2482580210, 932863521, 2287903684, 3334633517, 2329412468, 2679143256, 1584390542},
				A:   [7]uint32{1651939397, 2364158735, 25350572, 1616996840, 3261310075, 3663937633, 2461090985},
				PC:  16528240,
				SR:  41218,
				USP: 10269570,
				SSP: 15175068,
				RAM: [][2]uint32{{16528232, 7}, {16528233, 240}, {16528234, 138}, {16528235, 168}, {16528236, 120}, {16528237, 22}, {15544370, 62}, {15544371, 117}, {16528238, 117}, {16528239, 4}},
				Cycles: 18,
			},
		},
		{
			name: "500 BSET D5, (A6) 0bd6",
			init: cpuState{
				D:   [8]uint32{3508786574, 2028324343, 1718994470, 3603533751, 1011949408, 3394951692, 1031101671, 2037339957},
				A:   [7]uint32{2272579427, 2660662297, 2325576678, 2834564661, 2041274466, 2003781054, 3529586227},
				PC:  16220020,
				SR:  1030,
				USP: 3475638,
				SSP: 4615488,
				RAM: [][2]uint32{{16220016, 11}, {16220017, 214}, {16220018, 178}, {16220019, 173}, {6370866, 252}, {6370867, 3}, {16220020, 245}, {16220021, 225}},
			},
			want: cpuState{
				D:   [8]uint32{3508786574, 2028324343, 1718994470, 3603533751, 1011949408, 3394951692, 1031101671, 2037339957},
				A:   [7]uint32{2272579427, 2660662297, 2325576678, 2834564661, 2041274466, 2003781054, 3529586227},
				PC:  16220022,
				SR:  1030,
				USP: 3475638,
				SSP: 4615488,
				RAM: [][2]uint32{{16220016, 11}, {16220017, 214}, {16220018, 178}, {16220019, 173}, {6370866, 252}, {6370867, 19}, {16220020, 245}, {16220021, 225}},
				Cycles: 12,
			},
		},
		{
			name: "1000 BSET D7, (A0)+ 0fd8",
			init: cpuState{
				D:   [8]uint32{3167391406, 421253711, 4149799400, 924853522, 1483142837, 3007600275, 841190735, 1127532473},
				A:   [7]uint32{1238082436, 626831372, 2497479834, 580864854, 1311438457, 1511204449, 852062506},
				PC:  9578196,
				SR:  770,
				USP: 5823868,
				SSP: 1883288,
				RAM: [][2]uint32{{9578192, 15}, {9578193, 216}, {9578194, 74}, {9578195, 21}, {13345668, 125}, {13345669, 58}, {9578196, 89}, {9578197, 116}},
			},
			want: cpuState{
				D:   [8]uint32{3167391406, 421253711, 4149799400, 924853522, 1483142837, 3007600275, 841190735, 1127532473},
				A:   [7]uint32{1238082437, 626831372, 2497479834, 580864854, 1311438457, 1511204449, 852062506},
				PC:  9578198,
				SR:  774,
				USP: 5823868,
				SSP: 1883288,
				RAM: [][2]uint32{{9578192, 15}, {9578193, 216}, {9578194, 74}, {9578195, 21}, {13345668, 127}, {13345669, 58}, {9578196, 89}, {9578197, 116}},
				Cycles: 12,
			},
		},
		{
			name: "1500 BSET D5, (d16, A6) 0bee",
			init: cpuState{
				D:   [8]uint32{3894034595, 1716187724, 587748032, 443189928, 3440174616, 2708820926, 1902260627, 1216512883},
				A:   [7]uint32{191899901, 3007884842, 1151745322, 2937206102, 3102075939, 2370515136, 2579915195},
				PC:  4691250,
				SR:  265,
				USP: 32854,
				SSP: 7562170,
				RAM: [][2]uint32{{4691246, 11}, {4691247, 238}, {4691248, 198}, {4691249, 5}, {4691250, 78}, {4691251, 70}, {12986304, 105}, {12986305, 97}, {4691252, 113}, {4691253, 67}},
			},
			want: cpuState{
				D:   [8]uint32{3894034595, 1716187724, 587748032, 443189928, 3440174616, 2708820926, 1902260627, 1216512883},
				A:   [7]uint32{191899901, 3007884842, 1151745322, 2937206102, 3102075939, 2370515136, 2579915195},
				PC:  4691254,
				SR:  265,
				USP: 32854,
				SSP: 7562170,
				RAM: [][2]uint32{{4691246, 11}, {4691247, 238}, {4691248, 198}, {4691249, 5}, {4691250, 78}, {4691251, 70}, {12986304, 105}, {12986305, 97}, {4691252, 113}, {4691253, 67}},
				Cycles: 16,
			},
		},
		{
			name: "2000 BSET D6, -(A2) 0de2",
			init: cpuState{
				D:   [8]uint32{3853645441, 2423355303, 993505953, 4208043640, 3504157559, 1341606935, 1042090885, 2342835483},
				A:   [7]uint32{693600950, 2811164785, 3427399036, 4123042480, 1200479161, 619507113, 56235949},
				PC:  7771250,
				SR:  33038,
				USP: 12483292,
				SSP: 2351436,
				RAM: [][2]uint32{{7771246, 13}, {7771247, 226}, {7771248, 201}, {7771249, 174}, {4846970, 202}, {4846971, 17}, {7771250, 103}, {7771251, 108}},
			},
			want: cpuState{
				D:   [8]uint32{3853645441, 2423355303, 993505953, 4208043640, 3504157559, 1341606935, 1042090885, 2342835483},
				A:   [7]uint32{693600950, 2811164785, 3427399035, 4123042480, 1200479161, 619507113, 56235949},
				PC:  7771252,
				SR:  33038,
				USP: 12483292,
				SSP: 2351436,
				RAM: [][2]uint32{{7771246, 13}, {7771247, 226}, {7771248, 201}, {7771249, 174}, {4846970, 202}, {4846971, 49}, {7771250, 103}, {7771251, 108}},
				Cycles: 14,
			},
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			runTest(t, tt.init, tt.want)
		})
	}
}
