package m68k

import "testing"

func TestBcc(t *testing.T) {
	tests := []struct {
		name string
		init cpuState
		want cpuState
	}{
		{
			name: "000 Bcc -80 6db0",
			init: cpuState{
				D:   [8]uint32{4187024648, 62555484, 1022058849, 215382112, 2686217827, 2345266576, 1716992870, 3408817317},
				A:   [7]uint32{1006772389, 235843841, 2081029407, 3448030389, 1930618072, 3421174642, 1087767110},
				PC:  9316410,
				SR:  9481,
				USP: 12438560,
				SSP: 14980430,
				RAM: [][2]uint32{{9316406, 109}, {9316407, 176}, {9316408, 248}, {9316409, 173}, {9316328, 145}, {9316329, 127}, {9316330, 210}, {9316331, 60}},
			},
			want: cpuState{
				D:   [8]uint32{4187024648, 62555484, 1022058849, 215382112, 2686217827, 2345266576, 1716992870, 3408817317},
				A:   [7]uint32{1006772389, 235843841, 2081029407, 3448030389, 1930618072, 3421174642, 1087767110},
				PC:  9316332,
				SR:  9481,
				USP: 12438560,
				SSP: 14980430,
				RAM: [][2]uint32{{9316406, 109}, {9316407, 176}, {9316408, 248}, {9316409, 173}, {9316328, 145}, {9316329, 127}, {9316330, 210}, {9316331, 60}},
			},
		},
		{
			name: "500 Bcc -25 66e7",
			init: cpuState{
				D:   [8]uint32{946910288, 1149199056, 2243949998, 762037226, 3660233864, 3279667752, 211456927, 1288790653},
				A:   [7]uint32{331766020, 1234250103, 3945669382, 1747682109, 3213995765, 2044992904, 206250018},
				PC:  12199514,
				SR:  42242,
				USP: 13415392,
				SSP: 11506512,
				RAM: [][2]uint32{{12199510, 102}, {12199511, 231}, {12199512, 48}, {12199513, 18}, {12, 118}, {13, 32}, {14, 252}, {15, 20}, {2161684, 45}, {2161685, 123}, {2161686, 158}, {2161687, 196}},
			},
			want: cpuState{
				D:      [8]uint32{946910288, 1149199056, 2243949998, 762037226, 3660233864, 3279667752, 211456927, 1288790653},
				A:      [7]uint32{331766020, 1234250103, 3945669382, 1747682109, 3213995765, 2044992904, 206250018},
				PC:     1981873176,
				SR:     9474,
				USP:    13415392,
				SSP:    11506498,
				RAM:    [][2]uint32{{12199510, 102}, {12199511, 231}, {12199512, 48}, {12199513, 18}, {11506510, 38}, {11506511, 88}, {11506506, 165}, {11506507, 2}, {11506508, 0}, {11506509, 186}, {11506504, 102}, {11506505, 231}, {11506502, 38}, {11506503, 63}, {11506498, 102}, {11506499, 246}, {11506500, 0}, {11506501, 186}, {12, 118}, {13, 32}, {14, 252}, {15, 20}, {2161684, 45}, {2161685, 123}, {2161686, 158}, {2161687, 196}},
				Halted: true,
			},
		},
		{
			name: "1000 Bcc -8 6bf8",
			init: cpuState{
				D:   [8]uint32{3723674433, 1521102939, 4050976276, 2751836167, 2283804069, 2662701467, 3164523502, 2459363185},
				A:   [7]uint32{627539118, 269339213, 3776729705, 2285550687, 2829062498, 2447324423, 1596934858},
				PC:  1156788,
				SR:  34318,
				USP: 1217426,
				SSP: 478508,
				RAM: [][2]uint32{{1156784, 107}, {1156785, 248}, {1156786, 198}, {1156787, 62}, {1156778, 15}, {1156779, 227}, {1156780, 233}, {1156781, 227}},
			},
			want: cpuState{
				D:   [8]uint32{3723674433, 1521102939, 4050976276, 2751836167, 2283804069, 2662701467, 3164523502, 2459363185},
				A:   [7]uint32{627539118, 269339213, 3776729705, 2285550687, 2829062498, 2447324423, 1596934858},
				PC:  1156782,
				SR:  34318,
				USP: 1217426,
				SSP: 478508,
				RAM: [][2]uint32{{1156784, 107}, {1156785, 248}, {1156786, 198}, {1156787, 62}, {1156778, 15}, {1156779, 227}, {1156780, 233}, {1156781, 227}},
			},
		},
		{
			name: "1500 Bcc 125 6d7d",
			init: cpuState{
				D:   [8]uint32{1334265018, 2406764584, 1396111089, 4198729912, 2751986744, 1056578558, 1345792454, 501024912},
				A:   [7]uint32{4293212581, 3397045342, 3786352084, 1844000818, 482154803, 183418349, 621448310},
				PC:  15955510,
				SR:  42000,
				USP: 13366732,
				SSP: 5120436,
				RAM: [][2]uint32{{15955506, 109}, {15955507, 125}, {15955508, 253}, {15955509, 30}, {15955510, 143}, {15955511, 218}},
			},
			want: cpuState{
				D:   [8]uint32{1334265018, 2406764584, 1396111089, 4198729912, 2751986744, 1056578558, 1345792454, 501024912},
				A:   [7]uint32{4293212581, 3397045342, 3786352084, 1844000818, 482154803, 183418349, 621448310},
				PC:  15955512,
				SR:  42000,
				USP: 13366732,
				SSP: 5120436,
				RAM: [][2]uint32{{15955506, 109}, {15955507, 125}, {15955508, 253}, {15955509, 30}, {15955510, 143}, {15955511, 218}},
			},
		},
		{
			name: "2000 Bcc -16 66f0",
			init: cpuState{
				D:   [8]uint32{3543292952, 3436214379, 2125969800, 3227155865, 1962353159, 1321805480, 3349587513, 1692349050},
				A:   [7]uint32{3122347684, 3119164496, 3247917102, 1786881534, 4112948791, 458839725, 3934356523},
				PC:  7359356,
				SR:  42011,
				USP: 5143550,
				SSP: 3381716,
				RAM: [][2]uint32{{7359352, 102}, {7359353, 240}, {7359354, 84}, {7359355, 174}, {7359338, 165}, {7359339, 95}, {7359340, 177}, {7359341, 10}},
			},
			want: cpuState{
				D:   [8]uint32{3543292952, 3436214379, 2125969800, 3227155865, 1962353159, 1321805480, 3349587513, 1692349050},
				A:   [7]uint32{3122347684, 3119164496, 3247917102, 1786881534, 4112948791, 458839725, 3934356523},
				PC:  7359342,
				SR:  42011,
				USP: 5143550,
				SSP: 3381716,
				RAM: [][2]uint32{{7359352, 102}, {7359353, 240}, {7359354, 84}, {7359355, 174}, {7359338, 165}, {7359339, 95}, {7359340, 177}, {7359341, 10}},
			},
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			runTest(t, tt.init, tt.want)
		})
	}
}

func TestBSR(t *testing.T) {
	tests := []struct {
		name string
		init cpuState
		want cpuState
	}{
		{
			name: "000 BSR -20 61ec",
			init: cpuState{
				D:   [8]uint32{282065017, 450776920, 4155908866, 846884965, 61560607, 2160627461, 2290516079, 3350402472},
				A:   [7]uint32{609322689, 1107540203, 1702551578, 2455661732, 994947294, 1134626817, 1803885892},
				PC:  5074288,
				SR:  40988,
				USP: 13118394,
				SSP: 7423392,
				RAM: [][2]uint32{{5074284, 97}, {5074285, 236}, {5074286, 139}, {5074287, 162}, {5074266, 201}, {5074267, 45}, {5074268, 101}, {5074269, 168}},
			},
			want: cpuState{
				D:   [8]uint32{282065017, 450776920, 4155908866, 846884965, 61560607, 2160627461, 2290516079, 3350402472},
				A:   [7]uint32{609322689, 1107540203, 1702551578, 2455661732, 994947294, 1134626817, 1803885892},
				PC:  5074270,
				SR:  40988,
				USP: 13118394,
				SSP: 7423388,
				RAM: [][2]uint32{{5074284, 97}, {5074285, 236}, {5074286, 139}, {5074287, 162}, {7423388, 0}, {7423389, 77}, {7423390, 109}, {7423391, 110}, {5074266, 201}, {5074267, 45}, {5074268, 101}, {5074269, 168}},
			},
		},
		{
			name: "500 BSR -106 6196",
			init: cpuState{
				D:   [8]uint32{1877854762, 3434415810, 1260049976, 239366656, 2579800176, 96212638, 694958620, 1041556033},
				A:   [7]uint32{1358712227, 3780186112, 850184818, 988076609, 559431923, 3496645377, 1850818023},
				PC:  13124450,
				SR:  542,
				USP: 3579692,
				SSP: 2740244,
				RAM: [][2]uint32{{13124446, 97}, {13124447, 150}, {13124448, 87}, {13124449, 238}, {13124342, 225}, {13124343, 17}, {13124344, 31}, {13124345, 148}},
			},
			want: cpuState{
				D:   [8]uint32{1877854762, 3434415810, 1260049976, 239366656, 2579800176, 96212638, 694958620, 1041556033},
				A:   [7]uint32{1358712227, 3780186112, 850184818, 988076609, 559431923, 3496645377, 1850818023},
				PC:  13124346,
				SR:  542,
				USP: 3579688,
				SSP: 2740244,
				RAM: [][2]uint32{{13124446, 97}, {13124447, 150}, {13124448, 87}, {13124449, 238}, {3579688, 0}, {3579689, 200}, {3579690, 67}, {3579691, 96}, {13124342, 225}, {13124343, 17}, {13124344, 31}, {13124345, 148}},
			},
		},
		{
			name: "1000 BSR 31 611f",
			init: cpuState{
				D:   [8]uint32{1109380244, 1522467750, 4026450329, 260704155, 1958536903, 4092963074, 3578845900, 4235999725},
				A:   [7]uint32{1124561082, 849824773, 119010643, 40899830, 248388312, 2695529245, 409442983},
				PC:  9120614,
				SR:  9497,
				USP: 12022808,
				SSP: 7095424,
				RAM: [][2]uint32{{9120610, 97}, {9120611, 31}, {9120612, 9}, {9120613, 129}, {12, 21}, {13, 178}, {14, 207}, {15, 140}, {11718540, 90}, {11718541, 178}, {11718542, 28}, {11718543, 115}},
			},
			want: cpuState{
				D:      [8]uint32{1109380244, 1522467750, 4026450329, 260704155, 1958536903, 4092963074, 3578845900, 4235999725},
				A:      [7]uint32{1124561082, 849824773, 119010643, 40899830, 248388312, 2695529245, 409442983},
				PC:     364040080,
				SR:     9497,
				USP:    12022808,
				SSP:    7095406,
				RAM:    [][2]uint32{{9120610, 97}, {9120611, 31}, {9120612, 9}, {9120613, 129}, {7095420, 0}, {7095421, 139}, {7095422, 43}, {7095423, 100}, {7095418, 43}, {7095419, 131}, {7095414, 37}, {7095415, 25}, {7095416, 0}, {7095417, 139}, {7095412, 97}, {7095413, 31}, {7095410, 43}, {7095411, 131}, {7095406, 97}, {7095407, 22}, {7095408, 0}, {7095409, 139}, {12, 21}, {13, 178}, {14, 207}, {15, 140}, {11718540, 90}, {11718541, 178}, {11718542, 28}, {11718543, 115}},
				Halted: true,
			},
		},
		{
			name: "1500 BSR 45 612d",
			init: cpuState{
				D:   [8]uint32{53481911, 677601385, 2631769522, 4095665240, 4225311380, 1658776787, 1179989423, 1588662221},
				A:   [7]uint32{1636470783, 3831338466, 3652180990, 3696933587, 1563135856, 1029852308, 3225059393},
				PC:  11384068,
				SR:  33038,
				USP: 6214238,
				SSP: 16513836,
				RAM: [][2]uint32{{11384064, 97}, {11384065, 45}, {11384066, 228}, {11384067, 234}, {12, 105}, {13, 86}, {14, 247}, {15, 178}, {5699506, 218}, {5699507, 123}, {5699508, 24}, {5699509, 213}},
			},
			want: cpuState{
				D:      [8]uint32{53481911, 677601385, 2631769522, 4095665240, 4225311380, 1658776787, 1179989423, 1588662221},
				A:      [7]uint32{1636470783, 3831338466, 3652180990, 3696933587, 1563135856, 1029852308, 3225059393},
				PC:     1767307190,
				SR:     8462,
				USP:    6214234,
				SSP:    16513822,
				RAM:    [][2]uint32{{11384064, 97}, {11384065, 45}, {11384066, 228}, {11384067, 234}, {6214234, 0}, {6214235, 173}, {6214236, 181}, {6214237, 2}, {16513834, 181}, {16513835, 47}, {16513830, 129}, {16513831, 14}, {16513832, 0}, {16513833, 173}, {16513828, 97}, {16513829, 45}, {16513826, 181}, {16513827, 47}, {16513822, 97}, {16513823, 50}, {16513824, 0}, {16513825, 173}, {12, 105}, {13, 86}, {14, 247}, {15, 178}, {5699506, 218}, {5699507, 123}, {5699508, 24}, {5699509, 213}},
				Halted: true,
			},
		},
		{
			name: "2000 BSR 82 6152",
			init: cpuState{
				D:   [8]uint32{2227477461, 3311121812, 216051618, 3557750288, 238013731, 659853091, 1340984986, 228057643},
				A:   [7]uint32{213300034, 177849925, 802464502, 1946744831, 1687113901, 3159475630, 840520611},
				PC:  11332438,
				SR:  264,
				USP: 3849762,
				SSP: 15130976,
				RAM: [][2]uint32{{11332434, 97}, {11332435, 82}, {11332436, 234}, {11332437, 91}, {11332518, 99}, {11332519, 97}, {11332520, 11}, {11332521, 165}},
			},
			want: cpuState{
				D:   [8]uint32{2227477461, 3311121812, 216051618, 3557750288, 238013731, 659853091, 1340984986, 228057643},
				A:   [7]uint32{213300034, 177849925, 802464502, 1946744831, 1687113901, 3159475630, 840520611},
				PC:  11332522,
				SR:  264,
				USP: 3849758,
				SSP: 15130976,
				RAM: [][2]uint32{{11332434, 97}, {11332435, 82}, {11332436, 234}, {11332437, 91}, {3849758, 0}, {3849759, 172}, {3849760, 235}, {3849761, 84}, {11332518, 99}, {11332519, 97}, {11332520, 11}, {11332521, 165}},
			},
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			runTest(t, tt.init, tt.want)
		})
	}
}

func TestDBcc(t *testing.T) {
	tests := []struct {
		name string
		init cpuState
		want cpuState
	}{
		{
			name: "000 DBcc D7, # 5ecf",
			init: cpuState{
				D:   [8]uint32{2995527499, 185128935, 238788573, 245135735, 1352650698, 2996237592, 2907838549, 3496842426},
				A:   [7]uint32{3531171237, 1021743264, 2324599395, 1455201896, 126441683, 1136191243, 2260655387},
				PC:  1931310,
				SR:  41218,
				USP: 12957490,
				SSP: 16025126,
				RAM: [][2]uint32{{1931306, 94}, {1931307, 207}, {1931308, 151}, {1931309, 253}, {12, 210}, {13, 156}, {14, 184}, {15, 38}, {10270758, 16}, {10270759, 109}, {10270760, 166}, {10270761, 189}},
			},
			want: cpuState{
				D:      [8]uint32{2995527499, 185128935, 238788573, 245135735, 1352650698, 2996237592, 2907838549, 3496842426},
				A:      [7]uint32{3531171237, 1021743264, 2324599395, 1455201896, 126441683, 1136191243, 2260655387},
				PC:     3533486122,
				SR:     8450,
				USP:    12957490,
				SSP:    16025112,
				RAM:    [][2]uint32{{1931306, 94}, {1931307, 207}, {1931308, 151}, {1931309, 253}, {16025124, 120}, {16025125, 46}, {16025120, 161}, {16025121, 2}, {16025122, 0}, {16025123, 29}, {16025118, 94}, {16025119, 207}, {16025116, 16}, {16025117, 41}, {16025112, 94}, {16025113, 214}, {16025114, 0}, {16025115, 29}, {12, 210}, {13, 156}, {14, 184}, {15, 38}, {10270758, 16}, {10270759, 109}, {10270760, 166}, {10270761, 189}},
				Halted: true,
			},
		},
		{
			name: "500 DBcc D3, # 58cb",
			init: cpuState{
				D:   [8]uint32{1645034692, 4168574144, 3147622305, 2099341536, 1757386005, 2038162240, 1603267217, 3885830916},
				A:   [7]uint32{3222673329, 2494480326, 720805755, 791682558, 789638103, 4106760158, 472147609},
				PC:  3598084,
				SR:  42257,
				USP: 2376884,
				SSP: 15246992,
				RAM: [][2]uint32{{3598080, 88}, {3598081, 203}, {3598082, 13}, {3598083, 164}, {3598084, 183}, {3598085, 13}, {3598086, 21}, {3598087, 173}},
			},
			want: cpuState{
				D:   [8]uint32{1645034692, 4168574144, 3147622305, 2099341536, 1757386005, 2038162240, 1603267217, 3885830916},
				A:   [7]uint32{3222673329, 2494480326, 720805755, 791682558, 789638103, 4106760158, 472147609},
				PC:  3598088,
				SR:  42257,
				USP: 2376884,
				SSP: 15246992,
				RAM: [][2]uint32{{3598080, 88}, {3598081, 203}, {3598082, 13}, {3598083, 164}, {3598084, 183}, {3598085, 13}, {3598086, 21}, {3598087, 173}},
			},
		},
		{
			name: "1000 DBcc D0, # 59c8",
			init: cpuState{
				D:   [8]uint32{3828964938, 467316427, 104272372, 4104947443, 3508510621, 2375457041, 1292477162, 3699257015},
				A:   [7]uint32{3255399493, 620571100, 1707133965, 306082289, 2035564272, 2396524369, 2750955643},
				PC:  2925350,
				SR:  32780,
				USP: 10386092,
				SSP: 8737614,
				RAM: [][2]uint32{{2925346, 89}, {2925347, 200}, {2925348, 76}, {2925349, 201}, {12, 151}, {13, 206}, {14, 87}, {15, 214}, {13522902, 250}, {13522903, 233}, {13522904, 3}, {13522905, 249}},
			},
			want: cpuState{
				D:      [8]uint32{3828964938, 467316427, 104272372, 4104947443, 3508510621, 2375457041, 1292477162, 3699257015},
				A:      [7]uint32{3255399493, 620571100, 1707133965, 306082289, 2035564272, 2396524369, 2750955643},
				PC:     2546882522,
				SR:     8204,
				USP:    10386092,
				SSP:    8737600,
				RAM:    [][2]uint32{{2925346, 89}, {2925347, 200}, {2925348, 76}, {2925349, 201}, {8737612, 163}, {8737613, 38}, {8737608, 128}, {8737609, 12}, {8737610, 0}, {8737611, 44}, {8737606, 89}, {8737607, 200}, {8737604, 239}, {8737605, 237}, {8737600, 89}, {8737601, 210}, {8737602, 0}, {8737603, 44}, {12, 151}, {13, 206}, {14, 87}, {15, 214}, {13522902, 250}, {13522903, 233}, {13522904, 3}, {13522905, 249}},
				Halted: true,
			},
		},
		{
			name: "1500 DBcc D5, # 5fcd",
			init: cpuState{
				D:   [8]uint32{929369192, 1646652344, 126751312, 1251774708, 2498665192, 546990681, 332622137, 4033118572},
				A:   [7]uint32{1111807569, 1542720971, 3921158509, 4121314672, 2351138183, 3713321398, 143846596},
				PC:  15681446,
				SR:  275,
				USP: 8581674,
				SSP: 9325262,
				RAM: [][2]uint32{{15681442, 95}, {15681443, 205}, {15681444, 186}, {15681445, 18}, {15681446, 52}, {15681447, 220}, {15681448, 221}, {15681449, 208}},
			},
			want: cpuState{
				D:   [8]uint32{929369192, 1646652344, 126751312, 1251774708, 2498665192, 546990681, 332622137, 4033118572},
				A:   [7]uint32{1111807569, 1542720971, 3921158509, 4121314672, 2351138183, 3713321398, 143846596},
				PC:  15681450,
				SR:  275,
				USP: 8581674,
				SSP: 9325262,
				RAM: [][2]uint32{{15681442, 95}, {15681443, 205}, {15681444, 186}, {15681445, 18}, {15681446, 52}, {15681447, 220}, {15681448, 221}, {15681449, 208}},
			},
		},
		{
			name: "2000 DBcc D1, # 52c9",
			init: cpuState{
				D:   [8]uint32{2880410386, 2147284519, 3868746026, 2939782942, 1509575812, 3840860719, 3909752407, 2590188555},
				A:   [7]uint32{3538370527, 3687915870, 2362378934, 3877705240, 3839976232, 1329757070, 3122372940},
				PC:  6080736,
				SR:  41735,
				USP: 6050416,
				SSP: 9111226,
				RAM: [][2]uint32{{6080732, 82}, {6080733, 201}, {6080734, 35}, {6080735, 214}, {6089908, 128}, {6089909, 95}, {6089910, 22}, {6089911, 116}},
			},
			want: cpuState{
				D:   [8]uint32{2880410386, 2147284518, 3868746026, 2939782942, 1509575812, 3840860719, 3909752407, 2590188555},
				A:   [7]uint32{3538370527, 3687915870, 2362378934, 3877705240, 3839976232, 1329757070, 3122372940},
				PC:  6089912,
				SR:  41735,
				USP: 6050416,
				SSP: 9111226,
				RAM: [][2]uint32{{6080732, 82}, {6080733, 201}, {6080734, 35}, {6080735, 214}, {6089908, 128}, {6089909, 95}, {6089910, 22}, {6089911, 116}},
			},
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			runTest(t, tt.init, tt.want)
		})
	}
}

func TestJMP(t *testing.T) {
	tests := []struct {
		name string
		init cpuState
		want cpuState
	}{
		{
			name: "000 JMP (d16, A5) 4eed",
			init: cpuState{
				D:   [8]uint32{745889030, 751113020, 2468056411, 91420713, 1920717159, 183156110, 2387904918, 2689567734},
				A:   [7]uint32{942442625, 1780494319, 1538762649, 2721591091, 4025689279, 1757057227, 1932686148},
				PC:  2785168,
				SR:  9231,
				USP: 11061346,
				SSP: 12702386,
				RAM: [][2]uint32{{2785164, 78}, {2785165, 237}, {2785166, 94}, {2785167, 109}, {12250936, 182}, {12250937, 80}, {12250938, 109}, {12250939, 128}},
			},
			want: cpuState{
				D:   [8]uint32{745889030, 751113020, 2468056411, 91420713, 1920717159, 183156110, 2387904918, 2689567734},
				A:   [7]uint32{942442625, 1780494319, 1538762649, 2721591091, 4025689279, 1757057227, 1932686148},
				PC:  1757081404,
				SR:  9231,
				USP: 11061346,
				SSP: 12702386,
				RAM: [][2]uint32{{2785164, 78}, {2785165, 237}, {2785166, 94}, {2785167, 109}, {12250936, 182}, {12250937, 80}, {12250938, 109}, {12250939, 128}},
			},
		},
		{
			name: "500 JMP (d8, A6, Xn) 4ef6",
			init: cpuState{
				D:   [8]uint32{3272571536, 1336971600, 1189992508, 3497766230, 1202087446, 1853155348, 2432691630, 2711388394},
				A:   [7]uint32{2077230665, 62160572, 1749834634, 3286666578, 182905516, 596114910, 1839588409},
				PC:  2033070,
				SR:  32791,
				USP: 10509952,
				SSP: 8169246,
				RAM: [][2]uint32{{2033066, 78}, {2033067, 246}, {2033068, 22}, {2033069, 195}, {10843468, 217}, {10843469, 192}, {10843470, 27}, {10843471, 209}},
			},
			want: cpuState{
				D:   [8]uint32{3272571536, 1336971600, 1189992508, 3497766230, 1202087446, 1853155348, 2432691630, 2711388394},
				A:   [7]uint32{2077230665, 62160572, 1749834634, 3286666578, 182905516, 596114910, 1839588409},
				PC:  1839560016,
				SR:  32791,
				USP: 10509952,
				SSP: 8169246,
				RAM: [][2]uint32{{2033066, 78}, {2033067, 246}, {2033068, 22}, {2033069, 195}, {10843468, 217}, {10843469, 192}, {10843470, 27}, {10843471, 209}},
			},
		},
		{
			name: "1000 JMP (A5) 4ed5",
			init: cpuState{
				D:   [8]uint32{760543373, 3574582601, 2061523406, 3166992743, 2178936080, 3797177112, 897087586, 606564495},
				A:   [7]uint32{2926725022, 1987931151, 627560349, 3933496302, 3289922527, 223094650, 2878435780},
				PC:  8145484,
				SR:  42771,
				USP: 6107784,
				SSP: 13208250,
				RAM: [][2]uint32{{8145480, 78}, {8145481, 213}, {8145482, 226}, {8145483, 131}, {4990842, 15}, {4990843, 38}, {4990844, 17}, {4990845, 19}},
			},
			want: cpuState{
				D:   [8]uint32{760543373, 3574582601, 2061523406, 3166992743, 2178936080, 3797177112, 897087586, 606564495},
				A:   [7]uint32{2926725022, 1987931151, 627560349, 3933496302, 3289922527, 223094650, 2878435780},
				PC:  223094654,
				SR:  42771,
				USP: 6107784,
				SSP: 13208250,
				RAM: [][2]uint32{{8145480, 78}, {8145481, 213}, {8145482, 226}, {8145483, 131}, {4990842, 15}, {4990843, 38}, {4990844, 17}, {4990845, 19}},
			},
		},
		{
			name: "1500 JMP (A7) 4ed7",
			init: cpuState{
				D:   [8]uint32{1012461551, 843842533, 1172216144, 3266381777, 3227195030, 742001114, 2456044769, 3898212410},
				A:   [7]uint32{828055125, 4124604081, 2999074623, 945305302, 3805355977, 1254410542, 1940611252},
				PC:  5832584,
				SR:  8968,
				USP: 4477770,
				SSP: 2782500,
				RAM: [][2]uint32{{5832580, 78}, {5832581, 215}, {5832582, 84}, {5832583, 179}, {2782500, 18}, {2782501, 171}, {2782502, 1}, {2782503, 233}},
			},
			want: cpuState{
				D:   [8]uint32{1012461551, 843842533, 1172216144, 3266381777, 3227195030, 742001114, 2456044769, 3898212410},
				A:   [7]uint32{828055125, 4124604081, 2999074623, 945305302, 3805355977, 1254410542, 1940611252},
				PC:  2782504,
				SR:  8968,
				USP: 4477770,
				SSP: 2782500,
				RAM: [][2]uint32{{5832580, 78}, {5832581, 215}, {5832582, 84}, {5832583, 179}, {2782500, 18}, {2782501, 171}, {2782502, 1}, {2782503, 233}},
			},
		},
		{
			name: "2000 JMP (d16, A5) 4eed",
			init: cpuState{
				D:   [8]uint32{1155252600, 774649694, 3340398229, 4252194510, 971016656, 3542734191, 2337693389, 4037864046},
				A:   [7]uint32{1588553176, 2566817684, 472276968, 4009903322, 2768960548, 3341013647, 3339811079},
				PC:  14792884,
				SR:  1796,
				USP: 12915786,
				SSP: 1888142,
				RAM: [][2]uint32{{14792880, 78}, {14792881, 237}, {14792882, 140}, {14792883, 250}, {12, 57}, {13, 60}, {14, 155}, {15, 178}, {3972018, 159}, {3972019, 247}, {3972020, 144}, {3972021, 78}},
			},
			want: cpuState{
				D:      [8]uint32{1155252600, 774649694, 3340398229, 4252194510, 971016656, 3542734191, 2337693389, 4037864046},
				A:      [7]uint32{1588553176, 2566817684, 472276968, 4009903322, 2768960548, 3341013647, 3339811079},
				PC:     960273334,
				SR:     9988,
				USP:    12915786,
				SSP:    1888128,
				RAM:    [][2]uint32{{14792880, 78}, {14792881, 237}, {14792882, 140}, {14792883, 250}, {1888140, 184}, {1888141, 178}, {1888136, 7}, {1888137, 4}, {1888138, 0}, {1888139, 225}, {1888134, 78}, {1888135, 237}, {1888132, 95}, {1888133, 137}, {1888128, 78}, {1888129, 242}, {1888130, 199}, {1888131, 35}, {12, 57}, {13, 60}, {14, 155}, {15, 178}, {3972018, 159}, {3972019, 247}, {3972020, 144}, {3972021, 78}},
				Halted: true,
			},
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			runTest(t, tt.init, tt.want)
		})
	}
}

func TestJSR(t *testing.T) {
	tests := []struct {
		name string
		init cpuState
		want cpuState
	}{
		{
			name: "000 JSR (d8, A1, Xn) 4eb1",
			init: cpuState{
				D:   [8]uint32{1600294685, 3112433752, 1669031062, 34427579, 1785411382, 1773508002, 2759635301, 758111668},
				A:   [7]uint32{1754547812, 1256436806, 438165672, 2420389637, 2509340694, 1870930497, 372462759},
				PC:  7570002,
				SR:  8982,
				USP: 14355986,
				SSP: 12815352,
				RAM: [][2]uint32{{7569998, 78}, {7569999, 177}, {7570000, 140}, {7570001, 244}, {7862942, 83}, {7862943, 93}, {7862944, 87}, {7862945, 133}},
			},
			want: cpuState{
				D:   [8]uint32{1600294685, 3112433752, 1669031062, 34427579, 1785411382, 1773508002, 2759635301, 758111668},
				A:   [7]uint32{1754547812, 1256436806, 438165672, 2420389637, 2509340694, 1870930497, 372462759},
				PC:  3010984610,
				SR:  8982,
				USP: 14355986,
				SSP: 12815348,
				RAM: [][2]uint32{{7569998, 78}, {7569999, 177}, {7570000, 140}, {7570001, 244}, {7862942, 83}, {7862943, 93}, {12815348, 0}, {12815349, 115}, {12815350, 130}, {12815351, 82}, {7862944, 87}, {7862945, 133}},
			},
		},
		{
			name: "500 JSR (d16, A6) 4eae",
			init: cpuState{
				D:   [8]uint32{4170057760, 3048064759, 4159830885, 802967404, 2501638666, 3518291317, 258346968, 1925559210},
				A:   [7]uint32{3454652510, 4080744271, 1094589163, 1206408458, 626715477, 794874404, 2160408342},
				PC:  15845638,
				SR:  1818,
				USP: 12836776,
				SSP: 13946840,
				RAM: [][2]uint32{{15845634, 78}, {15845635, 174}, {15845636, 33}, {15845637, 48}, {12933190, 129}, {12933191, 105}, {12933192, 39}, {12933193, 165}},
			},
			want: cpuState{
				D:   [8]uint32{4170057760, 3048064759, 4159830885, 802967404, 2501638666, 3518291317, 258346968, 1925559210},
				A:   [7]uint32{3454652510, 4080744271, 1094589163, 1206408458, 626715477, 794874404, 2160408342},
				PC:  2160416842,
				SR:  1818,
				USP: 12836772,
				SSP: 13946840,
				RAM: [][2]uint32{{15845634, 78}, {15845635, 174}, {15845636, 33}, {15845637, 48}, {12933190, 129}, {12933191, 105}, {12836772, 0}, {12836773, 241}, {12836774, 201}, {12836775, 6}, {12933192, 39}, {12933193, 165}},
			},
		},
		{
			name: "1000 JSR (A3) 4e93",
			init: cpuState{
				D:   [8]uint32{3390383189, 3548604776, 1962784537, 626072408, 1376102999, 3141586279, 3361195775, 701006708},
				A:   [7]uint32{4251518801, 1492861572, 841385586, 2676393951, 2886469397, 3073328202, 650965347},
				PC:  16384000,
				SR:  9500,
				USP: 8655398,
				SSP: 11677748,
				RAM: [][2]uint32{{16383996, 78}, {16383997, 147}, {16383998, 255}, {16383999, 123}, {12, 99}, {13, 30}, {14, 188}, {15, 196}, {2014404, 79}, {2014405, 109}, {2014406, 41}, {2014407, 134}},
			},
			want: cpuState{
				D:      [8]uint32{3390383189, 3548604776, 1962784537, 626072408, 1376102999, 3141586279, 3361195775, 701006708},
				A:      [7]uint32{4251518801, 1492861572, 841385586, 2676393951, 2886469397, 3073328202, 650965347},
				PC:     1662958792,
				SR:     9500,
				USP:    8655398,
				SSP:    11677734,
				RAM:    [][2]uint32{{16383996, 78}, {16383997, 147}, {16383998, 255}, {16383999, 123}, {11677746, 255}, {11677747, 254}, {11677742, 37}, {11677743, 28}, {11677744, 0}, {11677745, 249}, {11677740, 78}, {11677741, 147}, {11677738, 135}, {11677739, 223}, {11677734, 78}, {11677735, 150}, {11677736, 159}, {11677737, 134}, {12, 99}, {13, 30}, {14, 188}, {15, 196}, {2014404, 79}, {2014405, 109}, {2014406, 41}, {2014407, 134}},
				Halted: true,
			},
		},
		{
			name: "1500 JSR (d8, A2, Xn) 4eb2",
			init: cpuState{
				D:   [8]uint32{409797424, 2669198804, 514792184, 2600671081, 1564663472, 1655659042, 2081094196, 3464513787},
				A:   [7]uint32{3053473403, 894802690, 108960797, 2296543056, 4272828092, 1873103683, 1748237444},
				PC:  3798614,
				SR:  8733,
				USP: 16484310,
				SSP: 6167888,
				RAM: [][2]uint32{{3798610, 78}, {3798611, 178}, {3798612, 86}, {3798613, 128}, {12, 112}, {13, 164}, {14, 147}, {15, 168}, {10785704, 55}, {10785705, 6}, {10785706, 12}, {10785707, 38}},
			},
			want: cpuState{
				D:      [8]uint32{409797424, 2669198804, 514792184, 2600671081, 1564663472, 1655659042, 2081094196, 3464513787},
				A:      [7]uint32{3053473403, 894802690, 108960797, 2296543056, 4272828092, 1873103683, 1748237444},
				PC:     1889833900,
				SR:     8733,
				USP:    16484310,
				SSP:    6167874,
				RAM:    [][2]uint32{{3798610, 78}, {3798611, 178}, {3798612, 86}, {3798613, 128}, {6167886, 246}, {6167887, 86}, {6167882, 34}, {6167883, 29}, {6167884, 0}, {6167885, 57}, {6167880, 78}, {6167881, 178}, {6167878, 245}, {6167879, 191}, {6167874, 78}, {6167875, 182}, {6167876, 6}, {6167877, 126}, {12, 112}, {13, 164}, {14, 147}, {15, 168}, {10785704, 55}, {10785705, 6}, {10785706, 12}, {10785707, 38}},
				Halted: true,
			},
		},
		{
			name: "2000 JSR (d16, A3) 4eab",
			init: cpuState{
				D:   [8]uint32{3586360724, 3879548271, 1126100928, 3364551242, 278618610, 1967958598, 4214867775, 3618881800},
				A:   [7]uint32{3905959790, 634339621, 1566442007, 2782971118, 1808052656, 1723049753, 2646940198},
				PC:  3683006,
				SR:  9501,
				USP: 4779146,
				SSP: 8945124,
				RAM: [][2]uint32{{3683002, 78}, {3683003, 171}, {3683004, 73}, {3683005, 74}, {14749240, 4}, {14749241, 206}, {14749242, 244}, {14749243, 200}},
			},
			want: cpuState{
				D:   [8]uint32{3586360724, 3879548271, 1126100928, 3364551242, 278618610, 1967958598, 4214867775, 3618881800},
				A:   [7]uint32{3905959790, 634339621, 1566442007, 2782971118, 1808052656, 1723049753, 2646940198},
				PC:  2782989884,
				SR:  9501,
				USP: 4779146,
				SSP: 8945120,
				RAM: [][2]uint32{{3683002, 78}, {3683003, 171}, {3683004, 73}, {3683005, 74}, {14749240, 4}, {14749241, 206}, {8945120, 0}, {8945121, 56}, {8945122, 50}, {8945123, 190}, {14749242, 244}, {14749243, 200}},
			},
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			runTest(t, tt.init, tt.want)
		})
	}
}

func TestRTS(t *testing.T) {
	tests := []struct {
		name string
		init cpuState
		want cpuState
	}{
		{
			name: "000 RTS 4e75",
			init: cpuState{
				D:   [8]uint32{1695586892, 2581458317, 3573081930, 3842343658, 3273788867, 3861101892, 497534621, 1062265147},
				A:   [7]uint32{680415265, 3338935803, 612009649, 3170529000, 1229391163, 1605743300, 3812752736},
				PC:  16646948,
				SR:  42001,
				USP: 2170122,
				SSP: 2454062,
				RAM: [][2]uint32{{16646944, 78}, {16646945, 117}, {16646946, 198}, {16646947, 249}, {2454062, 77}, {2454063, 34}, {2454064, 244}, {2454065, 132}, {2290820, 102}, {2290821, 59}, {2290822, 0}, {2290823, 183}},
			},
			want: cpuState{
				D:   [8]uint32{1695586892, 2581458317, 3573081930, 3842343658, 3273788867, 3861101892, 497534621, 1062265147},
				A:   [7]uint32{680415265, 3338935803, 612009649, 3170529000, 1229391163, 1605743300, 3812752736},
				PC:  1294136456,
				SR:  42001,
				USP: 2170122,
				SSP: 2454066,
				RAM: [][2]uint32{{16646944, 78}, {16646945, 117}, {16646946, 198}, {16646947, 249}, {2454062, 77}, {2454063, 34}, {2454064, 244}, {2454065, 132}, {2290820, 102}, {2290821, 59}, {2290822, 0}, {2290823, 183}},
			},
		},
		{
			name: "500 RTS 4e75",
			init: cpuState{
				D:   [8]uint32{629022600, 663757219, 2316567015, 61143864, 3665773000, 2914065297, 1948540536, 1775383208},
				A:   [7]uint32{1493197715, 857111238, 1016204030, 675911558, 2695398306, 3168255150, 3566256598},
				PC:  5335628,
				SR:  34309,
				USP: 9377998,
				SSP: 7581754,
				RAM: [][2]uint32{{5335624, 78}, {5335625, 117}, {5335626, 173}, {5335627, 62}, {9377998, 147}, {9377999, 166}, {9378000, 223}, {9378001, 184}, {10936248, 68}, {10936249, 8}, {10936250, 176}, {10936251, 210}},
			},
			want: cpuState{
				D:   [8]uint32{629022600, 663757219, 2316567015, 61143864, 3665773000, 2914065297, 1948540536, 1775383208},
				A:   [7]uint32{1493197715, 857111238, 1016204030, 675911558, 2695398306, 3168255150, 3566256598},
				PC:  2477187004,
				SR:  34309,
				USP: 9378002,
				SSP: 7581754,
				RAM: [][2]uint32{{5335624, 78}, {5335625, 117}, {5335626, 173}, {5335627, 62}, {9377998, 147}, {9377999, 166}, {9378000, 223}, {9378001, 184}, {10936248, 68}, {10936249, 8}, {10936250, 176}, {10936251, 210}},
			},
		},
		{
			name: "1000 RTS 4e75",
			init: cpuState{
				D:   [8]uint32{1136298507, 2309943268, 2479884004, 1433412065, 3481035468, 989636940, 2244900975, 1463489540},
				A:   [7]uint32{747737787, 1124982305, 1238221132, 1287989246, 2034727518, 1826599331, 681943309},
				PC:  11803834,
				SR:  33285,
				USP: 1134946,
				SSP: 4934874,
				RAM: [][2]uint32{{11803830, 78}, {11803831, 117}, {11803832, 11}, {11803833, 82}, {1134946, 219}, {1134947, 21}, {1134948, 183}, {1134949, 48}, {1423152, 91}, {1423153, 178}, {1423154, 174}, {1423155, 129}},
			},
			want: cpuState{
				D:   [8]uint32{1136298507, 2309943268, 2479884004, 1433412065, 3481035468, 989636940, 2244900975, 1463489540},
				A:   [7]uint32{747737787, 1124982305, 1238221132, 1287989246, 2034727518, 1826599331, 681943309},
				PC:  3675633460,
				SR:  33285,
				USP: 1134950,
				SSP: 4934874,
				RAM: [][2]uint32{{11803830, 78}, {11803831, 117}, {11803832, 11}, {11803833, 82}, {1134946, 219}, {1134947, 21}, {1134948, 183}, {1134949, 48}, {1423152, 91}, {1423153, 178}, {1423154, 174}, {1423155, 129}},
			},
		},
		{
			name: "1500 RTS 4e75",
			init: cpuState{
				D:   [8]uint32{1733660104, 3063328298, 1422780063, 261130745, 3760094743, 222816045, 3986566305, 2545228888},
				A:   [7]uint32{1026467905, 2337815119, 402480534, 4069753170, 1474969818, 2480941049, 2661582173},
				PC:  15553060,
				SR:  41745,
				USP: 11392022,
				SSP: 2861738,
				RAM: [][2]uint32{{15553056, 78}, {15553057, 117}, {15553058, 195}, {15553059, 145}, {2861738, 5}, {2861739, 212}, {2861740, 73}, {2861741, 23}, {12, 116}, {13, 188}, {14, 107}, {15, 86}, {12348246, 79}, {12348247, 29}, {12348248, 146}, {12348249, 154}},
			},
			want: cpuState{
				D:      [8]uint32{1733660104, 3063328298, 1422780063, 261130745, 3760094743, 222816045, 3986566305, 2545228888},
				A:      [7]uint32{1026467905, 2337815119, 402480534, 4069753170, 1474969818, 2480941049, 2661582173},
				PC:     1958505306,
				SR:     8977,
				USP:    11392022,
				SSP:    2861728,
				RAM:    [][2]uint32{{15553056, 78}, {15553057, 117}, {15553058, 195}, {15553059, 145}, {2861738, 0}, {2861739, 237}, {2861740, 82}, {2861741, 34}, {2861736, 163}, {2861737, 17}, {2861734, 78}, {2861735, 117}, {2861732, 73}, {2861733, 23}, {2861728, 78}, {2861729, 118}, {2861730, 5}, {2861731, 212}, {12, 116}, {13, 188}, {14, 107}, {15, 86}, {12348246, 79}, {12348247, 29}, {12348248, 146}, {12348249, 154}},
				Halted: true,
			},
		},
		{
			name: "2000 RTS 4e75",
			init: cpuState{
				D:   [8]uint32{1484962938, 734951143, 1685375636, 3933067055, 1797407892, 2550938166, 3138527250, 1604251153},
				A:   [7]uint32{155407640, 1576724980, 1064857638, 205689168, 3544357790, 3385808559, 3402424142},
				PC:  14952584,
				SR:  42001,
				USP: 11386566,
				SSP: 5246450,
				RAM: [][2]uint32{{14952580, 78}, {14952581, 117}, {14952582, 66}, {14952583, 149}, {5246450, 31}, {5246451, 111}, {5246452, 203}, {5246453, 39}, {12, 54}, {13, 0}, {14, 42}, {15, 142}, {10894, 41}, {10895, 243}, {10896, 87}, {10897, 229}},
			},
			want: cpuState{
				D:      [8]uint32{1484962938, 734951143, 1685375636, 3933067055, 1797407892, 2550938166, 3138527250, 1604251153},
				A:      [7]uint32{155407640, 1576724980, 1064857638, 205689168, 3544357790, 3385808559, 3402424142},
				PC:     905980562,
				SR:     9233,
				USP:    11386566,
				SSP:    5246440,
				RAM:    [][2]uint32{{14952580, 78}, {14952581, 117}, {14952582, 66}, {14952583, 149}, {5246450, 0}, {5246451, 228}, {5246452, 40}, {5246453, 134}, {5246448, 164}, {5246449, 17}, {5246446, 78}, {5246447, 117}, {5246444, 203}, {5246445, 39}, {5246440, 78}, {5246441, 118}, {5246442, 31}, {5246443, 111}, {12, 54}, {13, 0}, {14, 42}, {15, 142}, {10894, 41}, {10895, 243}, {10896, 87}, {10897, 229}},
				Halted: true,
			},
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			runTest(t, tt.init, tt.want)
		})
	}
}

func TestRTE(t *testing.T) {
	tests := []struct {
		name string
		init cpuState
		want cpuState
	}{
		{
			name: "000 RTE 4e73",
			init: cpuState{
				D:   [8]uint32{2007613906, 3706720267, 1617529897, 1478009187, 377458258, 3442747953, 961913447, 3748574403},
				A:   [7]uint32{764235716, 3367791794, 2831329522, 575282664, 1029867960, 2013620114, 1419658330},
				PC:  15605432,
				SR:  778,
				USP: 4721610,
				SSP: 10621156,
				RAM: [][2]uint32{{15605428, 78}, {15605429, 115}, {15605430, 36}, {15605431, 157}, {32, 219}, {33, 226}, {34, 207}, {35, 28}, {14864156, 152}, {14864157, 203}, {14864158, 51}, {14864159, 135}},
			},
			want: cpuState{
				D:   [8]uint32{2007613906, 3706720267, 1617529897, 1478009187, 377458258, 3442747953, 961913447, 3748574403},
				A:   [7]uint32{764235716, 3367791794, 2831329522, 575282664, 1029867960, 2013620114, 1419658330},
				PC:  3689074464,
				SR:  8970,
				USP: 4721610,
				SSP: 10621150,
				RAM: [][2]uint32{{15605428, 78}, {15605429, 115}, {15605430, 36}, {15605431, 157}, {10621154, 30}, {10621155, 180}, {10621150, 3}, {10621151, 10}, {10621152, 0}, {10621153, 238}, {32, 219}, {33, 226}, {34, 207}, {35, 28}, {14864156, 152}, {14864157, 203}, {14864158, 51}, {14864159, 135}},
			},
		},
		{
			name: "500 RTE 4e73",
			init: cpuState{
				D:   [8]uint32{2221414571, 3956737362, 208546185, 1935250726, 2195464630, 1600184883, 3076862501, 2256691781},
				A:   [7]uint32{3359723529, 2485194935, 3152046800, 1310161809, 140537743, 2777150788, 3816163366},
				PC:  5342352,
				SR:  1537,
				USP: 4548948,
				SSP: 7149932,
				RAM: [][2]uint32{{5342348, 78}, {5342349, 115}, {5342350, 99}, {5342351, 217}, {32, 237}, {33, 230}, {34, 24}, {35, 42}, {15079466, 38}, {15079467, 50}, {15079468, 166}, {15079469, 187}},
			},
			want: cpuState{
				D:   [8]uint32{2221414571, 3956737362, 208546185, 1935250726, 2195464630, 1600184883, 3076862501, 2256691781},
				A:   [7]uint32{3359723529, 2485194935, 3152046800, 1310161809, 140537743, 2777150788, 3816163366},
				PC:  3991279662,
				SR:  9729,
				USP: 4548948,
				SSP: 7149926,
				RAM: [][2]uint32{{5342348, 78}, {5342349, 115}, {5342350, 99}, {5342351, 217}, {7149930, 132}, {7149931, 140}, {7149926, 6}, {7149927, 1}, {7149928, 0}, {7149929, 81}, {32, 237}, {33, 230}, {34, 24}, {35, 42}, {15079466, 38}, {15079467, 50}, {15079468, 166}, {15079469, 187}},
			},
		},
		{
			name: "1000 RTE 4e73",
			init: cpuState{
				D:   [8]uint32{3125306166, 3663182540, 3909088783, 3439064563, 3393840139, 1841608469, 1729574606, 2144366555},
				A:   [7]uint32{1031113320, 3529800621, 1726419362, 854766565, 103190725, 2236147592, 251468944},
				PC:  14897532,
				SR:  34055,
				USP: 7371654,
				SSP: 6134854,
				RAM: [][2]uint32{{14897528, 78}, {14897529, 115}, {14897530, 248}, {14897531, 193}, {32, 70}, {33, 142}, {34, 157}, {35, 222}, {9346526, 126}, {9346527, 247}, {9346528, 77}, {9346529, 170}},
			},
			want: cpuState{
				D:   [8]uint32{3125306166, 3663182540, 3909088783, 3439064563, 3393840139, 1841608469, 1729574606, 2144366555},
				A:   [7]uint32{1031113320, 3529800621, 1726419362, 854766565, 103190725, 2236147592, 251468944},
				PC:  1183751650,
				SR:  9479,
				USP: 7371654,
				SSP: 6134848,
				RAM: [][2]uint32{{14897528, 78}, {14897529, 115}, {14897530, 248}, {14897531, 193}, {6134852, 81}, {6134853, 120}, {6134848, 133}, {6134849, 7}, {6134850, 0}, {6134851, 227}, {32, 70}, {33, 142}, {34, 157}, {35, 222}, {9346526, 126}, {9346527, 247}, {9346528, 77}, {9346529, 170}},
			},
		},
		{
			name: "1500 RTE 4e73",
			init: cpuState{
				D:   [8]uint32{3607803679, 3055269627, 1964017250, 1053076135, 975355677, 2124515498, 2742135060, 1551329094},
				A:   [7]uint32{2519875778, 1597478461, 2776226350, 1381059176, 1071457636, 3904205493, 749588320},
				PC:  6376388,
				SR:  33812,
				USP: 8689902,
				SSP: 1081272,
				RAM: [][2]uint32{{6376384, 78}, {6376385, 115}, {6376386, 95}, {6376387, 231}, {32, 39}, {33, 236}, {34, 64}, {35, 34}, {15482914, 88}, {15482915, 90}, {15482916, 134}, {15482917, 206}},
			},
			want: cpuState{
				D:   [8]uint32{3607803679, 3055269627, 1964017250, 1053076135, 975355677, 2124515498, 2742135060, 1551329094},
				A:   [7]uint32{2519875778, 1597478461, 2776226350, 1381059176, 1071457636, 3904205493, 749588320},
				PC:  669794342,
				SR:  9236,
				USP: 8689902,
				SSP: 1081266,
				RAM: [][2]uint32{{6376384, 78}, {6376385, 115}, {6376386, 95}, {6376387, 231}, {1081270, 75}, {1081271, 192}, {1081266, 132}, {1081267, 20}, {1081268, 0}, {1081269, 97}, {32, 39}, {33, 236}, {34, 64}, {35, 34}, {15482914, 88}, {15482915, 90}, {15482916, 134}, {15482917, 206}},
			},
		},
		{
			name: "2000 RTE 4e73",
			init: cpuState{
				D:   [8]uint32{4030082485, 1969029020, 1327468247, 3708766939, 2662732343, 1790579801, 184152359, 2051792554},
				A:   [7]uint32{859156867, 2798190248, 3218804450, 3993992914, 3820347400, 726703149, 1086380784},
				PC:  10007566,
				SR:  42000,
				USP: 14222822,
				SSP: 9022358,
				RAM: [][2]uint32{{10007562, 78}, {10007563, 115}, {10007564, 221}, {10007565, 59}, {9022358, 49}, {9022359, 65}, {9022360, 99}, {9022361, 24}, {9022362, 76}, {9022363, 85}, {12, 165}, {13, 216}, {14, 211}, {15, 162}, {14209954, 145}, {14209955, 193}, {14209956, 23}, {14209957, 116}},
			},
			want: cpuState{
				D:      [8]uint32{4030082485, 1969029020, 1327468247, 3708766939, 2662732343, 1790579801, 184152359, 2051792554},
				A:      [7]uint32{859156867, 2798190248, 3218804450, 3993992914, 3820347400, 726703149, 1086380784},
				PC:     2782450598,
				SR:     8449,
				USP:    14222822,
				SSP:    9022350,
				RAM:    [][2]uint32{{10007562, 78}, {10007563, 115}, {10007564, 221}, {10007565, 59}, {9022358, 33}, {9022359, 1}, {9022360, 0}, {9022361, 152}, {9022362, 180}, {9022363, 12}, {9022356, 78}, {9022357, 115}, {9022354, 76}, {9022355, 85}, {9022350, 78}, {9022351, 118}, {9022352, 99}, {9022353, 24}, {12, 165}, {13, 216}, {14, 211}, {15, 162}, {14209954, 145}, {14209955, 193}, {14209956, 23}, {14209957, 116}},
				Halted: true,
			},
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			runTest(t, tt.init, tt.want)
		})
	}
}

func TestRTR(t *testing.T) {
	tests := []struct {
		name string
		init cpuState
		want cpuState
	}{
		{
			name: "000 RTR 4e77",
			init: cpuState{
				D:   [8]uint32{887876628, 1649616181, 754186551, 1707996084, 3973797659, 2884949253, 3514544028, 4187563914},
				A:   [7]uint32{1766300949, 3299178609, 1105265473, 4189530864, 603131126, 273063191, 577203404},
				PC:  8390996,
				SR:  8469,
				USP: 10700098,
				SSP: 16670482,
				RAM: [][2]uint32{{8390992, 78}, {8390993, 119}, {8390994, 130}, {8390995, 52}, {16670482, 139}, {16670483, 123}, {16670484, 54}, {16670485, 195}, {16670486, 164}, {16670487, 202}, {12821706, 223}, {12821707, 101}, {12821708, 90}, {12821709, 61}},
			},
			want: cpuState{
				D:   [8]uint32{887876628, 1649616181, 754186551, 1707996084, 3973797659, 2884949253, 3514544028, 4187563914},
				A:   [7]uint32{1766300949, 3299178609, 1105265473, 4189530864, 603131126, 273063191, 577203404},
				PC:  918791374,
				SR:  8475,
				USP: 10700098,
				SSP: 16670488,
				RAM: [][2]uint32{{8390992, 78}, {8390993, 119}, {8390994, 130}, {8390995, 52}, {16670482, 139}, {16670483, 123}, {16670484, 54}, {16670485, 195}, {16670486, 164}, {16670487, 202}, {12821706, 223}, {12821707, 101}, {12821708, 90}, {12821709, 61}},
			},
		},
		{
			name: "500 RTR 4e77",
			init: cpuState{
				D:   [8]uint32{144575082, 3448157917, 3797288922, 2145681870, 1080874620, 657098350, 1343422443, 3314277674},
				A:   [7]uint32{2962757053, 3819692722, 1704417714, 680954669, 1046809227, 3333281498, 4193455201},
				PC:  7718938,
				SR:  531,
				USP: 6770832,
				SSP: 8647386,
				RAM: [][2]uint32{{7718934, 78}, {7718935, 119}, {7718936, 52}, {7718937, 28}, {6770832, 183}, {6770833, 51}, {6770834, 138}, {6770835, 143}, {6770836, 133}, {6770837, 114}, {9405810, 193}, {9405811, 57}, {9405812, 11}, {9405813, 27}},
			},
			want: cpuState{
				D:   [8]uint32{144575082, 3448157917, 3797288922, 2145681870, 1080874620, 657098350, 1343422443, 3314277674},
				A:   [7]uint32{2962757053, 3819692722, 1704417714, 680954669, 1046809227, 3333281498, 4193455201},
				PC:  2324661622,
				SR:  531,
				USP: 6770838,
				SSP: 8647386,
				RAM: [][2]uint32{{7718934, 78}, {7718935, 119}, {7718936, 52}, {7718937, 28}, {6770832, 183}, {6770833, 51}, {6770834, 138}, {6770835, 143}, {6770836, 133}, {6770837, 114}, {9405810, 193}, {9405811, 57}, {9405812, 11}, {9405813, 27}},
			},
		},
		{
			name: "1000 RTR 4e77",
			init: cpuState{
				D:   [8]uint32{1859631930, 3407559207, 3105071367, 1127178465, 2654869987, 223799096, 124335202, 875488641},
				A:   [7]uint32{2788112476, 2446366214, 285833550, 2051845484, 137069292, 1695483379, 1277784082},
				PC:  13793844,
				SR:  9993,
				USP: 2689244,
				SSP: 9850802,
				RAM: [][2]uint32{{13793840, 78}, {13793841, 119}, {13793842, 1}, {13793843, 226}, {9850802, 37}, {9850803, 212}, {9850804, 5}, {9850805, 254}, {9850806, 166}, {9850807, 81}, {12, 244}, {13, 186}, {14, 172}, {15, 24}, {12233752, 129}, {12233753, 189}, {12233754, 63}, {12233755, 209}},
			},
			want: cpuState{
				D:      [8]uint32{1859631930, 3407559207, 3105071367, 1127178465, 2654869987, 223799096, 124335202, 875488641},
				A:      [7]uint32{2788112476, 2446366214, 285833550, 2051845484, 137069292, 1695483379, 1277784082},
				PC:     4105874460,
				SR:     10004,
				USP:    2689244,
				SSP:    9850794,
				RAM:    [][2]uint32{{13793840, 78}, {13793841, 119}, {13793842, 1}, {13793843, 226}, {9850802, 39}, {9850803, 20}, {9850804, 0}, {9850805, 210}, {9850806, 122}, {9850807, 50}, {9850800, 78}, {9850801, 119}, {9850798, 166}, {9850799, 81}, {9850794, 78}, {9850795, 118}, {9850796, 5}, {9850797, 254}, {12, 244}, {13, 186}, {14, 172}, {15, 24}, {12233752, 129}, {12233753, 189}, {12233754, 63}, {12233755, 209}},
				Halted: true,
			},
		},
		{
			name: "1500 RTR 4e77",
			init: cpuState{
				D:   [8]uint32{1410329757, 1256322782, 2550808965, 1893424744, 3494168045, 315530377, 3520185035, 1030474678},
				A:   [7]uint32{2530038319, 2865297077, 489194764, 2372496306, 1409331026, 1108599352, 1432542654},
				PC:  883066,
				SR:  41989,
				USP: 4329160,
				SSP: 642558,
				RAM: [][2]uint32{{883062, 78}, {883063, 119}, {883064, 225}, {883065, 69}, {642558, 46}, {642559, 213}, {642560, 67}, {642561, 221}, {642562, 117}, {642563, 206}, {14513614, 131}, {14513615, 137}, {14513616, 125}, {14513617, 35}},
			},
			want: cpuState{
				D:   [8]uint32{1410329757, 1256322782, 2550808965, 1893424744, 3494168045, 315530377, 3520185035, 1030474678},
				A:   [7]uint32{2530038319, 2865297077, 489194764, 2372496306, 1409331026, 1108599352, 1432542654},
				PC:  1138587090,
				SR:  42005,
				USP: 4329160,
				SSP: 642564,
				RAM: [][2]uint32{{883062, 78}, {883063, 119}, {883064, 225}, {883065, 69}, {642558, 46}, {642559, 213}, {642560, 67}, {642561, 221}, {642562, 117}, {642563, 206}, {14513614, 131}, {14513615, 137}, {14513616, 125}, {14513617, 35}},
			},
		},
		{
			name: "2000 RTR 4e77",
			init: cpuState{
				D:   [8]uint32{517082379, 2043251229, 3181018212, 684885461, 118794459, 4077114755, 2793195966, 2895234059},
				A:   [7]uint32{2351101974, 3218097533, 2387558499, 2376605782, 98888236, 3651385614, 2559747564},
				PC:  4886308,
				SR:  33024,
				USP: 6164490,
				SSP: 12121582,
				RAM: [][2]uint32{{4886304, 78}, {4886305, 119}, {4886306, 214}, {4886307, 229}, {6164490, 232}, {6164491, 158}, {6164492, 231}, {6164493, 8}, {6164494, 235}, {6164495, 165}, {12, 234}, {13, 88}, {14, 180}, {15, 144}, {5813392, 246}, {5813393, 152}, {5813394, 8}, {5813395, 26}},
			},
			want: cpuState{
				D:      [8]uint32{517082379, 2043251229, 3181018212, 684885461, 118794459, 4077114755, 2793195966, 2895234059},
				A:      [7]uint32{2351101974, 3218097533, 2387558499, 2376605782, 98888236, 3651385614, 2559747564},
				PC:     3931681940,
				SR:     8478,
				USP:    6164496,
				SSP:    12121568,
				RAM:    [][2]uint32{{4886304, 78}, {4886305, 119}, {4886306, 214}, {4886307, 229}, {6164490, 232}, {6164491, 158}, {6164492, 231}, {6164493, 8}, {6164494, 235}, {6164495, 165}, {12121580, 143}, {12121581, 34}, {12121576, 129}, {12121577, 30}, {12121578, 0}, {12121579, 74}, {12121574, 78}, {12121575, 119}, {12121572, 235}, {12121573, 165}, {12121568, 78}, {12121569, 114}, {12121570, 231}, {12121571, 8}, {12, 234}, {13, 88}, {14, 180}, {15, 144}, {5813392, 246}, {5813393, 152}, {5813394, 8}, {5813395, 26}},
				Halted: true,
			},
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			runTest(t, tt.init, tt.want)
		})
	}
}

func TestScc(t *testing.T) {
	tests := []struct {
		name string
		init cpuState
		want cpuState
	}{
		{
			name: "000 Scc (d8, A1, Xn) 58f1",
			init: cpuState{
				D:   [8]uint32{2355410420, 4032925383, 1116994587, 452526939, 3750177789, 3265598523, 4284137692, 4249560757},
				A:   [7]uint32{2312394867, 2995638878, 1947851535, 3663692246, 3369873501, 3516882026, 3661281778},
				PC:  15971444,
				SR:  33805,
				USP: 678102,
				SSP: 6517542,
				RAM: [][2]uint32{{15971440, 88}, {15971441, 241}, {15971442, 249}, {15971443, 242}, {15971444, 52}, {15971445, 150}, {9972518, 162}, {9972519, 48}, {15971446, 97}, {15971447, 219}},
			},
			want: cpuState{
				D:   [8]uint32{2355410420, 4032925383, 1116994587, 452526939, 3750177789, 3265598523, 4284137692, 4249560757},
				A:   [7]uint32{2312394867, 2995638878, 1947851535, 3663692246, 3369873501, 3516882026, 3661281778},
				PC:  15971448,
				SR:  33805,
				USP: 678102,
				SSP: 6517542,
				RAM: [][2]uint32{{15971440, 88}, {15971441, 241}, {15971442, 249}, {15971443, 242}, {15971444, 52}, {15971445, 150}, {9972518, 255}, {9972519, 48}, {15971446, 97}, {15971447, 219}},
			},
		},
		{
			name: "500 Scc (A2)+ 53da",
			init: cpuState{
				D:   [8]uint32{756830727, 3474189924, 27870880, 4087934069, 1642956519, 2849526014, 1770610631, 583771518},
				A:   [7]uint32{4090549674, 1201571667, 4187244547, 660748505, 4137055656, 3328310769, 703678363},
				PC:  6567738,
				SR:  8979,
				USP: 12566382,
				SSP: 12587668,
				RAM: [][2]uint32{{6567734, 83}, {6567735, 218}, {6567736, 47}, {6567737, 103}, {9717762, 48}, {9717763, 100}, {6567738, 238}, {6567739, 106}},
			},
			want: cpuState{
				D:   [8]uint32{756830727, 3474189924, 27870880, 4087934069, 1642956519, 2849526014, 1770610631, 583771518},
				A:   [7]uint32{4090549674, 1201571667, 4187244548, 660748505, 4137055656, 3328310769, 703678363},
				PC:  6567740,
				SR:  8979,
				USP: 12566382,
				SSP: 12587668,
				RAM: [][2]uint32{{6567734, 83}, {6567735, 218}, {6567736, 47}, {6567737, 103}, {9717762, 48}, {9717763, 255}, {6567738, 238}, {6567739, 106}},
			},
		},
		{
			name: "1000 Scc D6 56c6",
			init: cpuState{
				D:   [8]uint32{859578878, 2609283649, 4109253489, 60381320, 1176919218, 3321657270, 1824658855, 736797058},
				A:   [7]uint32{3312185744, 1332514506, 495929451, 2890869657, 3527724635, 4257440176, 4143243589},
				PC:  7494810,
				SR:  526,
				USP: 6119358,
				SSP: 3665150,
				RAM: [][2]uint32{{7494806, 86}, {7494807, 198}, {7494808, 62}, {7494809, 218}, {7494810, 29}, {7494811, 191}},
			},
			want: cpuState{
				D:   [8]uint32{859578878, 2609283649, 4109253489, 60381320, 1176919218, 3321657270, 1824658688, 736797058},
				A:   [7]uint32{3312185744, 1332514506, 495929451, 2890869657, 3527724635, 4257440176, 4143243589},
				PC:  7494812,
				SR:  526,
				USP: 6119358,
				SSP: 3665150,
				RAM: [][2]uint32{{7494806, 86}, {7494807, 198}, {7494808, 62}, {7494809, 218}, {7494810, 29}, {7494811, 191}},
			},
		},
		{
			name: "1500 Scc (d8, A2, Xn) 57f2",
			init: cpuState{
				D:   [8]uint32{2695333102, 1039551154, 4149839335, 90698407, 606538325, 2073707135, 3769311755, 1101127661},
				A:   [7]uint32{3671173924, 105719026, 3654381435, 161518047, 1700732425, 2781694436, 3858224045},
				PC:  12312746,
				SR:  42773,
				USP: 13817546,
				SSP: 11774450,
				RAM: [][2]uint32{{12312742, 87}, {12312743, 242}, {12312744, 50}, {12312745, 15}, {12312746, 74}, {12312747, 0}, {13722160, 143}, {13722161, 75}, {12312748, 11}, {12312749, 239}},
			},
			want: cpuState{
				D:   [8]uint32{2695333102, 1039551154, 4149839335, 90698407, 606538325, 2073707135, 3769311755, 1101127661},
				A:   [7]uint32{3671173924, 105719026, 3654381435, 161518047, 1700732425, 2781694436, 3858224045},
				PC:  12312750,
				SR:  42773,
				USP: 13817546,
				SSP: 11774450,
				RAM: [][2]uint32{{12312742, 87}, {12312743, 242}, {12312744, 50}, {12312745, 15}, {12312746, 74}, {12312747, 0}, {13722160, 143}, {13722161, 255}, {12312748, 11}, {12312749, 239}},
			},
		},
		{
			name: "2000 Scc (A4)+ 58dc",
			init: cpuState{
				D:   [8]uint32{607168389, 2311596014, 1791809683, 669057654, 3333444563, 3654210747, 1344819866, 4190951188},
				A:   [7]uint32{3563534161, 3449412941, 2708121637, 442514785, 4042190009, 2190154832, 2334373654},
				PC:  11523162,
				SR:  8206,
				USP: 9113786,
				SSP: 6850744,
				RAM: [][2]uint32{{11523158, 88}, {11523159, 220}, {11523160, 106}, {11523161, 213}, {15658168, 166}, {15658169, 168}, {11523162, 229}, {11523163, 78}},
			},
			want: cpuState{
				D:   [8]uint32{607168389, 2311596014, 1791809683, 669057654, 3333444563, 3654210747, 1344819866, 4190951188},
				A:   [7]uint32{3563534161, 3449412941, 2708121637, 442514785, 4042190010, 2190154832, 2334373654},
				PC:  11523164,
				SR:  8206,
				USP: 9113786,
				SSP: 6850744,
				RAM: [][2]uint32{{11523158, 88}, {11523159, 220}, {11523160, 106}, {11523161, 213}, {15658168, 166}, {15658169, 0}, {11523162, 229}, {11523163, 78}},
			},
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			runTest(t, tt.init, tt.want)
		})
	}
}
