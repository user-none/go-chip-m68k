package m68k

import "testing"

func TestADD_B(t *testing.T) {
	tests := []struct {
		name string
		init cpuState
		want cpuState
	}{
		{
			name: "000 ADD.b D3, (d16, A2) d72a",
			init: cpuState{
				D:   [8]uint32{3941987954, 2037397763, 1314175244, 4090795974, 2050183426, 2809892028, 3716267913, 1805417682},
				A:   [7]uint32{1266352929, 2143940923, 3504068078, 2124816477, 3083094888, 697352590, 3202848776},
				PC:  3328950,
				SR:  32786,
				USP: 11763420,
				SSP: 1362616,
				RAM: [][2]uint32{{3328946, 215}, {3328947, 42}, {3328948, 156}, {3328949, 188}, {3328950, 119}, {3328951, 179}, {14381738, 109}, {14381739, 240}, {3328952, 27}, {3328953, 10}},
			},
			want: cpuState{
				D:   [8]uint32{3941987954, 2037397763, 1314175244, 4090795974, 2050183426, 2809892028, 3716267913, 1805417682},
				A:   [7]uint32{1266352929, 2143940923, 3504068078, 2124816477, 3083094888, 697352590, 3202848776},
				PC:  3328954,
				SR:  32785,
				USP: 11763420,
				SSP: 1362616,
				RAM: [][2]uint32{{3328946, 215}, {3328947, 42}, {3328948, 156}, {3328949, 188}, {3328950, 119}, {3328951, 179}, {14381738, 51}, {14381739, 240}, {3328952, 27}, {3328953, 10}},
				Cycles: 16,
			},
		},
		{
			name: "500 ADD.b 4, (d16, A1) 5829",
			init: cpuState{
				D:   [8]uint32{4251128074, 455529726, 755189540, 2491783780, 3583604615, 2176046989, 917357912, 3352027911},
				A:   [7]uint32{1683649949, 1926168676, 457561248, 1170001361, 1233739421, 2968312619, 3732093732},
				PC:  3309678,
				SR:  41746,
				USP: 11113114,
				SSP: 4554102,
				RAM: [][2]uint32{{3309674, 88}, {3309675, 41}, {3309676, 125}, {3309677, 174}, {3309678, 169}, {3309679, 93}, {13598226, 27}, {13598227, 80}, {3309680, 38}, {3309681, 7}},
			},
			want: cpuState{
				D:   [8]uint32{4251128074, 455529726, 755189540, 2491783780, 3583604615, 2176046989, 917357912, 3352027911},
				A:   [7]uint32{1683649949, 1926168676, 457561248, 1170001361, 1233739421, 2968312619, 3732093732},
				PC:  3309682,
				SR:  41728,
				USP: 11113114,
				SSP: 4554102,
				RAM: [][2]uint32{{3309674, 88}, {3309675, 41}, {3309676, 125}, {3309677, 174}, {3309678, 169}, {3309679, 93}, {13598226, 31}, {13598227, 80}, {3309680, 38}, {3309681, 7}},
				Cycles: 16,
			},
		},
		{
			name: "1000 ADD.b -(A6), D4 d826",
			init: cpuState{
				D:   [8]uint32{2491314503, 2886725744, 1636192530, 1489192880, 1915967032, 4124964415, 468187637, 879686914},
				A:   [7]uint32{3301505292, 2852997734, 1339865613, 1811225264, 689451768, 868534933, 2880048985},
				PC:  1791162,
				SR:  42772,
				USP: 11881152,
				SSP: 3733090,
				RAM: [][2]uint32{{1791158, 216}, {1791159, 38}, {1791160, 64}, {1791161, 155}, {11145048, 79}, {11145049, 163}, {1791162, 77}, {1791163, 60}},
			},
			want: cpuState{
				D:   [8]uint32{2491314503, 2886725744, 1636192530, 1489192880, 1915967111, 4124964415, 468187637, 879686914},
				A:   [7]uint32{3301505292, 2852997734, 1339865613, 1811225264, 689451768, 868534933, 2880048984},
				PC:  1791164,
				SR:  42762,
				USP: 11881152,
				SSP: 3733090,
				RAM: [][2]uint32{{1791158, 216}, {1791159, 38}, {1791160, 64}, {1791161, 155}, {11145048, 79}, {11145049, 163}, {1791162, 77}, {1791163, 60}},
				Cycles: 10,
			},
		},
		{
			name: "1500 ADD.b D4, (d16, A5) d92d",
			init: cpuState{
				D:   [8]uint32{851131566, 852556397, 2031642083, 2745379360, 3358653554, 1551149807, 3333695399, 330177788},
				A:   [7]uint32{3755431392, 234785205, 4287286157, 2799525855, 4272636270, 1314989274, 600361140},
				PC:  5875692,
				SR:  1038,
				USP: 13776306,
				SSP: 4968940,
				RAM: [][2]uint32{{5875688, 217}, {5875689, 45}, {5875690, 29}, {5875691, 186}, {5875692, 38}, {5875693, 50}, {6374036, 162}, {6374037, 83}, {5875694, 136}, {5875695, 215}},
			},
			want: cpuState{
				D:   [8]uint32{851131566, 852556397, 2031642083, 2745379360, 3358653554, 1551149807, 3333695399, 330177788},
				A:   [7]uint32{3755431392, 234785205, 4287286157, 2799525855, 4272636270, 1314989274, 600361140},
				PC:  5875696,
				SR:  1041,
				USP: 13776306,
				SSP: 4968940,
				RAM: [][2]uint32{{5875688, 217}, {5875689, 45}, {5875690, 29}, {5875691, 186}, {5875692, 38}, {5875693, 50}, {6374036, 20}, {6374037, 83}, {5875694, 136}, {5875695, 215}},
				Cycles: 16,
			},
		},
		{
			name: "2000 ADD.b #, (A4) 0614",
			init: cpuState{
				D:   [8]uint32{1621186025, 2306956336, 2366813438, 1989103356, 3738049034, 1597603231, 1236431036, 1101930610},
				A:   [7]uint32{1061232993, 2256534653, 671275449, 4132154555, 2746374070, 2476035424, 2287647861},
				PC:  548322,
				SR:  33305,
				USP: 8705170,
				SSP: 16685368,
				RAM: [][2]uint32{{548318, 6}, {548319, 20}, {548320, 177}, {548321, 215}, {548322, 113}, {548323, 167}, {11687862, 218}, {11687863, 110}, {548324, 144}, {548325, 255}},
			},
			want: cpuState{
				D:   [8]uint32{1621186025, 2306956336, 2366813438, 1989103356, 3738049034, 1597603231, 1236431036, 1101930610},
				A:   [7]uint32{1061232993, 2256534653, 671275449, 4132154555, 2746374070, 2476035424, 2287647861},
				PC:  548326,
				SR:  33305,
				USP: 8705170,
				SSP: 16685368,
				RAM: [][2]uint32{{548318, 6}, {548319, 20}, {548320, 177}, {548321, 215}, {548322, 113}, {548323, 167}, {11687862, 177}, {11687863, 110}, {548324, 144}, {548325, 255}},
				Cycles: 16,
			},
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			runTest(t, tt.init, tt.want)
		})
	}
}

func TestADD_W(t *testing.T) {
	tests := []struct {
		name string
		init cpuState
		want cpuState
	}{
		{
			name: "000 ADD.w 1, D4 5244",
			init: cpuState{
				D:   [8]uint32{430770453, 2802729725, 2039179676, 3255779504, 2270003432, 2019469770, 479886605, 491753643},
				A:   [7]uint32{1909699865, 1739743613, 1028431515, 1544913034, 526166023, 4208995751, 1362253081},
				PC:  7435090,
				SR:  41752,
				USP: 796552,
				SSP: 16059558,
				RAM: [][2]uint32{{7435086, 82}, {7435087, 68}, {7435088, 63}, {7435089, 70}, {7435090, 230}, {7435091, 94}},
			},
			want: cpuState{
				D:   [8]uint32{430770453, 2802729725, 2039179676, 3255779504, 2270003433, 2019469770, 479886605, 491753643},
				A:   [7]uint32{1909699865, 1739743613, 1028431515, 1544913034, 526166023, 4208995751, 1362253081},
				PC:  7435092,
				SR:  41736,
				USP: 796552,
				SSP: 16059558,
				RAM: [][2]uint32{{7435086, 82}, {7435087, 68}, {7435088, 63}, {7435089, 70}, {7435090, 230}, {7435091, 94}},
				Cycles: 4,
			},
		},
		{
			name: "500 ADD.w 6, D4 5c44",
			init: cpuState{
				D:   [8]uint32{2112210899, 2964070417, 1905644747, 697820884, 2982338436, 3240454492, 3551405239, 2086966805},
				A:   [7]uint32{2563005078, 64302311, 636377601, 3598885971, 1556801253, 1695232732, 3346942430},
				PC:  5771750,
				SR:  517,
				USP: 13365698,
				SSP: 9262816,
				RAM: [][2]uint32{{5771746, 92}, {5771747, 68}, {5771748, 79}, {5771749, 231}, {5771750, 135}, {5771751, 80}},
			},
			want: cpuState{
				D:   [8]uint32{2112210899, 2964070417, 1905644747, 697820884, 2982338442, 3240454492, 3551405239, 2086966805},
				A:   [7]uint32{2563005078, 64302311, 636377601, 3598885971, 1556801253, 1695232732, 3346942430},
				PC:  5771752,
				SR:  520,
				USP: 13365698,
				SSP: 9262816,
				RAM: [][2]uint32{{5771746, 92}, {5771747, 68}, {5771748, 79}, {5771749, 231}, {5771750, 135}, {5771751, 80}},
				Cycles: 4,
			},
		},
		{
			name: "1000 ADD.w #, (d8, A4, Xn) 0674",
			init: cpuState{
				D:   [8]uint32{373832229, 2045266333, 2597361689, 240668984, 4086913542, 3506224842, 49363115, 3627640000},
				A:   [7]uint32{2471788548, 574045210, 2856672112, 755277718, 1456953095, 2664118686, 1300343672},
				PC:  8305148,
				SR:  264,
				USP: 12996952,
				SSP: 862336,
				RAM: [][2]uint32{{8305144, 6}, {8305145, 116}, {8305146, 48}, {8305147, 70}, {8305148, 187}, {8305149, 141}, {8305150, 218}, {8305151, 236}, {14415402, 218}, {14415403, 159}, {8305152, 201}, {8305153, 117}},
			},
			want: cpuState{
				D:   [8]uint32{373832229, 2045266333, 2597361689, 240668984, 4086913542, 3506224842, 49363115, 3627640000},
				A:   [7]uint32{2471788548, 574045210, 2856672112, 755277718, 1456953095, 2664118686, 1300343672},
				PC:  8305154,
				SR:  273,
				USP: 12996952,
				SSP: 862336,
				RAM: [][2]uint32{{8305144, 6}, {8305145, 116}, {8305146, 48}, {8305147, 70}, {8305148, 187}, {8305149, 141}, {8305150, 218}, {8305151, 236}, {14415402, 10}, {14415403, 229}, {8305152, 201}, {8305153, 117}},
				Cycles: 22,
			},
		},
		{
			name: "1500 ADD.w D2, -(A2) d562",
			init: cpuState{
				D:   [8]uint32{3292715614, 2045765043, 3181417329, 1300687111, 3501803472, 2364772717, 1226831045, 1007002366},
				A:   [7]uint32{2984759263, 2719015106, 880323050, 3835470203, 3189771112, 3290763888, 1958318305},
				PC:  7360294,
				SR:  10015,
				USP: 806262,
				SSP: 10635868,
				RAM: [][2]uint32{{7360290, 213}, {7360291, 98}, {7360292, 196}, {7360293, 85}, {7907816, 30}, {7907817, 184}, {7360294, 106}, {7360295, 77}},
			},
			want: cpuState{
				D:   [8]uint32{3292715614, 2045765043, 3181417329, 1300687111, 3501803472, 2364772717, 1226831045, 1007002366},
				A:   [7]uint32{2984759263, 2719015106, 880323048, 3835470203, 3189771112, 3290763888, 1958318305},
				PC:  7360296,
				SR:  9992,
				USP: 806262,
				SSP: 10635868,
				RAM: [][2]uint32{{7360290, 213}, {7360291, 98}, {7360292, 196}, {7360293, 85}, {7907816, 178}, {7907817, 41}, {7360294, 106}, {7360295, 77}},
				Cycles: 14,
			},
		},
		{
			name: "2000 ADD.w D0, -(A4) d164",
			init: cpuState{
				D:   [8]uint32{478702470, 1340516552, 2892925863, 760846340, 103963887, 2570774856, 2956880464, 3815113657},
				A:   [7]uint32{2894363122, 619251031, 1290920016, 943671690, 768153821, 790541136, 2818650093},
				PC:  11687738,
				SR:  1040,
				USP: 38220,
				SSP: 8455906,
				RAM: [][2]uint32{{11687734, 209}, {11687735, 100}, {11687736, 241}, {11687737, 51}, {12, 104}, {13, 76}, {14, 131}, {15, 34}, {5014306, 188}, {5014307, 99}, {5014308, 64}, {5014309, 111}},
			},
			want: cpuState{
				D:      [8]uint32{478702470, 1340516552, 2892925863, 760846340, 103963887, 2570774856, 2956880464, 3815113657},
				A:      [7]uint32{2894363122, 619251031, 1290920016, 943671690, 768153819, 790541136, 2818650093},
				PC:     1749844774,
				SR:     9232,
				USP:    38220,
				SSP:    8455892,
				RAM:    [][2]uint32{{11687734, 209}, {11687735, 100}, {11687736, 241}, {11687737, 51}, {8455904, 87}, {8455905, 58}, {8455900, 4}, {8455901, 16}, {8455902, 0}, {8455903, 178}, {8455898, 209}, {8455899, 100}, {8455896, 24}, {8455897, 219}, {8455892, 209}, {8455893, 113}, {8455894, 45}, {8455895, 201}, {12, 104}, {13, 76}, {14, 131}, {15, 34}, {5014306, 188}, {5014307, 99}, {5014308, 64}, {5014309, 111}},
				Halted: true,
			},
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			runTest(t, tt.init, tt.want)
		})
	}
}

func TestADD_L(t *testing.T) {
	tests := []struct {
		name string
		init cpuState
		want cpuState
	}{
		{
			name: "000 ADD.l D5, (d8, A3, Xn) dbb3",
			init: cpuState{
				D:   [8]uint32{2716418231, 4207376922, 2543932834, 4262317947, 3724476184, 22002888, 386349136, 3381172759},
				A:   [7]uint32{2874603247, 2869405373, 1615831200, 1045252699, 2138434487, 709118711, 3722715766},
				PC:  3065352,
				SR:  8979,
				USP: 14939940,
				SSP: 4539052,
				RAM: [][2]uint32{{3065348, 219}, {3065349, 179}, {3065350, 12}, {3065351, 79}, {3065352, 6}, {3065353, 183}, {12, 224}, {13, 16}, {14, 233}, {15, 22}, {1108246, 10}, {1108247, 58}, {1108248, 220}, {1108249, 238}},
			},
			want: cpuState{
				D:      [8]uint32{2716418231, 4207376922, 2543932834, 4262317947, 3724476184, 22002888, 386349136, 3381172759},
				A:      [7]uint32{2874603247, 2869405373, 1615831200, 1045252699, 2138434487, 709118711, 3722715766},
				PC:     3759204634,
				SR:     8979,
				USP:    14939940,
				SSP:    4539038,
				RAM:    [][2]uint32{{3065348, 219}, {3065349, 179}, {3065350, 12}, {3065351, 79}, {3065352, 6}, {3065353, 183}, {4539050, 198}, {4539051, 6}, {4539046, 35}, {4539047, 19}, {4539048, 0}, {4539049, 46}, {4539044, 219}, {4539045, 179}, {4539042, 139}, {4539043, 97}, {4539038, 219}, {4539039, 181}, {4539040, 224}, {4539041, 54}, {12, 224}, {13, 16}, {14, 233}, {15, 22}, {1108246, 10}, {1108247, 58}, {1108248, 220}, {1108249, 238}},
				Halted: true,
			},
		},
		{
			name: "500 ADD.l -(A7), D4 d8a7",
			init: cpuState{
				D:   [8]uint32{1464287997, 554386041, 3887730148, 2185993342, 3001880088, 378082243, 3578433898, 2465168491},
				A:   [7]uint32{163518063, 2397436891, 4124904640, 1102613353, 1908206022, 3700052004, 923254654},
				PC:  11151146,
				SR:  1311,
				USP: 12096570,
				SSP: 2525228,
				RAM: [][2]uint32{{11151142, 216}, {11151143, 167}, {11151144, 208}, {11151145, 224}, {12096566, 41}, {12096567, 247}, {12096568, 163}, {12096569, 34}, {11151146, 224}, {11151147, 89}},
			},
			want: cpuState{
				D:   [8]uint32{1464287997, 554386041, 3887730148, 2185993342, 3705975098, 378082243, 3578433898, 2465168491},
				A:   [7]uint32{163518063, 2397436891, 4124904640, 1102613353, 1908206022, 3700052004, 923254654},
				PC:  11151148,
				SR:  1288,
				USP: 12096566,
				SSP: 2525228,
				RAM: [][2]uint32{{11151142, 216}, {11151143, 167}, {11151144, 208}, {11151145, 224}, {12096566, 41}, {12096567, 247}, {12096568, 163}, {12096569, 34}, {11151146, 224}, {11151147, 89}},
				Cycles: 16,
			},
		},
		{
			name: "1000 ADD.l 5, -(A4) 5aa4",
			init: cpuState{
				D:   [8]uint32{2619285985, 1925216638, 378178917, 3926764760, 2401236533, 876400138, 4100076479, 891502556},
				A:   [7]uint32{24336229, 2285867149, 2291944242, 1242972929, 2729282478, 1635746504, 566093415},
				PC:  8721036,
				SR:  8705,
				USP: 10982728,
				SSP: 3918218,
				RAM: [][2]uint32{{8721032, 90}, {8721033, 164}, {8721034, 36}, {8721035, 179}, {11373482, 233}, {11373483, 50}, {11373484, 77}, {11373485, 201}, {8721036, 60}, {8721037, 20}},
			},
			want: cpuState{
				D:   [8]uint32{2619285985, 1925216638, 378178917, 3926764760, 2401236533, 876400138, 4100076479, 891502556},
				A:   [7]uint32{24336229, 2285867149, 2291944242, 1242972929, 2729282474, 1635746504, 566093415},
				PC:  8721038,
				SR:  8712,
				USP: 10982728,
				SSP: 3918218,
				RAM: [][2]uint32{{8721032, 90}, {8721033, 164}, {8721034, 36}, {8721035, 179}, {11373482, 233}, {11373483, 50}, {11373484, 77}, {11373485, 206}, {8721036, 60}, {8721037, 20}},
				Cycles: 22,
			},
		},
		{
			name: "1500 ADD.l (A0)+, D5 da98",
			init: cpuState{
				D:   [8]uint32{1546755666, 3978331449, 292994626, 2574451037, 2483638804, 525818923, 1449235995, 2779746162},
				A:   [7]uint32{1387516899, 1905346324, 1200303954, 1497033632, 1983392107, 403827175, 3371803439},
				PC:  8040040,
				SR:  9477,
				USP: 9588392,
				SSP: 6158450,
				RAM: [][2]uint32{{8040036, 218}, {8040037, 152}, {8040038, 34}, {8040039, 236}, {12, 32}, {13, 58}, {14, 223}, {15, 18}, {3858194, 0}, {3858195, 181}, {3858196, 199}, {3858197, 69}},
			},
			want: cpuState{
				D:      [8]uint32{1546755666, 3978331449, 292994626, 2574451037, 2483638804, 525818923, 1449235995, 2779746162},
				A:      [7]uint32{1387516899, 1905346324, 1200303954, 1497033632, 1983392107, 403827175, 3371803439},
				PC:     540729110,
				SR:     9477,
				USP:    9588392,
				SSP:    6158436,
				RAM:    [][2]uint32{{8040036, 218}, {8040037, 152}, {8040038, 34}, {8040039, 236}, {6158448, 174}, {6158449, 102}, {6158444, 37}, {6158445, 5}, {6158446, 0}, {6158447, 122}, {6158442, 218}, {6158443, 152}, {6158440, 211}, {6158441, 227}, {6158436, 218}, {6158437, 149}, {6158438, 82}, {6158439, 179}, {12, 32}, {13, 58}, {14, 223}, {15, 18}, {3858194, 0}, {3858195, 181}, {3858196, 199}, {3858197, 69}},
				Halted: true,
			},
		},
		{
			name: "2000 ADD.l #, (A0) 0690",
			init: cpuState{
				D:   [8]uint32{1559146838, 3539592242, 3548872570, 963141589, 4011367675, 1828380738, 4264968104, 764381064},
				A:   [7]uint32{349926689, 3406555350, 1647720366, 3609071408, 3111363858, 1523308046, 3279236371},
				PC:  370030,
				SR:  8206,
				USP: 13506444,
				SSP: 190472,
				RAM: [][2]uint32{{370026, 6}, {370027, 144}, {370028, 228}, {370029, 172}, {370030, 54}, {370031, 91}, {370032, 81}, {370033, 172}, {12, 41}, {13, 132}, {14, 198}, {15, 152}, {8701592, 170}, {8701593, 142}, {8701594, 173}, {8701595, 11}},
			},
			want: cpuState{
				D:      [8]uint32{1559146838, 3539592242, 3548872570, 963141589, 4011367675, 1828380738, 4264968104, 764381064},
				A:      [7]uint32{349926689, 3406555350, 1647720366, 3609071408, 3111363858, 1523308046, 3279236371},
				PC:     696567452,
				SR:     8206,
				USP:    13506444,
				SSP:    190458,
				RAM:    [][2]uint32{{370026, 6}, {370027, 144}, {370028, 228}, {370029, 172}, {370030, 54}, {370031, 91}, {370032, 81}, {370033, 172}, {190470, 165}, {190471, 112}, {190466, 32}, {190467, 14}, {190468, 0}, {190469, 5}, {190464, 6}, {190465, 144}, {190462, 117}, {190463, 33}, {190458, 6}, {190459, 149}, {190460, 20}, {190461, 219}, {12, 41}, {13, 132}, {14, 198}, {15, 152}, {8701592, 170}, {8701593, 142}, {8701594, 173}, {8701595, 11}},
				Halted: true,
			},
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			runTest(t, tt.init, tt.want)
		})
	}
}

func TestADDA_W(t *testing.T) {
	tests := []struct {
		name string
		init cpuState
		want cpuState
	}{
		{
			name: "000 ADDA.w (d16, A0), A2 d4e8",
			init: cpuState{
				D:   [8]uint32{3597950942, 3391415435, 3445088799, 1597919559, 294870065, 1337499212, 1126913713, 2248054717},
				A:   [7]uint32{1497914091, 2386817744, 579384692, 2821960988, 3155809731, 2473268795, 2208773622},
				PC:  9681622,
				SR:  34583,
				USP: 481542,
				SSP: 10933724,
				RAM: [][2]uint32{{9681618, 212}, {9681619, 232}, {9681620, 136}, {9681621, 78}, {9681622, 154}, {9681623, 99}, {12, 30}, {13, 124}, {14, 113}, {15, 224}, {8155616, 59}, {8155617, 190}, {8155618, 55}, {8155619, 219}},
			},
			want: cpuState{
				D:      [8]uint32{3597950942, 3391415435, 3445088799, 1597919559, 294870065, 1337499212, 1126913713, 2248054717},
				A:      [7]uint32{1497914091, 2386817744, 579384692, 2821960988, 3155809731, 2473268795, 2208773622},
				PC:     511472100,
				SR:     10007,
				USP:    481542,
				SSP:    10933710,
				RAM:    [][2]uint32{{9681618, 212}, {9681619, 232}, {9681620, 136}, {9681621, 78}, {9681622, 154}, {9681623, 99}, {10933722, 186}, {10933723, 212}, {10933718, 135}, {10933719, 23}, {10933720, 0}, {10933721, 147}, {10933716, 212}, {10933717, 232}, {10933714, 227}, {10933715, 57}, {10933710, 212}, {10933711, 241}, {10933712, 89}, {10933713, 71}, {12, 30}, {13, 124}, {14, 113}, {15, 224}, {8155616, 59}, {8155617, 190}, {8155618, 55}, {8155619, 219}},
				Halted: true,
			},
		},
		{
			name: "500 ADDA.w (A5), A0 d0d5",
			init: cpuState{
				D:   [8]uint32{2705787859, 1489959357, 948773599, 1831963320, 981282264, 4043538049, 592155262, 3174709345},
				A:   [7]uint32{164434849, 2574239793, 3606326509, 154182994, 391755068, 611893632, 1022973450},
				PC:  7527900,
				SR:  33820,
				USP: 14105584,
				SSP: 6859282,
				RAM: [][2]uint32{{7527896, 208}, {7527897, 213}, {7527898, 13}, {7527899, 86}, {7913856, 203}, {7913857, 103}, {7527900, 48}, {7527901, 160}},
			},
			want: cpuState{
				D:   [8]uint32{2705787859, 1489959357, 948773599, 1831963320, 981282264, 4043538049, 592155262, 3174709345},
				A:   [7]uint32{164421384, 2574239793, 3606326509, 154182994, 391755068, 611893632, 1022973450},
				PC:  7527902,
				SR:  33820,
				USP: 14105584,
				SSP: 6859282,
				RAM: [][2]uint32{{7527896, 208}, {7527897, 213}, {7527898, 13}, {7527899, 86}, {7913856, 203}, {7913857, 103}, {7527900, 48}, {7527901, 160}},
				Cycles: 12,
			},
		},
		{
			name: "1000 ADDA.w (d8, A7, Xn), A4 d8f7",
			init: cpuState{
				D:   [8]uint32{3848523572, 3152832300, 732298797, 1686405678, 2759647777, 3002253350, 3241958134, 4280890333},
				A:   [7]uint32{3011731805, 2936270313, 4131770887, 67293818, 2610481305, 3196519856, 2491756737},
				PC:  12860026,
				SR:  532,
				USP: 8027608,
				SSP: 3304262,
				RAM: [][2]uint32{{12860022, 216}, {12860023, 247}, {12860024, 251}, {12860025, 185}, {12860026, 85}, {12860027, 105}, {12, 231}, {13, 4}, {14, 111}, {15, 164}, {290724, 240}, {290725, 53}, {290726, 85}, {290727, 175}},
			},
			want: cpuState{
				D:      [8]uint32{3848523572, 3152832300, 732298797, 1686405678, 2759647777, 3002253350, 3241958134, 4280890333},
				A:      [7]uint32{3011731805, 2936270313, 4131770887, 67293818, 2610481305, 3196519856, 2491756737},
				PC:     3875827624,
				SR:     8724,
				USP:    8027608,
				SSP:    3304248,
				RAM:    [][2]uint32{{12860022, 216}, {12860023, 247}, {12860024, 251}, {12860025, 185}, {12860026, 85}, {12860027, 105}, {3304260, 58}, {3304261, 120}, {3304256, 2}, {3304257, 20}, {3304258, 0}, {3304259, 196}, {3304254, 216}, {3304255, 247}, {3304252, 251}, {3304253, 105}, {3304248, 216}, {3304249, 241}, {3304250, 0}, {3304251, 244}, {12, 231}, {13, 4}, {14, 111}, {15, 164}, {290724, 240}, {290725, 53}, {290726, 85}, {290727, 175}},
				Halted: true,
			},
		},
		{
			name: "1500 ADDA.w D4, A7 dec4",
			init: cpuState{
				D:   [8]uint32{1600072499, 2883560763, 4118941917, 3610026532, 2827090577, 1524493220, 1211169298, 2760757668},
				A:   [7]uint32{2849045241, 3221405000, 1641493384, 904602802, 166532812, 3829357961, 1589140872},
				PC:  10426612,
				SR:  1052,
				USP: 9022032,
				SSP: 6900302,
				RAM: [][2]uint32{{10426608, 222}, {10426609, 196}, {10426610, 214}, {10426611, 214}, {10426612, 36}, {10426613, 113}},
			},
			want: cpuState{
				D:   [8]uint32{1600072499, 2883560763, 4118941917, 3610026532, 2827090577, 1524493220, 1211169298, 2760757668},
				A:   [7]uint32{2849045241, 3221405000, 1641493384, 904602802, 166532812, 3829357961, 1589140872},
				PC:  10426614,
				SR:  1052,
				USP: 9020641,
				SSP: 6900302,
				RAM: [][2]uint32{{10426608, 222}, {10426609, 196}, {10426610, 214}, {10426611, 214}, {10426612, 36}, {10426613, 113}},
				Cycles: 8,
			},
		},
		{
			name: "2000 ADDA.w (A1)+, A2 d4d9",
			init: cpuState{
				D:   [8]uint32{2621495335, 2159505638, 659150666, 3489618385, 2635209543, 2662001846, 1793971140, 2301414497},
				A:   [7]uint32{1328373017, 1307571906, 623087067, 600395495, 2544796043, 2621170528, 1547048081},
				PC:  12134652,
				SR:  9746,
				USP: 12333522,
				SSP: 9232818,
				RAM: [][2]uint32{{12134648, 212}, {12134649, 217}, {12134650, 218}, {12134651, 82}, {15726274, 23}, {15726275, 156}, {12134652, 74}, {12134653, 21}},
			},
			want: cpuState{
				D:   [8]uint32{2621495335, 2159505638, 659150666, 3489618385, 2635209543, 2662001846, 1793971140, 2301414497},
				A:   [7]uint32{1328373017, 1307571908, 623093111, 600395495, 2544796043, 2621170528, 1547048081},
				PC:  12134654,
				SR:  9746,
				USP: 12333522,
				SSP: 9232818,
				RAM: [][2]uint32{{12134648, 212}, {12134649, 217}, {12134650, 218}, {12134651, 82}, {15726274, 23}, {15726275, 156}, {12134652, 74}, {12134653, 21}},
				Cycles: 12,
			},
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			runTest(t, tt.init, tt.want)
		})
	}
}

func TestADDA_L(t *testing.T) {
	tests := []struct {
		name string
		init cpuState
		want cpuState
	}{
		{
			name: "000 ADDA.l (d16, A6), A6 ddee",
			init: cpuState{
				D:   [8]uint32{601553886, 3882265256, 4081024186, 3333190385, 226977110, 1489897429, 129445653, 2806454671},
				A:   [7]uint32{4046042593, 3262263489, 483918555, 4268878349, 560546210, 1619534125, 1069688090},
				PC:  7360406,
				SR:  34322,
				USP: 9316066,
				SSP: 7938836,
				RAM: [][2]uint32{{7360402, 221}, {7360403, 238}, {7360404, 156}, {7360405, 78}, {7360406, 72}, {7360407, 59}, {12697960, 175}, {12697961, 240}, {12697962, 211}, {12697963, 198}, {7360408, 106}, {7360409, 130}},
			},
			want: cpuState{
				D:   [8]uint32{601553886, 3882265256, 4081024186, 3333190385, 226977110, 1489897429, 129445653, 2806454671},
				A:   [7]uint32{4046042593, 3262263489, 483918555, 4268878349, 560546210, 1619534125, 4021483744},
				PC:  7360410,
				SR:  34322,
				USP: 9316066,
				SSP: 7938836,
				RAM: [][2]uint32{{7360402, 221}, {7360403, 238}, {7360404, 156}, {7360405, 78}, {7360406, 72}, {7360407, 59}, {12697960, 175}, {12697961, 240}, {12697962, 211}, {12697963, 198}, {7360408, 106}, {7360409, 130}},
				Cycles: 18,
			},
		},
		{
			name: "500 ADDA.l A5, A7 dfcd",
			init: cpuState{
				D:   [8]uint32{325425224, 2165434707, 4022750909, 4120326758, 4103400145, 1506280071, 1999615348, 709136770},
				A:   [7]uint32{2135957202, 1644677255, 4110620975, 798277481, 72951212, 2085279858, 3048835118},
				PC:  6300614,
				SR:  41240,
				USP: 6383252,
				SSP: 1977036,
				RAM: [][2]uint32{{6300610, 223}, {6300611, 205}, {6300612, 186}, {6300613, 173}, {6300614, 212}, {6300615, 157}},
			},
			want: cpuState{
				D:   [8]uint32{325425224, 2165434707, 4022750909, 4120326758, 4103400145, 1506280071, 1999615348, 709136770},
				A:   [7]uint32{2135957202, 1644677255, 4110620975, 798277481, 72951212, 2085279858, 3048835118},
				PC:  6300616,
				SR:  41240,
				USP: 6383252,
				SSP: 2087256894,
				RAM: [][2]uint32{{6300610, 223}, {6300611, 205}, {6300612, 186}, {6300613, 173}, {6300614, 212}, {6300615, 157}},
				Cycles: 8,
			},
		},
		{
			name: "1000 ADDA.l -(A4), A3 d7e4",
			init: cpuState{
				D:   [8]uint32{1014014963, 1927771678, 383380099, 1616418368, 101374157, 1392850973, 996040081, 3782587050},
				A:   [7]uint32{1957885287, 2124181366, 2911731850, 341525497, 2637370931, 3171271031, 3677820347},
				PC:  1819318,
				SR:  34568,
				USP: 879188,
				SSP: 10576816,
				RAM: [][2]uint32{{1819314, 215}, {1819315, 228}, {1819316, 230}, {1819317, 1}, {12, 21}, {13, 98}, {14, 204}, {15, 80}, {6474832, 25}, {6474833, 70}, {6474834, 68}, {6474835, 63}},
			},
			want: cpuState{
				D:      [8]uint32{1014014963, 1927771678, 383380099, 1616418368, 101374157, 1392850973, 996040081, 3782587050},
				A:      [7]uint32{1957885287, 2124181366, 2911731850, 341525497, 2637370927, 3171271031, 3677820347},
				PC:     358796372,
				SR:     9992,
				USP:    879188,
				SSP:    10576802,
				RAM:    [][2]uint32{{1819314, 215}, {1819315, 228}, {1819316, 230}, {1819317, 1}, {10576814, 194}, {10576815, 180}, {10576810, 135}, {10576811, 8}, {10576812, 0}, {10576813, 27}, {10576808, 215}, {10576809, 228}, {10576806, 22}, {10576807, 47}, {10576802, 215}, {10576803, 241}, {10576804, 157}, {10576805, 51}, {12, 21}, {13, 98}, {14, 204}, {15, 80}, {6474832, 25}, {6474833, 70}, {6474834, 68}, {6474835, 63}},
				Halted: true,
			},
		},
		{
			name: "1500 ADDA.l (A7), A5 dbd7",
			init: cpuState{
				D:   [8]uint32{1522638056, 984977510, 3739777633, 1430309213, 2406156165, 820282274, 1707776302, 688914386},
				A:   [7]uint32{2833190671, 1627302379, 1442590570, 1781265011, 385127715, 1481129180, 186978221},
				PC:  11317120,
				SR:  9486,
				USP: 1798798,
				SSP: 13358862,
				RAM: [][2]uint32{{11317116, 219}, {11317117, 215}, {11317118, 112}, {11317119, 230}, {13358862, 223}, {13358863, 26}, {13358864, 168}, {13358865, 20}, {11317120, 234}, {11317121, 5}},
			},
			want: cpuState{
				D:   [8]uint32{1522638056, 984977510, 3739777633, 1430309213, 2406156165, 820282274, 1707776302, 688914386},
				A:   [7]uint32{2833190671, 1627302379, 1442590570, 1781265011, 385127715, 929228016, 186978221},
				PC:  11317122,
				SR:  9486,
				USP: 1798798,
				SSP: 13358862,
				RAM: [][2]uint32{{11317116, 219}, {11317117, 215}, {11317118, 112}, {11317119, 230}, {13358862, 223}, {13358863, 26}, {13358864, 168}, {13358865, 20}, {11317120, 234}, {11317121, 5}},
				Cycles: 14,
			},
		},
		{
			name: "2000 ADDA.l A7, A4 d9cf",
			init: cpuState{
				D:   [8]uint32{3696740116, 2987940164, 3097721049, 3664448355, 775441488, 2051348306, 858378600, 1143879448},
				A:   [7]uint32{867382973, 4084847420, 592599200, 1644751001, 2064749223, 1791485335, 625353196},
				PC:  14728864,
				SR:  41218,
				USP: 9934714,
				SSP: 6552504,
				RAM: [][2]uint32{{14728860, 217}, {14728861, 207}, {14728862, 151}, {14728863, 128}, {14728864, 34}, {14728865, 178}},
			},
			want: cpuState{
				D:   [8]uint32{3696740116, 2987940164, 3097721049, 3664448355, 775441488, 2051348306, 858378600, 1143879448},
				A:   [7]uint32{867382973, 4084847420, 592599200, 1644751001, 2071301727, 1791485335, 625353196},
				PC:  14728866,
				SR:  41218,
				USP: 9934714,
				SSP: 6552504,
				RAM: [][2]uint32{{14728860, 217}, {14728861, 207}, {14728862, 151}, {14728863, 128}, {14728864, 34}, {14728865, 178}},
				Cycles: 8,
			},
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			runTest(t, tt.init, tt.want)
		})
	}
}

func TestADDX_B(t *testing.T) {
	tests := []struct {
		name string
		init cpuState
		want cpuState
	}{
		{
			name: "000 ADDX.b D2, D3 d702",
			init: cpuState{
				D:   [8]uint32{44548103, 261823688, 2324915324, 4058951795, 1544780998, 104217652, 2555894768, 1341936939},
				A:   [7]uint32{230480667, 3437772131, 3037520413, 2374507427, 2278188298, 4056559490, 2377918318},
				PC:  6052604,
				SR:  34311,
				USP: 9835192,
				SSP: 12857820,
				RAM: [][2]uint32{{6052600, 215}, {6052601, 2}, {6052602, 99}, {6052603, 194}, {6052604, 10}, {6052605, 42}},
			},
			want: cpuState{
				D:   [8]uint32{44548103, 261823688, 2324915324, 4058951919, 1544780998, 104217652, 2555894768, 1341936939},
				A:   [7]uint32{230480667, 3437772131, 3037520413, 2374507427, 2278188298, 4056559490, 2377918318},
				PC:  6052606,
				SR:  34314,
				USP: 9835192,
				SSP: 12857820,
				RAM: [][2]uint32{{6052600, 215}, {6052601, 2}, {6052602, 99}, {6052603, 194}, {6052604, 10}, {6052605, 42}},
				Cycles: 4,
			},
		},
		{
			name: "500 ADDX.b D6, D2 d506",
			init: cpuState{
				D:   [8]uint32{1758749811, 2649764283, 1154568341, 2821009687, 2908759639, 2212884726, 3358355161, 1172285619},
				A:   [7]uint32{855896303, 4289596540, 2949982655, 606413390, 3147955411, 4039921642, 291843211},
				PC:  4802834,
				SR:  1054,
				USP: 15169706,
				SSP: 12605438,
				RAM: [][2]uint32{{4802830, 213}, {4802831, 6}, {4802832, 17}, {4802833, 129}, {4802834, 54}, {4802835, 221}},
			},
			want: cpuState{
				D:   [8]uint32{1758749811, 2649764283, 1154568303, 2821009687, 2908759639, 2212884726, 3358355161, 1172285619},
				A:   [7]uint32{855896303, 4289596540, 2949982655, 606413390, 3147955411, 4039921642, 291843211},
				PC:  4802836,
				SR:  1043,
				USP: 15169706,
				SSP: 12605438,
				RAM: [][2]uint32{{4802830, 213}, {4802831, 6}, {4802832, 17}, {4802833, 129}, {4802834, 54}, {4802835, 221}},
				Cycles: 4,
			},
		},
		{
			name: "1000 ADDX.b D2, D0 d102",
			init: cpuState{
				D:   [8]uint32{1791248072, 3603890067, 1211474062, 1740990572, 2600245656, 3032994918, 1491369759, 302012029},
				A:   [7]uint32{127453526, 2073325692, 2744519054, 190396329, 2548142277, 154819654, 1875055831},
				PC:  11170676,
				SR:  42259,
				USP: 5722486,
				SSP: 15820602,
				RAM: [][2]uint32{{11170672, 209}, {11170673, 2}, {11170674, 12}, {11170675, 251}, {11170676, 193}, {11170677, 128}},
			},
			want: cpuState{
				D:   [8]uint32{1791247959, 3603890067, 1211474062, 1740990572, 2600245656, 3032994918, 1491369759, 302012029},
				A:   [7]uint32{127453526, 2073325692, 2744519054, 190396329, 2548142277, 154819654, 1875055831},
				PC:  11170678,
				SR:  42259,
				USP: 5722486,
				SSP: 15820602,
				RAM: [][2]uint32{{11170672, 209}, {11170673, 2}, {11170674, 12}, {11170675, 251}, {11170676, 193}, {11170677, 128}},
				Cycles: 4,
			},
		},
		{
			name: "1500 ADDX.b D6, D6 dd06",
			init: cpuState{
				D:   [8]uint32{1610852722, 2630499302, 202837656, 1694622764, 4133252871, 3595479717, 2740374934, 3590640564},
				A:   [7]uint32{2526809391, 2437997017, 1425815587, 1408663465, 517666581, 1048937585, 3219207909},
				PC:  1266682,
				SR:  517,
				USP: 11347356,
				SSP: 11774022,
				RAM: [][2]uint32{{1266678, 221}, {1266679, 6}, {1266680, 56}, {1266681, 229}, {1266682, 255}, {1266683, 216}},
			},
			want: cpuState{
				D:   [8]uint32{1610852722, 2630499302, 202837656, 1694622764, 4133252871, 3595479717, 2740374828, 3590640564},
				A:   [7]uint32{2526809391, 2437997017, 1425815587, 1408663465, 517666581, 1048937585, 3219207909},
				PC:  1266684,
				SR:  531,
				USP: 11347356,
				SSP: 11774022,
				RAM: [][2]uint32{{1266678, 221}, {1266679, 6}, {1266680, 56}, {1266681, 229}, {1266682, 255}, {1266683, 216}},
				Cycles: 4,
			},
		},
		{
			name: "2000 ADDX.b -(A7), -(A2) d50f",
			init: cpuState{
				D:   [8]uint32{2084856921, 495120043, 994623979, 4199543528, 1697110441, 1284568835, 682106535, 115719222},
				A:   [7]uint32{674489008, 2067737516, 1137699686, 2629200295, 1335284620, 4174141166, 2033007142},
				PC:  11012722,
				SR:  30,
				USP: 16376360,
				SSP: 11120104,
				RAM: [][2]uint32{{11012718, 213}, {11012719, 15}, {11012720, 88}, {11012721, 43}, {16376358, 66}, {16376359, 80}, {13626212, 53}, {13626213, 220}, {11012722, 168}, {11012723, 238}},
			},
			want: cpuState{
				D:   [8]uint32{2084856921, 495120043, 994623979, 4199543528, 1697110441, 1284568835, 682106535, 115719222},
				A:   [7]uint32{674489008, 2067737516, 1137699685, 2629200295, 1335284620, 4174141166, 2033007142},
				PC:  11012724,
				SR:  17,
				USP: 16376358,
				SSP: 11120104,
				RAM: [][2]uint32{{11012718, 213}, {11012719, 15}, {11012720, 88}, {11012721, 43}, {16376358, 66}, {16376359, 80}, {13626212, 53}, {13626213, 31}, {11012722, 168}, {11012723, 238}},
				Cycles: 18,
			},
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			runTest(t, tt.init, tt.want)
		})
	}
}

func TestADDX_W(t *testing.T) {
	tests := []struct {
		name string
		init cpuState
		want cpuState
	}{
		{
			name: "000 ADDX.w -(A1), -(A0) d149",
			init: cpuState{
				D:   [8]uint32{4224040949, 2022320032, 1925160569, 1739841148, 3920638392, 3871974204, 1202770696, 1059347476},
				A:   [7]uint32{1919114651, 2948124421, 3822682899, 2814065292, 1532911305, 1463532462, 69421316},
				PC:  8735904,
				SR:  8223,
				USP: 7862948,
				SSP: 6686588,
				RAM: [][2]uint32{{8735900, 209}, {8735901, 73}, {8735902, 35}, {8735903, 66}, {12, 79}, {13, 122}, {14, 194}, {15, 70}, {8045126, 176}, {8045127, 215}, {8045128, 230}, {8045129, 159}},
			},
			want: cpuState{
				D:      [8]uint32{4224040949, 2022320032, 1925160569, 1739841148, 3920638392, 3871974204, 1202770696, 1059347476},
				A:      [7]uint32{1919114651, 2948124419, 3822682899, 2814065292, 1532911305, 1463532462, 69421316},
				PC:     1333445194,
				SR:     8223,
				USP:    7862948,
				SSP:    6686574,
				RAM:    [][2]uint32{{8735900, 209}, {8735901, 73}, {8735902, 35}, {8735903, 66}, {6686586, 76}, {6686587, 160}, {6686582, 32}, {6686583, 31}, {6686584, 0}, {6686585, 133}, {6686580, 209}, {6686581, 73}, {6686578, 207}, {6686579, 3}, {6686574, 209}, {6686575, 85}, {6686576, 175}, {6686577, 184}, {12, 79}, {13, 122}, {14, 194}, {15, 70}, {8045126, 176}, {8045127, 215}, {8045128, 230}, {8045129, 159}},
				Halted: true,
			},
		},
		{
			name: "500 ADDX.w D3, D6 dd43",
			init: cpuState{
				D:   [8]uint32{921193556, 3936169273, 3208887717, 369499651, 1795355241, 3057163989, 1176047377, 3441411159},
				A:   [7]uint32{2431475340, 3452238503, 2485025285, 753723195, 3091443919, 3978807955, 2294225276},
				PC:  10917938,
				SR:  34332,
				USP: 2057172,
				SSP: 1280160,
				RAM: [][2]uint32{{10917934, 221}, {10917935, 67}, {10917936, 18}, {10917937, 210}, {10917938, 251}, {10917939, 103}},
			},
			want: cpuState{
				D:   [8]uint32{921193556, 3936169273, 3208887717, 369499651, 1795355241, 3057163989, 1176055061, 3441411159},
				A:   [7]uint32{2431475340, 3452238503, 2485025285, 753723195, 3091443919, 3978807955, 2294225276},
				PC:  10917940,
				SR:  34304,
				USP: 2057172,
				SSP: 1280160,
				RAM: [][2]uint32{{10917934, 221}, {10917935, 67}, {10917936, 18}, {10917937, 210}, {10917938, 251}, {10917939, 103}},
				Cycles: 4,
			},
		},
		{
			name: "1000 ADDX.w -(A0), -(A4) d948",
			init: cpuState{
				D:   [8]uint32{3991951231, 1579443155, 3900364942, 2563991609, 2015557299, 3201390280, 3989341645, 29201898},
				A:   [7]uint32{913281408, 961767058, 47615166, 983406455, 2596001435, 1193193539, 2390382697},
				PC:  12125192,
				SR:  10000,
				USP: 5779338,
				SSP: 11316572,
				RAM: [][2]uint32{{12125188, 217}, {12125189, 72}, {12125190, 44}, {12125191, 204}, {7311742, 123}, {7311743, 67}, {12, 194}, {13, 122}, {14, 49}, {15, 54}, {8007990, 84}, {8007991, 0}, {8007992, 196}, {8007993, 224}},
			},
			want: cpuState{
				D:      [8]uint32{3991951231, 1579443155, 3900364942, 2563991609, 2015557299, 3201390280, 3989341645, 29201898},
				A:      [7]uint32{913281406, 961767058, 47615166, 983406455, 2596001433, 1193193539, 2390382697},
				PC:     3262787898,
				SR:     10000,
				USP:    5779338,
				SSP:    11316558,
				RAM:    [][2]uint32{{12125188, 217}, {12125189, 72}, {12125190, 44}, {12125191, 204}, {7311742, 123}, {7311743, 67}, {11316570, 4}, {11316571, 8}, {11316566, 39}, {11316567, 16}, {11316568, 0}, {11316569, 185}, {11316564, 217}, {11316565, 72}, {11316562, 214}, {11316563, 153}, {11316558, 217}, {11316559, 85}, {11316560, 154}, {11316561, 187}, {12, 194}, {13, 122}, {14, 49}, {15, 54}, {8007990, 84}, {8007991, 0}, {8007992, 196}, {8007993, 224}},
				Halted: true,
			},
		},
		{
			name: "1500 ADDX.w D0, D2 d540",
			init: cpuState{
				D:   [8]uint32{3095417307, 797766886, 1841299555, 429218234, 944155785, 4103913236, 3204259183, 2847506126},
				A:   [7]uint32{1095939720, 3819207191, 2396019033, 3598081810, 487151067, 2039194989, 3283988248},
				PC:  11415672,
				SR:  41733,
				USP: 7137676,
				SSP: 16647184,
				RAM: [][2]uint32{{11415668, 213}, {11415669, 64}, {11415670, 43}, {11415671, 184}, {11415672, 18}, {11415673, 50}},
			},
			want: cpuState{
				D:   [8]uint32{3095417307, 797766886, 1841320510, 429218234, 944155785, 4103913236, 3204259183, 2847506126},
				A:   [7]uint32{1095939720, 3819207191, 2396019033, 3598081810, 487151067, 2039194989, 3283988248},
				PC:  11415674,
				SR:  41728,
				USP: 7137676,
				SSP: 16647184,
				RAM: [][2]uint32{{11415668, 213}, {11415669, 64}, {11415670, 43}, {11415671, 184}, {11415672, 18}, {11415673, 50}},
				Cycles: 4,
			},
		},
		{
			name: "2000 ADDX.w D1, D5 db41",
			init: cpuState{
				D:   [8]uint32{2709841231, 3691936508, 2910150062, 563456753, 3660118800, 4118823669, 3530130283, 1345627357},
				A:   [7]uint32{2388978548, 1813250281, 4211104467, 544864561, 188140976, 1046017600, 3151826148},
				PC:  5267286,
				SR:  9501,
				USP: 10644906,
				SSP: 14222904,
				RAM: [][2]uint32{{5267282, 219}, {5267283, 65}, {5267284, 253}, {5267285, 95}, {5267286, 108}, {5267287, 117}},
			},
			want: cpuState{
				D:   [8]uint32{2709841231, 3691936508, 2910150062, 563456753, 3660118800, 4118855154, 3530130283, 1345627357},
				A:   [7]uint32{2388978548, 1813250281, 4211104467, 544864561, 188140976, 1046017600, 3151826148},
				PC:  5267288,
				SR:  9482,
				USP: 10644906,
				SSP: 14222904,
				RAM: [][2]uint32{{5267282, 219}, {5267283, 65}, {5267284, 253}, {5267285, 95}, {5267286, 108}, {5267287, 117}},
				Cycles: 4,
			},
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			runTest(t, tt.init, tt.want)
		})
	}
}

func TestADDX_L(t *testing.T) {
	tests := []struct {
		name string
		init cpuState
		want cpuState
	}{
		{
			name: "000 ADDX.l D7, D3 d787",
			init: cpuState{
				D:   [8]uint32{1197053804, 3399353227, 2740321668, 970265451, 3765064288, 1562279320, 307052771, 146705388},
				A:   [7]uint32{1409285987, 2048459142, 2712308714, 2961438980, 566968450, 4263654526, 1243038899},
				PC:  3883982,
				SR:  41996,
				USP: 15027612,
				SSP: 10721058,
				RAM: [][2]uint32{{3883978, 215}, {3883979, 135}, {3883980, 84}, {3883981, 27}, {3883982, 147}, {3883983, 148}},
			},
			want: cpuState{
				D:   [8]uint32{1197053804, 3399353227, 2740321668, 1116970839, 3765064288, 1562279320, 307052771, 146705388},
				A:   [7]uint32{1409285987, 2048459142, 2712308714, 2961438980, 566968450, 4263654526, 1243038899},
				PC:  3883984,
				SR:  41984,
				USP: 15027612,
				SSP: 10721058,
				RAM: [][2]uint32{{3883978, 215}, {3883979, 135}, {3883980, 84}, {3883981, 27}, {3883982, 147}, {3883983, 148}},
				Cycles: 8,
			},
		},
		{
			name: "500 ADDX.l D0, D6 dd80",
			init: cpuState{
				D:   [8]uint32{2301228822, 4098955082, 3906124809, 2880041830, 3515986994, 3697753751, 326443551, 1399239578},
				A:   [7]uint32{1257952984, 121692183, 510024756, 1418552007, 460661837, 3638469699, 2781236375},
				PC:  12913506,
				SR:  1814,
				USP: 9499798,
				SSP: 7660206,
				RAM: [][2]uint32{{12913502, 221}, {12913503, 128}, {12913504, 99}, {12913505, 59}, {12913506, 137}, {12913507, 9}},
			},
			want: cpuState{
				D:   [8]uint32{2301228822, 4098955082, 3906124809, 2880041830, 3515986994, 3697753751, 2627672374, 1399239578},
				A:   [7]uint32{1257952984, 121692183, 510024756, 1418552007, 460661837, 3638469699, 2781236375},
				PC:  12913508,
				SR:  1800,
				USP: 9499798,
				SSP: 7660206,
				RAM: [][2]uint32{{12913502, 221}, {12913503, 128}, {12913504, 99}, {12913505, 59}, {12913506, 137}, {12913507, 9}},
				Cycles: 8,
			},
		},
		{
			name: "1000 ADDX.l -(A6), -(A2) d58e",
			init: cpuState{
				D:   [8]uint32{2746726150, 1945254889, 417643221, 2266878627, 2985751432, 2292996443, 186955863, 3616861156},
				A:   [7]uint32{278975727, 461149493, 1675980301, 2331855053, 3036905593, 866750393, 152336974},
				PC:  4497950,
				SR:  1026,
				USP: 16613890,
				SSP: 14511670,
				RAM: [][2]uint32{{4497946, 213}, {4497947, 142}, {4497948, 177}, {4497949, 254}, {1342028, 191}, {1342029, 4}, {1342026, 56}, {1342027, 2}, {12, 187}, {13, 136}, {14, 37}, {15, 224}, {8922592, 38}, {8922593, 64}, {8922594, 60}, {8922595, 203}},
			},
			want: cpuState{
				D:      [8]uint32{2746726150, 1945254889, 417643221, 2266878627, 2985751432, 2292996443, 186955863, 3616861156},
				A:      [7]uint32{278975727, 461149493, 1675980301, 2331855053, 3036905593, 866750393, 152336970},
				PC:     3146261988,
				SR:     9218,
				USP:    16613890,
				SSP:    14511656,
				RAM:    [][2]uint32{{4497946, 213}, {4497947, 142}, {4497948, 177}, {4497949, 254}, {1342028, 191}, {1342029, 4}, {1342026, 56}, {1342027, 2}, {14511668, 162}, {14511669, 30}, {14511664, 4}, {14511665, 2}, {14511666, 0}, {14511667, 68}, {14511662, 213}, {14511663, 142}, {14511660, 110}, {14511661, 11}, {14511656, 213}, {14511657, 145}, {14511658, 99}, {14511659, 229}, {12, 187}, {13, 136}, {14, 37}, {15, 224}, {8922592, 38}, {8922593, 64}, {8922594, 60}, {8922595, 203}},
				Halted: true,
			},
		},
		{
			name: "1500 ADDX.l D2, D7 df82",
			init: cpuState{
				D:   [8]uint32{4145695073, 2535570807, 3073958342, 2248074834, 3981471895, 2765352897, 3751033112, 3505595434},
				A:   [7]uint32{1007736431, 2572741474, 592864956, 77362809, 3459726544, 3222006758, 2131677545},
				PC:  1589408,
				SR:  9228,
				USP: 16050948,
				SSP: 1651500,
				RAM: [][2]uint32{{1589404, 223}, {1589405, 130}, {1589406, 242}, {1589407, 114}, {1589408, 177}, {1589409, 77}},
			},
			want: cpuState{
				D:   [8]uint32{4145695073, 2535570807, 3073958342, 2248074834, 3981471895, 2765352897, 3751033112, 2284586480},
				A:   [7]uint32{1007736431, 2572741474, 592864956, 77362809, 3459726544, 3222006758, 2131677545},
				PC:  1589410,
				SR:  9241,
				USP: 16050948,
				SSP: 1651500,
				RAM: [][2]uint32{{1589404, 223}, {1589405, 130}, {1589406, 242}, {1589407, 114}, {1589408, 177}, {1589409, 77}},
				Cycles: 8,
			},
		},
		{
			name: "2000 ADDX.l -(A7), -(A0) d18f",
			init: cpuState{
				D:   [8]uint32{1488402042, 3546197818, 825194713, 2556981956, 3521454437, 2293392277, 3169881152, 4015812514},
				A:   [7]uint32{3979553049, 1837613905, 1294803692, 449279801, 429588003, 2986754987, 1778440752},
				PC:  4985326,
				SR:  9240,
				USP: 8592258,
				SSP: 15934418,
				RAM: [][2]uint32{{4985322, 209}, {4985323, 143}, {4985324, 174}, {4985325, 217}, {15934416, 52}, {15934417, 66}, {15934414, 92}, {15934415, 201}, {12, 104}, {13, 170}, {14, 126}, {15, 194}, {11173570, 107}, {11173571, 39}, {11173572, 162}, {11173573, 131}},
			},
			want: cpuState{
				D:      [8]uint32{1488402042, 3546197818, 825194713, 2556981956, 3521454437, 2293392277, 3169881152, 4015812514},
				A:      [7]uint32{3979553049, 1837613905, 1294803692, 449279801, 429588003, 2986754987, 1778440752},
				PC:     1756004038,
				SR:     9240,
				USP:    8592258,
				SSP:    15934400,
				RAM:    [][2]uint32{{4985322, 209}, {4985323, 143}, {4985324, 174}, {4985325, 217}, {15934416, 52}, {15934417, 66}, {15934414, 92}, {15934415, 201}, {15934412, 17}, {15934413, 238}, {15934408, 36}, {15934409, 24}, {15934410, 0}, {15934411, 76}, {15934406, 209}, {15934407, 143}, {15934404, 41}, {15934405, 23}, {15934400, 209}, {15934401, 149}, {15934402, 237}, {15934403, 51}, {12, 104}, {13, 170}, {14, 126}, {15, 194}, {11173570, 107}, {11173571, 39}, {11173572, 162}, {11173573, 131}},
				Halted: true,
			},
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			runTest(t, tt.init, tt.want)
		})
	}
}

func TestSUB_B(t *testing.T) {
	tests := []struct {
		name string
		init cpuState
		want cpuState
	}{
		{
			name: "000 SUB.b #, -(A0) 0420",
			init: cpuState{
				D:   [8]uint32{3437425658, 626517206, 1000825843, 2316349802, 3604152426, 3851502031, 3394184782, 3053024384},
				A:   [7]uint32{3296183512, 3819277623, 1780743123, 2905093333, 1460519341, 1613759537, 718903270},
				PC:  12503382,
				SR:  771,
				USP: 2581670,
				SSP: 124124,
				RAM: [][2]uint32{{12503378, 4}, {12503379, 32}, {12503380, 143}, {12503381, 37}, {12503382, 1}, {12503383, 233}, {7849174, 88}, {7849175, 19}, {12503384, 63}, {12503385, 1}},
			},
			want: cpuState{
				D:   [8]uint32{3437425658, 626517206, 1000825843, 2316349802, 3604152426, 3851502031, 3394184782, 3053024384},
				A:   [7]uint32{3296183511, 3819277623, 1780743123, 2905093333, 1460519341, 1613759537, 718903270},
				PC:  12503386,
				SR:  793,
				USP: 2581670,
				SSP: 124124,
				RAM: [][2]uint32{{12503378, 4}, {12503379, 32}, {12503380, 143}, {12503381, 37}, {12503382, 1}, {12503383, 233}, {7849174, 88}, {7849175, 238}, {12503384, 63}, {12503385, 1}},
				Cycles: 18,
			},
		},
		{
			name: "500 SUB.b (A4), D6 9c14",
			init: cpuState{
				D:   [8]uint32{788171003, 615830693, 1117140683, 1726663104, 2870692238, 19005344, 846034352, 66472723},
				A:   [7]uint32{2909271590, 3472661757, 922855361, 2354883996, 1593318996, 1649173677, 262676505},
				PC:  8660336,
				SR:  41997,
				USP: 16744672,
				SSP: 1199018,
				RAM: [][2]uint32{{8660332, 156}, {8660333, 20}, {8660334, 251}, {8660335, 98}, {16260692, 90}, {16260693, 251}, {8660336, 202}, {8660337, 144}},
			},
			want: cpuState{
				D:   [8]uint32{788171003, 615830693, 1117140683, 1726663104, 2870692238, 19005344, 846034262, 66472723},
				A:   [7]uint32{2909271590, 3472661757, 922855361, 2354883996, 1593318996, 1649173677, 262676505},
				PC:  8660338,
				SR:  41986,
				USP: 16744672,
				SSP: 1199018,
				RAM: [][2]uint32{{8660332, 156}, {8660333, 20}, {8660334, 251}, {8660335, 98}, {16260692, 90}, {16260693, 251}, {8660336, 202}, {8660337, 144}},
				Cycles: 8,
			},
		},
		{
			name: "1000 SUB.b (d8, A3, Xn), D1 9233",
			init: cpuState{
				D:   [8]uint32{4206547149, 4194890382, 3486214681, 3520049570, 3961909652, 968668379, 2269899433, 1554870558},
				A:   [7]uint32{386208379, 2500787246, 324640844, 2367230804, 2858400550, 3191230414, 1687873995},
				PC:  12914814,
				SR:  41755,
				USP: 9041646,
				SSP: 3756558,
				RAM: [][2]uint32{{12914810, 146}, {12914811, 51}, {12914812, 0}, {12914813, 214}, {12914814, 56}, {12914815, 134}, {1631222, 130}, {1631223, 195}, {12914816, 90}, {12914817, 133}},
			},
			want: cpuState{
				D:   [8]uint32{4206547149, 4194890443, 3486214681, 3520049570, 3961909652, 968668379, 2269899433, 1554870558},
				A:   [7]uint32{386208379, 2500787246, 324640844, 2367230804, 2858400550, 3191230414, 1687873995},
				PC:  12914818,
				SR:  41753,
				USP: 9041646,
				SSP: 3756558,
				RAM: [][2]uint32{{12914810, 146}, {12914811, 51}, {12914812, 0}, {12914813, 214}, {12914814, 56}, {12914815, 134}, {1631222, 130}, {1631223, 195}, {12914816, 90}, {12914817, 133}},
				Cycles: 14,
			},
		},
		{
			name: "1500 SUB.b (xxx).w, D6 9c38",
			init: cpuState{
				D:   [8]uint32{2273046000, 331481534, 2065092284, 3013863883, 1906904132, 945353949, 2579006597, 4273195724},
				A:   [7]uint32{1079026672, 3423777972, 3986894373, 2708808711, 2659227820, 868880499, 3102138922},
				PC:  9135864,
				SR:  798,
				USP: 13878842,
				SSP: 1007856,
				RAM: [][2]uint32{{9135860, 156}, {9135861, 56}, {9135862, 68}, {9135863, 174}, {9135864, 210}, {9135865, 32}, {17582, 151}, {17583, 245}, {9135866, 172}, {9135867, 38}},
			},
			want: cpuState{
				D:   [8]uint32{2273046000, 331481534, 2065092284, 3013863883, 1906904132, 945353949, 2579006702, 4273195724},
				A:   [7]uint32{1079026672, 3423777972, 3986894373, 2708808711, 2659227820, 868880499, 3102138922},
				PC:  9135868,
				SR:  793,
				USP: 13878842,
				SSP: 1007856,
				RAM: [][2]uint32{{9135860, 156}, {9135861, 56}, {9135862, 68}, {9135863, 174}, {9135864, 210}, {9135865, 32}, {17582, 151}, {17583, 245}, {9135866, 172}, {9135867, 38}},
				Cycles: 12,
			},
		},
		{
			name: "2000 SUB.b D2, (d16, A1) 9529",
			init: cpuState{
				D:   [8]uint32{3579706632, 2966131563, 2522598236, 2356676839, 228146334, 9204655, 4014346406, 2058141629},
				A:   [7]uint32{3610508292, 1729573067, 1512237355, 1890453634, 3626244582, 4044825426, 1314031991},
				PC:  3914820,
				SR:  9242,
				USP: 8657308,
				SSP: 6590048,
				RAM: [][2]uint32{{3914816, 149}, {3914817, 41}, {3914818, 80}, {3914819, 69}, {3914820, 175}, {3914821, 43}, {1540368, 85}, {1540369, 211}, {3914822, 63}, {3914823, 46}},
			},
			want: cpuState{
				D:   [8]uint32{3579706632, 2966131563, 2522598236, 2356676839, 228146334, 9204655, 4014346406, 2058141629},
				A:   [7]uint32{3610508292, 1729573067, 1512237355, 1890453634, 3626244582, 4044825426, 1314031991},
				PC:  3914824,
				SR:  9241,
				USP: 8657308,
				SSP: 6590048,
				RAM: [][2]uint32{{3914816, 149}, {3914817, 41}, {3914818, 80}, {3914819, 69}, {3914820, 175}, {3914821, 43}, {1540368, 249}, {1540369, 211}, {3914822, 63}, {3914823, 46}},
				Cycles: 16,
			},
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			runTest(t, tt.init, tt.want)
		})
	}
}

func TestSUB_W(t *testing.T) {
	tests := []struct {
		name string
		init cpuState
		want cpuState
	}{
		{
			name: "000 SUB.w D7, (xxx).w 9f78",
			init: cpuState{
				D:   [8]uint32{778189525, 3625107800, 2162281962, 3042322923, 602243132, 131004613, 1295821721, 2828723018},
				A:   [7]uint32{2402517068, 1417749771, 3823487136, 1208433966, 355320110, 4050864189, 844697989},
				PC:  11738168,
				SR:  33033,
				USP: 14659424,
				SSP: 16745600,
				RAM: [][2]uint32{{11738164, 159}, {11738165, 120}, {11738166, 183}, {11738167, 203}, {11738168, 209}, {11738169, 234}, {12, 244}, {13, 36}, {14, 149}, {15, 136}, {2397576, 36}, {2397577, 33}, {2397578, 237}, {2397579, 237}},
			},
			want: cpuState{
				D:      [8]uint32{778189525, 3625107800, 2162281962, 3042322923, 602243132, 131004613, 1295821721, 2828723018},
				A:      [7]uint32{2402517068, 1417749771, 3823487136, 1208433966, 355320110, 4050864189, 844697989},
				PC:     4096038284,
				SR:     8457,
				USP:    14659424,
				SSP:    16745586,
				RAM:    [][2]uint32{{11738164, 159}, {11738165, 120}, {11738166, 183}, {11738167, 203}, {11738168, 209}, {11738169, 234}, {16745598, 28}, {16745599, 56}, {16745594, 129}, {16745595, 9}, {16745596, 0}, {16745597, 179}, {16745592, 159}, {16745593, 120}, {16745590, 183}, {16745591, 203}, {16745586, 159}, {16745587, 113}, {16745588, 255}, {16745589, 255}, {12, 244}, {13, 36}, {14, 149}, {15, 136}, {2397576, 36}, {2397577, 33}, {2397578, 237}, {2397579, 237}},
				Halted: true,
			},
		},
		{
			name: "500 SUB.w D6, (d16, A0) 9d68",
			init: cpuState{
				D:   [8]uint32{1395220928, 608279909, 988544966, 3428709179, 3746349990, 2633183441, 1210827680, 627422436},
				A:   [7]uint32{619351081, 3931145708, 236692255, 1170054324, 941137013, 513050375, 3048807278},
				PC:  2142834,
				SR:  34573,
				USP: 2421658,
				SSP: 16610388,
				RAM: [][2]uint32{{2142830, 157}, {2142831, 104}, {2142832, 118}, {2142833, 205}, {2142834, 114}, {2142835, 3}, {15401718, 122}, {15401719, 11}, {2142836, 169}, {2142837, 198}},
			},
			want: cpuState{
				D:   [8]uint32{1395220928, 608279909, 988544966, 3428709179, 3746349990, 2633183441, 1210827680, 627422436},
				A:   [7]uint32{619351081, 3931145708, 236692255, 1170054324, 941137013, 513050375, 3048807278},
				PC:  2142838,
				SR:  34587,
				USP: 2421658,
				SSP: 16610388,
				RAM: [][2]uint32{{2142830, 157}, {2142831, 104}, {2142832, 118}, {2142833, 205}, {2142834, 114}, {2142835, 3}, {15401718, 182}, {15401719, 107}, {2142836, 169}, {2142837, 198}},
				Cycles: 16,
			},
		},
		{
			name: "1000 SUB.w D2, (d8, A6, Xn) 9576",
			init: cpuState{
				D:   [8]uint32{3625249756, 3245171826, 930234665, 2446400959, 628581484, 1262082402, 2267988574, 4106991817},
				A:   [7]uint32{3443608986, 1997088992, 383529149, 2454865281, 1372498769, 2042495561, 650617147},
				PC:  7658838,
				SR:  9735,
				USP: 1794264,
				SSP: 1890700,
				RAM: [][2]uint32{{7658834, 149}, {7658835, 118}, {7658836, 164}, {7658837, 151}, {7658838, 248}, {7658839, 241}, {12, 237}, {13, 154}, {14, 143}, {15, 192}, {10129344, 250}, {10129345, 54}, {10129346, 187}, {10129347, 113}},
			},
			want: cpuState{
				D:      [8]uint32{3625249756, 3245171826, 930234665, 2446400959, 628581484, 1262082402, 2267988574, 4106991817},
				A:      [7]uint32{3443608986, 1997088992, 383529149, 2454865281, 1372498769, 2042495561, 650617147},
				PC:     3986329540,
				SR:     9735,
				USP:    1794264,
				SSP:    1890686,
				RAM:    [][2]uint32{{7658834, 149}, {7658835, 118}, {7658836, 164}, {7658837, 151}, {7658838, 248}, {7658839, 241}, {1890698, 221}, {1890699, 84}, {1890694, 38}, {1890695, 7}, {1890696, 0}, {1890697, 116}, {1890692, 149}, {1890693, 118}, {1890690, 209}, {1890691, 143}, {1890686, 149}, {1890687, 117}, {1890688, 38}, {1890689, 199}, {12, 237}, {13, 154}, {14, 143}, {15, 192}, {10129344, 250}, {10129345, 54}, {10129346, 187}, {10129347, 113}},
				Halted: true,
			},
		},
		{
			name: "1500 SUB.w -(A7), D4 9867",
			init: cpuState{
				D:   [8]uint32{4188791806, 701266004, 2620792223, 1523264027, 2471591911, 204235478, 50810715, 2026526396},
				A:   [7]uint32{451417472, 4225087265, 2634435366, 2755886176, 3431593682, 1783435471, 2941848543},
				PC:  4902344,
				SR:  41495,
				USP: 2322602,
				SSP: 7915082,
				RAM: [][2]uint32{{4902340, 152}, {4902341, 103}, {4902342, 72}, {4902343, 3}, {7915080, 97}, {7915081, 126}, {4902344, 68}, {4902345, 83}},
			},
			want: cpuState{
				D:   [8]uint32{4188791806, 701266004, 2620792223, 1523264027, 2471566953, 204235478, 50810715, 2026526396},
				A:   [7]uint32{451417472, 4225087265, 2634435366, 2755886176, 3431593682, 1783435471, 2941848543},
				PC:  4902346,
				SR:  41472,
				USP: 2322602,
				SSP: 7915080,
				RAM: [][2]uint32{{4902340, 152}, {4902341, 103}, {4902342, 72}, {4902343, 3}, {7915080, 97}, {7915081, 126}, {4902344, 68}, {4902345, 83}},
				Cycles: 10,
			},
		},
		{
			name: "2000 SUB.w D3, (d8, A0, Xn) 9770",
			init: cpuState{
				D:   [8]uint32{2469074980, 1570600625, 2927152919, 137328580, 1047357137, 2368697655, 3555661399, 1024636318},
				A:   [7]uint32{240433839, 2990126750, 549506027, 2898860265, 2394711043, 1502593005, 726682597},
				PC:  3612516,
				SR:  1536,
				USP: 3024784,
				SSP: 7237294,
				RAM: [][2]uint32{{3612512, 151}, {3612513, 112}, {3612514, 77}, {3612515, 218}, {3612516, 105}, {3612517, 127}, {12722522, 228}, {12722523, 213}, {3612518, 180}, {3612519, 138}},
			},
			want: cpuState{
				D:   [8]uint32{2469074980, 1570600625, 2927152919, 137328580, 1047357137, 2368697655, 3555661399, 1024636318},
				A:   [7]uint32{240433839, 2990126750, 549506027, 2898860265, 2394711043, 1502593005, 726682597},
				PC:  3612520,
				SR:  1538,
				USP: 3024784,
				SSP: 7237294,
				RAM: [][2]uint32{{3612512, 151}, {3612513, 112}, {3612514, 77}, {3612515, 218}, {3612516, 105}, {3612517, 127}, {12722522, 109}, {12722523, 17}, {3612518, 180}, {3612519, 138}},
				Cycles: 18,
			},
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			runTest(t, tt.init, tt.want)
		})
	}
}

func TestSUB_L(t *testing.T) {
	tests := []struct {
		name string
		init cpuState
		want cpuState
	}{
		{
			name: "000 SUB.l D4, -(A6) 99a6",
			init: cpuState{
				D:   [8]uint32{2430741266, 2034761921, 1379322137, 3782162824, 2038882028, 1468357326, 3551250365, 3843388948},
				A:   [7]uint32{3953464159, 2314470778, 2738875704, 1762611768, 710786340, 164768393, 4009775052},
				PC:  16458270,
				SR:  8991,
				USP: 6416760,
				SSP: 9623548,
				RAM: [][2]uint32{{16458266, 153}, {16458267, 166}, {16458268, 163}, {16458269, 131}, {20424, 120}, {20425, 53}, {20426, 139}, {20427, 92}, {16458270, 161}, {16458271, 219}},
			},
			want: cpuState{
				D:   [8]uint32{2430741266, 2034761921, 1379322137, 3782162824, 2038882028, 1468357326, 3551250365, 3843388948},
				A:   [7]uint32{3953464159, 2314470778, 2738875704, 1762611768, 710786340, 164768393, 4009775048},
				PC:  16458272,
				SR:  8985,
				USP: 6416760,
				SSP: 9623548,
				RAM: [][2]uint32{{16458266, 153}, {16458267, 166}, {16458268, 163}, {16458269, 131}, {20424, 254}, {20425, 174}, {20426, 172}, {20427, 112}, {16458270, 161}, {16458271, 219}},
				Cycles: 22,
			},
		},
		{
			name: "500 SUB.l (d16, A1), D0 90a9",
			init: cpuState{
				D:   [8]uint32{334203677, 312705136, 3898025512, 4292677127, 1400971187, 181492914, 817515606, 3825712596},
				A:   [7]uint32{176575104, 3820522794, 960113371, 2718489097, 3678728455, 2696676619, 685288024},
				PC:  2744060,
				SR:  1282,
				USP: 1524878,
				SSP: 11240890,
				RAM: [][2]uint32{{2744056, 144}, {2744057, 169}, {2744058, 250}, {2744059, 235}, {2744060, 170}, {2744061, 236}, {12, 123}, {13, 114}, {14, 91}, {15, 162}, {7494562, 19}, {7494563, 233}, {7494564, 189}, {7494565, 67}},
			},
			want: cpuState{
				D:      [8]uint32{334203677, 312705136, 3898025512, 4292677127, 1400971187, 181492914, 817515606, 3825712596},
				A:      [7]uint32{176575104, 3820522794, 960113371, 2718489097, 3678728455, 2696676619, 685288024},
				PC:     2071092134,
				SR:     9474,
				USP:    1524878,
				SSP:    11240876,
				RAM:    [][2]uint32{{2744056, 144}, {2744057, 169}, {2744058, 250}, {2744059, 235}, {2744060, 170}, {2744061, 236}, {11240888, 222}, {11240889, 250}, {11240884, 5}, {11240885, 2}, {11240886, 0}, {11240887, 41}, {11240882, 144}, {11240883, 169}, {11240880, 136}, {11240881, 21}, {11240876, 144}, {11240877, 177}, {11240878, 227}, {11240879, 184}, {12, 123}, {13, 114}, {14, 91}, {15, 162}, {7494562, 19}, {7494563, 233}, {7494564, 189}, {7494565, 67}},
				Halted: true,
			},
		},
		{
			name: "1000 SUB.l D0, -(A1) 91a1",
			init: cpuState{
				D:   [8]uint32{6808300, 2348337226, 4144759068, 2994982435, 2430466917, 2679086928, 4115985396, 318674175},
				A:   [7]uint32{1148597021, 3839712008, 3417249186, 360891825, 185301989, 1791949484, 1046588297},
				PC:  12967430,
				SR:  8,
				USP: 6002182,
				SSP: 1339834,
				RAM: [][2]uint32{{12967426, 145}, {12967427, 161}, {12967428, 239}, {12967429, 168}, {14506756, 105}, {14506757, 182}, {14506758, 91}, {14506759, 221}, {12967430, 183}, {12967431, 156}},
			},
			want: cpuState{
				D:   [8]uint32{6808300, 2348337226, 4144759068, 2994982435, 2430466917, 2679086928, 4115985396, 318674175},
				A:   [7]uint32{1148597021, 3839712004, 3417249186, 360891825, 185301989, 1791949484, 1046588297},
				PC:  12967432,
				SR:  0,
				USP: 6002182,
				SSP: 1339834,
				RAM: [][2]uint32{{12967426, 145}, {12967427, 161}, {12967428, 239}, {12967429, 168}, {14506756, 105}, {14506757, 78}, {14506758, 120}, {14506759, 241}, {12967430, 183}, {12967431, 156}},
				Cycles: 22,
			},
		},
		{
			name: "1500 SUB.l D6, (A6) 9d96",
			init: cpuState{
				D:   [8]uint32{3733564301, 3722637472, 114559997, 3933481534, 2935905042, 2313870483, 1452650104, 3190890119},
				A:   [7]uint32{139049803, 783282066, 656214, 921942992, 1484801290, 3818258180, 483380725},
				PC:  16031108,
				SR:  42773,
				USP: 16716632,
				SSP: 11626030,
				RAM: [][2]uint32{{16031104, 157}, {16031105, 150}, {16031106, 2}, {16031107, 139}, {12, 188}, {13, 32}, {14, 255}, {15, 146}, {2162578, 251}, {2162579, 82}, {2162580, 19}, {2162581, 71}},
			},
			want: cpuState{
				D:      [8]uint32{3733564301, 3722637472, 114559997, 3933481534, 2935905042, 2313870483, 1452650104, 3190890119},
				A:      [7]uint32{139049803, 783282066, 656214, 921942992, 1484801290, 3818258180, 483380725},
				PC:     3156279190,
				SR:     10005,
				USP:    16716632,
				SSP:    11626016,
				RAM:    [][2]uint32{{16031104, 157}, {16031105, 150}, {16031106, 2}, {16031107, 139}, {11626028, 157}, {11626029, 130}, {11626024, 167}, {11626025, 21}, {11626026, 0}, {11626027, 244}, {11626022, 157}, {11626023, 150}, {11626020, 205}, {11626021, 245}, {11626016, 157}, {11626017, 149}, {11626018, 28}, {11626019, 207}, {12, 188}, {13, 32}, {14, 255}, {15, 146}, {2162578, 251}, {2162579, 82}, {2162580, 19}, {2162581, 71}},
				Halted: true,
			},
		},
		{
			name: "2000 SUB.l 3, (A7) 5797",
			init: cpuState{
				D:   [8]uint32{3985805992, 1833191869, 3276090607, 3595141033, 2409002652, 2098937895, 1946491201, 1758336557},
				A:   [7]uint32{1884066253, 1364613245, 3379868286, 1592759763, 1773256376, 392562107, 3253197953},
				PC:  10324572,
				SR:  42502,
				USP: 4468658,
				SSP: 1593630,
				RAM: [][2]uint32{{10324568, 87}, {10324569, 151}, {10324570, 40}, {10324571, 199}, {1593630, 231}, {1593631, 192}, {1593632, 224}, {1593633, 135}, {10324572, 31}, {10324573, 207}},
			},
			want: cpuState{
				D:   [8]uint32{3985805992, 1833191869, 3276090607, 3595141033, 2409002652, 2098937895, 1946491201, 1758336557},
				A:   [7]uint32{1884066253, 1364613245, 3379868286, 1592759763, 1773256376, 392562107, 3253197953},
				PC:  10324574,
				SR:  42504,
				USP: 4468658,
				SSP: 1593630,
				RAM: [][2]uint32{{10324568, 87}, {10324569, 151}, {10324570, 40}, {10324571, 199}, {1593630, 231}, {1593631, 192}, {1593632, 224}, {1593633, 132}, {10324572, 31}, {10324573, 207}},
				Cycles: 20,
			},
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			runTest(t, tt.init, tt.want)
		})
	}
}

func TestSUBA_W(t *testing.T) {
	tests := []struct {
		name string
		init cpuState
		want cpuState
	}{
		{
			name: "000 SUBA.w (A5), A2 94d5",
			init: cpuState{
				D:   [8]uint32{2555685699, 4294204953, 1208816045, 3095682307, 4075401804, 2797727569, 3906643456, 293716231},
				A:   [7]uint32{2222925949, 1147031860, 955217515, 563695126, 3926080718, 3321264132, 723868351},
				PC:  73010,
				SR:  9736,
				USP: 1517628,
				SSP: 9739654,
				RAM: [][2]uint32{{73006, 148}, {73007, 213}, {73008, 182}, {73009, 106}, {16152580, 232}, {16152581, 53}, {73010, 82}, {73011, 211}},
			},
			want: cpuState{
				D:   [8]uint32{2555685699, 4294204953, 1208816045, 3095682307, 4075401804, 2797727569, 3906643456, 293716231},
				A:   [7]uint32{2222925949, 1147031860, 955223606, 563695126, 3926080718, 3321264132, 723868351},
				PC:  73012,
				SR:  9736,
				USP: 1517628,
				SSP: 9739654,
				RAM: [][2]uint32{{73006, 148}, {73007, 213}, {73008, 182}, {73009, 106}, {16152580, 232}, {16152581, 53}, {73010, 82}, {73011, 211}},
				Cycles: 12,
			},
		},
		{
			name: "500 SUBA.w A4, A2 94cc",
			init: cpuState{
				D:   [8]uint32{2137760209, 1551224382, 1447424128, 3550651661, 1620025275, 1102141270, 309570704, 2381611821},
				A:   [7]uint32{2238744748, 4038488692, 2862719138, 292049888, 788491941, 3720204833, 1461451153},
				PC:  2290934,
				SR:  9235,
				USP: 695150,
				SSP: 9624948,
				RAM: [][2]uint32{{2290930, 148}, {2290931, 204}, {2290932, 238}, {2290933, 210}, {2290934, 187}, {2290935, 200}},
			},
			want: cpuState{
				D:   [8]uint32{2137760209, 1551224382, 1447424128, 3550651661, 1620025275, 1102141270, 309570704, 2381611821},
				A:   [7]uint32{2238744748, 4038488692, 2862690813, 292049888, 788491941, 3720204833, 1461451153},
				PC:  2290936,
				SR:  9235,
				USP: 695150,
				SSP: 9624948,
				RAM: [][2]uint32{{2290930, 148}, {2290931, 204}, {2290932, 238}, {2290933, 210}, {2290934, 187}, {2290935, 200}},
				Cycles: 8,
			},
		},
		{
			name: "1000 SUBA.w A4, A0 90cc",
			init: cpuState{
				D:   [8]uint32{3814257001, 2462933956, 574888176, 800588259, 1865021946, 2291471666, 867968397, 2302830458},
				A:   [7]uint32{1436659069, 3611165953, 4114781543, 661110361, 1278615945, 554176329, 3764800916},
				PC:  14373096,
				SR:  260,
				USP: 11068360,
				SSP: 15685160,
				RAM: [][2]uint32{{14373092, 144}, {14373093, 204}, {14373094, 98}, {14373095, 132}, {14373096, 179}, {14373097, 58}},
			},
			want: cpuState{
				D:   [8]uint32{3814257001, 2462933956, 574888176, 800588259, 1865021946, 2291471666, 867968397, 2302830458},
				A:   [7]uint32{1436650484, 3611165953, 4114781543, 661110361, 1278615945, 554176329, 3764800916},
				PC:  14373098,
				SR:  260,
				USP: 11068360,
				SSP: 15685160,
				RAM: [][2]uint32{{14373092, 144}, {14373093, 204}, {14373094, 98}, {14373095, 132}, {14373096, 179}, {14373097, 58}},
				Cycles: 8,
			},
		},
		{
			name: "1500 SUBA.w A5, A1 92cd",
			init: cpuState{
				D:   [8]uint32{855789783, 936511422, 1361020324, 366716107, 544931698, 1388469891, 621119327, 414792588},
				A:   [7]uint32{3902119118, 3586683336, 1885500271, 2956032494, 1564777523, 3870943353, 2576076073},
				PC:  10240666,
				SR:  41229,
				USP: 16497470,
				SSP: 15277322,
				RAM: [][2]uint32{{10240662, 146}, {10240663, 205}, {10240664, 185}, {10240665, 198}, {10240666, 80}, {10240667, 242}},
			},
			want: cpuState{
				D:   [8]uint32{855789783, 936511422, 1361020324, 366716107, 544931698, 1388469891, 621119327, 414792588},
				A:   [7]uint32{3902119118, 3586689359, 1885500271, 2956032494, 1564777523, 3870943353, 2576076073},
				PC:  10240668,
				SR:  41229,
				USP: 16497470,
				SSP: 15277322,
				RAM: [][2]uint32{{10240662, 146}, {10240663, 205}, {10240664, 185}, {10240665, 198}, {10240666, 80}, {10240667, 242}},
				Cycles: 8,
			},
		},
		{
			name: "2000 SUBA.w (A5)+, A1 92dd",
			init: cpuState{
				D:   [8]uint32{1200094438, 2710464425, 1491532271, 3415499353, 1505559846, 3662795322, 1852107100, 1802724523},
				A:   [7]uint32{2304171441, 4137259190, 1024336870, 3269010179, 3422266355, 742018199, 2420570018},
				PC:  2189056,
				SR:  33024,
				USP: 9280120,
				SSP: 4328632,
				RAM: [][2]uint32{{2189052, 146}, {2189053, 221}, {2189054, 242}, {2189055, 186}, {12, 58}, {13, 228}, {14, 187}, {15, 94}, {14990174, 251}, {14990175, 64}, {14990176, 202}, {14990177, 106}},
			},
			want: cpuState{
				D:      [8]uint32{1200094438, 2710464425, 1491532271, 3415499353, 1505559846, 3662795322, 1852107100, 1802724523},
				A:      [7]uint32{2304171441, 4137259190, 1024336870, 3269010179, 3422266355, 742018201, 2420570018},
				PC:     988068706,
				SR:     8448,
				USP:    9280120,
				SSP:    4328618,
				RAM:    [][2]uint32{{2189052, 146}, {2189053, 221}, {2189054, 242}, {2189055, 186}, {4328630, 102}, {4328631, 254}, {4328626, 129}, {4328627, 0}, {4328628, 0}, {4328629, 33}, {4328624, 146}, {4328625, 221}, {4328622, 76}, {4328623, 151}, {4328618, 146}, {4328619, 209}, {4328620, 44}, {4328621, 58}, {12, 58}, {13, 228}, {14, 187}, {15, 94}, {14990174, 251}, {14990175, 64}, {14990176, 202}, {14990177, 106}},
				Halted: true,
			},
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			runTest(t, tt.init, tt.want)
		})
	}
}

func TestSUBA_L(t *testing.T) {
	tests := []struct {
		name string
		init cpuState
		want cpuState
	}{
		{
			name: "000 SUBA.l A7, A5 9bcf",
			init: cpuState{
				D:   [8]uint32{2927985550, 2572516369, 3659843338, 2212692435, 329454559, 380389395, 81115122, 3163900104},
				A:   [7]uint32{3354378056, 3285426378, 3967998792, 1787116354, 3683824708, 3322511701, 257399086},
				PC:  1027382,
				SR:  9730,
				USP: 5566452,
				SSP: 5638490,
				RAM: [][2]uint32{{1027378, 155}, {1027379, 207}, {1027380, 80}, {1027381, 239}, {1027382, 117}, {1027383, 14}},
			},
			want: cpuState{
				D:   [8]uint32{2927985550, 2572516369, 3659843338, 2212692435, 329454559, 380389395, 81115122, 3163900104},
				A:   [7]uint32{3354378056, 3285426378, 3967998792, 1787116354, 3683824708, 3316873211, 257399086},
				PC:  1027384,
				SR:  9730,
				USP: 5566452,
				SSP: 5638490,
				RAM: [][2]uint32{{1027378, 155}, {1027379, 207}, {1027380, 80}, {1027381, 239}, {1027382, 117}, {1027383, 14}},
				Cycles: 8,
			},
		},
		{
			name: "500 SUBA.l (A2), A5 9bd2",
			init: cpuState{
				D:   [8]uint32{2185894080, 2051541787, 2533431815, 1356192708, 759413790, 2994854005, 2289983088, 3838686731},
				A:   [7]uint32{1899953752, 78137318, 2480945130, 947692529, 1422852961, 1145668129, 734184684},
				PC:  5085372,
				SR:  34568,
				USP: 5238910,
				SSP: 7270852,
				RAM: [][2]uint32{{5085368, 155}, {5085369, 210}, {5085370, 250}, {5085371, 168}, {14694378, 191}, {14694379, 183}, {14694380, 218}, {14694381, 187}, {5085372, 80}, {5085373, 41}},
			},
			want: cpuState{
				D:   [8]uint32{2185894080, 2051541787, 2533431815, 1356192708, 759413790, 2994854005, 2289983088, 3838686731},
				A:   [7]uint32{1899953752, 78137318, 2480945130, 947692529, 1422852961, 2224138086, 734184684},
				PC:  5085374,
				SR:  34568,
				USP: 5238910,
				SSP: 7270852,
				RAM: [][2]uint32{{5085368, 155}, {5085369, 210}, {5085370, 250}, {5085371, 168}, {14694378, 191}, {14694379, 183}, {14694380, 218}, {14694381, 187}, {5085372, 80}, {5085373, 41}},
				Cycles: 14,
			},
		},
		{
			name: "1000 SUBA.l #, A7 9ffc",
			init: cpuState{
				D:   [8]uint32{1249772816, 1518020361, 2884699220, 3864711330, 1911106808, 3761841370, 2676111703, 923855093},
				A:   [7]uint32{1873603648, 46024271, 760093153, 599376497, 3846156052, 3086390888, 3290626641},
				PC:  14655082,
				SR:  32782,
				USP: 8461784,
				SSP: 215396,
				RAM: [][2]uint32{{14655078, 159}, {14655079, 252}, {14655080, 246}, {14655081, 140}, {14655082, 200}, {14655083, 189}, {14655084, 93}, {14655085, 63}, {14655086, 180}, {14655087, 241}},
			},
			want: cpuState{
				D:   [8]uint32{1249772816, 1518020361, 2884699220, 3864711330, 1911106808, 3761841370, 2676111703, 923855093},
				A:   [7]uint32{1873603648, 46024271, 760093153, 599376497, 3846156052, 3086390888, 3290626641},
				PC:  14655088,
				SR:  32782,
				USP: 167007515,
				SSP: 215396,
				RAM: [][2]uint32{{14655078, 159}, {14655079, 252}, {14655080, 246}, {14655081, 140}, {14655082, 200}, {14655083, 189}, {14655084, 93}, {14655085, 63}, {14655086, 180}, {14655087, 241}},
				Cycles: 16,
			},
		},
		{
			name: "1500 SUBA.l (A3)+, A7 9fdb",
			init: cpuState{
				D:   [8]uint32{4278707095, 3234980542, 852299093, 364256079, 3806006670, 160748904, 1313270789, 784579430},
				A:   [7]uint32{3699481401, 2977221355, 823793567, 3976332257, 492966052, 4180531494, 216652224},
				PC:  6827910,
				SR:  1284,
				USP: 9251184,
				SSP: 9116262,
				RAM: [][2]uint32{{6827906, 159}, {6827907, 219}, {6827908, 183}, {6827909, 74}, {12, 235}, {13, 196}, {14, 251}, {15, 24}, {12909336, 99}, {12909337, 153}, {12909338, 50}, {12909339, 37}},
			},
			want: cpuState{
				D:      [8]uint32{4278707095, 3234980542, 852299093, 364256079, 3806006670, 160748904, 1313270789, 784579430},
				A:      [7]uint32{3699481401, 2977221355, 823793567, 3976332257, 492966052, 4180531494, 216652224},
				PC:     3955555100,
				SR:     9476,
				USP:    9251184,
				SSP:    9116248,
				RAM:    [][2]uint32{{6827906, 159}, {6827907, 219}, {6827908, 183}, {6827909, 74}, {9116260, 47}, {9116261, 132}, {9116256, 5}, {9116257, 4}, {9116258, 0}, {9116259, 104}, {9116254, 159}, {9116255, 219}, {9116252, 3}, {9116253, 225}, {9116248, 159}, {9116249, 209}, {9116250, 237}, {9116251, 2}, {12, 235}, {13, 196}, {14, 251}, {15, 24}, {12909336, 99}, {12909337, 153}, {12909338, 50}, {12909339, 37}},
				Halted: true,
			},
		},
		{
			name: "2000 SUBA.l (d16, A1), A4 99e9",
			init: cpuState{
				D:   [8]uint32{1991873915, 3961568039, 1651929968, 2575840779, 896837556, 2315102667, 842750628, 2507533045},
				A:   [7]uint32{1833300072, 2976508747, 660631124, 495463360, 665171967, 1762331000, 3466448591},
				PC:  6317088,
				SR:  41988,
				USP: 11337178,
				SSP: 6436056,
				RAM: [][2]uint32{{6317084, 153}, {6317085, 233}, {6317086, 168}, {6317087, 64}, {6317088, 191}, {6317089, 138}, {12, 66}, {13, 224}, {14, 234}, {15, 32}, {14740000, 94}, {14740001, 156}, {14740002, 1}, {14740003, 164}},
			},
			want: cpuState{
				D:      [8]uint32{1991873915, 3961568039, 1651929968, 2575840779, 896837556, 2315102667, 842750628, 2507533045},
				A:      [7]uint32{1833300072, 2976508747, 660631124, 495463360, 665171967, 1762331000, 3466448591},
				PC:     1122036260,
				SR:     9220,
				USP:    11337178,
				SSP:    6436042,
				RAM:    [][2]uint32{{6317084, 153}, {6317085, 233}, {6317086, 168}, {6317087, 64}, {6317088, 191}, {6317089, 138}, {6436054, 100}, {6436055, 30}, {6436050, 164}, {6436051, 4}, {6436052, 0}, {6436053, 96}, {6436048, 153}, {6436049, 233}, {6436046, 147}, {6436047, 139}, {6436042, 153}, {6436043, 245}, {6436044, 177}, {6436045, 105}, {12, 66}, {13, 224}, {14, 234}, {15, 32}, {14740000, 94}, {14740001, 156}, {14740002, 1}, {14740003, 164}},
				Halted: true,
			},
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			runTest(t, tt.init, tt.want)
		})
	}
}

func TestSUBX_B(t *testing.T) {
	tests := []struct {
		name string
		init cpuState
		want cpuState
	}{
		{
			name: "000 SUBX.b -(A6), -(A5) 9b0e",
			init: cpuState{
				D:   [8]uint32{1992413736, 2830914761, 1670552328, 1701732656, 790525025, 2778523620, 586266019, 2663743660},
				A:   [7]uint32{2006458740, 662972021, 885725256, 2224149744, 3585966472, 1971606215, 1492285973},
				PC:  13635960,
				SR:  8463,
				USP: 12911244,
				SSP: 7204516,
				RAM: [][2]uint32{{13635956, 155}, {13635957, 14}, {13635958, 243}, {13635959, 140}, {15890964, 114}, {15890965, 140}, {8671942, 133}, {8671943, 138}, {13635960, 33}, {13635961, 45}},
			},
			want: cpuState{
				D:   [8]uint32{1992413736, 2830914761, 1670552328, 1701732656, 790525025, 2778523620, 586266019, 2663743660},
				A:   [7]uint32{2006458740, 662972021, 885725256, 2224149744, 3585966472, 1971606214, 1492285972},
				PC:  13635962,
				SR:  8450,
				USP: 12911244,
				SSP: 7204516,
				RAM: [][2]uint32{{13635956, 155}, {13635957, 14}, {13635958, 243}, {13635959, 140}, {15890964, 114}, {15890965, 140}, {8671942, 19}, {8671943, 138}, {13635960, 33}, {13635961, 45}},
				Cycles: 18,
			},
		},
		{
			name: "500 SUBX.b D3, D1 9303",
			init: cpuState{
				D:   [8]uint32{3607775820, 3852275476, 2086456299, 3109634837, 3061187380, 4023692619, 606212908, 750760402},
				A:   [7]uint32{2811092768, 3538319113, 2026927621, 129018793, 1986217640, 2307847067, 1577127887},
				PC:  10401066,
				SR:  34574,
				USP: 7201574,
				SSP: 15314004,
				RAM: [][2]uint32{{10401062, 147}, {10401063, 3}, {10401064, 37}, {10401065, 132}, {10401066, 116}, {10401067, 10}},
			},
			want: cpuState{
				D:   [8]uint32{3607775820, 3852275711, 2086456299, 3109634837, 3061187380, 4023692619, 606212908, 750760402},
				A:   [7]uint32{2811092768, 3538319113, 2026927621, 129018793, 1986217640, 2307847067, 1577127887},
				PC:  10401068,
				SR:  34585,
				USP: 7201574,
				SSP: 15314004,
				RAM: [][2]uint32{{10401062, 147}, {10401063, 3}, {10401064, 37}, {10401065, 132}, {10401066, 116}, {10401067, 10}},
				Cycles: 4,
			},
		},
		{
			name: "1000 SUBX.b D3, D7 9f03",
			init: cpuState{
				D:   [8]uint32{2214119253, 3205647929, 1118066804, 3524112174, 2586932746, 3142786789, 2177820875, 3717659512},
				A:   [7]uint32{4065170353, 2794160949, 174123141, 1494318511, 1764308580, 93036787, 4070929803},
				PC:  2268760,
				SR:  9995,
				USP: 7256972,
				SSP: 3415412,
				RAM: [][2]uint32{{2268756, 159}, {2268757, 3}, {2268758, 126}, {2268759, 95}, {2268760, 155}, {2268761, 85}},
			},
			want: cpuState{
				D:   [8]uint32{2214119253, 3205647929, 1118066804, 3524112174, 2586932746, 3142786789, 2177820875, 3717659466},
				A:   [7]uint32{4065170353, 2794160949, 174123141, 1494318511, 1764308580, 93036787, 4070929803},
				PC:  2268762,
				SR:  9984,
				USP: 7256972,
				SSP: 3415412,
				RAM: [][2]uint32{{2268756, 159}, {2268757, 3}, {2268758, 126}, {2268759, 95}, {2268760, 155}, {2268761, 85}},
				Cycles: 4,
			},
		},
		{
			name: "1500 SUBX.b D2, D7 9f02",
			init: cpuState{
				D:   [8]uint32{2404998694, 3054321717, 831178097, 2315447791, 1837712828, 1967192083, 3833131050, 2035964520},
				A:   [7]uint32{3550639313, 2352309012, 3072929013, 681564011, 211763272, 138000919, 1175576334},
				PC:  10970312,
				SR:  9733,
				USP: 11692018,
				SSP: 10180286,
				RAM: [][2]uint32{{10970308, 159}, {10970309, 2}, {10970310, 179}, {10970311, 1}, {10970312, 75}, {10970313, 85}},
			},
			want: cpuState{
				D:   [8]uint32{2404998694, 3054321717, 831178097, 2315447791, 1837712828, 1967192083, 3833131050, 2035964663},
				A:   [7]uint32{3550639313, 2352309012, 3072929013, 681564011, 211763272, 138000919, 1175576334},
				PC:  10970314,
				SR:  9753,
				USP: 11692018,
				SSP: 10180286,
				RAM: [][2]uint32{{10970308, 159}, {10970309, 2}, {10970310, 179}, {10970311, 1}, {10970312, 75}, {10970313, 85}},
				Cycles: 4,
			},
		},
		{
			name: "2000 SUBX.b -(A0), -(A3) 9708",
			init: cpuState{
				D:   [8]uint32{2640525249, 3789624198, 2455280901, 3058645379, 3645109833, 1128799361, 3181016728, 104781491},
				A:   [7]uint32{2149250470, 2067707905, 48345627, 971488715, 3663762014, 3856590103, 644088014},
				PC:  14543104,
				SR:  33024,
				USP: 12161948,
				SSP: 3247132,
				RAM: [][2]uint32{{14543100, 151}, {14543101, 8}, {14543102, 147}, {14543103, 251}, {1766820, 168}, {1766821, 175}, {15187402, 53}, {15187403, 64}, {14543104, 138}, {14543105, 239}},
			},
			want: cpuState{
				D:   [8]uint32{2640525249, 3789624198, 2455280901, 3058645379, 3645109833, 1128799361, 3181016728, 104781491},
				A:   [7]uint32{2149250469, 2067707905, 48345627, 971488714, 3663762014, 3856590103, 644088014},
				PC:  14543106,
				SR:  33051,
				USP: 12161948,
				SSP: 3247132,
				RAM: [][2]uint32{{14543100, 151}, {14543101, 8}, {14543102, 147}, {14543103, 251}, {1766820, 168}, {1766821, 175}, {15187402, 134}, {15187403, 64}, {14543104, 138}, {14543105, 239}},
				Cycles: 18,
			},
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			runTest(t, tt.init, tt.want)
		})
	}
}

func TestSUBX_W(t *testing.T) {
	tests := []struct {
		name string
		init cpuState
		want cpuState
	}{
		{
			name: "000 SUBX.w D5, D2 9545",
			init: cpuState{
				D:   [8]uint32{2368090618, 343229324, 4077421584, 1140111816, 776276871, 3590116636, 2450341692, 3648754164},
				A:   [7]uint32{4047161302, 70600069, 1880235323, 2046352221, 2227657362, 3059693067, 2360542679},
				PC:  2067428,
				SR:  41477,
				USP: 4882060,
				SSP: 4975382,
				RAM: [][2]uint32{{2067424, 149}, {2067425, 69}, {2067426, 64}, {2067427, 193}, {2067428, 191}, {2067429, 222}},
			},
			want: cpuState{
				D:   [8]uint32{2368090618, 343229324, 4077432564, 1140111816, 776276871, 3590116636, 2450341692, 3648754164},
				A:   [7]uint32{4047161302, 70600069, 1880235323, 2046352221, 2227657362, 3059693067, 2360542679},
				PC:  2067430,
				SR:  41497,
				USP: 4882060,
				SSP: 4975382,
				RAM: [][2]uint32{{2067424, 149}, {2067425, 69}, {2067426, 64}, {2067427, 193}, {2067428, 191}, {2067429, 222}},
				Cycles: 4,
			},
		},
		{
			name: "500 SUBX.w -(A2), -(A0) 914a",
			init: cpuState{
				D:   [8]uint32{2936823178, 7347522, 3773887089, 4003544569, 3057959006, 2070266061, 1523658904, 3894157454},
				A:   [7]uint32{2682350763, 1452815909, 2769952263, 1459158443, 4178282268, 3078142158, 706093560},
				PC:  10310310,
				SR:  1037,
				USP: 4171798,
				SSP: 4256170,
				RAM: [][2]uint32{{10310306, 145}, {10310307, 74}, {10310308, 101}, {10310309, 149}, {12, 113}, {13, 34}, {14, 72}, {15, 210}, {2246866, 48}, {2246867, 106}, {2246868, 137}, {2246869, 154}},
			},
			want: cpuState{
				D:      [8]uint32{2936823178, 7347522, 3773887089, 4003544569, 3057959006, 2070266061, 1523658904, 3894157454},
				A:      [7]uint32{2682350763, 1452815909, 2769952261, 1459158443, 4178282268, 3078142158, 706093560},
				PC:     1898072278,
				SR:     9229,
				USP:    4171798,
				SSP:    4256156,
				RAM:    [][2]uint32{{10310306, 145}, {10310307, 74}, {10310308, 101}, {10310309, 149}, {4256168, 82}, {4256169, 166}, {4256164, 4}, {4256165, 13}, {4256166, 0}, {4256167, 157}, {4256162, 145}, {4256163, 74}, {4256160, 30}, {4256161, 5}, {4256156, 145}, {4256157, 81}, {4256158, 165}, {4256159, 26}, {12, 113}, {13, 34}, {14, 72}, {15, 210}, {2246866, 48}, {2246867, 106}, {2246868, 137}, {2246869, 154}},
				Halted: true,
			},
		},
		{
			name: "1000 SUBX.w D5, D6 9d45",
			init: cpuState{
				D:   [8]uint32{3743873211, 2510793158, 952828386, 2955811353, 278848245, 1916221434, 173137106, 19647896},
				A:   [7]uint32{3480323470, 558545683, 1696229955, 4116847201, 4258902043, 122529455, 2057321215},
				PC:  13102538,
				SR:  32779,
				USP: 16379214,
				SSP: 14552778,
				RAM: [][2]uint32{{13102534, 157}, {13102535, 69}, {13102536, 170}, {13102537, 148}, {13102538, 109}, {13102539, 206}},
			},
			want: cpuState{
				D:   [8]uint32{3743873211, 2510793158, 952828386, 2955811353, 278848245, 1916221434, 173122776, 19647896},
				A:   [7]uint32{3480323470, 558545683, 1696229955, 4116847201, 4258902043, 122529455, 2057321215},
				PC:  13102540,
				SR:  32776,
				USP: 16379214,
				SSP: 14552778,
				RAM: [][2]uint32{{13102534, 157}, {13102535, 69}, {13102536, 170}, {13102537, 148}, {13102538, 109}, {13102539, 206}},
				Cycles: 4,
			},
		},
		{
			name: "1500 SUBX.w -(A3), -(A1) 934b",
			init: cpuState{
				D:   [8]uint32{3992332493, 2953250120, 3581761513, 1360944680, 1036679635, 1848665135, 368980980, 1772969713},
				A:   [7]uint32{1953424370, 199472263, 2900465183, 3331704019, 1205584150, 1112065161, 1755161018},
				PC:  15138642,
				SR:  8704,
				USP: 15746114,
				SSP: 16484694,
				RAM: [][2]uint32{{15138638, 147}, {15138639, 75}, {15138640, 180}, {15138641, 87}, {12, 151}, {13, 160}, {14, 236}, {15, 228}, {10546404, 128}, {10546405, 31}, {10546406, 216}, {10546407, 24}},
			},
			want: cpuState{
				D:      [8]uint32{3992332493, 2953250120, 3581761513, 1360944680, 1036679635, 1848665135, 368980980, 1772969713},
				A:      [7]uint32{1953424370, 199472263, 2900465183, 3331704017, 1205584150, 1112065161, 1755161018},
				PC:     2543906024,
				SR:     8704,
				USP:    15746114,
				SSP:    16484680,
				RAM:    [][2]uint32{{15138638, 147}, {15138639, 75}, {15138640, 180}, {15138641, 87}, {16484692, 255}, {16484693, 82}, {16484688, 34}, {16484689, 0}, {16484690, 0}, {16484691, 230}, {16484686, 147}, {16484687, 75}, {16484684, 196}, {16484685, 209}, {16484680, 147}, {16484681, 85}, {16484682, 198}, {16484683, 149}, {12, 151}, {13, 160}, {14, 236}, {15, 228}, {10546404, 128}, {10546405, 31}, {10546406, 216}, {10546407, 24}},
				Halted: true,
			},
		},
		{
			name: "2000 SUBX.w D6, D3 9746",
			init: cpuState{
				D:   [8]uint32{2204287251, 926604205, 2878869808, 3199531458, 1911079139, 2047342402, 708180200, 3402671090},
				A:   [7]uint32{386897662, 338160254, 2001948227, 2826979243, 2559545764, 1141324282, 2960639232},
				PC:  5820544,
				SR:  33054,
				USP: 5444154,
				SSP: 3647576,
				RAM: [][2]uint32{{5820540, 151}, {5820541, 70}, {5820542, 209}, {5820543, 15}, {5820544, 160}, {5820545, 62}},
			},
			want: cpuState{
				D:   [8]uint32{2204287251, 926604205, 2878869808, 3199467737, 1911079139, 2047342402, 708180200, 3402671090},
				A:   [7]uint32{386897662, 338160254, 2001948227, 2826979243, 2559545764, 1141324282, 2960639232},
				PC:  5820546,
				SR:  33024,
				USP: 5444154,
				SSP: 3647576,
				RAM: [][2]uint32{{5820540, 151}, {5820541, 70}, {5820542, 209}, {5820543, 15}, {5820544, 160}, {5820545, 62}},
				Cycles: 4,
			},
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			runTest(t, tt.init, tt.want)
		})
	}
}

func TestSUBX_L(t *testing.T) {
	tests := []struct {
		name string
		init cpuState
		want cpuState
	}{
		{
			name: "000 SUBX.l -(A6), -(A2) 958e",
			init: cpuState{
				D:   [8]uint32{3998716147, 1884058010, 347900656, 1574976611, 3082201317, 2227218840, 2511244533, 2551522518},
				A:   [7]uint32{1723973144, 3968916633, 1403253225, 1895955939, 868571842, 764095775, 2031814423},
				PC:  10788340,
				SR:  8724,
				USP: 10546882,
				SSP: 4313374,
				RAM: [][2]uint32{{10788336, 149}, {10788337, 142}, {10788338, 143}, {10788339, 243}, {12, 50}, {13, 222}, {14, 157}, {15, 148}, {14589332, 87}, {14589333, 251}, {14589334, 193}, {14589335, 15}},
			},
			want: cpuState{
				D:      [8]uint32{3998716147, 1884058010, 347900656, 1574976611, 3082201317, 2227218840, 2511244533, 2551522518},
				A:      [7]uint32{1723973144, 3968916633, 1403253225, 1895955939, 868571842, 764095775, 2031814423},
				PC:     853450136,
				SR:     8724,
				USP:    10546882,
				SSP:    4313360,
				RAM:    [][2]uint32{{10788336, 149}, {10788337, 142}, {10788338, 143}, {10788339, 243}, {4313372, 157}, {4313373, 244}, {4313368, 34}, {4313369, 20}, {4313370, 0}, {4313371, 164}, {4313366, 149}, {4313367, 142}, {4313364, 7}, {4313365, 21}, {4313360, 149}, {4313361, 149}, {4313362, 121}, {4313363, 27}, {12, 50}, {13, 222}, {14, 157}, {15, 148}, {14589332, 87}, {14589333, 251}, {14589334, 193}, {14589335, 15}},
				Halted: true,
			},
		},
		{
			name: "500 SUBX.l D5, D6 9d85",
			init: cpuState{
				D:   [8]uint32{1177166279, 2983156458, 4052913851, 3653753092, 1481739443, 280949103, 2853165828, 4158329713},
				A:   [7]uint32{1994257294, 3560441798, 555313364, 1296375058, 1883998737, 4097668338, 2082551441},
				PC:  15477386,
				SR:  799,
				USP: 13714882,
				SSP: 7272352,
				RAM: [][2]uint32{{15477382, 157}, {15477383, 133}, {15477384, 88}, {15477385, 163}, {15477386, 203}, {15477387, 226}},
			},
			want: cpuState{
				D:   [8]uint32{1177166279, 2983156458, 4052913851, 3653753092, 1481739443, 280949103, 2572216724, 4158329713},
				A:   [7]uint32{1994257294, 3560441798, 555313364, 1296375058, 1883998737, 4097668338, 2082551441},
				PC:  15477388,
				SR:  776,
				USP: 13714882,
				SSP: 7272352,
				RAM: [][2]uint32{{15477382, 157}, {15477383, 133}, {15477384, 88}, {15477385, 163}, {15477386, 203}, {15477387, 226}},
				Cycles: 8,
			},
		},
		{
			name: "1000 SUBX.l -(A0), -(A2) 9588",
			init: cpuState{
				D:   [8]uint32{1073792535, 1713940482, 4150666253, 3680109022, 3585595004, 133752179, 568794129, 2437906882},
				A:   [7]uint32{3406972139, 3339041660, 4172556270, 4200484020, 1820746192, 4211564701, 177623546},
				PC:  16263260,
				SR:  1291,
				USP: 8404574,
				SSP: 12640662,
				RAM: [][2]uint32{{16263256, 149}, {16263257, 136}, {16263258, 249}, {16263259, 41}, {12, 129}, {13, 34}, {14, 201}, {15, 52}, {2279732, 134}, {2279733, 128}, {2279734, 109}, {2279735, 192}},
			},
			want: cpuState{
				D:      [8]uint32{1073792535, 1713940482, 4150666253, 3680109022, 3585595004, 133752179, 568794129, 2437906882},
				A:      [7]uint32{3406972139, 3339041660, 4172556270, 4200484020, 1820746192, 4211564701, 177623546},
				PC:     2166540600,
				SR:     9483,
				USP:    8404574,
				SSP:    12640648,
				RAM:    [][2]uint32{{16263256, 149}, {16263257, 136}, {16263258, 249}, {16263259, 41}, {12640660, 40}, {12640661, 92}, {12640656, 5}, {12640657, 11}, {12640658, 0}, {12640659, 248}, {12640654, 149}, {12640655, 136}, {12640652, 68}, {12640653, 233}, {12640648, 149}, {12640649, 145}, {12640650, 203}, {12640651, 18}, {12, 129}, {13, 34}, {14, 201}, {15, 52}, {2279732, 134}, {2279733, 128}, {2279734, 109}, {2279735, 192}},
				Halted: true,
			},
		},
		{
			name: "1500 SUBX.l D3, D1 9383",
			init: cpuState{
				D:   [8]uint32{3081361654, 1949624502, 275647440, 4203986045, 2801166071, 3214309611, 3618139208, 521033498},
				A:   [7]uint32{2198920263, 2656819640, 1901102606, 1347607790, 527186474, 2690600641, 2192291404},
				PC:  5508346,
				SR:  42781,
				USP: 14277816,
				SSP: 6647522,
				RAM: [][2]uint32{{5508342, 147}, {5508343, 131}, {5508344, 66}, {5508345, 153}, {5508346, 69}, {5508347, 84}},
			},
			want: cpuState{
				D:   [8]uint32{3081361654, 2040605752, 275647440, 4203986045, 2801166071, 3214309611, 3618139208, 521033498},
				A:   [7]uint32{2198920263, 2656819640, 1901102606, 1347607790, 527186474, 2690600641, 2192291404},
				PC:  5508348,
				SR:  42769,
				USP: 14277816,
				SSP: 6647522,
				RAM: [][2]uint32{{5508342, 147}, {5508343, 131}, {5508344, 66}, {5508345, 153}, {5508346, 69}, {5508347, 84}},
				Cycles: 8,
			},
		},
		{
			name: "2000 SUBX.l D1, D6 9d81",
			init: cpuState{
				D:   [8]uint32{3270441181, 2998506866, 266330081, 3613779098, 2443894529, 3085376056, 2530138017, 819066031},
				A:   [7]uint32{568205808, 4157961893, 2519078259, 720555680, 940767118, 3553912161, 883864083},
				PC:  13146686,
				SR:  8961,
				USP: 574652,
				SSP: 3515870,
				RAM: [][2]uint32{{13146682, 157}, {13146683, 129}, {13146684, 123}, {13146685, 25}, {13146686, 243}, {13146687, 27}},
			},
			want: cpuState{
				D:   [8]uint32{3270441181, 2998506866, 266330081, 3613779098, 2443894529, 3085376056, 3826598447, 819066031},
				A:   [7]uint32{568205808, 4157961893, 2519078259, 720555680, 940767118, 3553912161, 883864083},
				PC:  13146688,
				SR:  8985,
				USP: 574652,
				SSP: 3515870,
				RAM: [][2]uint32{{13146682, 157}, {13146683, 129}, {13146684, 123}, {13146685, 25}, {13146686, 243}, {13146687, 27}},
				Cycles: 8,
			},
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			runTest(t, tt.init, tt.want)
		})
	}
}

func TestCMP_B(t *testing.T) {
	tests := []struct {
		name string
		init cpuState
		want cpuState
	}{
		{
			name: "000 CMP.b -(A6), D4 b826",
			init: cpuState{
				D:   [8]uint32{971844580, 1812861013, 27970319, 3949035807, 2380838791, 3659193200, 145864429, 3453271095},
				A:   [7]uint32{1372439117, 2510623076, 305287105, 4155038048, 367488451, 2584974675, 2945782320},
				PC:  10279440,
				SR:  34061,
				USP: 11391200,
				SSP: 10095880,
				RAM: [][2]uint32{{10279436, 184}, {10279437, 38}, {10279438, 17}, {10279439, 4}, {9769518, 63}, {9769519, 246}, {10279440, 74}, {10279441, 145}},
			},
			want: cpuState{
				D:   [8]uint32{971844580, 1812861013, 27970319, 3949035807, 2380838791, 3659193200, 145864429, 3453271095},
				A:   [7]uint32{1372439117, 2510623076, 305287105, 4155038048, 367488451, 2584974675, 2945782319},
				PC:  10279442,
				SR:  34057,
				USP: 11391200,
				SSP: 10095880,
				RAM: [][2]uint32{{10279436, 184}, {10279437, 38}, {10279438, 17}, {10279439, 4}, {9769518, 63}, {9769519, 246}, {10279440, 74}, {10279441, 145}},
				Cycles: 10,
			},
		},
		{
			name: "500 CMP.b (A3)+, D6 bc1b",
			init: cpuState{
				D:   [8]uint32{4103582143, 3541400306, 2142431289, 2317210614, 1887327045, 2952401233, 3185063202, 3176330391},
				A:   [7]uint32{1407754141, 401874186, 4286769263, 2964796375, 2781891991, 3233929964, 2763242394},
				PC:  2419364,
				SR:  42764,
				USP: 3717632,
				SSP: 7952714,
				RAM: [][2]uint32{{2419360, 188}, {2419361, 27}, {2419362, 104}, {2419363, 32}, {12006358, 184}, {12006359, 148}, {2419364, 102}, {2419365, 185}},
			},
			want: cpuState{
				D:   [8]uint32{4103582143, 3541400306, 2142431289, 2317210614, 1887327045, 2952401233, 3185063202, 3176330391},
				A:   [7]uint32{1407754141, 401874186, 4286769263, 2964796376, 2781891991, 3233929964, 2763242394},
				PC:  2419366,
				SR:  42763,
				USP: 3717632,
				SSP: 7952714,
				RAM: [][2]uint32{{2419360, 188}, {2419361, 27}, {2419362, 104}, {2419363, 32}, {12006358, 184}, {12006359, 148}, {2419364, 102}, {2419365, 185}},
				Cycles: 8,
			},
		},
		{
			name: "1000 CMP.b (A2)+, D6 bc1a",
			init: cpuState{
				D:   [8]uint32{587359256, 3377784372, 3419674454, 3191861891, 2231089784, 4260099078, 836723093, 3141217735},
				A:   [7]uint32{4137390969, 809576895, 2181251552, 4114761434, 2237186001, 2287719562, 2250507913},
				PC:  5320572,
				SR:  271,
				USP: 9094554,
				SSP: 11548102,
				RAM: [][2]uint32{{5320568, 188}, {5320569, 26}, {5320570, 159}, {5320571, 133}, {213472, 159}, {213473, 23}, {5320572, 11}, {5320573, 12}},
			},
			want: cpuState{
				D:   [8]uint32{587359256, 3377784372, 3419674454, 3191861891, 2231089784, 4260099078, 836723093, 3141217735},
				A:   [7]uint32{4137390969, 809576895, 2181251553, 4114761434, 2237186001, 2287719562, 2250507913},
				PC:  5320574,
				SR:  265,
				USP: 9094554,
				SSP: 11548102,
				RAM: [][2]uint32{{5320568, 188}, {5320569, 26}, {5320570, 159}, {5320571, 133}, {213472, 159}, {213473, 23}, {5320572, 11}, {5320573, 12}},
				Cycles: 8,
			},
		},
		{
			name: "1500 CMP.b (A0)+, (A1)+ b308",
			init: cpuState{
				D:   [8]uint32{477093065, 2614927220, 3913435992, 1552413812, 3318717539, 1856776789, 2613612364, 1210048736},
				A:   [7]uint32{971509181, 1410455758, 1605825394, 2560635674, 4207601826, 3367104321, 1245244702},
				PC:  2291006,
				SR:  1547,
				USP: 14016228,
				SSP: 7422354,
				RAM: [][2]uint32{{2291002, 179}, {2291003, 8}, {2291004, 252}, {2291005, 194}, {15207868, 20}, {15207869, 198}, {1169614, 235}, {1169615, 54}, {2291006, 191}, {2291007, 64}},
			},
			want: cpuState{
				D:   [8]uint32{477093065, 2614927220, 3913435992, 1552413812, 3318717539, 1856776789, 2613612364, 1210048736},
				A:   [7]uint32{971509182, 1410455759, 1605825394, 2560635674, 4207601826, 3367104321, 1245244702},
				PC:  2291008,
				SR:  1536,
				USP: 14016228,
				SSP: 7422354,
				RAM: [][2]uint32{{2291002, 179}, {2291003, 8}, {2291004, 252}, {2291005, 194}, {15207868, 20}, {15207869, 198}, {1169614, 235}, {1169615, 54}, {2291006, 191}, {2291007, 64}},
				Cycles: 12,
			},
		},
		{
			name: "2000 CMP.b (A0)+, (A7)+ bf08",
			init: cpuState{
				D:   [8]uint32{2664990469, 3584817476, 1655904414, 3265092004, 2379807461, 1282059737, 3821217157, 44524397},
				A:   [7]uint32{4057619591, 446612087, 2324484762, 562336244, 1340700737, 1157129157, 738026055},
				PC:  2839622,
				SR:  41485,
				USP: 6060238,
				SSP: 2341050,
				RAM: [][2]uint32{{2839618, 191}, {2839619, 8}, {2839620, 166}, {2839621, 7}, {14310534, 30}, {14310535, 222}, {2341050, 157}, {2341051, 57}, {2839622, 46}, {2839623, 111}},
			},
			want: cpuState{
				D:   [8]uint32{2664990469, 3584817476, 1655904414, 3265092004, 2379807461, 1282059737, 3821217157, 44524397},
				A:   [7]uint32{4057619592, 446612087, 2324484762, 562336244, 1340700737, 1157129157, 738026055},
				PC:  2839624,
				SR:  41481,
				USP: 6060238,
				SSP: 2341052,
				RAM: [][2]uint32{{2839618, 191}, {2839619, 8}, {2839620, 166}, {2839621, 7}, {14310534, 30}, {14310535, 222}, {2341050, 157}, {2341051, 57}, {2839622, 46}, {2839623, 111}},
				Cycles: 12,
			},
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			runTest(t, tt.init, tt.want)
		})
	}
}

func TestCMP_W(t *testing.T) {
	tests := []struct {
		name string
		init cpuState
		want cpuState
	}{
		{
			name: "000 CMP.w D0, D7 be40",
			init: cpuState{
				D:   [8]uint32{475846680, 1619015039, 2261907358, 638950013, 2024958630, 2787497989, 2852434231, 2181996627},
				A:   [7]uint32{912093076, 3515086865, 685731751, 945725105, 709438987, 719239687, 621681129},
				PC:  4295318,
				SR:  1553,
				USP: 15983202,
				SSP: 14333880,
				RAM: [][2]uint32{{4295314, 190}, {4295315, 64}, {4295316, 17}, {4295317, 40}, {4295318, 156}, {4295319, 47}},
			},
			want: cpuState{
				D:   [8]uint32{475846680, 1619015039, 2261907358, 638950013, 2024958630, 2787497989, 2852434231, 2181996627},
				A:   [7]uint32{912093076, 3515086865, 685731751, 945725105, 709438987, 719239687, 621681129},
				PC:  4295320,
				SR:  1561,
				USP: 15983202,
				SSP: 14333880,
				RAM: [][2]uint32{{4295314, 190}, {4295315, 64}, {4295316, 17}, {4295317, 40}, {4295318, 156}, {4295319, 47}},
				Cycles: 4,
			},
		},
		{
			name: "500 CMP.w -(A1), D0 b061",
			init: cpuState{
				D:   [8]uint32{142592529, 2185911067, 2934495150, 141010255, 2931120456, 3253358107, 845451191, 2640229853},
				A:   [7]uint32{3094419315, 2760999199, 1086957140, 2775550500, 1745243799, 1831606442, 1400276022},
				PC:  9636860,
				SR:  1798,
				USP: 7476816,
				SSP: 7402524,
				RAM: [][2]uint32{{9636856, 176}, {9636857, 97}, {9636858, 116}, {9636859, 108}, {12, 136}, {13, 72}, {14, 119}, {15, 208}, {4749264, 31}, {4749265, 143}, {4749266, 70}, {4749267, 210}},
			},
			want: cpuState{
				D:      [8]uint32{142592529, 2185911067, 2934495150, 141010255, 2931120456, 3253358107, 845451191, 2640229853},
				A:      [7]uint32{3094419315, 2760999197, 1086957140, 2775550500, 1745243799, 1831606442, 1400276022},
				PC:     2286450644,
				SR:     9990,
				USP:    7476816,
				SSP:    7402510,
				RAM:    [][2]uint32{{9636856, 176}, {9636857, 97}, {9636858, 116}, {9636859, 108}, {7402522, 11}, {7402523, 252}, {7402518, 7}, {7402519, 6}, {7402520, 0}, {7402521, 147}, {7402516, 176}, {7402517, 97}, {7402514, 129}, {7402515, 29}, {7402510, 176}, {7402511, 113}, {7402512, 164}, {7402513, 145}, {12, 136}, {13, 72}, {14, 119}, {15, 208}, {4749264, 31}, {4749265, 143}, {4749266, 70}, {4749267, 210}},
				Halted: true,
			},
		},
		{
			name: "1000 CMP.w (A1)+, (A2)+ b549",
			init: cpuState{
				D:   [8]uint32{2174776045, 2906739810, 2593367242, 1246203378, 3712275982, 270526096, 2282705329, 2654483443},
				A:   [7]uint32{2647120325, 2459271211, 2668870752, 383522417, 2493378426, 4249576296, 3061110826},
				PC:  11441080,
				SR:  42763,
				USP: 875472,
				SSP: 8920110,
				RAM: [][2]uint32{{11441076, 181}, {11441077, 73}, {11441078, 125}, {11441079, 0}, {12, 208}, {13, 32}, {14, 233}, {15, 160}, {2156960, 236}, {2156961, 166}, {2156962, 25}, {2156963, 70}},
			},
			want: cpuState{
				D:      [8]uint32{2174776045, 2906739810, 2593367242, 1246203378, 3712275982, 270526096, 2282705329, 2654483443},
				A:      [7]uint32{2647120325, 2459271213, 2668870752, 383522417, 2493378426, 4249576296, 3061110826},
				PC:     3491817892,
				SR:     9995,
				USP:    875472,
				SSP:    8920096,
				RAM:    [][2]uint32{{11441076, 181}, {11441077, 73}, {11441078, 125}, {11441079, 0}, {8920108, 147}, {8920109, 184}, {8920104, 167}, {8920105, 11}, {8920106, 0}, {8920107, 174}, {8920102, 181}, {8920103, 73}, {8920100, 128}, {8920101, 43}, {8920096, 181}, {8920097, 85}, {8920098, 146}, {8920099, 149}, {12, 208}, {13, 32}, {14, 233}, {15, 160}, {2156960, 236}, {2156961, 166}, {2156962, 25}, {2156963, 70}},
				Halted: true,
			},
		},
		{
			name: "1500 CMP.w A3, D1 b24b",
			init: cpuState{
				D:   [8]uint32{532461093, 719949441, 1485963593, 1746427899, 973757195, 1222926418, 2625085399, 3467197186},
				A:   [7]uint32{2932473002, 2804142607, 2270392323, 2858873931, 757070850, 916000211, 1657168767},
				PC:  3642172,
				SR:  8729,
				USP: 5541678,
				SSP: 10787434,
				RAM: [][2]uint32{{3642168, 178}, {3642169, 75}, {3642170, 120}, {3642171, 176}, {3642172, 8}, {3642173, 248}},
			},
			want: cpuState{
				D:   [8]uint32{532461093, 719949441, 1485963593, 1746427899, 973757195, 1222926418, 2625085399, 3467197186},
				A:   [7]uint32{2932473002, 2804142607, 2270392323, 2858873931, 757070850, 916000211, 1657168767},
				PC:  3642174,
				SR:  8729,
				USP: 5541678,
				SSP: 10787434,
				RAM: [][2]uint32{{3642168, 178}, {3642169, 75}, {3642170, 120}, {3642171, 176}, {3642172, 8}, {3642173, 248}},
				Cycles: 4,
			},
		},
		{
			name: "2000 CMP.w (d16, A1), D6 bc69",
			init: cpuState{
				D:   [8]uint32{3380041833, 1023749837, 1014912297, 3165526920, 1286129792, 796254585, 3163641195, 4282601106},
				A:   [7]uint32{191094300, 3417913887, 1168948522, 760140204, 1605406607, 2413961042, 161870244},
				PC:  8605712,
				SR:  32797,
				USP: 2286494,
				SSP: 4895084,
				RAM: [][2]uint32{{8605708, 188}, {8605709, 105}, {8605710, 230}, {8605711, 107}, {8605712, 71}, {8605713, 146}, {12132490, 184}, {12132491, 11}, {8605714, 118}, {8605715, 180}},
			},
			want: cpuState{
				D:   [8]uint32{3380041833, 1023749837, 1014912297, 3165526920, 1286129792, 796254585, 3163641195, 4282601106},
				A:   [7]uint32{191094300, 3417913887, 1168948522, 760140204, 1605406607, 2413961042, 161870244},
				PC:  8605716,
				SR:  32795,
				USP: 2286494,
				SSP: 4895084,
				RAM: [][2]uint32{{8605708, 188}, {8605709, 105}, {8605710, 230}, {8605711, 107}, {8605712, 71}, {8605713, 146}, {12132490, 184}, {12132491, 11}, {8605714, 118}, {8605715, 180}},
				Cycles: 12,
			},
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			runTest(t, tt.init, tt.want)
		})
	}
}

func TestCMP_L(t *testing.T) {
	tests := []struct {
		name string
		init cpuState
		want cpuState
	}{
		{
			name: "000 CMP.l (A1)+, (A6)+ bd89",
			init: cpuState{
				D:   [8]uint32{2602817071, 3813811932, 4035084860, 112487151, 1127809461, 19275107, 1666006179, 2424633415},
				A:   [7]uint32{1989085351, 2865131306, 3839278173, 3151297554, 2196693584, 4001985737, 2898117290},
				PC:  8257522,
				SR:  1049,
				USP: 7460316,
				SSP: 15544974,
				RAM: [][2]uint32{{8257518, 189}, {8257519, 137}, {8257520, 187}, {8257521, 97}, {13004586, 197}, {13004587, 50}, {13004588, 199}, {13004589, 185}, {12436138, 187}, {12436139, 64}, {12436140, 116}, {12436141, 119}, {8257522, 148}, {8257523, 95}},
			},
			want: cpuState{
				D:   [8]uint32{2602817071, 3813811932, 4035084860, 112487151, 1127809461, 19275107, 1666006179, 2424633415},
				A:   [7]uint32{1989085351, 2865131310, 3839278173, 3151297554, 2196693584, 4001985737, 2898117294},
				PC:  8257524,
				SR:  1049,
				USP: 7460316,
				SSP: 15544974,
				RAM: [][2]uint32{{8257518, 189}, {8257519, 137}, {8257520, 187}, {8257521, 97}, {13004586, 197}, {13004587, 50}, {13004588, 199}, {13004589, 185}, {12436138, 187}, {12436139, 64}, {12436140, 116}, {12436141, 119}, {8257522, 148}, {8257523, 95}},
				Cycles: 20,
			},
		},
		{
			name: "500 CMP.l (d8, A4, Xn), D6 bcb4",
			init: cpuState{
				D:   [8]uint32{1376672531, 1885140260, 623935522, 2233742434, 3028840733, 891270686, 2271780302, 3180168354},
				A:   [7]uint32{2594637097, 2333959586, 1113885730, 2321971044, 3588261746, 4179365780, 3796795233},
				PC:  3335270,
				SR:  1549,
				USP: 996568,
				SSP: 16454320,
				RAM: [][2]uint32{{3335266, 188}, {3335267, 180}, {3335268, 76}, {3335269, 198}, {3335270, 106}, {3335271, 78}, {12, 102}, {13, 186}, {14, 182}, {15, 40}, {12236328, 90}, {12236329, 202}, {12236330, 190}, {12236331, 153}},
			},
			want: cpuState{
				D:      [8]uint32{1376672531, 1885140260, 623935522, 2233742434, 3028840733, 891270686, 2271780302, 3180168354},
				A:      [7]uint32{2594637097, 2333959586, 1113885730, 2321971044, 3588261746, 4179365780, 3796795233},
				PC:     1723512364,
				SR:     9741,
				USP:    996568,
				SSP:    16454306,
				RAM:    [][2]uint32{{3335266, 188}, {3335267, 180}, {3335268, 76}, {3335269, 198}, {3335270, 106}, {3335271, 78}, {16454318, 228}, {16454319, 100}, {16454314, 6}, {16454315, 13}, {16454316, 0}, {16454317, 50}, {16454312, 188}, {16454313, 180}, {16454310, 248}, {16454311, 85}, {16454306, 188}, {16454307, 177}, {16454308, 138}, {16454309, 104}, {12, 102}, {13, 186}, {14, 182}, {15, 40}, {12236328, 90}, {12236329, 202}, {12236330, 190}, {12236331, 153}},
				Halted: true,
			},
		},
		{
			name: "1000 CMP.l -(A0), D7 bea0",
			init: cpuState{
				D:   [8]uint32{1270657884, 4245752031, 3640518077, 3550181606, 293055011, 1312543449, 2467842035, 1690838038},
				A:   [7]uint32{3663490712, 3097110916, 2355529633, 423090181, 1109150842, 2221997236, 2510293408},
				PC:  15620792,
				SR:  42782,
				USP: 8518812,
				SSP: 7322328,
				RAM: [][2]uint32{{15620788, 190}, {15620789, 160}, {15620790, 196}, {15620791, 9}, {6057620, 159}, {6057621, 85}, {6057622, 209}, {6057623, 132}, {15620792, 54}, {15620793, 47}},
			},
			want: cpuState{
				D:   [8]uint32{1270657884, 4245752031, 3640518077, 3550181606, 293055011, 1312543449, 2467842035, 1690838038},
				A:   [7]uint32{3663490708, 3097110916, 2355529633, 423090181, 1109150842, 2221997236, 2510293408},
				PC:  15620794,
				SR:  42779,
				USP: 8518812,
				SSP: 7322328,
				RAM: [][2]uint32{{15620788, 190}, {15620789, 160}, {15620790, 196}, {15620791, 9}, {6057620, 159}, {6057621, 85}, {6057622, 209}, {6057623, 132}, {15620792, 54}, {15620793, 47}},
				Cycles: 16,
			},
		},
		{
			name: "1500 CMP.l (d8, A6, Xn), D7 beb6",
			init: cpuState{
				D:   [8]uint32{1769718620, 2710303105, 1506316887, 1509684142, 3864885641, 4270562231, 325454053, 894372554},
				A:   [7]uint32{3666905663, 3568298632, 2842972664, 4178202536, 14971123, 1315932753, 216521209},
				PC:  11401684,
				SR:  34590,
				USP: 5074658,
				SSP: 5124358,
				RAM: [][2]uint32{{11401680, 190}, {11401681, 182}, {11401682, 156}, {11401683, 136}, {11401684, 196}, {11401685, 159}, {12, 22}, {13, 172}, {14, 78}, {15, 14}, {11292174, 37}, {11292175, 242}, {11292176, 208}, {11292177, 126}},
			},
			want: cpuState{
				D:      [8]uint32{1769718620, 2710303105, 1506316887, 1509684142, 3864885641, 4270562231, 325454053, 894372554},
				A:      [7]uint32{3666905663, 3568298632, 2842972664, 4178202536, 14971123, 1315932753, 216521209},
				PC:     380390930,
				SR:     10014,
				USP:    5074658,
				SSP:    5124344,
				RAM:    [][2]uint32{{11401680, 190}, {11401681, 182}, {11401682, 156}, {11401683, 136}, {11401684, 196}, {11401685, 159}, {5124356, 249}, {5124357, 210}, {5124352, 135}, {5124353, 30}, {5124354, 0}, {5124355, 173}, {5124350, 190}, {5124351, 182}, {5124348, 196}, {5124349, 9}, {5124344, 190}, {5124345, 177}, {5124346, 225}, {5124347, 151}, {12, 22}, {13, 172}, {14, 78}, {15, 14}, {11292174, 37}, {11292175, 242}, {11292176, 208}, {11292177, 126}},
				Halted: true,
			},
		},
		{
			name: "2000 CMP.l (d8, A0, Xn), D5 bab0",
			init: cpuState{
				D:   [8]uint32{2077505327, 463790756, 3129488334, 4263845755, 4193451820, 3717590645, 846018652, 2030228542},
				A:   [7]uint32{2228968255, 4294540364, 4262826014, 2381997817, 3023409651, 3204030991, 914704705},
				PC:  5056442,
				SR:  41472,
				USP: 6027476,
				SSP: 10809520,
				RAM: [][2]uint32{{5056438, 186}, {5056439, 176}, {5056440, 26}, {5056441, 166}, {5056442, 8}, {5056443, 219}, {12, 236}, {13, 128}, {14, 220}, {15, 16}, {8444944, 43}, {8444945, 48}, {8444946, 216}, {8444947, 128}},
			},
			want: cpuState{
				D:      [8]uint32{2077505327, 463790756, 3129488334, 4263845755, 4193451820, 3717590645, 846018652, 2030228542},
				A:      [7]uint32{2228968255, 4294540364, 4262826014, 2381997817, 3023409651, 3204030991, 914704705},
				PC:     3967867924,
				SR:     8704,
				USP:    6027476,
				SSP:    10809506,
				RAM:    [][2]uint32{{5056438, 186}, {5056439, 176}, {5056440, 26}, {5056441, 166}, {5056442, 8}, {5056443, 219}, {10809518, 39}, {10809519, 184}, {10809514, 162}, {10809515, 0}, {10809516, 0}, {10809517, 77}, {10809512, 186}, {10809513, 176}, {10809510, 61}, {10809511, 137}, {10809506, 186}, {10809507, 181}, {10809508, 160}, {10809509, 128}, {12, 236}, {13, 128}, {14, 220}, {15, 16}, {8444944, 43}, {8444945, 48}, {8444946, 216}, {8444947, 128}},
				Halted: true,
			},
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			runTest(t, tt.init, tt.want)
		})
	}
}

func TestCMPA_W(t *testing.T) {
	tests := []struct {
		name string
		init cpuState
		want cpuState
	}{
		{
			name: "000 CMPA.w (A3)+, A3 b6db",
			init: cpuState{
				D:   [8]uint32{492070105, 1571437183, 313863493, 1080259018, 2237413311, 1921128094, 2709787501, 2022490657},
				A:   [7]uint32{578471791, 1488481635, 724012354, 93350870, 1485134294, 1369588139, 1380749972},
				PC:  14948046,
				SR:  8450,
				USP: 13927062,
				SSP: 5762640,
				RAM: [][2]uint32{{14948042, 182}, {14948043, 219}, {14948044, 16}, {14948045, 79}, {9464790, 205}, {9464791, 231}, {14948046, 170}, {14948047, 166}},
			},
			want: cpuState{
				D:   [8]uint32{492070105, 1571437183, 313863493, 1080259018, 2237413311, 1921128094, 2709787501, 2022490657},
				A:   [7]uint32{578471791, 1488481635, 724012354, 93350872, 1485134294, 1369588139, 1380749972},
				PC:  14948048,
				SR:  8449,
				USP: 13927062,
				SSP: 5762640,
				RAM: [][2]uint32{{14948042, 182}, {14948043, 219}, {14948044, 16}, {14948045, 79}, {9464790, 205}, {9464791, 231}, {14948046, 170}, {14948047, 166}},
				Cycles: 10,
			},
		},
		{
			name: "500 CMPA.w D7, A4 b8c7",
			init: cpuState{
				D:   [8]uint32{1684219232, 340340602, 2020911260, 3878343800, 1607588106, 2899264654, 891078013, 2475017235},
				A:   [7]uint32{759508923, 4292527294, 1609179738, 2856449460, 969409643, 3807140723, 3376424158},
				PC:  13890546,
				SR:  260,
				USP: 16031100,
				SSP: 9582176,
				RAM: [][2]uint32{{13890542, 184}, {13890543, 199}, {13890544, 227}, {13890545, 86}, {13890546, 32}, {13890547, 220}},
			},
			want: cpuState{
				D:   [8]uint32{1684219232, 340340602, 2020911260, 3878343800, 1607588106, 2899264654, 891078013, 2475017235},
				A:   [7]uint32{759508923, 4292527294, 1609179738, 2856449460, 969409643, 3807140723, 3376424158},
				PC:  13890548,
				SR:  257,
				USP: 16031100,
				SSP: 9582176,
				RAM: [][2]uint32{{13890542, 184}, {13890543, 199}, {13890544, 227}, {13890545, 86}, {13890546, 32}, {13890547, 220}},
				Cycles: 6,
			},
		},
		{
			name: "1000 CMPA.w (A0)+, A3 b6d8",
			init: cpuState{
				D:   [8]uint32{417406711, 3642446289, 833343870, 2456269747, 1638293136, 2476317691, 3057716634, 3075085268},
				A:   [7]uint32{2810769204, 2611851034, 3505614135, 2003770830, 2335048986, 1636705159, 583241371},
				PC:  8152848,
				SR:  512,
				USP: 9546952,
				SSP: 14164524,
				RAM: [][2]uint32{{8152844, 182}, {8152845, 216}, {8152846, 230}, {8152847, 36}, {8974132, 56}, {8974133, 205}, {8152848, 190}, {8152849, 116}},
			},
			want: cpuState{
				D:   [8]uint32{417406711, 3642446289, 833343870, 2456269747, 1638293136, 2476317691, 3057716634, 3075085268},
				A:   [7]uint32{2810769206, 2611851034, 3505614135, 2003770830, 2335048986, 1636705159, 583241371},
				PC:  8152850,
				SR:  512,
				USP: 9546952,
				SSP: 14164524,
				RAM: [][2]uint32{{8152844, 182}, {8152845, 216}, {8152846, 230}, {8152847, 36}, {8974132, 56}, {8974133, 205}, {8152848, 190}, {8152849, 116}},
				Cycles: 10,
			},
		},
		{
			name: "1500 CMPA.w -(A7), A1 b2e7",
			init: cpuState{
				D:   [8]uint32{2045924875, 1671279105, 3095246169, 2853977159, 1249068894, 762824857, 3569871165, 3449744706},
				A:   [7]uint32{423035514, 2505079516, 2715657797, 2776337756, 3487025369, 3384318591, 3393958738},
				PC:  12734732,
				SR:  41486,
				USP: 16719434,
				SSP: 13916380,
				RAM: [][2]uint32{{12734728, 178}, {12734729, 231}, {12734730, 227}, {12734731, 140}, {13916378, 129}, {13916379, 132}, {12734732, 169}, {12734733, 90}},
			},
			want: cpuState{
				D:   [8]uint32{2045924875, 1671279105, 3095246169, 2853977159, 1249068894, 762824857, 3569871165, 3449744706},
				A:   [7]uint32{423035514, 2505079516, 2715657797, 2776337756, 3487025369, 3384318591, 3393958738},
				PC:  12734734,
				SR:  41481,
				USP: 16719434,
				SSP: 13916378,
				RAM: [][2]uint32{{12734728, 178}, {12734729, 231}, {12734730, 227}, {12734731, 140}, {13916378, 129}, {13916379, 132}, {12734732, 169}, {12734733, 90}},
				Cycles: 12,
			},
		},
		{
			name: "2000 CMPA.w (A3)+, A3 b6db",
			init: cpuState{
				D:   [8]uint32{2610677873, 2182921324, 1994046837, 1991770870, 1254942964, 4117929659, 3292579872, 1420689387},
				A:   [7]uint32{2430273115, 3471146516, 2202927400, 1326717104, 4241561056, 3700412691, 1960209238},
				PC:  5946206,
				SR:  1307,
				USP: 5204142,
				SSP: 8869418,
				RAM: [][2]uint32{{5946202, 182}, {5946203, 219}, {5946204, 153}, {5946205, 43}, {1317040, 126}, {1317041, 84}, {5946206, 44}, {5946207, 215}},
			},
			want: cpuState{
				D:   [8]uint32{2610677873, 2182921324, 1994046837, 1991770870, 1254942964, 4117929659, 3292579872, 1420689387},
				A:   [7]uint32{2430273115, 3471146516, 2202927400, 1326717106, 4241561056, 3700412691, 1960209238},
				PC:  5946208,
				SR:  1296,
				USP: 5204142,
				SSP: 8869418,
				RAM: [][2]uint32{{5946202, 182}, {5946203, 219}, {5946204, 153}, {5946205, 43}, {1317040, 126}, {1317041, 84}, {5946206, 44}, {5946207, 215}},
				Cycles: 10,
			},
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			runTest(t, tt.init, tt.want)
		})
	}
}

func TestCMPA_L(t *testing.T) {
	tests := []struct {
		name string
		init cpuState
		want cpuState
	}{
		{
			name: "000 CMPA.l (d16, A4), A3 b7ec",
			init: cpuState{
				D:   [8]uint32{2890798821, 1862138709, 2854314823, 398855901, 3873552237, 4105501077, 2205126645, 3703781335},
				A:   [7]uint32{854050806, 399742751, 2206797844, 3644069934, 2479716593, 1347522574, 2529794186},
				PC:  4796260,
				SR:  8711,
				USP: 3160850,
				SSP: 11019136,
				RAM: [][2]uint32{{4796256, 183}, {4796257, 236}, {4796258, 21}, {4796259, 34}, {4796260, 191}, {4796261, 37}, {12, 116}, {13, 242}, {14, 2}, {15, 254}, {15860478, 254}, {15860479, 45}, {15860480, 4}, {15860481, 213}},
			},
			want: cpuState{
				D:      [8]uint32{2890798821, 1862138709, 2854314823, 398855901, 3873552237, 4105501077, 2205126645, 3703781335},
				A:      [7]uint32{854050806, 399742751, 2206797844, 3644069934, 2479716593, 1347522574, 2529794186},
				PC:     1962017538,
				SR:     8711,
				USP:    3160850,
				SSP:    11019122,
				RAM:    [][2]uint32{{4796256, 183}, {4796257, 236}, {4796258, 21}, {4796259, 34}, {4796260, 191}, {4796261, 37}, {11019134, 47}, {11019135, 98}, {11019130, 34}, {11019131, 7}, {11019132, 0}, {11019133, 73}, {11019128, 183}, {11019129, 236}, {11019126, 142}, {11019127, 19}, {11019122, 183}, {11019123, 245}, {11019124, 147}, {11019125, 205}, {12, 116}, {13, 242}, {14, 2}, {15, 254}, {15860478, 254}, {15860479, 45}, {15860480, 4}, {15860481, 213}},
				Halted: true,
			},
		},
		{
			name: "500 CMPA.l (A3), A2 b5d3",
			init: cpuState{
				D:   [8]uint32{2252290140, 3090839686, 3370884756, 2616564005, 4104746129, 3510351794, 3807957154, 3476238244},
				A:   [7]uint32{3003121672, 108294146, 3334919252, 663744853, 390905783, 871256995, 2525146124},
				PC:  7496644,
				SR:  8971,
				USP: 9358608,
				SSP: 9889444,
				RAM: [][2]uint32{{7496640, 181}, {7496641, 211}, {7496642, 190}, {7496643, 234}, {12, 47}, {13, 158}, {14, 165}, {15, 18}, {10396946, 193}, {10396947, 64}, {10396948, 197}, {10396949, 5}},
			},
			want: cpuState{
				D:      [8]uint32{2252290140, 3090839686, 3370884756, 2616564005, 4104746129, 3510351794, 3807957154, 3476238244},
				A:      [7]uint32{3003121672, 108294146, 3334919252, 663744853, 390905783, 871256995, 2525146124},
				PC:     798926102,
				SR:     8971,
				USP:    9358608,
				SSP:    9889430,
				RAM:    [][2]uint32{{7496640, 181}, {7496641, 211}, {7496642, 190}, {7496643, 234}, {9889442, 99}, {9889443, 194}, {9889438, 35}, {9889439, 11}, {9889440, 0}, {9889441, 114}, {9889436, 181}, {9889437, 211}, {9889434, 241}, {9889435, 85}, {9889430, 181}, {9889431, 213}, {9889432, 39}, {9889433, 143}, {12, 47}, {13, 158}, {14, 165}, {15, 18}, {10396946, 193}, {10396947, 64}, {10396948, 197}, {10396949, 5}},
				Halted: true,
			},
		},
		{
			name: "1000 CMPA.l D4, A7 bfc4",
			init: cpuState{
				D:   [8]uint32{4245341750, 2180014711, 1511230218, 2546602185, 1155340818, 3749460867, 2586965732, 2223212119},
				A:   [7]uint32{2743596617, 1657190777, 1818367150, 691250381, 502230760, 1314469045, 2399492302},
				PC:  2732462,
				SR:  33823,
				USP: 9920682,
				SSP: 954602,
				RAM: [][2]uint32{{2732458, 191}, {2732459, 196}, {2732460, 26}, {2732461, 133}, {2732462, 141}, {2732463, 143}},
			},
			want: cpuState{
				D:   [8]uint32{4245341750, 2180014711, 1511230218, 2546602185, 1155340818, 3749460867, 2586965732, 2223212119},
				A:   [7]uint32{2743596617, 1657190777, 1818367150, 691250381, 502230760, 1314469045, 2399492302},
				PC:  2732464,
				SR:  33817,
				USP: 9920682,
				SSP: 954602,
				RAM: [][2]uint32{{2732458, 191}, {2732459, 196}, {2732460, 26}, {2732461, 133}, {2732462, 141}, {2732463, 143}},
				Cycles: 6,
			},
		},
		{
			name: "1500 CMPA.l (d8, A6, Xn), A7 bff6",
			init: cpuState{
				D:   [8]uint32{3987165711, 102518476, 275509086, 3062358003, 2513144564, 2637653817, 4071257875, 1143483842},
				A:   [7]uint32{3909428019, 3152158048, 2799137073, 1989633970, 1503233045, 994553797, 2954679395},
				PC:  12331406,
				SR:  793,
				USP: 1124404,
				SSP: 8804074,
				RAM: [][2]uint32{{12331402, 191}, {12331403, 246}, {12331404, 54}, {12331405, 174}, {12331406, 187}, {12331407, 3}, {1881092, 225}, {1881093, 23}, {1881094, 126}, {1881095, 183}, {12331408, 0}, {12331409, 59}},
			},
			want: cpuState{
				D:   [8]uint32{3987165711, 102518476, 275509086, 3062358003, 2513144564, 2637653817, 4071257875, 1143483842},
				A:   [7]uint32{3909428019, 3152158048, 2799137073, 1989633970, 1503233045, 994553797, 2954679395},
				PC:  12331410,
				SR:  785,
				USP: 1124404,
				SSP: 8804074,
				RAM: [][2]uint32{{12331402, 191}, {12331403, 246}, {12331404, 54}, {12331405, 174}, {12331406, 187}, {12331407, 3}, {1881092, 225}, {1881093, 23}, {1881094, 126}, {1881095, 183}, {12331408, 0}, {12331409, 59}},
				Cycles: 20,
			},
		},
		{
			name: "2000 CMPA.l (d8, A3, Xn), A7 bff3",
			init: cpuState{
				D:   [8]uint32{824506334, 1008659423, 4073145469, 2386503430, 3167144410, 2077742698, 4293335420, 43512426},
				A:   [7]uint32{3272086479, 4213570550, 1461721843, 205849882, 1614537925, 2773894694, 3722807823},
				PC:  8788234,
				SR:  782,
				USP: 12995958,
				SSP: 12226408,
				RAM: [][2]uint32{{8788230, 191}, {8788231, 243}, {8788232, 49}, {8788233, 6}, {8788234, 82}, {8788235, 235}, {4533286, 244}, {4533287, 6}, {4533288, 89}, {4533289, 126}, {8788236, 18}, {8788237, 225}},
			},
			want: cpuState{
				D:   [8]uint32{824506334, 1008659423, 4073145469, 2386503430, 3167144410, 2077742698, 4293335420, 43512426},
				A:   [7]uint32{3272086479, 4213570550, 1461721843, 205849882, 1614537925, 2773894694, 3722807823},
				PC:  8788238,
				SR:  769,
				USP: 12995958,
				SSP: 12226408,
				RAM: [][2]uint32{{8788230, 191}, {8788231, 243}, {8788232, 49}, {8788233, 6}, {8788234, 82}, {8788235, 235}, {4533286, 244}, {4533287, 6}, {4533288, 89}, {4533289, 126}, {8788236, 18}, {8788237, 225}},
				Cycles: 20,
			},
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			runTest(t, tt.init, tt.want)
		})
	}
}

func TestMULU(t *testing.T) {
	tests := []struct {
		name string
		init cpuState
		want cpuState
	}{
		{
			name: "000 MULU D7, D6 ccc7",
			init: cpuState{
				D:   [8]uint32{2909375531, 45066297, 2272781739, 3284563293, 222391173, 2171116808, 1410154944, 3340024981},
				A:   [7]uint32{3471851701, 600322505, 4058441337, 3860183758, 245925844, 2792002862, 3063616133},
				PC:  14881286,
				SR:  33543,
				USP: 2770922,
				SSP: 14958,
				RAM: [][2]uint32{{14881282, 204}, {14881283, 199}, {14881284, 116}, {14881285, 37}, {14881286, 34}, {14881287, 226}},
			},
			want: cpuState{
				D:   [8]uint32{2909375531, 45066297, 2272781739, 3284563293, 222391173, 2171116808, 812598464, 3340024981},
				A:   [7]uint32{3471851701, 600322505, 4058441337, 3860183758, 245925844, 2792002862, 3063616133},
				PC:  14881288,
				SR:  33536,
				USP: 2770922,
				SSP: 14958,
				RAM: [][2]uint32{{14881282, 204}, {14881283, 199}, {14881284, 116}, {14881285, 37}, {14881286, 34}, {14881287, 226}},
				// MULU: uses flat worst-case 70 cycles (real range 38-70).
				// Cycles: 56,
			},
		},
		{
			name: "500 MULU (A6), D4 c8d6",
			init: cpuState{
				D:   [8]uint32{557752111, 3120745195, 1183650044, 1157818305, 1856489520, 4115329407, 2275210584, 1322986555},
				A:   [7]uint32{3961347917, 290040884, 2837849344, 2516501503, 103586381, 1311019909, 3311802680},
				PC:  15573028,
				SR:  277,
				USP: 13123928,
				SSP: 10552228,
				RAM: [][2]uint32{{15573024, 200}, {15573025, 214}, {15573026, 184}, {15573027, 114}, {6691128, 11}, {6691129, 213}, {15573028, 32}, {15573029, 147}},
			},
			want: cpuState{
				D:   [8]uint32{557752111, 3120745195, 1183650044, 1157818305, 155230192, 4115329407, 2275210584, 1322986555},
				A:   [7]uint32{3961347917, 290040884, 2837849344, 2516501503, 103586381, 1311019909, 3311802680},
				PC:  15573030,
				SR:  272,
				USP: 13123928,
				SSP: 10552228,
				RAM: [][2]uint32{{15573024, 200}, {15573025, 214}, {15573026, 184}, {15573027, 114}, {6691128, 11}, {6691129, 213}, {15573028, 32}, {15573029, 147}},
				// MULU: uses flat worst-case 70 cycles (real range 38-70).
				// Cycles: 58,
			},
		},
		{
			name: "1000 MULU (d16, A6), D1 c2ee",
			init: cpuState{
				D:   [8]uint32{499070063, 2416728071, 2856028692, 2663182908, 302958052, 3718686238, 3918859815, 4238725179},
				A:   [7]uint32{635427773, 736488623, 2903352753, 3303195388, 1422995643, 3916655940, 2230818305},
				PC:  13310326,
				SR:  8984,
				USP: 1814124,
				SSP: 6229988,
				RAM: [][2]uint32{{13310322, 194}, {13310323, 238}, {13310324, 222}, {13310325, 206}, {13310326, 140}, {13310327, 73}, {12, 192}, {13, 122}, {14, 107}, {15, 58}, {8022842, 21}, {8022843, 113}, {8022844, 93}, {8022845, 209}},
			},
			want: cpuState{
				D:      [8]uint32{499070063, 2416728071, 2856028692, 2663182908, 302958052, 3718686238, 3918859815, 4238725179},
				A:      [7]uint32{635427773, 736488623, 2903352753, 3303195388, 1422995643, 3916655940, 2230818305},
				PC:     3229248318,
				SR:     8984,
				USP:    1814124,
				SSP:    6229974,
				RAM:    [][2]uint32{{13310322, 194}, {13310323, 238}, {13310324, 222}, {13310325, 206}, {13310326, 140}, {13310327, 73}, {6229986, 25}, {6229987, 116}, {6229982, 35}, {6229983, 24}, {6229984, 0}, {6229985, 203}, {6229980, 194}, {6229981, 238}, {6229978, 116}, {6229979, 207}, {6229974, 194}, {6229975, 245}, {6229976, 132}, {6229977, 247}, {12, 192}, {13, 122}, {14, 107}, {15, 58}, {8022842, 21}, {8022843, 113}, {8022844, 93}, {8022845, 209}},
				Halted: true,
			},
		},
		{
			name: "1500 MULU (d8, PC, Xn), D4 c8fb",
			init: cpuState{
				D:   [8]uint32{3944805228, 1156130819, 881415182, 1582996232, 2282124988, 962557027, 1129793315, 1924010085},
				A:   [7]uint32{231387872, 4220046673, 2645142616, 3874436287, 576378809, 2675111738, 1981800159},
				PC:  5331250,
				SR:  40966,
				USP: 12464774,
				SSP: 8192214,
				RAM: [][2]uint32{{5331246, 200}, {5331247, 251}, {5331248, 208}, {5331249, 178}, {5331250, 42}, {5331251, 155}, {5328924, 225}, {5328925, 67}, {5331252, 65}, {5331253, 62}},
			},
			want: cpuState{
				D:   [8]uint32{3944805228, 1156130819, 881415182, 1582996232, 1752846132, 962557027, 1129793315, 1924010085},
				A:   [7]uint32{231387872, 4220046673, 2645142616, 3874436287, 576378809, 2675111738, 1981800159},
				PC:  5331254,
				SR:  40960,
				USP: 12464774,
				SSP: 8192214,
				RAM: [][2]uint32{{5331246, 200}, {5331247, 251}, {5331248, 208}, {5331249, 178}, {5331250, 42}, {5331251, 155}, {5328924, 225}, {5328925, 67}, {5331252, 65}, {5331253, 62}},
				// MULU: uses flat worst-case 70 cycles (real range 38-70).
				// Cycles: 62,
			},
		},
		{
			name: "2000 MULU (d16, A6), D3 c6ee",
			init: cpuState{
				D:   [8]uint32{3435918671, 795469021, 1742257036, 343936349, 2602879117, 3692859732, 1040948598, 3927716538},
				A:   [7]uint32{1207471368, 1038265701, 2963329091, 641468235, 541445411, 1655751825, 664242045},
				PC:  8986292,
				SR:  42760,
				USP: 14887320,
				SSP: 9745114,
				RAM: [][2]uint32{{8986288, 198}, {8986289, 238}, {8986290, 241}, {8986291, 61}, {8986292, 69}, {8986293, 122}, {9926842, 182}, {9926843, 192}, {8986294, 200}, {8986295, 164}},
			},
			want: cpuState{
				D:   [8]uint32{3435918671, 795469021, 1742257036, 160048064, 2602879117, 3692859732, 1040948598, 3927716538},
				A:   [7]uint32{1207471368, 1038265701, 2963329091, 641468235, 541445411, 1655751825, 664242045},
				PC:  8986296,
				SR:  42752,
				USP: 14887320,
				SSP: 9745114,
				RAM: [][2]uint32{{8986288, 198}, {8986289, 238}, {8986290, 241}, {8986291, 61}, {8986292, 69}, {8986293, 122}, {9926842, 182}, {9926843, 192}, {8986294, 200}, {8986295, 164}},
				// MULU: uses flat worst-case 70 cycles (real range 38-70).
				// Cycles: 60,
			},
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			runTest(t, tt.init, tt.want)
		})
	}
}

func TestMULS(t *testing.T) {
	tests := []struct {
		name string
		init cpuState
		want cpuState
	}{
		{
			name: "000 MULS (A0), D7 cfd0",
			init: cpuState{
				D:   [8]uint32{1704645368, 1901729937, 3128084608, 2902137850, 1704553321, 1645148921, 1541705176, 3019654251},
				A:   [7]uint32{3191554209, 2285547708, 1406541405, 3273714787, 3633134209, 1861415841, 1909716418},
				PC:  7257768,
				SR:  41231,
				USP: 11325510,
				SSP: 4905300,
				RAM: [][2]uint32{{7257764, 207}, {7257765, 208}, {7257766, 65}, {7257767, 182}, {12, 212}, {13, 136}, {14, 12}, {15, 28}, {8915996, 32}, {8915997, 192}, {8915998, 67}, {8915999, 162}},
			},
			want: cpuState{
				D:      [8]uint32{1704645368, 1901729937, 3128084608, 2902137850, 1704553321, 1645148921, 1541705176, 3019654251},
				A:      [7]uint32{3191554209, 2285547708, 1406541405, 3273714787, 3633134209, 1861415841, 1909716418},
				PC:     3565685792,
				SR:     8463,
				USP:    11325510,
				SSP:    4905286,
				RAM:    [][2]uint32{{7257764, 207}, {7257765, 208}, {7257766, 65}, {7257767, 182}, {4905298, 190}, {4905299, 166}, {4905294, 161}, {4905295, 15}, {4905296, 0}, {4905297, 110}, {4905292, 207}, {4905293, 208}, {4905290, 64}, {4905291, 161}, {4905286, 207}, {4905287, 213}, {4905288, 190}, {4905289, 59}, {12, 212}, {13, 136}, {14, 12}, {15, 28}, {8915996, 32}, {8915997, 192}, {8915998, 67}, {8915999, 162}},
				Halted: true,
			},
		},
		{
			name: "500 MULS (A4), D3 c7d4",
			init: cpuState{
				D:   [8]uint32{3201550852, 1081349702, 4268869544, 1144659714, 3038672353, 3112386840, 3444486923, 221977737},
				A:   [7]uint32{3336816699, 1872675517, 1376689166, 3395013168, 586106007, 2358942989, 767937415},
				PC:  11326772,
				SR:  42761,
				USP: 10667612,
				SSP: 11962342,
				RAM: [][2]uint32{{11326768, 199}, {11326769, 212}, {11326770, 55}, {11326771, 14}, {12, 83}, {13, 26}, {14, 15}, {15, 150}, {1707926, 123}, {1707927, 31}, {1707928, 36}, {1707929, 21}},
			},
			want: cpuState{
				D:      [8]uint32{3201550852, 1081349702, 4268869544, 1144659714, 3038672353, 3112386840, 3444486923, 221977737},
				A:      [7]uint32{3336816699, 1872675517, 1376689166, 3395013168, 586106007, 2358942989, 767937415},
				PC:     1394216858,
				SR:     9993,
				USP:    10667612,
				SSP:    11962328,
				RAM:    [][2]uint32{{11326768, 199}, {11326769, 212}, {11326770, 55}, {11326771, 14}, {11962340, 213}, {11962341, 50}, {11962336, 167}, {11962337, 9}, {11962338, 0}, {11962339, 172}, {11962334, 199}, {11962335, 212}, {11962332, 68}, {11962333, 151}, {11962328, 199}, {11962329, 213}, {11962330, 34}, {11962331, 239}, {12, 83}, {13, 26}, {14, 15}, {15, 150}, {1707926, 123}, {1707927, 31}, {1707928, 36}, {1707929, 21}},
				Halted: true,
			},
		},
		{
			name: "1000 MULS (xxx).l, D4 c9f9",
			init: cpuState{
				D:   [8]uint32{3647687287, 1485830246, 721887628, 2156691615, 450378171, 624011470, 49863416, 1355137234},
				A:   [7]uint32{124806300, 46428065, 3305759920, 241462433, 945399426, 1783884140, 871044685},
				PC:  3275976,
				SR:  33287,
				USP: 6323212,
				SSP: 10972184,
				RAM: [][2]uint32{{3275972, 201}, {3275973, 249}, {3275974, 209}, {3275975, 224}, {3275976, 177}, {3275977, 43}, {3275978, 39}, {3275979, 198}, {12, 141}, {13, 154}, {14, 215}, {15, 86}, {10147670, 111}, {10147671, 17}, {10147672, 63}, {10147673, 41}},
			},
			want: cpuState{
				D:      [8]uint32{3647687287, 1485830246, 721887628, 2156691615, 450378171, 624011470, 49863416, 1355137234},
				A:      [7]uint32{124806300, 46428065, 3305759920, 241462433, 945399426, 1783884140, 871044685},
				PC:     2375735130,
				SR:     8711,
				USP:    6323212,
				SSP:    10972170,
				RAM:    [][2]uint32{{3275972, 201}, {3275973, 249}, {3275974, 209}, {3275975, 224}, {3275976, 177}, {3275977, 43}, {3275978, 39}, {3275979, 198}, {10972182, 252}, {10972183, 202}, {10972178, 130}, {10972179, 7}, {10972180, 0}, {10972181, 49}, {10972176, 201}, {10972177, 249}, {10972174, 177}, {10972175, 43}, {10972170, 201}, {10972171, 241}, {10972172, 209}, {10972173, 224}, {12, 141}, {13, 154}, {14, 215}, {15, 86}, {10147670, 111}, {10147671, 17}, {10147672, 63}, {10147673, 41}},
				Halted: true,
			},
		},
		{
			name: "1500 MULS -(A0), D4 c9e0",
			init: cpuState{
				D:   [8]uint32{1292028538, 1563758125, 1394486475, 3212262621, 1772501401, 3984915181, 1212938363, 529248960},
				A:   [7]uint32{838640754, 1277056709, 2192284561, 361350074, 2531121974, 2923346865, 50233311},
				PC:  10262042,
				SR:  8732,
				USP: 5413410,
				SSP: 15468822,
				RAM: [][2]uint32{{10262038, 201}, {10262039, 224}, {10262040, 216}, {10262041, 150}, {16557168, 41}, {16557169, 24}, {10262042, 160}, {10262043, 207}},
			},
			want: cpuState{
				D:   [8]uint32{1292028538, 1563758125, 1394486475, 3212262621, 155117400, 3984915181, 1212938363, 529248960},
				A:   [7]uint32{838640752, 1277056709, 2192284561, 361350074, 2531121974, 2923346865, 50233311},
				PC:  10262044,
				SR:  8720,
				USP: 5413410,
				SSP: 15468822,
				RAM: [][2]uint32{{10262038, 201}, {10262039, 224}, {10262040, 216}, {10262041, 150}, {16557168, 41}, {16557169, 24}, {10262042, 160}, {10262043, 207}},
				// MULS: uses flat worst-case 70 cycles (real range 38-70).
				// Cycles: 60,
			},
		},
		{
			name: "2000 MULS (d16, A5), D6 cded",
			init: cpuState{
				D:   [8]uint32{4020554460, 1046034208, 3440707144, 2082346192, 985801223, 2711674057, 2405889320, 2263125806},
				A:   [7]uint32{2793487633, 846310692, 2932435961, 1621580739, 641085303, 3175606001, 2751795172},
				PC:  16187586,
				SR:  1296,
				USP: 15891238,
				SSP: 12708586,
				RAM: [][2]uint32{{16187582, 205}, {16187583, 237}, {16187584, 165}, {16187585, 13}, {16187586, 198}, {16187587, 92}, {4688894, 2}, {4688895, 69}, {16187588, 252}, {16187589, 0}},
			},
			want: cpuState{
				D:   [8]uint32{4020554460, 1046034208, 3440707144, 2082346192, 985801223, 2711674057, 4293354440, 2263125806},
				A:   [7]uint32{2793487633, 846310692, 2932435961, 1621580739, 641085303, 3175606001, 2751795172},
				PC:  16187590,
				SR:  1304,
				USP: 15891238,
				SSP: 12708586,
				RAM: [][2]uint32{{16187582, 205}, {16187583, 237}, {16187584, 165}, {16187585, 13}, {16187586, 198}, {16187587, 92}, {4688894, 2}, {4688895, 69}, {16187588, 252}, {16187589, 0}},
				// MULS: uses flat worst-case 70 cycles (real range 38-70).
				// Cycles: 62,
			},
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			runTest(t, tt.init, tt.want)
		})
	}
}

func TestDIVU(t *testing.T) {
	tests := []struct {
		name string
		init cpuState
		want cpuState
	}{
		{
			name: "000 DIVU (xxx).l, D4 88f9",
			init: cpuState{
				D:   [8]uint32{851875928, 3326892796, 3873463131, 1757372564, 3594990973, 3869244608, 1245250439, 1267479684},
				A:   [7]uint32{1311392589, 1906478983, 557940564, 4217376967, 2321827578, 133874346, 2055113439},
				PC:  7822936,
				SR:  8712,
				USP: 2144018,
				SSP: 4103512,
				RAM: [][2]uint32{{7822932, 136}, {7822933, 249}, {7822934, 123}, {7822935, 151}, {7822936, 142}, {7822937, 194}, {7822938, 61}, {7822939, 93}, {9932482, 115}, {9932483, 216}, {7822940, 11}, {7822941, 53}},
			},
			want: cpuState{
				D:   [8]uint32{851875928, 3326892796, 3873463131, 1757372564, 3594990973, 3869244608, 1245250439, 1267479684},
				A:   [7]uint32{1311392589, 1906478983, 557940564, 4217376967, 2321827578, 133874346, 2055113439},
				PC:  7822942,
				SR:  8714,
				USP: 2144018,
				SSP: 4103512,
				RAM: [][2]uint32{{7822932, 136}, {7822933, 249}, {7822934, 123}, {7822935, 151}, {7822936, 142}, {7822937, 194}, {7822938, 61}, {7822939, 93}, {9932482, 115}, {9932483, 216}, {7822940, 11}, {7822941, 53}},
				// DIVU: uses flat worst-case 140 cycles (real range 76-140).
				// Cycles: 22,
			},
		},
		{
			name: "500 DIVU (A1)+, D5 8ad9",
			init: cpuState{
				D:   [8]uint32{2875726544, 3909222798, 1463529590, 1958708671, 2129862750, 1126164708, 2838606430, 1472630705},
				A:   [7]uint32{3437469760, 238558146, 4166014496, 40557750, 268931461, 1288885616, 2910876823},
				PC:  10731880,
				SR:  33546,
				USP: 14436168,
				SSP: 12846300,
				RAM: [][2]uint32{{10731876, 138}, {10731877, 217}, {10731878, 101}, {10731879, 14}, {3677122, 154}, {3677123, 240}, {10731880, 229}, {10731881, 151}},
			},
			want: cpuState{
				D:   [8]uint32{2875726544, 3909222798, 1463529590, 1958708671, 2129862750, 1600417512, 2838606430, 1472630705},
				A:   [7]uint32{3437469760, 238558148, 4166014496, 40557750, 268931461, 1288885616, 2910876823},
				PC:  10731882,
				SR:  33536,
				USP: 14436168,
				SSP: 12846300,
				RAM: [][2]uint32{{10731876, 138}, {10731877, 217}, {10731878, 101}, {10731879, 14}, {3677122, 154}, {3677123, 240}, {10731880, 229}, {10731881, 151}},
				// DIVU: uses flat worst-case 140 cycles (real range 76-140).
				// Cycles: 114,
			},
		},
		{
			name: "1000 DIVU (A6)+, D6 8cde",
			init: cpuState{
				D:   [8]uint32{3834880392, 129793522, 1395288021, 74557267, 3782152033, 4222315986, 326548149, 352547979},
				A:   [7]uint32{3766499185, 1593713367, 3608282384, 4288771288, 2571080414, 2229585658, 263275133},
				PC:  9890412,
				SR:  8733,
				USP: 5114318,
				SSP: 7162290,
				RAM: [][2]uint32{{9890408, 140}, {9890409, 222}, {9890410, 91}, {9890411, 199}, {12, 215}, {13, 72}, {14, 104}, {15, 154}, {4745370, 237}, {4745371, 60}, {4745372, 96}, {4745373, 170}},
			},
			want: cpuState{
				D:      [8]uint32{3834880392, 129793522, 1395288021, 74557267, 3782152033, 4222315986, 326548149, 352547979},
				A:      [7]uint32{3766499185, 1593713367, 3608282384, 4288771288, 2571080414, 2229585658, 263275135},
				PC:     3611846814,
				SR:     8733,
				USP:    5114318,
				SSP:    7162276,
				RAM:    [][2]uint32{{9890408, 140}, {9890409, 222}, {9890410, 91}, {9890411, 199}, {7162288, 234}, {7162289, 106}, {7162284, 34}, {7162285, 29}, {7162286, 0}, {7162287, 150}, {7162282, 140}, {7162283, 222}, {7162280, 66}, {7162281, 125}, {7162276, 140}, {7162277, 213}, {7162278, 15}, {7162279, 177}, {12, 215}, {13, 72}, {14, 104}, {15, 154}, {4745370, 237}, {4745371, 60}, {4745372, 96}, {4745373, 170}},
				Halted: true,
			},
		},
		{
			name: "1500 DIVU (A1), D1 82d1",
			init: cpuState{
				D:   [8]uint32{1131935187, 2967760831, 3107902653, 2388280997, 4053163231, 3090168194, 3223175447, 2391423524},
				A:   [7]uint32{2775753798, 2091270239, 879934419, 2666592742, 4506931, 1945308521, 422319434},
				PC:  819074,
				SR:  533,
				USP: 2463218,
				SSP: 16327346,
				RAM: [][2]uint32{{819070, 130}, {819071, 209}, {819072, 45}, {819073, 231}, {12, 22}, {13, 210}, {14, 49}, {15, 210}, {13775314, 6}, {13775315, 81}, {13775316, 135}, {13775317, 237}},
			},
			want: cpuState{
				D:      [8]uint32{1131935187, 2967760831, 3107902653, 2388280997, 4053163231, 3090168194, 3223175447, 2391423524},
				A:      [7]uint32{2775753798, 2091270239, 879934419, 2666592742, 4506931, 1945308521, 422319434},
				PC:     382874070,
				SR:     8725,
				USP:    2463218,
				SSP:    16327332,
				RAM:    [][2]uint32{{819070, 130}, {819071, 209}, {819072, 45}, {819073, 231}, {16327344, 127}, {16327345, 128}, {16327340, 2}, {16327341, 21}, {16327342, 0}, {16327343, 12}, {16327338, 130}, {16327339, 209}, {16327336, 64}, {16327337, 95}, {16327332, 130}, {16327333, 209}, {16327334, 124}, {16327335, 166}, {12, 22}, {13, 210}, {14, 49}, {15, 210}, {13775314, 6}, {13775315, 81}, {13775316, 135}, {13775317, 237}},
				Halted: true,
			},
		},
		{
			name: "2000 DIVU (d16, A1), D0 80e9",
			init: cpuState{
				D:   [8]uint32{2573467237, 3026339520, 4094927323, 3437714138, 3760626698, 2874405135, 3138198561, 2290507765},
				A:   [7]uint32{1340680993, 1499019, 1526447768, 1580288638, 3229236120, 529531783, 3686956147},
				PC:  14913576,
				SR:  8983,
				USP: 2511940,
				SSP: 4898976,
				RAM: [][2]uint32{{14913572, 128}, {14913573, 233}, {14913574, 198}, {14913575, 76}, {14913576, 136}, {14913577, 34}, {12, 233}, {13, 46}, {14, 225}, {15, 212}, {3072468, 147}, {3072469, 9}, {3072470, 123}, {3072471, 217}},
			},
			want: cpuState{
				D:      [8]uint32{2573467237, 3026339520, 4094927323, 3437714138, 3760626698, 2874405135, 3138198561, 2290507765},
				A:      [7]uint32{1340680993, 1499019, 1526447768, 1580288638, 3229236120, 529531783, 3686956147},
				PC:     3912163800,
				SR:     8983,
				USP:    2511940,
				SSP:    4898962,
				RAM:    [][2]uint32{{14913572, 128}, {14913573, 233}, {14913574, 198}, {14913575, 76}, {14913576, 136}, {14913577, 34}, {4898974, 144}, {4898975, 38}, {4898970, 35}, {4898971, 23}, {4898972, 0}, {4898973, 227}, {4898968, 128}, {4898969, 233}, {4898966, 165}, {4898967, 215}, {4898962, 128}, {4898963, 245}, {4898964, 0}, {4898965, 22}, {12, 233}, {13, 46}, {14, 225}, {15, 212}, {3072468, 147}, {3072469, 9}, {3072470, 123}, {3072471, 217}},
				Halted: true,
			},
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			runTest(t, tt.init, tt.want)
		})
	}
}

func TestDIVS(t *testing.T) {
	tests := []struct {
		name string
		init cpuState
		want cpuState
	}{
		{
			name: "000 DIVS (d8, A5, Xn), D3 87f5",
			init: cpuState{
				D:   [8]uint32{29756972, 616991612, 1976999711, 1678834343, 612027647, 4184950574, 3466407835, 1066071521},
				A:   [7]uint32{2537772812, 2955085712, 610031400, 2987339094, 923989849, 2054121622, 2621212741},
				PC:  1031504,
				SR:  42761,
				USP: 7062182,
				SSP: 3341948,
				RAM: [][2]uint32{{1031500, 135}, {1031501, 245}, {1031502, 7}, {1031503, 251}, {1031504, 108}, {1031505, 133}, {12, 220}, {13, 50}, {14, 58}, {15, 120}, {3291768, 113}, {3291769, 38}, {3291770, 26}, {3291771, 106}},
			},
			want: cpuState{
				D:      [8]uint32{29756972, 616991612, 1976999711, 1678834343, 612027647, 4184950574, 3466407835, 1066071521},
				A:      [7]uint32{2537772812, 2955085712, 610031400, 2987339094, 923989849, 2054121622, 2621212741},
				PC:     3694279292,
				SR:     9993,
				USP:    7062182,
				SSP:    3341934,
				RAM:    [][2]uint32{{1031500, 135}, {1031501, 245}, {1031502, 7}, {1031503, 251}, {1031504, 108}, {1031505, 133}, {3341946, 189}, {3341947, 78}, {3341942, 167}, {3341943, 9}, {3341944, 0}, {3341945, 15}, {3341940, 135}, {3341941, 245}, {3341938, 118}, {3341939, 189}, {3341934, 135}, {3341935, 245}, {3341936, 122}, {3341937, 111}, {12, 220}, {13, 50}, {14, 58}, {15, 120}, {3291768, 113}, {3291769, 38}, {3291770, 26}, {3291771, 106}},
				Halted: true,
			},
		},
		{
			name: "500 DIVS (d8, A3, Xn), D0 81f3",
			init: cpuState{
				D:   [8]uint32{3995915321, 553520025, 206943654, 3165326492, 3550810973, 4018946453, 249052858, 983860650},
				A:   [7]uint32{1414792790, 4286187463, 3643521646, 1173483425, 2582455143, 2245589733, 3801426438},
				PC:  5078722,
				SR:  33033,
				USP: 6621918,
				SSP: 15205072,
				RAM: [][2]uint32{{5078718, 129}, {5078719, 243}, {5078720, 236}, {5078721, 1}, {5078722, 73}, {5078723, 30}, {8853928, 112}, {8853929, 208}, {5078724, 192}, {5078725, 186}},
			},
			want: cpuState{
				D:   [8]uint32{2430195598, 553520025, 206943654, 3165326492, 3550810973, 4018946453, 249052858, 983860650},
				A:   [7]uint32{1414792790, 4286187463, 3643521646, 1173483425, 2582455143, 2245589733, 3801426438},
				PC:  5078726,
				SR:  33032,
				USP: 6621918,
				SSP: 15205072,
				RAM: [][2]uint32{{5078718, 129}, {5078719, 243}, {5078720, 236}, {5078721, 1}, {5078722, 73}, {5078723, 30}, {8853928, 112}, {8853929, 208}, {5078724, 192}, {5078725, 186}},
				// DIVS: uses flat worst-case 158 cycles (real range 120-158).
				// Cycles: 154,
			},
		},
		{
			name: "1000 DIVS (d16, A5), D0 81ed",
			init: cpuState{
				D:   [8]uint32{1140547528, 3945238508, 911961796, 2286671031, 2910261111, 2633603275, 4183104995, 2747525250},
				A:   [7]uint32{3262756970, 2864873974, 141573598, 1606328851, 2468185197, 2079355363, 2970406466},
				PC:  8689642,
				SR:  1037,
				USP: 8752324,
				SSP: 985666,
				RAM: [][2]uint32{{8689638, 129}, {8689639, 237}, {8689640, 50}, {8689641, 137}, {8689642, 246}, {8689643, 7}, {15770732, 236}, {15770733, 167}, {8689644, 167}, {8689645, 224}},
			},
			want: cpuState{
				D:   [8]uint32{1140547528, 3945238508, 911961796, 2286671031, 2910261111, 2633603275, 4183104995, 2747525250},
				A:   [7]uint32{3262756970, 2864873974, 141573598, 1606328851, 2468185197, 2079355363, 2970406466},
				PC:  8689646,
				SR:  1034,
				USP: 8752324,
				SSP: 985666,
				RAM: [][2]uint32{{8689638, 129}, {8689639, 237}, {8689640, 50}, {8689641, 137}, {8689642, 246}, {8689643, 7}, {15770732, 236}, {15770733, 167}, {8689644, 167}, {8689645, 224}},
				// DIVS: uses flat worst-case 158 cycles (real range 120-158).
				// Cycles: 24,
			},
		},
		{
			name: "1500 DIVS (d16, A0), D1 83e8",
			init: cpuState{
				D:   [8]uint32{3455805657, 3979762557, 26397384, 3452840719, 2888931481, 977527031, 3078193129, 768169947},
				A:   [7]uint32{2304857202, 2116751071, 2503783967, 3736252680, 4038767710, 2446533077, 2827146597},
				PC:  2024984,
				SR:  40981,
				USP: 4313356,
				SSP: 1473638,
				RAM: [][2]uint32{{2024980, 131}, {2024981, 232}, {2024982, 159}, {2024983, 248}, {2024984, 231}, {2024985, 253}, {6354026, 232}, {6354027, 146}, {2024986, 236}, {2024987, 86}},
			},
			want: cpuState{
				D:   [8]uint32{3455805657, 3979762557, 26397384, 3452840719, 2888931481, 977527031, 3078193129, 768169947},
				A:   [7]uint32{2304857202, 2116751071, 2503783967, 3736252680, 4038767710, 2446533077, 2827146597},
				PC:  2024988,
				SR:  40986,
				USP: 4313356,
				SSP: 1473638,
				RAM: [][2]uint32{{2024980, 131}, {2024981, 232}, {2024982, 159}, {2024983, 248}, {2024984, 231}, {2024985, 253}, {6354026, 232}, {6354027, 146}, {2024986, 236}, {2024987, 86}},
				// DIVS: uses flat worst-case 158 cycles (real range 120-158).
				// Cycles: 146,
			},
		},
		{
			name: "2000 DIVS D3, D2 85c3",
			init: cpuState{
				D:   [8]uint32{3864652131, 4018289350, 1746872504, 1569775634, 1930582046, 2901171047, 950435295, 1846188894},
				A:   [7]uint32{4037778918, 394480229, 1588205379, 2817207162, 1556542572, 1087663718, 2056948104},
				PC:  904396,
				SR:  33311,
				USP: 4975052,
				SSP: 16282624,
				RAM: [][2]uint32{{904392, 133}, {904393, 195}, {904394, 99}, {904395, 20}, {904396, 176}, {904397, 212}},
			},
			want: cpuState{
				D:   [8]uint32{3864652131, 4018289350, 1746872504, 1569775634, 1930582046, 2901171047, 950435295, 1846188894},
				A:   [7]uint32{4037778918, 394480229, 1588205379, 2817207162, 1556542572, 1087663718, 2056948104},
				PC:  904398,
				SR:  33306,
				USP: 4975052,
				SSP: 16282624,
				RAM: [][2]uint32{{904392, 133}, {904393, 195}, {904394, 99}, {904395, 20}, {904396, 176}, {904397, 212}},
				// DIVS: uses flat worst-case 158 cycles (real range 120-158).
				// Cycles: 16,
			},
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			runTest(t, tt.init, tt.want)
		})
	}
}

func TestNEG_B(t *testing.T) {
	tests := []struct {
		name string
		init cpuState
		want cpuState
	}{
		{
			name: "000 NEG.b -(A7) 4427",
			init: cpuState{
				D:   [8]uint32{396198535, 1181930665, 4254672472, 1589792576, 3682259040, 2742747230, 1605057671, 3666742351},
				A:   [7]uint32{3326241225, 1745474568, 2308808067, 618589700, 237322954, 1065187218, 868963597},
				PC:  3464952,
				SR:  8468,
				USP: 6936958,
				SSP: 16215566,
				RAM: [][2]uint32{{3464948, 68}, {3464949, 39}, {3464950, 172}, {3464951, 187}, {16215564, 163}, {16215565, 170}, {3464952, 167}, {3464953, 71}},
			},
			want: cpuState{
				D:   [8]uint32{396198535, 1181930665, 4254672472, 1589792576, 3682259040, 2742747230, 1605057671, 3666742351},
				A:   [7]uint32{3326241225, 1745474568, 2308808067, 618589700, 237322954, 1065187218, 868963597},
				PC:  3464954,
				SR:  8465,
				USP: 6936958,
				SSP: 16215564,
				RAM: [][2]uint32{{3464948, 68}, {3464949, 39}, {3464950, 172}, {3464951, 187}, {16215564, 93}, {16215565, 170}, {3464952, 167}, {3464953, 71}},
				Cycles: 14,
			},
		},
		{
			name: "500 NEG.b D3 4403",
			init: cpuState{
				D:   [8]uint32{4052738919, 2109823174, 2309325061, 1905689638, 2930924339, 1292244688, 1926885157, 2878920677},
				A:   [7]uint32{1762795623, 420605471, 394071882, 3472566300, 63814529, 2402662751, 1809944939},
				PC:  16581962,
				SR:  34575,
				USP: 4653340,
				SSP: 16025210,
				RAM: [][2]uint32{{16581958, 68}, {16581959, 3}, {16581960, 157}, {16581961, 204}, {16581962, 117}, {16581963, 46}},
			},
			want: cpuState{
				D:   [8]uint32{4052738919, 2109823174, 2309325061, 1905689818, 2930924339, 1292244688, 1926885157, 2878920677},
				A:   [7]uint32{1762795623, 420605471, 394071882, 3472566300, 63814529, 2402662751, 1809944939},
				PC:  16581964,
				SR:  34585,
				USP: 4653340,
				SSP: 16025210,
				RAM: [][2]uint32{{16581958, 68}, {16581959, 3}, {16581960, 157}, {16581961, 204}, {16581962, 117}, {16581963, 46}},
				Cycles: 4,
			},
		},
		{
			name: "1000 NEG.b D6 4406",
			init: cpuState{
				D:   [8]uint32{2786115618, 3243187115, 1122253902, 2223062291, 1995878727, 1396728621, 3991122186, 3116227774},
				A:   [7]uint32{3795215193, 1544589005, 2451242365, 1339654275, 1285430270, 1960634620, 225127047},
				PC:  13624918,
				SR:  8975,
				USP: 8890354,
				SSP: 5700712,
				RAM: [][2]uint32{{13624914, 68}, {13624915, 6}, {13624916, 152}, {13624917, 6}, {13624918, 52}, {13624919, 35}},
			},
			want: cpuState{
				D:   [8]uint32{2786115618, 3243187115, 1122253902, 2223062291, 1995878727, 1396728621, 3991122422, 3116227774},
				A:   [7]uint32{3795215193, 1544589005, 2451242365, 1339654275, 1285430270, 1960634620, 225127047},
				PC:  13624920,
				SR:  8985,
				USP: 8890354,
				SSP: 5700712,
				RAM: [][2]uint32{{13624914, 68}, {13624915, 6}, {13624916, 152}, {13624917, 6}, {13624918, 52}, {13624919, 35}},
				Cycles: 4,
			},
		},
		{
			name: "1500 NEG.b (A1) 4411",
			init: cpuState{
				D:   [8]uint32{1742587891, 3019803964, 4213390566, 888229207, 3942216734, 3813704720, 2340870396, 3902060417},
				A:   [7]uint32{1325795159, 1474082938, 563223687, 1617302894, 3264310563, 3799719278, 3666975137},
				PC:  9325484,
				SR:  42516,
				USP: 4940062,
				SSP: 12404136,
				RAM: [][2]uint32{{9325480, 68}, {9325481, 17}, {9325482, 82}, {9325483, 46}, {14465146, 246}, {14465147, 158}, {9325484, 255}, {9325485, 253}},
			},
			want: cpuState{
				D:   [8]uint32{1742587891, 3019803964, 4213390566, 888229207, 3942216734, 3813704720, 2340870396, 3902060417},
				A:   [7]uint32{1325795159, 1474082938, 563223687, 1617302894, 3264310563, 3799719278, 3666975137},
				PC:  9325486,
				SR:  42513,
				USP: 4940062,
				SSP: 12404136,
				RAM: [][2]uint32{{9325480, 68}, {9325481, 17}, {9325482, 82}, {9325483, 46}, {14465146, 10}, {14465147, 158}, {9325484, 255}, {9325485, 253}},
				Cycles: 12,
			},
		},
		{
			name: "2000 NEG.b (A2)+ 441a",
			init: cpuState{
				D:   [8]uint32{1383727117, 1981057679, 1629380444, 1107732215, 845514815, 3423783678, 335276429, 794835931},
				A:   [7]uint32{1193091966, 344326133, 2878833117, 3876587753, 2853679709, 3400865416, 2677642943},
				PC:  15676058,
				SR:  42753,
				USP: 12270282,
				SSP: 2962958,
				RAM: [][2]uint32{{15676054, 68}, {15676055, 26}, {15676056, 41}, {15676057, 74}, {9929180, 109}, {9929181, 10}, {15676058, 33}, {15676059, 136}},
			},
			want: cpuState{
				D:   [8]uint32{1383727117, 1981057679, 1629380444, 1107732215, 845514815, 3423783678, 335276429, 794835931},
				A:   [7]uint32{1193091966, 344326133, 2878833118, 3876587753, 2853679709, 3400865416, 2677642943},
				PC:  15676060,
				SR:  42777,
				USP: 12270282,
				SSP: 2962958,
				RAM: [][2]uint32{{15676054, 68}, {15676055, 26}, {15676056, 41}, {15676057, 74}, {9929180, 109}, {9929181, 246}, {15676058, 33}, {15676059, 136}},
				Cycles: 12,
			},
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			runTest(t, tt.init, tt.want)
		})
	}
}

func TestNEG_W(t *testing.T) {
	tests := []struct {
		name string
		init cpuState
		want cpuState
	}{
		{
			name: "000 NEG.w D6 4446",
			init: cpuState{
				D:   [8]uint32{2915949660, 4208110988, 3897725201, 157986744, 2424547139, 398580832, 3144043529, 3319658943},
				A:   [7]uint32{1155462772, 3810844444, 3589085788, 2091927467, 2326765843, 144408155, 1896118326},
				PC:  2969060,
				SR:  42259,
				USP: 15124356,
				SSP: 5960562,
				RAM: [][2]uint32{{2969056, 68}, {2969057, 70}, {2969058, 207}, {2969059, 223}, {2969060, 60}, {2969061, 110}},
			},
			want: cpuState{
				D:   [8]uint32{2915949660, 4208110988, 3897725201, 157986744, 2424547139, 398580832, 3144070135, 3319658943},
				A:   [7]uint32{1155462772, 3810844444, 3589085788, 2091927467, 2326765843, 144408155, 1896118326},
				PC:  2969062,
				SR:  42265,
				USP: 15124356,
				SSP: 5960562,
				RAM: [][2]uint32{{2969056, 68}, {2969057, 70}, {2969058, 207}, {2969059, 223}, {2969060, 60}, {2969061, 110}},
				Cycles: 4,
			},
		},
		{
			name: "500 NEG.w -(A3) 4463",
			init: cpuState{
				D:   [8]uint32{1355486337, 3788654406, 2725608882, 2862724238, 1739299320, 2577950922, 138807065, 1989673365},
				A:   [7]uint32{2626402756, 3905705728, 2872122411, 1799684652, 2856217698, 3949908055, 3113370227},
				PC:  16713452,
				SR:  8715,
				USP: 9174686,
				SSP: 11450042,
				RAM: [][2]uint32{{16713448, 68}, {16713449, 99}, {16713450, 80}, {16713451, 249}, {4522538, 41}, {4522539, 9}, {16713452, 45}, {16713453, 106}},
			},
			want: cpuState{
				D:   [8]uint32{1355486337, 3788654406, 2725608882, 2862724238, 1739299320, 2577950922, 138807065, 1989673365},
				A:   [7]uint32{2626402756, 3905705728, 2872122411, 1799684650, 2856217698, 3949908055, 3113370227},
				PC:  16713454,
				SR:  8729,
				USP: 9174686,
				SSP: 11450042,
				RAM: [][2]uint32{{16713448, 68}, {16713449, 99}, {16713450, 80}, {16713451, 249}, {4522538, 214}, {4522539, 247}, {16713452, 45}, {16713453, 106}},
				Cycles: 14,
			},
		},
		{
			name: "1000 NEG.w D1 4441",
			init: cpuState{
				D:   [8]uint32{2361158122, 3623290893, 3361650531, 2649015181, 4226626170, 3008168291, 3547930330, 1188128845},
				A:   [7]uint32{1036195776, 709692555, 2017677353, 3748819848, 2350382517, 4261949209, 621255156},
				PC:  1425156,
				SR:  41244,
				USP: 6837652,
				SSP: 14997410,
				RAM: [][2]uint32{{1425152, 68}, {1425153, 65}, {1425154, 170}, {1425155, 170}, {1425156, 227}, {1425157, 165}},
			},
			want: cpuState{
				D:   [8]uint32{2361158122, 3623352307, 3361650531, 2649015181, 4226626170, 3008168291, 3547930330, 1188128845},
				A:   [7]uint32{1036195776, 709692555, 2017677353, 3748819848, 2350382517, 4261949209, 621255156},
				PC:  1425158,
				SR:  41241,
				USP: 6837652,
				SSP: 14997410,
				RAM: [][2]uint32{{1425152, 68}, {1425153, 65}, {1425154, 170}, {1425155, 170}, {1425156, 227}, {1425157, 165}},
				Cycles: 4,
			},
		},
		{
			name: "1500 NEG.w -(A6) 4466",
			init: cpuState{
				D:   [8]uint32{1794164851, 758705101, 3432477330, 2444286583, 3418335022, 1704792676, 3636392261, 2252475950},
				A:   [7]uint32{917265208, 2625191631, 1208269651, 4060029441, 3006062624, 4058222987, 924253985},
				PC:  9348616,
				SR:  42245,
				USP: 7471700,
				SSP: 15119528,
				RAM: [][2]uint32{{9348612, 68}, {9348613, 102}, {9348614, 148}, {9348615, 239}, {12, 97}, {13, 162}, {14, 67}, {15, 80}, {10634064, 89}, {10634065, 254}, {10634066, 207}, {10634067, 38}},
			},
			want: cpuState{
				D:      [8]uint32{1794164851, 758705101, 3432477330, 2444286583, 3418335022, 1704792676, 3636392261, 2252475950},
				A:      [7]uint32{917265208, 2625191631, 1208269651, 4060029441, 3006062624, 4058222987, 924253983},
				PC:     1638024020,
				SR:     9477,
				USP:    7471700,
				SSP:    15119514,
				RAM:    [][2]uint32{{9348612, 68}, {9348613, 102}, {9348614, 148}, {9348615, 239}, {15119526, 166}, {15119527, 8}, {15119522, 165}, {15119523, 5}, {15119524, 0}, {15119525, 142}, {15119520, 68}, {15119521, 102}, {15119518, 255}, {15119519, 31}, {15119514, 68}, {15119515, 117}, {15119516, 55}, {15119517, 22}, {12, 97}, {13, 162}, {14, 67}, {15, 80}, {10634064, 89}, {10634065, 254}, {10634066, 207}, {10634067, 38}},
				Halted: true,
			},
		},
		{
			name: "2000 NEG.w (d16, A3) 446b",
			init: cpuState{
				D:   [8]uint32{1893049647, 3815111632, 4116717305, 1969157946, 2776697103, 4051343205, 3645149036, 304192302},
				A:   [7]uint32{1932126572, 446931892, 402232159, 1540546781, 3752128603, 1546144732, 1782733958},
				PC:  3623616,
				SR:  42502,
				USP: 3634900,
				SSP: 5757298,
				RAM: [][2]uint32{{3623612, 68}, {3623613, 107}, {3623614, 220}, {3623615, 132}, {3623616, 146}, {3623617, 57}, {12, 57}, {13, 8}, {14, 227}, {15, 42}, {582442, 221}, {582443, 66}, {582444, 37}, {582445, 31}},
			},
			want: cpuState{
				D:      [8]uint32{1893049647, 3815111632, 4116717305, 1969157946, 2776697103, 4051343205, 3645149036, 304192302},
				A:      [7]uint32{1932126572, 446931892, 402232159, 1540546781, 3752128603, 1546144732, 1782733958},
				PC:     956883758,
				SR:     9734,
				USP:    3634900,
				SSP:    5757284,
				RAM:    [][2]uint32{{3623612, 68}, {3623613, 107}, {3623614, 220}, {3623615, 132}, {3623616, 146}, {3623617, 57}, {5757296, 74}, {5757297, 190}, {5757292, 166}, {5757293, 6}, {5757294, 0}, {5757295, 55}, {5757290, 68}, {5757291, 107}, {5757288, 189}, {5757289, 97}, {5757284, 68}, {5757285, 117}, {5757286, 91}, {5757287, 210}, {12, 57}, {13, 8}, {14, 227}, {15, 42}, {582442, 221}, {582443, 66}, {582444, 37}, {582445, 31}},
				Halted: true,
			},
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			runTest(t, tt.init, tt.want)
		})
	}
}

func TestNEG_L(t *testing.T) {
	tests := []struct {
		name string
		init cpuState
		want cpuState
	}{
		{
			name: "000 NEG.l (d8, A6, Xn) 44b6",
			init: cpuState{
				D:   [8]uint32{719086016, 3259811995, 2860197788, 2621662612, 2307160278, 3595857550, 3802541122, 3273727736},
				A:   [7]uint32{853453440, 2727382335, 3119527772, 529205721, 182644064, 637917436, 2865619974},
				PC:  10066980,
				SR:  42516,
				USP: 10268442,
				SSP: 10730316,
				RAM: [][2]uint32{{10066976, 68}, {10066977, 182}, {10066978, 152}, {10066979, 29}, {10066980, 23}, {10066981, 213}, {6189410, 144}, {6189411, 137}, {6189412, 54}, {6189413, 166}, {10066982, 241}, {10066983, 187}},
			},
			want: cpuState{
				D:   [8]uint32{719086016, 3259811995, 2860197788, 2621662612, 2307160278, 3595857550, 3802541122, 3273727736},
				A:   [7]uint32{853453440, 2727382335, 3119527772, 529205721, 182644064, 637917436, 2865619974},
				PC:  10066984,
				SR:  42513,
				USP: 10268442,
				SSP: 10730316,
				RAM: [][2]uint32{{10066976, 68}, {10066977, 182}, {10066978, 152}, {10066979, 29}, {10066980, 23}, {10066981, 213}, {6189410, 111}, {6189411, 118}, {6189412, 201}, {6189413, 90}, {10066982, 241}, {10066983, 187}},
				Cycles: 26,
			},
		},
		{
			name: "500 NEG.l -(A1) 44a1",
			init: cpuState{
				D:   [8]uint32{3820270538, 3167951532, 4280191509, 1841217126, 3700595061, 1792962292, 992386636, 3652894431},
				A:   [7]uint32{3643201910, 2513309119, 1797912110, 1722048088, 4228619898, 2965726583, 2659334603},
				PC:  2765298,
				SR:  519,
				USP: 9858294,
				SSP: 4355452,
				RAM: [][2]uint32{{2765294, 68}, {2765295, 161}, {2765296, 228}, {2765297, 116}, {12, 91}, {13, 164}, {14, 17}, {15, 234}, {10752490, 198}, {10752491, 11}, {10752492, 116}, {10752493, 100}},
			},
			want: cpuState{
				D:      [8]uint32{3820270538, 3167951532, 4280191509, 1841217126, 3700595061, 1792962292, 992386636, 3652894431},
				A:      [7]uint32{3643201910, 2513309115, 1797912110, 1722048088, 4228619898, 2965726583, 2659334603},
				PC:     1537479150,
				SR:     8711,
				USP:    9858294,
				SSP:    4355438,
				RAM:    [][2]uint32{{2765294, 68}, {2765295, 161}, {2765296, 228}, {2765297, 116}, {4355450, 49}, {4355451, 240}, {4355446, 2}, {4355447, 7}, {4355448, 0}, {4355449, 42}, {4355444, 68}, {4355445, 161}, {4355442, 13}, {4355443, 187}, {4355438, 68}, {4355439, 177}, {4355440, 149}, {4355441, 206}, {12, 91}, {13, 164}, {14, 17}, {15, 234}, {10752490, 198}, {10752491, 11}, {10752492, 116}, {10752493, 100}},
				Halted: true,
			},
		},
		{
			name: "1000 NEG.l (A2) 4492",
			init: cpuState{
				D:   [8]uint32{1600078150, 1192545120, 2851157367, 3218614624, 4013698055, 456788395, 1877373041, 1086344250},
				A:   [7]uint32{2676042129, 1114560778, 3749899372, 4215979598, 4003652880, 3239091244, 949257642},
				PC:  8487452,
				SR:  1539,
				USP: 1765752,
				SSP: 15538022,
				RAM: [][2]uint32{{8487448, 68}, {8487449, 146}, {8487450, 203}, {8487451, 68}, {8580204, 85}, {8580205, 63}, {8580206, 149}, {8580207, 56}, {8487452, 66}, {8487453, 38}},
			},
			want: cpuState{
				D:   [8]uint32{1600078150, 1192545120, 2851157367, 3218614624, 4013698055, 456788395, 1877373041, 1086344250},
				A:   [7]uint32{2676042129, 1114560778, 3749899372, 4215979598, 4003652880, 3239091244, 949257642},
				PC:  8487454,
				SR:  1561,
				USP: 1765752,
				SSP: 15538022,
				RAM: [][2]uint32{{8487448, 68}, {8487449, 146}, {8487450, 203}, {8487451, 68}, {8580204, 170}, {8580205, 192}, {8580206, 106}, {8580207, 200}, {8487452, 66}, {8487453, 38}},
				Cycles: 20,
			},
		},
		{
			name: "1500 NEG.l (d8, A2, Xn) 44b2",
			init: cpuState{
				D:   [8]uint32{4264905605, 3598216323, 3153051087, 3593934027, 1611263043, 2584955757, 3339391747, 3225157841},
				A:   [7]uint32{1856076612, 3605553870, 2288008320, 2404733416, 4245482680, 2772047808, 2407091370},
				PC:  8998054,
				SR:  9755,
				USP: 13841716,
				SSP: 2052772,
				RAM: [][2]uint32{{8998050, 68}, {8998051, 178}, {8998052, 92}, {8998053, 9}, {8998054, 100}, {8998055, 219}, {7571446, 128}, {7571447, 107}, {7571448, 84}, {7571449, 23}, {8998056, 141}, {8998057, 155}},
			},
			want: cpuState{
				D:   [8]uint32{4264905605, 3598216323, 3153051087, 3593934027, 1611263043, 2584955757, 3339391747, 3225157841},
				A:   [7]uint32{1856076612, 3605553870, 2288008320, 2404733416, 4245482680, 2772047808, 2407091370},
				PC:  8998058,
				SR:  9745,
				USP: 13841716,
				SSP: 2052772,
				RAM: [][2]uint32{{8998050, 68}, {8998051, 178}, {8998052, 92}, {8998053, 9}, {8998054, 100}, {8998055, 219}, {7571446, 127}, {7571447, 148}, {7571448, 171}, {7571449, 233}, {8998056, 141}, {8998057, 155}},
				Cycles: 26,
			},
		},
		{
			name: "2000 NEG.l (A0)+ 4498",
			init: cpuState{
				D:   [8]uint32{520310635, 1158175548, 1286392270, 637683192, 3826063731, 2568583579, 57436952, 4201783504},
				A:   [7]uint32{2141690914, 3107331254, 2161806859, 1548999783, 4183940512, 2096745090, 3643515432},
				PC:  7823060,
				SR:  9245,
				USP: 3961036,
				SSP: 10385274,
				RAM: [][2]uint32{{7823056, 68}, {7823057, 152}, {7823058, 75}, {7823059, 34}, {10984482, 205}, {10984483, 225}, {10984484, 57}, {10984485, 52}, {7823060, 117}, {7823061, 5}},
			},
			want: cpuState{
				D:   [8]uint32{520310635, 1158175548, 1286392270, 637683192, 3826063731, 2568583579, 57436952, 4201783504},
				A:   [7]uint32{2141690918, 3107331254, 2161806859, 1548999783, 4183940512, 2096745090, 3643515432},
				PC:  7823062,
				SR:  9233,
				USP: 3961036,
				SSP: 10385274,
				RAM: [][2]uint32{{7823056, 68}, {7823057, 152}, {7823058, 75}, {7823059, 34}, {10984482, 50}, {10984483, 30}, {10984484, 198}, {10984485, 204}, {7823060, 117}, {7823061, 5}},
				Cycles: 20,
			},
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			runTest(t, tt.init, tt.want)
		})
	}
}

func TestNEGX_B(t *testing.T) {
	tests := []struct {
		name string
		init cpuState
		want cpuState
	}{
		{
			name: "000 NEGX.b D4 4004",
			init: cpuState{
				D:   [8]uint32{3980333592, 874802409, 3547105131, 2086528331, 3516025262, 4018885167, 3021613333, 725556595},
				A:   [7]uint32{4135520359, 4262412885, 3628678038, 1903614322, 1837529438, 1174442293, 258316547},
				PC:  12852440,
				SR:  9473,
				USP: 18164,
				SSP: 506524,
				RAM: [][2]uint32{{12852436, 64}, {12852437, 4}, {12852438, 170}, {12852439, 152}, {12852440, 206}, {12852441, 230}},
			},
			want: cpuState{
				D:   [8]uint32{3980333592, 874802409, 3547105131, 2086528331, 3516025170, 4018885167, 3021613333, 725556595},
				A:   [7]uint32{4135520359, 4262412885, 3628678038, 1903614322, 1837529438, 1174442293, 258316547},
				PC:  12852442,
				SR:  9489,
				USP: 18164,
				SSP: 506524,
				RAM: [][2]uint32{{12852436, 64}, {12852437, 4}, {12852438, 170}, {12852439, 152}, {12852440, 206}, {12852441, 230}},
				Cycles: 4,
			},
		},
		{
			name: "500 NEGX.b (d8, A1, Xn) 4031",
			init: cpuState{
				D:   [8]uint32{779448900, 1836693705, 578847797, 51354482, 918121271, 1356123195, 1512677812, 471225132},
				A:   [7]uint32{4046098897, 1024231822, 3009554779, 4231646865, 2748788438, 4277691689, 951330482},
				PC:  7299394,
				SR:  1794,
				USP: 10784694,
				SSP: 8131868,
				RAM: [][2]uint32{{7299390, 64}, {7299391, 49}, {7299392, 107}, {7299393, 16}, {7299394, 97}, {7299395, 78}, {3550034, 48}, {3550035, 15}, {7299396, 29}, {7299397, 51}},
			},
			want: cpuState{
				D:   [8]uint32{779448900, 1836693705, 578847797, 51354482, 918121271, 1356123195, 1512677812, 471225132},
				A:   [7]uint32{4046098897, 1024231822, 3009554779, 4231646865, 2748788438, 4277691689, 951330482},
				PC:  7299398,
				SR:  1817,
				USP: 10784694,
				SSP: 8131868,
				RAM: [][2]uint32{{7299390, 64}, {7299391, 49}, {7299392, 107}, {7299393, 16}, {7299394, 97}, {7299395, 78}, {3550034, 208}, {3550035, 15}, {7299396, 29}, {7299397, 51}},
				Cycles: 18,
			},
		},
		{
			name: "1000 NEGX.b (d16, A6) 402e",
			init: cpuState{
				D:   [8]uint32{11066133, 3698093092, 49542838, 2461574175, 1295205905, 2386816731, 1574440678, 4127703378},
				A:   [7]uint32{763463074, 3395581797, 2827092875, 1229755049, 933990074, 1810603751, 3429094173},
				PC:  1560824,
				SR:  34072,
				USP: 8029710,
				SSP: 3991910,
				RAM: [][2]uint32{{1560820, 64}, {1560821, 46}, {1560822, 46}, {1560823, 251}, {1560824, 102}, {1560825, 95}, {6554136, 34}, {6554137, 168}, {1560826, 207}, {1560827, 161}},
			},
			want: cpuState{
				D:   [8]uint32{11066133, 3698093092, 49542838, 2461574175, 1295205905, 2386816731, 1574440678, 4127703378},
				A:   [7]uint32{763463074, 3395581797, 2827092875, 1229755049, 933990074, 1810603751, 3429094173},
				PC:  1560828,
				SR:  34073,
				USP: 8029710,
				SSP: 3991910,
				RAM: [][2]uint32{{1560820, 64}, {1560821, 46}, {1560822, 46}, {1560823, 251}, {1560824, 102}, {1560825, 95}, {6554136, 221}, {6554137, 168}, {1560826, 207}, {1560827, 161}},
				Cycles: 16,
			},
		},
		{
			name: "1500 NEGX.b (A2)+ 401a",
			init: cpuState{
				D:   [8]uint32{4123596445, 2369664390, 1790215658, 4064424284, 204433936, 3140704313, 4257698800, 1164461973},
				A:   [7]uint32{233767048, 2476974590, 1587941988, 2593478033, 2684713315, 443548151, 1998600408},
				PC:  2074270,
				SR:  34321,
				USP: 6229444,
				SSP: 1757354,
				RAM: [][2]uint32{{2074266, 64}, {2074267, 26}, {2074268, 113}, {2074269, 11}, {10883684, 137}, {10883685, 156}, {2074270, 70}, {2074271, 6}},
			},
			want: cpuState{
				D:   [8]uint32{4123596445, 2369664390, 1790215658, 4064424284, 204433936, 3140704313, 4257698800, 1164461973},
				A:   [7]uint32{233767048, 2476974590, 1587941989, 2593478033, 2684713315, 443548151, 1998600408},
				PC:  2074272,
				SR:  34321,
				USP: 6229444,
				SSP: 1757354,
				RAM: [][2]uint32{{2074266, 64}, {2074267, 26}, {2074268, 113}, {2074269, 11}, {10883684, 118}, {10883685, 156}, {2074270, 70}, {2074271, 6}},
				Cycles: 12,
			},
		},
		{
			name: "2000 NEGX.b -(A4) 4024",
			init: cpuState{
				D:   [8]uint32{2762991148, 2120424293, 115103032, 570626981, 413385005, 1602143742, 1730016526, 903205874},
				A:   [7]uint32{3093332292, 896652120, 2365349382, 1154851703, 4102627304, 4004371961, 4096471579},
				PC:  10518912,
				SR:  9238,
				USP: 3399402,
				SSP: 5077546,
				RAM: [][2]uint32{{10518908, 64}, {10518909, 36}, {10518910, 83}, {10518911, 211}, {8986598, 229}, {8986599, 102}, {10518912, 252}, {10518913, 185}},
			},
			want: cpuState{
				D:   [8]uint32{2762991148, 2120424293, 115103032, 570626981, 413385005, 1602143742, 1730016526, 903205874},
				A:   [7]uint32{3093332292, 896652120, 2365349382, 1154851703, 4102627303, 4004371961, 4096471579},
				PC:  10518914,
				SR:  9241,
				USP: 3399402,
				SSP: 5077546,
				RAM: [][2]uint32{{10518908, 64}, {10518909, 36}, {10518910, 83}, {10518911, 211}, {8986598, 229}, {8986599, 153}, {10518912, 252}, {10518913, 185}},
				Cycles: 14,
			},
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			runTest(t, tt.init, tt.want)
		})
	}
}

func TestNEGX_W(t *testing.T) {
	tests := []struct {
		name string
		init cpuState
		want cpuState
	}{
		{
			name: "000 NEGX.w (d16, A1) 4069",
			init: cpuState{
				D:   [8]uint32{1064059708, 2948880760, 3150013704, 1370511521, 1090054400, 2992938096, 1579011178, 3096968114},
				A:   [7]uint32{671629648, 1609631514, 2343267296, 3868328393, 2033000172, 1710072273, 813654814},
				PC:  2523460,
				SR:  8470,
				USP: 14584866,
				SSP: 6486856,
				RAM: [][2]uint32{{2523456, 64}, {2523457, 105}, {2523458, 230}, {2523459, 181}, {2523460, 225}, {2523461, 98}, {12, 137}, {13, 86}, {14, 131}, {15, 142}, {5669774, 14}, {5669775, 36}, {5669776, 111}, {5669777, 86}},
			},
			want: cpuState{
				D:      [8]uint32{1064059708, 2948880760, 3150013704, 1370511521, 1090054400, 2992938096, 1579011178, 3096968114},
				A:      [7]uint32{671629648, 1609631514, 2343267296, 3868328393, 2033000172, 1710072273, 813654814},
				PC:     2304148370,
				SR:     8470,
				USP:    14584866,
				SSP:    6486842,
				RAM:    [][2]uint32{{2523456, 64}, {2523457, 105}, {2523458, 230}, {2523459, 181}, {2523460, 225}, {2523461, 98}, {6486854, 129}, {6486855, 66}, {6486850, 33}, {6486851, 22}, {6486852, 0}, {6486853, 38}, {6486848, 64}, {6486849, 105}, {6486846, 237}, {6486847, 207}, {6486842, 64}, {6486843, 117}, {6486844, 95}, {6486845, 240}, {12, 137}, {13, 86}, {14, 131}, {15, 142}, {5669774, 14}, {5669775, 36}, {5669776, 111}, {5669777, 86}},
				Halted: true,
			},
		},
		{
			name: "500 NEGX.w (d16, A6) 406e",
			init: cpuState{
				D:   [8]uint32{2777281223, 732087108, 3932581887, 910388629, 2612108473, 418631947, 3082288770, 1234535461},
				A:   [7]uint32{2239970411, 1087513444, 3180514328, 2186521960, 2251003407, 1638231520, 2741287547},
				PC:  5567408,
				SR:  526,
				USP: 8099216,
				SSP: 3790816,
				RAM: [][2]uint32{{5567404, 64}, {5567405, 110}, {5567406, 63}, {5567407, 132}, {5567408, 36}, {5567409, 216}, {12, 30}, {13, 220}, {14, 45}, {15, 74}, {14429514, 16}, {14429515, 8}, {14429516, 245}, {14429517, 121}},
			},
			want: cpuState{
				D:      [8]uint32{2777281223, 732087108, 3932581887, 910388629, 2612108473, 418631947, 3082288770, 1234535461},
				A:      [7]uint32{2239970411, 1087513444, 3180514328, 2186521960, 2251003407, 1638231520, 2741287547},
				PC:     517745998,
				SR:     8718,
				USP:    8099216,
				SSP:    3790802,
				RAM:    [][2]uint32{{5567404, 64}, {5567405, 110}, {5567406, 63}, {5567407, 132}, {5567408, 36}, {5567409, 216}, {3790814, 243}, {3790815, 174}, {3790810, 2}, {3790811, 14}, {3790812, 0}, {3790813, 84}, {3790808, 64}, {3790809, 110}, {3790806, 249}, {3790807, 255}, {3790802, 64}, {3790803, 113}, {3790804, 163}, {3790805, 100}, {12, 30}, {13, 220}, {14, 45}, {15, 74}, {14429514, 16}, {14429515, 8}, {14429516, 245}, {14429517, 121}},
				Halted: true,
			},
		},
		{
			name: "1000 NEGX.w (d8, A1, Xn) 4071",
			init: cpuState{
				D:   [8]uint32{3842873051, 4137188192, 181526536, 75040596, 1482918950, 319385367, 783924732, 971181099},
				A:   [7]uint32{1532412480, 1702480641, 1038355970, 2617144223, 3119047569, 317415789, 270821705},
				PC:  2208734,
				SR:  514,
				USP: 178180,
				SSP: 16349680,
				RAM: [][2]uint32{{2208730, 64}, {2208731, 113}, {2208732, 112}, {2208733, 27}, {2208734, 64}, {2208735, 68}, {12, 73}, {13, 228}, {14, 88}, {15, 2}, {14964738, 28}, {14964739, 180}, {14964740, 215}, {14964741, 108}},
			},
			want: cpuState{
				D:      [8]uint32{3842873051, 4137188192, 181526536, 75040596, 1482918950, 319385367, 783924732, 971181099},
				A:      [7]uint32{1532412480, 1702480641, 1038355970, 2617144223, 3119047569, 317415789, 270821705},
				PC:     1239701510,
				SR:     8706,
				USP:    178180,
				SSP:    16349666,
				RAM:    [][2]uint32{{2208730, 64}, {2208731, 113}, {2208732, 112}, {2208733, 27}, {2208734, 64}, {2208735, 68}, {16349678, 179}, {16349679, 220}, {16349674, 2}, {16349675, 2}, {16349676, 0}, {16349677, 33}, {16349672, 64}, {16349673, 113}, {16349670, 215}, {16349671, 71}, {16349666, 64}, {16349667, 113}, {16349668, 101}, {16349669, 121}, {12, 73}, {13, 228}, {14, 88}, {15, 2}, {14964738, 28}, {14964739, 180}, {14964740, 215}, {14964741, 108}},
				Halted: true,
			},
		},
		{
			name: "1500 NEGX.w D1 4041",
			init: cpuState{
				D:   [8]uint32{2296759308, 2907016722, 1542574161, 2607177950, 3953991193, 1274392134, 2426391365, 4028269222},
				A:   [7]uint32{80423850, 2582462382, 2470789728, 2189346364, 4271158815, 3825166643, 2809976678},
				PC:  15932072,
				SR:  8205,
				USP: 11605910,
				SSP: 4163182,
				RAM: [][2]uint32{{15932068, 64}, {15932069, 65}, {15932070, 25}, {15932071, 193}, {15932072, 67}, {15932073, 105}},
			},
			want: cpuState{
				D:   [8]uint32{2296759308, 2907009518, 1542574161, 2607177950, 3953991193, 1274392134, 2426391365, 4028269222},
				A:   [7]uint32{80423850, 2582462382, 2470789728, 2189346364, 4271158815, 3825166643, 2809976678},
				PC:  15932074,
				SR:  8209,
				USP: 11605910,
				SSP: 4163182,
				RAM: [][2]uint32{{15932068, 64}, {15932069, 65}, {15932070, 25}, {15932071, 193}, {15932072, 67}, {15932073, 105}},
				Cycles: 4,
			},
		},
		{
			name: "2000 NEGX.w D4 4044",
			init: cpuState{
				D:   [8]uint32{3322846783, 2301773415, 3097965220, 598260863, 3640736768, 1999808889, 36380249, 2084825944},
				A:   [7]uint32{2376813229, 1372505702, 306325296, 4110400587, 2377250960, 2627511076, 2732170484},
				PC:  12754342,
				SR:  795,
				USP: 6245492,
				SSP: 10228444,
				RAM: [][2]uint32{{12754338, 64}, {12754339, 68}, {12754340, 78}, {12754341, 241}, {12754342, 252}, {12754343, 69}},
			},
			want: cpuState{
				D:   [8]uint32{3322846783, 2301773415, 3097965220, 598260863, 3640771583, 1999808889, 36380249, 2084825944},
				A:   [7]uint32{2376813229, 1372505702, 306325296, 4110400587, 2377250960, 2627511076, 2732170484},
				PC:  12754344,
				SR:  793,
				USP: 6245492,
				SSP: 10228444,
				RAM: [][2]uint32{{12754338, 64}, {12754339, 68}, {12754340, 78}, {12754341, 241}, {12754342, 252}, {12754343, 69}},
				Cycles: 4,
			},
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			runTest(t, tt.init, tt.want)
		})
	}
}

func TestNEGX_L(t *testing.T) {
	tests := []struct {
		name string
		init cpuState
		want cpuState
	}{
		{
			name: "000 NEGX.l (A6)+ 409e",
			init: cpuState{
				D:   [8]uint32{4240857964, 1679385175, 3055850285, 2316363324, 2224790394, 85715596, 1509275769, 3288733101},
				A:   [7]uint32{1789172564, 2353643390, 2311147913, 3267304612, 3706756269, 3816240940, 2746850424},
				PC:  4880902,
				SR:  8222,
				USP: 4986334,
				SSP: 7780692,
				RAM: [][2]uint32{{4880898, 64}, {4880899, 158}, {4880900, 186}, {4880901, 132}, {12164216, 30}, {12164217, 54}, {12164218, 29}, {12164219, 250}, {4880902, 149}, {4880903, 215}},
			},
			want: cpuState{
				D:   [8]uint32{4240857964, 1679385175, 3055850285, 2316363324, 2224790394, 85715596, 1509275769, 3288733101},
				A:   [7]uint32{1789172564, 2353643390, 2311147913, 3267304612, 3706756269, 3816240940, 2746850428},
				PC:  4880904,
				SR:  8217,
				USP: 4986334,
				SSP: 7780692,
				RAM: [][2]uint32{{4880898, 64}, {4880899, 158}, {4880900, 186}, {4880901, 132}, {12164216, 225}, {12164217, 201}, {12164218, 226}, {12164219, 5}, {4880902, 149}, {4880903, 215}},
				Cycles: 20,
			},
		},
		{
			name: "500 NEGX.l D0 4080",
			init: cpuState{
				D:   [8]uint32{1028292963, 3888977925, 927288569, 606827059, 3506466882, 2436069606, 3367663369, 3807993776},
				A:   [7]uint32{170729621, 1755868974, 1591706618, 579617635, 2930088736, 1413302687, 2977931232},
				PC:  9491808,
				SR:  1308,
				USP: 12507300,
				SSP: 8365796,
				RAM: [][2]uint32{{9491804, 64}, {9491805, 128}, {9491806, 20}, {9491807, 65}, {9491808, 64}, {9491809, 23}},
			},
			want: cpuState{
				D:   [8]uint32{3266674332, 3888977925, 927288569, 606827059, 3506466882, 2436069606, 3367663369, 3807993776},
				A:   [7]uint32{170729621, 1755868974, 1591706618, 579617635, 2930088736, 1413302687, 2977931232},
				PC:  9491810,
				SR:  1305,
				USP: 12507300,
				SSP: 8365796,
				RAM: [][2]uint32{{9491804, 64}, {9491805, 128}, {9491806, 20}, {9491807, 65}, {9491808, 64}, {9491809, 23}},
				Cycles: 6,
			},
		},
		{
			name: "1000 NEGX.l D3 4083",
			init: cpuState{
				D:   [8]uint32{1282700620, 200846980, 1317557413, 1266262493, 625261358, 3631873799, 4257740204, 4271767421},
				A:   [7]uint32{4046120622, 4237388774, 45118112, 92172885, 2833000261, 871258928, 2188318111},
				PC:  1727590,
				SR:  531,
				USP: 8826766,
				SSP: 9212558,
				RAM: [][2]uint32{{1727586, 64}, {1727587, 131}, {1727588, 125}, {1727589, 136}, {1727590, 156}, {1727591, 254}},
			},
			want: cpuState{
				D:   [8]uint32{1282700620, 200846980, 1317557413, 3028704802, 625261358, 3631873799, 4257740204, 4271767421},
				A:   [7]uint32{4046120622, 4237388774, 45118112, 92172885, 2833000261, 871258928, 2188318111},
				PC:  1727592,
				SR:  537,
				USP: 8826766,
				SSP: 9212558,
				RAM: [][2]uint32{{1727586, 64}, {1727587, 131}, {1727588, 125}, {1727589, 136}, {1727590, 156}, {1727591, 254}},
				Cycles: 6,
			},
		},
		{
			name: "1500 NEGX.l (A7) 4097",
			init: cpuState{
				D:   [8]uint32{2608453345, 3169214991, 2448554872, 2975448585, 1963750723, 656202000, 3772950400, 1482845607},
				A:   [7]uint32{4196114662, 4202382138, 394648055, 3541570277, 3346200569, 3275516632, 3230502465},
				PC:  13027680,
				SR:  42773,
				USP: 4731840,
				SSP: 13508120,
				RAM: [][2]uint32{{13027676, 64}, {13027677, 151}, {13027678, 253}, {13027679, 241}, {13508120, 53}, {13508121, 117}, {13508122, 215}, {13508123, 103}, {13027680, 241}, {13027681, 116}},
			},
			want: cpuState{
				D:   [8]uint32{2608453345, 3169214991, 2448554872, 2975448585, 1963750723, 656202000, 3772950400, 1482845607},
				A:   [7]uint32{4196114662, 4202382138, 394648055, 3541570277, 3346200569, 3275516632, 3230502465},
				PC:  13027682,
				SR:  42777,
				USP: 4731840,
				SSP: 13508120,
				RAM: [][2]uint32{{13027676, 64}, {13027677, 151}, {13027678, 253}, {13027679, 241}, {13508120, 202}, {13508121, 138}, {13508122, 40}, {13508123, 152}, {13027680, 241}, {13027681, 116}},
				Cycles: 20,
			},
		},
		{
			name: "2000 NEGX.l -(A3) 40a3",
			init: cpuState{
				D:   [8]uint32{93941123, 2705081736, 4215729906, 780671896, 3329343442, 2263349083, 4028802248, 4006990731},
				A:   [7]uint32{561855232, 3693713646, 963574217, 491910599, 1574843593, 3285678042, 1871124792},
				PC:  9318520,
				SR:  1802,
				USP: 2873848,
				SSP: 9189338,
				RAM: [][2]uint32{{9318516, 64}, {9318517, 163}, {9318518, 252}, {9318519, 239}, {12, 233}, {13, 180}, {14, 32}, {15, 46}, {11804718, 183}, {11804719, 88}, {11804720, 24}, {11804721, 247}},
			},
			want: cpuState{
				D:      [8]uint32{93941123, 2705081736, 4215729906, 780671896, 3329343442, 2263349083, 4028802248, 4006990731},
				A:      [7]uint32{561855232, 3693713646, 963574217, 491910595, 1574843593, 3285678042, 1871124792},
				PC:     3920896050,
				SR:     9994,
				USP:    2873848,
				SSP:    9189324,
				RAM:    [][2]uint32{{9318516, 64}, {9318517, 163}, {9318518, 252}, {9318519, 239}, {9189336, 48}, {9189337, 118}, {9189332, 7}, {9189333, 10}, {9189334, 0}, {9189335, 142}, {9189330, 64}, {9189331, 163}, {9189328, 245}, {9189329, 195}, {9189324, 64}, {9189325, 177}, {9189326, 29}, {9189327, 81}, {12, 233}, {13, 180}, {14, 32}, {15, 46}, {11804718, 183}, {11804719, 88}, {11804720, 24}, {11804721, 247}},
				Halted: true,
			},
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			runTest(t, tt.init, tt.want)
		})
	}
}

func TestCLR_B(t *testing.T) {
	tests := []struct {
		name string
		init cpuState
		want cpuState
	}{
		{
			name: "000 CLR.b (A4) 4214",
			init: cpuState{
				D:   [8]uint32{542462093, 2134690401, 1123704793, 2392395773, 758553190, 1953436813, 3741710315, 23122916},
				A:   [7]uint32{3860978724, 2240138486, 2915247362, 3439621469, 83669039, 456444398, 466748201},
				PC:  16153094,
				SR:  1815,
				USP: 12914376,
				SSP: 877856,
				RAM: [][2]uint32{{16153090, 66}, {16153091, 20}, {16153092, 65}, {16153093, 28}, {16560174, 179}, {16560175, 115}, {16153094, 236}, {16153095, 207}},
			},
			want: cpuState{
				D:   [8]uint32{542462093, 2134690401, 1123704793, 2392395773, 758553190, 1953436813, 3741710315, 23122916},
				A:   [7]uint32{3860978724, 2240138486, 2915247362, 3439621469, 83669039, 456444398, 466748201},
				PC:  16153096,
				SR:  1812,
				USP: 12914376,
				SSP: 877856,
				RAM: [][2]uint32{{16153090, 66}, {16153091, 20}, {16153092, 65}, {16153093, 28}, {16560174, 179}, {16560175, 0}, {16153094, 236}, {16153095, 207}},
				Cycles: 12,
			},
		},
		{
			name: "500 CLR.b (A6) 4216",
			init: cpuState{
				D:   [8]uint32{2367719273, 2935267536, 1074006132, 1937300076, 1304958457, 2756250844, 4137078402, 577241723},
				A:   [7]uint32{2921521288, 1014768886, 2676417057, 4149789395, 3345851856, 690175411, 2280357477},
				PC:  10397158,
				SR:  785,
				USP: 6511188,
				SSP: 2896438,
				RAM: [][2]uint32{{10397154, 66}, {10397155, 22}, {10397156, 73}, {10397157, 61}, {15433316, 215}, {15433317, 98}, {10397158, 170}, {10397159, 48}},
			},
			want: cpuState{
				D:   [8]uint32{2367719273, 2935267536, 1074006132, 1937300076, 1304958457, 2756250844, 4137078402, 577241723},
				A:   [7]uint32{2921521288, 1014768886, 2676417057, 4149789395, 3345851856, 690175411, 2280357477},
				PC:  10397160,
				SR:  788,
				USP: 6511188,
				SSP: 2896438,
				RAM: [][2]uint32{{10397154, 66}, {10397155, 22}, {10397156, 73}, {10397157, 61}, {15433316, 215}, {15433317, 0}, {10397158, 170}, {10397159, 48}},
				Cycles: 12,
			},
		},
		{
			name: "1000 CLR.b (d16, A2) 422a",
			init: cpuState{
				D:   [8]uint32{4043790270, 2818088851, 2588194572, 538883084, 3954146836, 4123230870, 4112056519, 2218111710},
				A:   [7]uint32{287295431, 135867941, 3577171, 1793819204, 2357152170, 1647431975, 703397921},
				PC:  6012048,
				SR:  41992,
				USP: 15608570,
				SSP: 4466114,
				RAM: [][2]uint32{{6012044, 66}, {6012045, 42}, {6012046, 197}, {6012047, 100}, {6012048, 228}, {6012049, 86}, {3562166, 5}, {3562167, 41}, {6012050, 70}, {6012051, 14}},
			},
			want: cpuState{
				D:   [8]uint32{4043790270, 2818088851, 2588194572, 538883084, 3954146836, 4123230870, 4112056519, 2218111710},
				A:   [7]uint32{287295431, 135867941, 3577171, 1793819204, 2357152170, 1647431975, 703397921},
				PC:  6012052,
				SR:  41988,
				USP: 15608570,
				SSP: 4466114,
				RAM: [][2]uint32{{6012044, 66}, {6012045, 42}, {6012046, 197}, {6012047, 100}, {6012048, 228}, {6012049, 86}, {3562166, 5}, {3562167, 0}, {6012050, 70}, {6012051, 14}},
				Cycles: 16,
			},
		},
		{
			name: "1500 CLR.b D6 4206",
			init: cpuState{
				D:   [8]uint32{4174188352, 216060503, 1753916560, 3566326877, 4209704889, 2058941594, 2022948727, 76017636},
				A:   [7]uint32{3011286317, 3285849291, 2703673719, 1527835334, 406716476, 1197740173, 220881388},
				PC:  2254826,
				SR:  42762,
				USP: 11231908,
				SSP: 575128,
				RAM: [][2]uint32{{2254822, 66}, {2254823, 6}, {2254824, 226}, {2254825, 179}, {2254826, 63}, {2254827, 111}},
			},
			want: cpuState{
				D:   [8]uint32{4174188352, 216060503, 1753916560, 3566326877, 4209704889, 2058941594, 2022948608, 76017636},
				A:   [7]uint32{3011286317, 3285849291, 2703673719, 1527835334, 406716476, 1197740173, 220881388},
				PC:  2254828,
				SR:  42756,
				USP: 11231908,
				SSP: 575128,
				RAM: [][2]uint32{{2254822, 66}, {2254823, 6}, {2254824, 226}, {2254825, 179}, {2254826, 63}, {2254827, 111}},
				Cycles: 4,
			},
		},
		{
			name: "2000 CLR.b D5 4205",
			init: cpuState{
				D:   [8]uint32{3558727290, 1797688069, 1415234489, 2532428581, 833435361, 3883578420, 1171598142, 4054809566},
				A:   [7]uint32{4213554266, 1920306162, 3505835412, 3269053452, 2712898693, 1444871961, 2559101095},
				PC:  4865812,
				SR:  8710,
				USP: 2883162,
				SSP: 12229152,
				RAM: [][2]uint32{{4865808, 66}, {4865809, 5}, {4865810, 89}, {4865811, 92}, {4865812, 63}, {4865813, 19}},
			},
			want: cpuState{
				D:   [8]uint32{3558727290, 1797688069, 1415234489, 2532428581, 833435361, 3883578368, 1171598142, 4054809566},
				A:   [7]uint32{4213554266, 1920306162, 3505835412, 3269053452, 2712898693, 1444871961, 2559101095},
				PC:  4865814,
				SR:  8708,
				USP: 2883162,
				SSP: 12229152,
				RAM: [][2]uint32{{4865808, 66}, {4865809, 5}, {4865810, 89}, {4865811, 92}, {4865812, 63}, {4865813, 19}},
				Cycles: 4,
			},
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			runTest(t, tt.init, tt.want)
		})
	}
}

func TestCLR_W(t *testing.T) {
	tests := []struct {
		name string
		init cpuState
		want cpuState
	}{
		{
			name: "000 CLR.w D2 4242",
			init: cpuState{
				D:   [8]uint32{247709150, 2989687714, 1271176990, 3510861373, 1462957905, 1214298931, 898893479, 3629596489},
				A:   [7]uint32{986890596, 546202386, 1239535990, 3840628796, 322801797, 3892186327, 2538260593},
				PC:  16331162,
				SR:  33286,
				USP: 5263440,
				SSP: 1684324,
				RAM: [][2]uint32{{16331158, 66}, {16331159, 66}, {16331160, 231}, {16331161, 58}, {16331162, 91}, {16331163, 34}},
			},
			want: cpuState{
				D:   [8]uint32{247709150, 2989687714, 1271136256, 3510861373, 1462957905, 1214298931, 898893479, 3629596489},
				A:   [7]uint32{986890596, 546202386, 1239535990, 3840628796, 322801797, 3892186327, 2538260593},
				PC:  16331164,
				SR:  33284,
				USP: 5263440,
				SSP: 1684324,
				RAM: [][2]uint32{{16331158, 66}, {16331159, 66}, {16331160, 231}, {16331161, 58}, {16331162, 91}, {16331163, 34}},
				Cycles: 4,
			},
		},
		{
			name: "500 CLR.w (A1) 4251",
			init: cpuState{
				D:   [8]uint32{3041134975, 619927195, 455679472, 616348039, 676966442, 3759168515, 4132559661, 899751483},
				A:   [7]uint32{3654440679, 3299587987, 881081507, 3905665912, 3977063869, 761466378, 80998878},
				PC:  3502052,
				SR:  518,
				USP: 2250414,
				SSP: 7009766,
				RAM: [][2]uint32{{3502048, 66}, {3502049, 81}, {3502050, 139}, {3502051, 55}, {12, 200}, {13, 18}, {14, 7}, {15, 210}, {1181650, 0}, {1181651, 150}, {1181652, 110}, {1181653, 135}},
			},
			want: cpuState{
				D:      [8]uint32{3041134975, 619927195, 455679472, 616348039, 676966442, 3759168515, 4132559661, 899751483},
				A:      [7]uint32{3654440679, 3299587987, 881081507, 3905665912, 3977063869, 761466378, 80998878},
				PC:     3356624854,
				SR:     8710,
				USP:    2250414,
				SSP:    7009752,
				RAM:    [][2]uint32{{3502048, 66}, {3502049, 81}, {3502050, 139}, {3502051, 55}, {7009764, 111}, {7009765, 226}, {7009760, 2}, {7009761, 6}, {7009762, 0}, {7009763, 53}, {7009758, 66}, {7009759, 81}, {7009756, 183}, {7009757, 147}, {7009752, 66}, {7009753, 81}, {7009754, 196}, {7009755, 171}, {12, 200}, {13, 18}, {14, 7}, {15, 210}, {1181650, 0}, {1181651, 150}, {1181652, 110}, {1181653, 135}},
				Halted: true,
			},
		},
		{
			name: "1000 CLR.w (A7)+ 425f",
			init: cpuState{
				D:   [8]uint32{3493535317, 1328703997, 4087566758, 730907590, 1341825527, 2098700332, 3767427253, 3905471177},
				A:   [7]uint32{3082000248, 2241506887, 845786349, 1314798024, 951535837, 1927011618, 2683773968},
				PC:  5006682,
				SR:  33564,
				USP: 14092912,
				SSP: 6301284,
				RAM: [][2]uint32{{5006678, 66}, {5006679, 95}, {5006680, 116}, {5006681, 232}, {14092912, 228}, {14092913, 130}, {5006682, 74}, {5006683, 13}},
			},
			want: cpuState{
				D:   [8]uint32{3493535317, 1328703997, 4087566758, 730907590, 1341825527, 2098700332, 3767427253, 3905471177},
				A:   [7]uint32{3082000248, 2241506887, 845786349, 1314798024, 951535837, 1927011618, 2683773968},
				PC:  5006684,
				SR:  33556,
				USP: 14092914,
				SSP: 6301284,
				RAM: [][2]uint32{{5006678, 66}, {5006679, 95}, {5006680, 116}, {5006681, 232}, {14092912, 0}, {14092913, 0}, {5006682, 74}, {5006683, 13}},
				Cycles: 12,
			},
		},
		{
			name: "1500 CLR.w (A4) 4254",
			init: cpuState{
				D:   [8]uint32{2896565739, 3076345286, 2655497447, 390565713, 2877380110, 3970568900, 3694603600, 84658276},
				A:   [7]uint32{1786688504, 1055503422, 1136458042, 611010879, 1875277675, 2487906714, 429223861},
				PC:  7351372,
				SR:  42777,
				USP: 6291014,
				SSP: 9227022,
				RAM: [][2]uint32{{7351368, 66}, {7351369, 84}, {7351370, 202}, {7351371, 201}, {12, 93}, {13, 166}, {14, 36}, {15, 220}, {10888412, 82}, {10888413, 202}, {10888414, 12}, {10888415, 22}},
			},
			want: cpuState{
				D:      [8]uint32{2896565739, 3076345286, 2655497447, 390565713, 2877380110, 3970568900, 3694603600, 84658276},
				A:      [7]uint32{1786688504, 1055503422, 1136458042, 611010879, 1875277675, 2487906714, 429223861},
				PC:     1571169504,
				SR:     10009,
				USP:    6291014,
				SSP:    9227008,
				RAM:    [][2]uint32{{7351368, 66}, {7351369, 84}, {7351370, 202}, {7351371, 201}, {9227020, 44}, {9227021, 74}, {9227016, 167}, {9227017, 25}, {9227018, 0}, {9227019, 112}, {9227014, 66}, {9227015, 84}, {9227012, 119}, {9227013, 107}, {9227008, 66}, {9227009, 85}, {9227010, 111}, {9227011, 198}, {12, 93}, {13, 166}, {14, 36}, {15, 220}, {10888412, 82}, {10888413, 202}, {10888414, 12}, {10888415, 22}},
				Halted: true,
			},
		},
		{
			name: "2000 CLR.w (d8, A4, Xn) 4274",
			init: cpuState{
				D:   [8]uint32{224110873, 1800340085, 3971891236, 2464684371, 3351005794, 3333422142, 1688094349, 3767663999},
				A:   [7]uint32{4072552275, 3374003887, 108066808, 3656477495, 3613464847, 1614756257, 2433830451},
				PC:  16048910,
				SR:  9496,
				USP: 4271470,
				SSP: 595708,
				RAM: [][2]uint32{{16048906, 66}, {16048907, 116}, {16048908, 58}, {16048909, 89}, {16048910, 206}, {16048911, 42}, {12, 51}, {13, 198}, {14, 188}, {15, 76}, {13024332, 161}, {13024333, 225}, {13024334, 85}, {13024335, 168}},
			},
			want: cpuState{
				D:      [8]uint32{224110873, 1800340085, 3971891236, 2464684371, 3351005794, 3333422142, 1688094349, 3767663999},
				A:      [7]uint32{4072552275, 3374003887, 108066808, 3656477495, 3613464847, 1614756257, 2433830451},
				PC:     868662352,
				SR:     9496,
				USP:    4271470,
				SSP:    595694,
				RAM:    [][2]uint32{{16048906, 66}, {16048907, 116}, {16048908, 58}, {16048909, 89}, {16048910, 206}, {16048911, 42}, {595706, 227}, {595707, 12}, {595702, 37}, {595703, 24}, {595704, 0}, {595705, 244}, {595700, 66}, {595701, 116}, {595698, 50}, {595699, 187}, {595694, 66}, {595695, 117}, {595696, 106}, {595697, 73}, {12, 51}, {13, 198}, {14, 188}, {15, 76}, {13024332, 161}, {13024333, 225}, {13024334, 85}, {13024335, 168}},
				Halted: true,
			},
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			runTest(t, tt.init, tt.want)
		})
	}
}

func TestCLR_L(t *testing.T) {
	tests := []struct {
		name string
		init cpuState
		want cpuState
	}{
		{
			name: "000 CLR.l (A3)+ 429b",
			init: cpuState{
				D:   [8]uint32{2422470949, 2352751603, 3310642392, 2557582276, 380119850, 920096879, 3616229318, 1779579187},
				A:   [7]uint32{2692427444, 1322854950, 1696773387, 2211182001, 787681578, 2580602796, 847691825},
				PC:  359476,
				SR:  524,
				USP: 1864286,
				SSP: 16661754,
				RAM: [][2]uint32{{359472, 66}, {359473, 155}, {359474, 139}, {359475, 57}, {12, 13}, {13, 70}, {14, 176}, {15, 194}, {4632770, 1}, {4632771, 18}, {4632772, 109}, {4632773, 176}},
			},
			want: cpuState{
				D:      [8]uint32{2422470949, 2352751603, 3310642392, 2557582276, 380119850, 920096879, 3616229318, 1779579187},
				A:      [7]uint32{2692427444, 1322854950, 1696773387, 2211182001, 787681578, 2580602796, 847691825},
				PC:     222736582,
				SR:     8716,
				USP:    1864286,
				SSP:    16661740,
				RAM:    [][2]uint32{{359472, 66}, {359473, 155}, {359474, 139}, {359475, 57}, {16661752, 124}, {16661753, 50}, {16661748, 2}, {16661749, 12}, {16661750, 0}, {16661751, 5}, {16661746, 66}, {16661747, 155}, {16661744, 245}, {16661745, 177}, {16661740, 66}, {16661741, 145}, {16661742, 131}, {16661743, 203}, {12, 13}, {13, 70}, {14, 176}, {15, 194}, {4632770, 1}, {4632771, 18}, {4632772, 109}, {4632773, 176}},
				Halted: true,
			},
		},
		{
			name: "500 CLR.l (A2) 4292",
			init: cpuState{
				D:   [8]uint32{1320146185, 466617488, 3787594080, 264785890, 2208218129, 1304777018, 850086501, 1633749877},
				A:   [7]uint32{718505777, 2311097494, 3988530849, 3198524845, 2188655873, 3440972885, 3617184241},
				PC:  141340,
				SR:  42266,
				USP: 13595982,
				SSP: 7228832,
				RAM: [][2]uint32{{141336, 66}, {141337, 146}, {141338, 160}, {141339, 68}, {12, 218}, {13, 34}, {14, 205}, {15, 100}, {2280804, 84}, {2280805, 22}, {2280806, 7}, {2280807, 248}},
			},
			want: cpuState{
				D:      [8]uint32{1320146185, 466617488, 3787594080, 264785890, 2208218129, 1304777018, 850086501, 1633749877},
				A:      [7]uint32{718505777, 2311097494, 3988530849, 3198524845, 2188655873, 3440972885, 3617184241},
				PC:     3659713896,
				SR:     9498,
				USP:    13595982,
				SSP:    7228818,
				RAM:    [][2]uint32{{141336, 66}, {141337, 146}, {141338, 160}, {141339, 68}, {7228830, 40}, {7228831, 26}, {7228826, 165}, {7228827, 26}, {7228828, 0}, {7228829, 2}, {7228824, 66}, {7228825, 146}, {7228822, 38}, {7228823, 161}, {7228818, 66}, {7228819, 149}, {7228820, 237}, {7228821, 188}, {12, 218}, {13, 34}, {14, 205}, {15, 100}, {2280804, 84}, {2280805, 22}, {2280806, 7}, {2280807, 248}},
				Halted: true,
			},
		},
		{
			name: "1000 CLR.l (d8, A5, Xn) 42b5",
			init: cpuState{
				D:   [8]uint32{1752226657, 1937529842, 1652178587, 4205885453, 1807083091, 4246316356, 2048834473, 473648662},
				A:   [7]uint32{2880357910, 1816404564, 515188618, 1442634717, 4094794215, 493503083, 3103062867},
				PC:  11196974,
				SR:  41479,
				USP: 11796638,
				SSP: 11191354,
				RAM: [][2]uint32{{11196970, 66}, {11196971, 181}, {11196972, 102}, {11196973, 7}, {11196974, 29}, {11196975, 49}, {12, 26}, {13, 118}, {14, 215}, {15, 108}, {7788396, 193}, {7788397, 50}, {7788398, 16}, {7788399, 117}},
			},
			want: cpuState{
				D:      [8]uint32{1752226657, 1937529842, 1652178587, 4205885453, 1807083091, 4246316356, 2048834473, 473648662},
				A:      [7]uint32{2880357910, 1816404564, 515188618, 1442634717, 4094794215, 493503083, 3103062867},
				PC:     443996016,
				SR:     8711,
				USP:    11796638,
				SSP:    11191340,
				RAM:    [][2]uint32{{11196970, 66}, {11196971, 181}, {11196972, 102}, {11196973, 7}, {11196974, 29}, {11196975, 49}, {11191352, 218}, {11191353, 44}, {11191348, 162}, {11191349, 7}, {11191350, 0}, {11191351, 170}, {11191346, 66}, {11191347, 181}, {11191344, 254}, {11191345, 27}, {11191340, 66}, {11191341, 181}, {11191342, 29}, {11191343, 105}, {12, 26}, {13, 118}, {14, 215}, {15, 108}, {7788396, 193}, {7788397, 50}, {7788398, 16}, {7788399, 117}},
				Halted: true,
			},
		},
		{
			name: "1500 CLR.l D6 4286",
			init: cpuState{
				D:   [8]uint32{531473246, 1932733682, 3623131195, 4138712934, 220087100, 3205440486, 520156068, 2961258776},
				A:   [7]uint32{1814743922, 284323712, 2200151911, 383872054, 2299882749, 544533189, 2756642758},
				PC:  14096652,
				SR:  8976,
				USP: 319754,
				SSP: 14415242,
				RAM: [][2]uint32{{14096648, 66}, {14096649, 134}, {14096650, 78}, {14096651, 15}, {14096652, 52}, {14096653, 1}},
			},
			want: cpuState{
				D:   [8]uint32{531473246, 1932733682, 3623131195, 4138712934, 220087100, 3205440486, 0, 2961258776},
				A:   [7]uint32{1814743922, 284323712, 2200151911, 383872054, 2299882749, 544533189, 2756642758},
				PC:  14096654,
				SR:  8980,
				USP: 319754,
				SSP: 14415242,
				RAM: [][2]uint32{{14096648, 66}, {14096649, 134}, {14096650, 78}, {14096651, 15}, {14096652, 52}, {14096653, 1}},
				Cycles: 6,
			},
		},
		{
			name: "2000 CLR.l D6 4286",
			init: cpuState{
				D:   [8]uint32{1222276151, 663092673, 2729074655, 3020377776, 495466853, 3443400666, 2557851554, 2881707184},
				A:   [7]uint32{3663383233, 960436745, 1968358415, 824766223, 3098363430, 1153634215, 3038400131},
				PC:  14175970,
				SR:  32797,
				USP: 1039972,
				SSP: 874904,
				RAM: [][2]uint32{{14175966, 66}, {14175967, 134}, {14175968, 252}, {14175969, 195}, {14175970, 85}, {14175971, 41}},
			},
			want: cpuState{
				D:   [8]uint32{1222276151, 663092673, 2729074655, 3020377776, 495466853, 3443400666, 0, 2881707184},
				A:   [7]uint32{3663383233, 960436745, 1968358415, 824766223, 3098363430, 1153634215, 3038400131},
				PC:  14175972,
				SR:  32788,
				USP: 1039972,
				SSP: 874904,
				RAM: [][2]uint32{{14175966, 66}, {14175967, 134}, {14175968, 252}, {14175969, 195}, {14175970, 85}, {14175971, 41}},
				Cycles: 6,
			},
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			runTest(t, tt.init, tt.want)
		})
	}
}

func TestEXT_W(t *testing.T) {
	tests := []struct {
		name string
		init cpuState
		want cpuState
	}{
		{
			name: "000 EXT.w D2 4882",
			init: cpuState{
				D:   [8]uint32{3819345852, 1802571790, 2247905797, 3018080418, 1989524333, 3317799016, 113612003, 2306054450},
				A:   [7]uint32{884290329, 3066226699, 4172221593, 3709084570, 1373732245, 1684373549, 2131941452},
				PC:  2338694,
				SR:  40982,
				USP: 1893728,
				SSP: 12735908,
				RAM: [][2]uint32{{2338690, 72}, {2338691, 130}, {2338692, 197}, {2338693, 87}, {2338694, 129}, {2338695, 219}},
			},
			want: cpuState{
				D:   [8]uint32{3819345852, 1802571790, 2247884805, 3018080418, 1989524333, 3317799016, 113612003, 2306054450},
				A:   [7]uint32{884290329, 3066226699, 4172221593, 3709084570, 1373732245, 1684373549, 2131941452},
				PC:  2338696,
				SR:  40976,
				USP: 1893728,
				SSP: 12735908,
				RAM: [][2]uint32{{2338690, 72}, {2338691, 130}, {2338692, 197}, {2338693, 87}, {2338694, 129}, {2338695, 219}},
				Cycles: 4,
			},
		},
		{
			name: "500 EXT.w D5 4885",
			init: cpuState{
				D:   [8]uint32{4022647521, 3542130543, 3465617827, 1974683050, 2855788256, 3091434338, 2303640923, 2126186426},
				A:   [7]uint32{3904236432, 1091743845, 3978858177, 1432668968, 1153633097, 1637282368, 2647490777},
				PC:  392152,
				SR:  42753,
				USP: 2040814,
				SSP: 9677088,
				RAM: [][2]uint32{{392148, 72}, {392149, 133}, {392150, 188}, {392151, 246}, {392152, 122}, {392153, 96}},
			},
			want: cpuState{
				D:   [8]uint32{4022647521, 3542130543, 3465617827, 1974683050, 2855788256, 3091398754, 2303640923, 2126186426},
				A:   [7]uint32{3904236432, 1091743845, 3978858177, 1432668968, 1153633097, 1637282368, 2647490777},
				PC:  392154,
				SR:  42752,
				USP: 2040814,
				SSP: 9677088,
				RAM: [][2]uint32{{392148, 72}, {392149, 133}, {392150, 188}, {392151, 246}, {392152, 122}, {392153, 96}},
				Cycles: 4,
			},
		},
		{
			name: "1000 EXT.w D4 4884",
			init: cpuState{
				D:   [8]uint32{3901642289, 1703664621, 1832260669, 3188899412, 13485890, 2939534652, 1585071063, 656086677},
				A:   [7]uint32{1843651544, 3692292217, 435112452, 1843711332, 3675657677, 3698003732, 2153828628},
				PC:  8883120,
				SR:  29,
				USP: 12134908,
				SSP: 15901242,
				RAM: [][2]uint32{{8883116, 72}, {8883117, 132}, {8883118, 229}, {8883119, 6}, {8883120, 69}, {8883121, 209}},
			},
			want: cpuState{
				D:   [8]uint32{3901642289, 1703664621, 1832260669, 3188899412, 13434946, 2939534652, 1585071063, 656086677},
				A:   [7]uint32{1843651544, 3692292217, 435112452, 1843711332, 3675657677, 3698003732, 2153828628},
				PC:  8883122,
				SR:  16,
				USP: 12134908,
				SSP: 15901242,
				RAM: [][2]uint32{{8883116, 72}, {8883117, 132}, {8883118, 229}, {8883119, 6}, {8883120, 69}, {8883121, 209}},
				Cycles: 4,
			},
		},
		{
			name: "1500 EXT.w D4 4884",
			init: cpuState{
				D:   [8]uint32{2910233987, 2624070919, 2425374423, 1536797924, 2148572118, 3504614670, 3878097228, 2293603482},
				A:   [7]uint32{4043443979, 3791164823, 2792267647, 854973601, 1888013027, 2753931827, 3743145796},
				PC:  306286,
				SR:  521,
				USP: 4376558,
				SSP: 15182520,
				RAM: [][2]uint32{{306282, 72}, {306283, 132}, {306284, 154}, {306285, 125}, {306286, 210}, {306287, 183}},
			},
			want: cpuState{
				D:   [8]uint32{2910233987, 2624070919, 2425374423, 1536797924, 2148597718, 3504614670, 3878097228, 2293603482},
				A:   [7]uint32{4043443979, 3791164823, 2792267647, 854973601, 1888013027, 2753931827, 3743145796},
				PC:  306288,
				SR:  520,
				USP: 4376558,
				SSP: 15182520,
				RAM: [][2]uint32{{306282, 72}, {306283, 132}, {306284, 154}, {306285, 125}, {306286, 210}, {306287, 183}},
				Cycles: 4,
			},
		},
		{
			name: "2000 EXT.w D7 4887",
			init: cpuState{
				D:   [8]uint32{2872006757, 2610292493, 1012789506, 947532185, 3244430392, 2406098955, 2773013171, 3267513964},
				A:   [7]uint32{2187455143, 3562221732, 173513855, 909586707, 3185955736, 641510580, 390340544},
				PC:  183042,
				SR:  9758,
				USP: 7917812,
				SSP: 12667980,
				RAM: [][2]uint32{{183038, 72}, {183039, 135}, {183040, 184}, {183041, 241}, {183042, 74}, {183043, 116}},
			},
			want: cpuState{
				D:   [8]uint32{2872006757, 2610292493, 1012789506, 947532185, 3244430392, 2406098955, 2773013171, 3267493996},
				A:   [7]uint32{2187455143, 3562221732, 173513855, 909586707, 3185955736, 641510580, 390340544},
				PC:  183044,
				SR:  9744,
				USP: 7917812,
				SSP: 12667980,
				RAM: [][2]uint32{{183038, 72}, {183039, 135}, {183040, 184}, {183041, 241}, {183042, 74}, {183043, 116}},
				Cycles: 4,
			},
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			runTest(t, tt.init, tt.want)
		})
	}
}

func TestEXT_L(t *testing.T) {
	tests := []struct {
		name string
		init cpuState
		want cpuState
	}{
		{
			name: "000 EXT.l D1 48c1",
			init: cpuState{
				D:   [8]uint32{1084095360, 439979344, 2598479884, 1927068663, 75468569, 3995372392, 3097123319, 2894407397},
				A:   [7]uint32{1004573750, 3335198915, 3766419635, 2643193439, 1513236470, 760830537, 3298629203},
				PC:  5540374,
				SR:  3,
				USP: 16459498,
				SSP: 14796920,
				RAM: [][2]uint32{{5540370, 72}, {5540371, 193}, {5540372, 245}, {5540373, 96}, {5540374, 23}, {5540375, 224}},
			},
			want: cpuState{
				D:   [8]uint32{1084095360, 4294937936, 2598479884, 1927068663, 75468569, 3995372392, 3097123319, 2894407397},
				A:   [7]uint32{1004573750, 3335198915, 3766419635, 2643193439, 1513236470, 760830537, 3298629203},
				PC:  5540376,
				SR:  8,
				USP: 16459498,
				SSP: 14796920,
				RAM: [][2]uint32{{5540370, 72}, {5540371, 193}, {5540372, 245}, {5540373, 96}, {5540374, 23}, {5540375, 224}},
				Cycles: 4,
			},
		},
		{
			name: "500 EXT.l D7 48c7",
			init: cpuState{
				D:   [8]uint32{3433296788, 3421773441, 3556189535, 3983039166, 2618204519, 941376959, 2206888639, 2181067495},
				A:   [7]uint32{1832748102, 4098606774, 573148560, 3239373399, 2620573444, 3557882264, 427439480},
				PC:  590868,
				SR:  8451,
				USP: 3210036,
				SSP: 7089550,
				RAM: [][2]uint32{{590864, 72}, {590865, 199}, {590866, 108}, {590867, 33}, {590868, 148}, {590869, 153}},
			},
			want: cpuState{
				D:   [8]uint32{3433296788, 3421773441, 3556189535, 3983039166, 2618204519, 941376959, 2206888639, 29415},
				A:   [7]uint32{1832748102, 4098606774, 573148560, 3239373399, 2620573444, 3557882264, 427439480},
				PC:  590870,
				SR:  8448,
				USP: 3210036,
				SSP: 7089550,
				RAM: [][2]uint32{{590864, 72}, {590865, 199}, {590866, 108}, {590867, 33}, {590868, 148}, {590869, 153}},
				Cycles: 4,
			},
		},
		{
			name: "1000 EXT.l D2 48c2",
			init: cpuState{
				D:   [8]uint32{525947097, 2856038383, 2143227186, 3842247773, 4258139931, 3223102284, 1006563338, 1854890671},
				A:   [7]uint32{4109825276, 3950931703, 1096697731, 1355962463, 3233335713, 2920295141, 1564106476},
				PC:  2595668,
				SR:  42007,
				USP: 7726130,
				SSP: 687524,
				RAM: [][2]uint32{{2595664, 72}, {2595665, 194}, {2595666, 213}, {2595667, 255}, {2595668, 161}, {2595669, 66}},
			},
			want: cpuState{
				D:   [8]uint32{525947097, 2856038383, 3378, 3842247773, 4258139931, 3223102284, 1006563338, 1854890671},
				A:   [7]uint32{4109825276, 3950931703, 1096697731, 1355962463, 3233335713, 2920295141, 1564106476},
				PC:  2595670,
				SR:  42000,
				USP: 7726130,
				SSP: 687524,
				RAM: [][2]uint32{{2595664, 72}, {2595665, 194}, {2595666, 213}, {2595667, 255}, {2595668, 161}, {2595669, 66}},
				Cycles: 4,
			},
		},
		{
			name: "1500 EXT.l D2 48c2",
			init: cpuState{
				D:   [8]uint32{4043106240, 3526014149, 458960308, 845570143, 3294968084, 3288504914, 2485706285, 4161800075},
				A:   [7]uint32{365557972, 4252299903, 138900851, 3360277243, 2303379061, 4146650210, 4150696651},
				PC:  11357626,
				SR:  40960,
				USP: 16107722,
				SSP: 4351566,
				RAM: [][2]uint32{{11357622, 72}, {11357623, 194}, {11357624, 158}, {11357625, 57}, {11357626, 73}, {11357627, 216}},
			},
			want: cpuState{
				D:   [8]uint32{4043106240, 3526014149, 11700, 845570143, 3294968084, 3288504914, 2485706285, 4161800075},
				A:   [7]uint32{365557972, 4252299903, 138900851, 3360277243, 2303379061, 4146650210, 4150696651},
				PC:  11357628,
				SR:  40960,
				USP: 16107722,
				SSP: 4351566,
				RAM: [][2]uint32{{11357622, 72}, {11357623, 194}, {11357624, 158}, {11357625, 57}, {11357626, 73}, {11357627, 216}},
				Cycles: 4,
			},
		},
		{
			name: "2000 EXT.l D4 48c4",
			init: cpuState{
				D:   [8]uint32{2112691038, 504353881, 3023695606, 1196041321, 1990541583, 786792290, 1534241876, 1354215896},
				A:   [7]uint32{2372434353, 2405806343, 3551249176, 3821860152, 4082547358, 2952760681, 4206655259},
				PC:  15351286,
				SR:  41229,
				USP: 16628022,
				SSP: 12447724,
				RAM: [][2]uint32{{15351282, 72}, {15351283, 196}, {15351284, 174}, {15351285, 106}, {15351286, 130}, {15351287, 164}},
			},
			want: cpuState{
				D:   [8]uint32{2112691038, 504353881, 3023695606, 1196041321, 16655, 786792290, 1534241876, 1354215896},
				A:   [7]uint32{2372434353, 2405806343, 3551249176, 3821860152, 4082547358, 2952760681, 4206655259},
				PC:  15351288,
				SR:  41216,
				USP: 16628022,
				SSP: 12447724,
				RAM: [][2]uint32{{15351282, 72}, {15351283, 196}, {15351284, 174}, {15351285, 106}, {15351286, 130}, {15351287, 164}},
				Cycles: 4,
			},
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			runTest(t, tt.init, tt.want)
		})
	}
}

func TestCHK(t *testing.T) {
	tests := []struct {
		name string
		init cpuState
		want cpuState
	}{
		{
			name: "000 CHK D2, D6 4d82",
			init: cpuState{
				D:   [8]uint32{1093139940, 3229618212, 2916979269, 30567346, 377616289, 3682892879, 1066143283, 4054575747},
				A:   [7]uint32{2332478783, 1687551685, 4067523350, 1440976318, 2531329268, 1056890715, 2838602126},
				PC:  16476360,
				SR:  533,
				USP: 8875980,
				SSP: 1000916,
				RAM: [][2]uint32{{16476356, 77}, {16476357, 130}, {16476358, 144}, {16476359, 84}, {24, 30}, {25, 86}, {26, 243}, {27, 236}, {5698540, 245}, {5698541, 16}, {5698542, 27}, {5698543, 140}},
			},
			want: cpuState{
				D:   [8]uint32{1093139940, 3229618212, 2916979269, 30567346, 377616289, 3682892879, 1066143283, 4054575747},
				A:   [7]uint32{2332478783, 1687551685, 4067523350, 1440976318, 2531329268, 1056890715, 2838602126},
				PC:  509015024,
				SR:  8720,
				USP: 8875980,
				SSP: 1000910,
				RAM: [][2]uint32{{16476356, 77}, {16476357, 130}, {16476358, 144}, {16476359, 84}, {1000914, 104}, {1000915, 198}, {1000910, 2}, {1000911, 16}, {1000912, 0}, {1000913, 251}, {24, 30}, {25, 86}, {26, 243}, {27, 236}, {5698540, 245}, {5698541, 16}, {5698542, 27}, {5698543, 140}},
				// CHK trap: uses fixed 34-cycle exception cost.
				// Cycles: 38,
			},
		},
		{
			name: "500 CHK (A7)+, D0 419f",
			init: cpuState{
				D:   [8]uint32{3523711714, 4239009988, 248448306, 334338384, 3041536728, 2194808353, 3754844762, 2501061804},
				A:   [7]uint32{3500690370, 2992759930, 2527148736, 1205025397, 700081165, 2621323504, 2647546657},
				PC:  10825216,
				SR:  541,
				USP: 12575608,
				SSP: 1984114,
				RAM: [][2]uint32{{10825212, 65}, {10825213, 159}, {10825214, 21}, {10825215, 175}, {12575608, 155}, {12575609, 69}, {24, 25}, {25, 214}, {26, 66}, {27, 18}, {14041618, 141}, {14041619, 189}, {14041620, 53}, {14041621, 163}},
			},
			want: cpuState{
				D:   [8]uint32{3523711714, 4239009988, 248448306, 334338384, 3041536728, 2194808353, 3754844762, 2501061804},
				A:   [7]uint32{3500690370, 2992759930, 2527148736, 1205025397, 700081165, 2621323504, 2647546657},
				PC:  433472022,
				SR:  8728,
				USP: 12575610,
				SSP: 1984108,
				RAM: [][2]uint32{{10825212, 65}, {10825213, 159}, {10825214, 21}, {10825215, 175}, {12575608, 155}, {12575609, 69}, {1984112, 45}, {1984113, 254}, {1984108, 2}, {1984109, 24}, {1984110, 0}, {1984111, 165}, {24, 25}, {25, 214}, {26, 66}, {27, 18}, {14041618, 141}, {14041619, 189}, {14041620, 53}, {14041621, 163}},
				// CHK trap: uses fixed 34-cycle exception cost.
				// Cycles: 44,
			},
		},
		{
			name: "1000 CHK (d16, A7), D0 41af",
			init: cpuState{
				D:   [8]uint32{1141050504, 2183113177, 3223073363, 4252999950, 1242126627, 2715393486, 4253075158, 3204293395},
				A:   [7]uint32{2854607175, 1527540367, 1653101289, 1765386454, 3156707373, 258989678, 2856990996},
				PC:  11357270,
				SR:  42005,
				USP: 5832736,
				SSP: 4876650,
				RAM: [][2]uint32{{11357266, 65}, {11357267, 175}, {11357268, 186}, {11357269, 17}, {11357270, 18}, {11357271, 86}, {12, 115}, {13, 188}, {14, 214}, {15, 70}, {12375622, 33}, {12375623, 254}, {12375624, 179}, {12375625, 242}},
			},
			want: cpuState{
				D:      [8]uint32{1141050504, 2183113177, 3223073363, 4252999950, 1242126627, 2715393486, 4253075158, 3204293395},
				A:      [7]uint32{2854607175, 1527540367, 1653101289, 1765386454, 3156707373, 258989678, 2856990996},
				PC:     1941755466,
				SR:     9237,
				USP:    5832736,
				SSP:    4876636,
				RAM:    [][2]uint32{{11357266, 65}, {11357267, 175}, {11357268, 186}, {11357269, 17}, {11357270, 18}, {11357271, 86}, {4876648, 76}, {4876649, 84}, {4876644, 164}, {4876645, 21}, {4876646, 0}, {4876647, 173}, {4876642, 65}, {4876643, 175}, {4876640, 35}, {4876641, 123}, {4876636, 65}, {4876637, 181}, {4876638, 0}, {4876639, 74}, {12, 115}, {13, 188}, {14, 214}, {15, 70}, {12375622, 33}, {12375623, 254}, {12375624, 179}, {12375625, 242}},
				Halted: true,
			},
		},
		{
			name: "1500 CHK (A4)+, D6 4d9c",
			init: cpuState{
				D:   [8]uint32{520865729, 602560383, 1545489448, 4086163120, 4216977002, 1308921722, 3347776916, 3502874075},
				A:   [7]uint32{3422500212, 3680544159, 2183390143, 2142782103, 533566631, 3639130958, 2804153879},
				PC:  16306568,
				SR:  284,
				USP: 3795202,
				SSP: 5861422,
				RAM: [][2]uint32{{16306564, 77}, {16306565, 156}, {16306566, 213}, {16306567, 177}, {12, 181}, {13, 102}, {14, 128}, {15, 40}, {6717480, 30}, {6717481, 105}, {6717482, 75}, {6717483, 123}},
			},
			want: cpuState{
				D:      [8]uint32{520865729, 602560383, 1545489448, 4086163120, 4216977002, 1308921722, 3347776916, 3502874075},
				A:      [7]uint32{3422500212, 3680544159, 2183390143, 2142782103, 533566633, 3639130958, 2804153879},
				PC:     3043393580,
				SR:     8476,
				USP:    3795202,
				SSP:    5861408,
				RAM:    [][2]uint32{{16306564, 77}, {16306565, 156}, {16306566, 213}, {16306567, 177}, {5861420, 209}, {5861421, 134}, {5861416, 1}, {5861417, 28}, {5861418, 0}, {5861419, 248}, {5861414, 77}, {5861415, 156}, {5861412, 148}, {5861413, 167}, {5861408, 77}, {5861409, 145}, {5861410, 31}, {5861411, 205}, {12, 181}, {13, 102}, {14, 128}, {15, 40}, {6717480, 30}, {6717481, 105}, {6717482, 75}, {6717483, 123}},
				Halted: true,
			},
		},
		{
			name: "2000 CHK (d8, A2, Xn), D6 4db2",
			init: cpuState{
				D:   [8]uint32{1127505738, 3935778481, 2930275396, 4165391571, 3372435042, 1295481911, 1686386403, 2061767005},
				A:   [7]uint32{3397951727, 3731192102, 816769727, 822853660, 603488700, 839541561, 3044055307},
				PC:  2961980,
				SR:  535,
				USP: 13666592,
				SSP: 4955024,
				RAM: [][2]uint32{{2961976, 77}, {2961977, 178}, {2961978, 155}, {2961979, 194}, {2961980, 235}, {2961981, 217}, {12, 155}, {13, 146}, {14, 231}, {15, 112}, {9627504, 10}, {9627505, 207}, {9627506, 216}, {9627507, 12}},
			},
			want: cpuState{
				D:      [8]uint32{1127505738, 3935778481, 2930275396, 4165391571, 3372435042, 1295481911, 1686386403, 2061767005},
				A:      [7]uint32{3397951727, 3731192102, 816769727, 822853660, 603488700, 839541561, 3044055307},
				PC:     2610095988,
				SR:     8727,
				USP:    13666592,
				SSP:    4955010,
				RAM:    [][2]uint32{{2961976, 77}, {2961977, 178}, {2961978, 155}, {2961979, 194}, {2961980, 235}, {2961981, 217}, {4955022, 50}, {4955023, 58}, {4955018, 2}, {4955019, 23}, {4955020, 0}, {4955021, 45}, {4955016, 77}, {4955017, 178}, {4955014, 99}, {4955015, 167}, {4955010, 77}, {4955011, 177}, {4955012, 15}, {4955013, 20}, {12, 155}, {13, 146}, {14, 231}, {15, 112}, {9627504, 10}, {9627505, 207}, {9627506, 216}, {9627507, 12}},
				Halted: true,
			},
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			runTest(t, tt.init, tt.want)
		})
	}
}
