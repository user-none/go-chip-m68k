package m68k

import "testing"

func TestABCD(t *testing.T) {
	tests := []struct {
		name string
		init cpuState
		want cpuState
	}{
		{
			name: "000 ABCD -(A3), -(A5) cb0b",
			init: cpuState{
				D:   [8]uint32{1856846401, 1354445898, 4146924943, 2826373679, 3623155492, 2637387800, 3703044994, 1627861361},
				A:   [7]uint32{934431941, 3222578904, 3522499819, 3173488240, 3569701346, 4127928230, 2726497174},
				PC:  14561754,
				SR:  1802,
				USP: 9357560,
				SSP: 8742784,
				RAM: [][2]uint32{{14561750, 203}, {14561751, 11}, {14561752, 47}, {14561753, 29}, {2594414, 46}, {2594415, 111}, {733092, 182}, {733093, 219}, {14561754, 225}, {14561755, 90}},
			},
			want: cpuState{
				D:   [8]uint32{1856846401, 1354445898, 4146924943, 2826373679, 3623155492, 2637387800, 3703044994, 1627861361},
				A:   [7]uint32{934431941, 3222578904, 3522499819, 3173488239, 3569701346, 4127928229, 2726497174},
				PC:  14561756,
				SR:  1819,
				USP: 9357560,
				SSP: 8742784,
				RAM: [][2]uint32{{14561750, 203}, {14561751, 11}, {14561752, 47}, {14561753, 29}, {2594414, 46}, {2594415, 111}, {733092, 182}, {733093, 176}, {14561754, 225}, {14561755, 90}},
				Cycles: 18,
			},
		},
		{
			name: "500 ABCD -(A1), -(A1) c309",
			init: cpuState{
				D:   [8]uint32{688366497, 3270682939, 1743538801, 51767684, 245593339, 1940429628, 2897400330, 632476192},
				A:   [7]uint32{3392026397, 889025637, 557258654, 1384933348, 1453822227, 3122083653, 409961448},
				PC:  2084990,
				SR:  42003,
				USP: 14919678,
				SSP: 2936838,
				RAM: [][2]uint32{{2084986, 195}, {2084987, 9}, {2084988, 243}, {2084989, 58}, {16610404, 155}, {16610405, 30}, {16610402, 232}, {16610403, 92}, {2084990, 243}, {2084991, 68}},
			},
			want: cpuState{
				D:   [8]uint32{688366497, 3270682939, 1743538801, 51767684, 245593339, 1940429628, 2897400330, 632476192},
				A:   [7]uint32{3392026397, 889025635, 557258654, 1384933348, 1453822227, 3122083653, 409961448},
				PC:  2084992,
				SR:  42001,
				USP: 14919678,
				SSP: 2936838,
				RAM: [][2]uint32{{2084986, 195}, {2084987, 9}, {2084988, 243}, {2084989, 58}, {16610404, 155}, {16610405, 30}, {16610402, 232}, {16610403, 94}, {2084990, 243}, {2084991, 68}},
				Cycles: 18,
			},
		},
		{
			name: "1000 ABCD D7, D5 cb07",
			init: cpuState{
				D:   [8]uint32{1053141187, 3742733449, 252931509, 2634556884, 2410033957, 1205761078, 2262519190, 2863312100},
				A:   [7]uint32{3931531863, 233341178, 2910525705, 1300015033, 2128734241, 370894859, 4005668834},
				PC:  8799804,
				SR:  33802,
				USP: 5971690,
				SSP: 14612668,
				RAM: [][2]uint32{{8799800, 203}, {8799801, 7}, {8799802, 249}, {8799803, 222}, {8799804, 119}, {8799805, 172}},
			},
			want: cpuState{
				D:   [8]uint32{1053141187, 3742733449, 252931509, 2634556884, 2410033957, 1205761152, 2262519190, 2863312100},
				A:   [7]uint32{3931531863, 233341178, 2910525705, 1300015033, 2128734241, 370894859, 4005668834},
				PC:  8799806,
				SR:  33819,
				USP: 5971690,
				SSP: 14612668,
				RAM: [][2]uint32{{8799800, 203}, {8799801, 7}, {8799802, 249}, {8799803, 222}, {8799804, 119}, {8799805, 172}},
				Cycles: 6,
			},
		},
		{
			name: "1500 ABCD D6, D7 cf06",
			init: cpuState{
				D:   [8]uint32{2837265261, 1254609888, 1765886087, 2647906673, 2892789762, 3176389461, 2254561836, 3465212624},
				A:   [7]uint32{3140326103, 1299316319, 3567664917, 1866477584, 2869131522, 3293345951, 1890676986},
				PC:  14589712,
				SR:  34320,
				USP: 16139972,
				SSP: 1700464,
				RAM: [][2]uint32{{14589708, 207}, {14589709, 6}, {14589710, 162}, {14589711, 59}, {14589712, 252}, {14589713, 44}},
			},
			want: cpuState{
				D:   [8]uint32{2837265261, 1254609888, 1765886087, 2647906673, 2892789762, 3176389461, 2254561836, 3465212515},
				A:   [7]uint32{3140326103, 1299316319, 3567664917, 1866477584, 2869131522, 3293345951, 1890676986},
				PC:  14589714,
				SR:  34321,
				USP: 16139972,
				SSP: 1700464,
				RAM: [][2]uint32{{14589708, 207}, {14589709, 6}, {14589710, 162}, {14589711, 59}, {14589712, 252}, {14589713, 44}},
				Cycles: 6,
			},
		},
		{
			name: "2000 ABCD -(A7), -(A1) c30f",
			init: cpuState{
				D:   [8]uint32{3000634781, 1057120324, 3705999389, 592824273, 1359181682, 3511708081, 3441152909, 1070612705},
				A:   [7]uint32{858043829, 2118734329, 3910953369, 2032184257, 2547250319, 2057265631, 3101810928},
				PC:  4561332,
				SR:  542,
				USP: 11894960,
				SSP: 1589788,
				RAM: [][2]uint32{{4561328, 195}, {4561329, 15}, {4561330, 4}, {4561331, 10}, {11894958, 184}, {11894959, 200}, {4805112, 247}, {4805113, 156}, {4561332, 47}, {4561333, 177}},
			},
			want: cpuState{
				D:   [8]uint32{3000634781, 1057120324, 3705999389, 592824273, 1359181682, 3511708081, 3441152909, 1070612705},
				A:   [7]uint32{858043829, 2118734328, 3910953369, 2032184257, 2547250319, 2057265631, 3101810928},
				PC:  4561334,
				SR:  529,
				USP: 11894958,
				SSP: 1589788,
				RAM: [][2]uint32{{4561328, 195}, {4561329, 15}, {4561330, 4}, {4561331, 10}, {11894958, 184}, {11894959, 200}, {4805112, 22}, {4805113, 156}, {4561332, 47}, {4561333, 177}},
				Cycles: 18,
			},
		},
		{
			name: "003 ABCD -(A3), -(A0) c10b",
			init: 			cpuState{
				D:   [8]uint32{1300316485, 3470886387, 1343474914, 833057533, 3185307879, 2306500633, 1856043336, 4251970220},
				A:   [7]uint32{2788973845, 408966665, 2672653943, 2038238353, 2711280413, 910693873, 2477976727},
				PC:  11092106,
				SR:  8203,
				USP: 4742374,
				SSP: 12154282,
				RAM: [][2]uint32{{11092102, 193}, {11092103, 11}, {11092104, 108}, {11092105, 12}, {8195216, 154}, {8195217, 242}, {3955988, 154}, {3955989, 180}, {11092106, 150}, {11092107, 55}},
			},
			want: 			cpuState{
				D:   [8]uint32{1300316485, 3470886387, 1343474914, 833057533, 3185307879, 2306500633, 1856043336, 4251970220},
				A:   [7]uint32{2788973844, 408966665, 2672653943, 2038238352, 2711280413, 910693873, 2477976727},
				PC:  11092108,
				SR:  8219,
				USP: 4742374,
				SSP: 12154282,
				RAM: [][2]uint32{{11092102, 193}, {11092103, 11}, {11092104, 108}, {11092105, 12}, {8195216, 154}, {8195217, 242}, {3955988, 154}, {3955989, 180}, {11092106, 150}, {11092107, 55}},
				Cycles: 18,
			},
		},
		{
			name: "292 ABCD D0, D2 c500",
			init: 			cpuState{
				D:   [8]uint32{4176053732, 3968982666, 3049438932, 4283264126, 2939688886, 1710845490, 3346255479, 3467546351},
				A:   [7]uint32{1529176526, 3056324839, 2518116742, 1628451542, 2624560777, 4285887072, 2359076447},
				PC:  15776558,
				SR:  9739,
				USP: 1191098,
				SSP: 6903300,
				RAM: [][2]uint32{{15776554, 197}, {15776555, 0}, {15776556, 103}, {15776557, 33}, {15776558, 183}, {15776559, 224}},
			},
			want: 			cpuState{
				D:   [8]uint32{4176053732, 3968982666, 3049438744, 4283264126, 2939688886, 1710845490, 3346255479, 3467546351},
				A:   [7]uint32{1529176526, 3056324839, 2518116742, 1628451542, 2624560777, 4285887072, 2359076447},
				PC:  15776560,
				SR:  9745,
				USP: 1191098,
				SSP: 6903300,
				RAM: [][2]uint32{{15776554, 197}, {15776555, 0}, {15776556, 103}, {15776557, 33}, {15776558, 183}, {15776559, 224}},
				Cycles: 6,
			},
		},
		{
			name: "566 ABCD -(A5), -(A3) c70d",
			init: 			cpuState{
				D:   [8]uint32{1516708142, 4243061583, 1997471414, 3672404395, 653805792, 1527901197, 3604879758, 421285828},
				A:   [7]uint32{3862139631, 1839916373, 1348596584, 410891504, 2237400427, 772247446, 1378338221},
				PC:  4677070,
				SR:  28,
				USP: 5385532,
				SSP: 15686648,
				RAM: [][2]uint32{{4677066, 199}, {4677067, 13}, {4677068, 130}, {4677069, 24}, {495508, 116}, {495509, 44}, {8238318, 50}, {8238319, 234}, {4677070, 149}, {4677071, 200}},
			},
			want: 			cpuState{
				D:   [8]uint32{1516708142, 4243061583, 1997471414, 3672404395, 653805792, 1527901197, 3604879758, 421285828},
				A:   [7]uint32{3862139631, 1839916373, 1348596584, 410891503, 2237400427, 772247445, 1378338221},
				PC:  4677072,
				SR:  17,
				USP: 5385532,
				SSP: 15686648,
				RAM: [][2]uint32{{4677066, 199}, {4677067, 13}, {4677068, 130}, {4677069, 24}, {495508, 116}, {495509, 44}, {8238318, 50}, {8238319, 125}, {4677070, 149}, {4677071, 200}},
				Cycles: 18,
			},
		},
		{
			name: "861 ABCD D6, D2 c506",
			init: 			cpuState{
				D:   [8]uint32{3780511584, 379974459, 4133854039, 2845099421, 3542915958, 1428638243, 2076716071, 3374947888},
				A:   [7]uint32{2388136044, 283705430, 643282460, 2710055040, 1174619244, 4050699988, 1638610942},
				PC:  16108786,
				SR:  1308,
				USP: 10205822,
				SSP: 11180706,
				RAM: [][2]uint32{{16108782, 197}, {16108783, 6}, {16108784, 175}, {16108785, 10}, {16108786, 57}, {16108787, 173}},
			},
			want: 			cpuState{
				D:   [8]uint32{3780511584, 379974459, 4133854085, 2845099421, 3542915958, 1428638243, 2076716071, 3374947888},
				A:   [7]uint32{2388136044, 283705430, 643282460, 2710055040, 1174619244, 4050699988, 1638610942},
				PC:  16108788,
				SR:  1290,
				USP: 10205822,
				SSP: 11180706,
				RAM: [][2]uint32{{16108782, 197}, {16108783, 6}, {16108784, 175}, {16108785, 10}, {16108786, 57}, {16108787, 173}},
				Cycles: 6,
			},
		},
		{
			name: "1132 ABCD D0, D0 c100",
			init: 			cpuState{
				D:   [8]uint32{3059734627, 642158676, 3048221193, 1570063297, 2382766221, 1115965541, 4282252297, 2233072879},
				A:   [7]uint32{3354433094, 3947298971, 3981069824, 3961039034, 3524666211, 490796, 2631744637},
				PC:  11202536,
				SR:  5,
				USP: 1694552,
				SSP: 15623582,
				RAM: [][2]uint32{{11202532, 193}, {11202533, 0}, {11202534, 25}, {11202535, 255}, {11202536, 62}, {11202537, 205}},
			},
			want: 			cpuState{
				D:   [8]uint32{3059734566, 642158676, 3048221193, 1570063297, 2382766221, 1115965541, 4282252297, 2233072879},
				A:   [7]uint32{3354433094, 3947298971, 3981069824, 3961039034, 3524666211, 490796, 2631744637},
				PC:  11202538,
				SR:  17,
				USP: 1694552,
				SSP: 15623582,
				RAM: [][2]uint32{{11202532, 193}, {11202533, 0}, {11202534, 25}, {11202535, 255}, {11202536, 62}, {11202537, 205}},
				Cycles: 6,
			},
		},
		{
			name: "1395 ABCD -(A3), -(A4) c90b",
			init: 			cpuState{
				D:   [8]uint32{3201902417, 2417748595, 1354896015, 556953795, 1885623736, 1596402071, 4116801763, 3759780899},
				A:   [7]uint32{192534185, 565612527, 3915287614, 530835277, 4197855493, 1369910488, 1214081426},
				PC:  6299406,
				SR:  540,
				USP: 9899666,
				SSP: 12575346,
				RAM: [][2]uint32{{6299402, 201}, {6299403, 11}, {6299404, 14}, {6299405, 16}, {10741580, 18}, {10741581, 34}, {3551492, 86}, {3551493, 201}, {6299406, 80}, {6299407, 29}},
			},
			want: 			cpuState{
				D:   [8]uint32{3201902417, 2417748595, 1354896015, 556953795, 1885623736, 1596402071, 4116801763, 3759780899},
				A:   [7]uint32{192534185, 565612527, 3915287614, 530835276, 4197855492, 1369910488, 1214081426},
				PC:  6299408,
				SR:  512,
				USP: 9899666,
				SSP: 12575346,
				RAM: [][2]uint32{{6299402, 201}, {6299403, 11}, {6299404, 14}, {6299405, 16}, {10741580, 18}, {10741581, 34}, {3551492, 105}, {3551493, 201}, {6299406, 80}, {6299407, 29}},
				Cycles: 18,
			},
		},
		{
			name: "1673 ABCD -(A1), -(A5) cb09",
			init: 			cpuState{
				D:   [8]uint32{1808502650, 3420833793, 4047337344, 4195941732, 23413350, 355019518, 890675961, 166117513},
				A:   [7]uint32{3369403991, 1294034344, 3868360046, 3405176191, 3739007483, 1602755361, 2096066396},
				PC:  13446810,
				SR:  8223,
				USP: 2532808,
				SSP: 5836874,
				RAM: [][2]uint32{{13446806, 203}, {13446807, 9}, {13446808, 166}, {13446809, 139}, {2188710, 220}, {2188711, 115}, {8919840, 194}, {8919841, 186}, {13446810, 211}, {13446811, 89}},
			},
			want: 			cpuState{
				D:   [8]uint32{1808502650, 3420833793, 4047337344, 4195941732, 23413350, 355019518, 890675961, 166117513},
				A:   [7]uint32{3369403991, 1294034343, 3868360046, 3405176191, 3739007483, 1602755360, 2096066396},
				PC:  13446812,
				SR:  8219,
				USP: 2532808,
				SSP: 5836874,
				RAM: [][2]uint32{{13446806, 203}, {13446807, 9}, {13446808, 166}, {13446809, 139}, {2188710, 220}, {2188711, 115}, {8919840, 150}, {8919841, 186}, {13446810, 211}, {13446811, 89}},
				Cycles: 18,
			},
		},
		{
			name: "1969 ABCD -(A4), -(A5) cb0c",
			init: 			cpuState{
				D:   [8]uint32{1633488150, 1114948283, 870072009, 3297590898, 1403320779, 1403549284, 510880707, 2414460365},
				A:   [7]uint32{4291053947, 4015994256, 3842241147, 852426746, 3291950725, 1738761842, 3346692868},
				PC:  7432890,
				SR:  1809,
				USP: 6804234,
				SSP: 9579546,
				RAM: [][2]uint32{{7432886, 203}, {7432887, 12}, {7432888, 50}, {7432889, 29}, {3616388, 53}, {3616389, 66}, {10708592, 230}, {10708593, 19}, {7432890, 186}, {7432891, 93}},
			},
			want: 			cpuState{
				D:   [8]uint32{1633488150, 1114948283, 870072009, 3297590898, 1403320779, 1403549284, 510880707, 2414460365},
				A:   [7]uint32{4291053947, 4015994256, 3842241147, 852426746, 3291950724, 1738761841, 3346692868},
				PC:  7432892,
				SR:  1792,
				USP: 6804234,
				SSP: 9579546,
				RAM: [][2]uint32{{7432886, 203}, {7432887, 12}, {7432888, 50}, {7432889, 29}, {3616388, 53}, {3616389, 66}, {10708592, 230}, {10708593, 73}, {7432890, 186}, {7432891, 93}},
				Cycles: 18,
			},
		},
		{
			name: "2238 ABCD D7, D3 c707",
			init: 			cpuState{
				D:   [8]uint32{938650623, 3219409962, 3382042712, 3159069380, 499288462, 2329096205, 1756269861, 1511932458},
				A:   [7]uint32{249179753, 3033672104, 2965533650, 429050177, 4157084602, 1368724224, 2786576755},
				PC:  15438610,
				SR:  267,
				USP: 8644200,
				SSP: 5629948,
				RAM: [][2]uint32{{15438606, 199}, {15438607, 7}, {15438608, 27}, {15438609, 139}, {15438610, 58}, {15438611, 141}},
			},
			want: 			cpuState{
				D:   [8]uint32{938650623, 3219409962, 3382042712, 3159069268, 499288462, 2329096205, 1756269861, 1511932458},
				A:   [7]uint32{249179753, 3033672104, 2965533650, 429050177, 4157084602, 1368724224, 2786576755},
				PC:  15438612,
				SR:  273,
				USP: 8644200,
				SSP: 5629948,
				RAM: [][2]uint32{{15438606, 199}, {15438607, 7}, {15438608, 27}, {15438609, 139}, {15438610, 58}, {15438611, 141}},
				Cycles: 6,
			},
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			runTest(t, tt.init, tt.want)
		})
	}
}

func TestSBCD(t *testing.T) {
	tests := []struct {
		name string
		init cpuState
		want cpuState
	}{
		{
			name: "000 SBCD D3, D2 8503",
			init: cpuState{
				D:   [8]uint32{342845124, 3682155058, 3735029516, 1772217720, 3884121916, 1824997711, 3565947305, 3664225138},
				A:   [7]uint32{3204852313, 1979966899, 3701895049, 4177683308, 2185839221, 3082295344, 1673787648},
				PC:  31582,
				SR:  8479,
				USP: 14868614,
				SSP: 4445112,
				RAM: [][2]uint32{{31578, 133}, {31579, 3}, {31580, 227}, {31581, 248}, {31582, 67}, {31583, 95}},
			},
			want: cpuState{
				D:   [8]uint32{342845124, 3682155058, 3735029555, 1772217720, 3884121916, 1824997711, 3565947305, 3664225138},
				A:   [7]uint32{3204852313, 1979966899, 3701895049, 4177683308, 2185839221, 3082295344, 1673787648},
				PC:  31584,
				SR:  8467,
				USP: 14868614,
				SSP: 4445112,
				RAM: [][2]uint32{{31578, 133}, {31579, 3}, {31580, 227}, {31581, 248}, {31582, 67}, {31583, 95}},
				Cycles: 6,
			},
		},
		{
			name: "500 SBCD D2, D5 8b02",
			init: cpuState{
				D:   [8]uint32{2478285018, 2156866910, 1581721079, 1059196777, 2735046602, 1525209043, 3734773321, 2282455679},
				A:   [7]uint32{3539882295, 3073542695, 2033294859, 3016050066, 115818120, 3830833547, 3952894779},
				PC:  16529720,
				SR:  9985,
				USP: 4978858,
				SSP: 502738,
				RAM: [][2]uint32{{16529716, 139}, {16529717, 2}, {16529718, 117}, {16529719, 68}, {16529720, 144}, {16529721, 202}},
			},
			want: cpuState{
				D:   [8]uint32{2478285018, 2156866910, 1581721079, 1059196777, 2735046602, 1525208950, 3734773321, 2282455679},
				A:   [7]uint32{3539882295, 3073542695, 2033294859, 3016050066, 115818120, 3830833547, 3952894779},
				PC:  16529722,
				SR:  10003,
				USP: 4978858,
				SSP: 502738,
				RAM: [][2]uint32{{16529716, 139}, {16529717, 2}, {16529718, 117}, {16529719, 68}, {16529720, 144}, {16529721, 202}},
				Cycles: 6,
			},
		},
		{
			name: "1000 SBCD -(A0), -(A0) 8108",
			init: cpuState{
				D:   [8]uint32{3235655401, 1494498131, 4229108421, 1243298640, 1045151744, 3830287692, 27956761, 2293923708},
				A:   [7]uint32{297370965, 4178527571, 1147597022, 1015317860, 2077573406, 61270622, 2597496020},
				PC:  15467766,
				SR:  1552,
				USP: 16083378,
				SSP: 101916,
				RAM: [][2]uint32{{15467762, 129}, {15467763, 8}, {15467764, 137}, {15467765, 66}, {12158292, 36}, {12158293, 93}, {12158290, 157}, {12158291, 177}, {15467766, 113}, {15467767, 30}},
			},
			want: cpuState{
				D:   [8]uint32{3235655401, 1494498131, 4229108421, 1243298640, 1045151744, 3830287692, 27956761, 2293923708},
				A:   [7]uint32{297370963, 4178527571, 1147597022, 1015317860, 2077573406, 61270622, 2597496020},
				PC:  15467768,
				SR:  1544,
				USP: 16083378,
				SSP: 101916,
				RAM: [][2]uint32{{15467762, 129}, {15467763, 8}, {15467764, 137}, {15467765, 66}, {12158292, 36}, {12158293, 93}, {12158290, 157}, {12158291, 134}, {15467766, 113}, {15467767, 30}},
				Cycles: 18,
			},
		},
		{
			name: "1500 SBCD -(A0), -(A5) 8b08",
			init: cpuState{
				D:   [8]uint32{4266187411, 2356653191, 2838010241, 993694739, 2857089857, 3988860074, 3539126226, 1100965592},
				A:   [7]uint32{4051446050, 4204672363, 1122565803, 104417355, 1274089878, 2390586928, 4187825068},
				PC:  4024428,
				SR:  9503,
				USP: 10970574,
				SSP: 6171974,
				RAM: [][2]uint32{{4024424, 139}, {4024425, 8}, {4024426, 182}, {4024427, 140}, {8136992, 120}, {8136993, 118}, {8222254, 202}, {8222255, 43}, {4024428, 51}, {4024429, 60}},
			},
			want: cpuState{
				D:   [8]uint32{4266187411, 2356653191, 2838010241, 993694739, 2857089857, 3988860074, 3539126226, 1100965592},
				A:   [7]uint32{4051446049, 4204672363, 1122565803, 104417355, 1274089878, 2390586927, 4187825068},
				PC:  4024430,
				SR:  9491,
				USP: 10970574,
				SSP: 6171974,
				RAM: [][2]uint32{{4024424, 139}, {4024425, 8}, {4024426, 182}, {4024427, 140}, {8136992, 120}, {8136993, 118}, {8222254, 202}, {8222255, 84}, {4024428, 51}, {4024429, 60}},
				Cycles: 18,
			},
		},
		{
			name: "2000 SBCD D6, D5 8b06",
			init: cpuState{
				D:   [8]uint32{352972844, 2986954171, 889988009, 1325787342, 4158568342, 2235177776, 2325455461, 1870921354},
				A:   [7]uint32{3983984537, 1574303238, 2885939812, 1879903544, 643820467, 988881854, 2979772562},
				PC:  11997714,
				SR:  1040,
				USP: 378414,
				SSP: 7001296,
				RAM: [][2]uint32{{11997710, 139}, {11997711, 6}, {11997712, 119}, {11997713, 53}, {11997714, 149}, {11997715, 22}},
			},
			want: cpuState{
				D:   [8]uint32{352972844, 2986954171, 889988009, 1325787342, 4158568342, 2235177828, 2325455461, 1870921354},
				A:   [7]uint32{3983984537, 1574303238, 2885939812, 1879903544, 643820467, 988881854, 2979772562},
				PC:  11997716,
				SR:  1043,
				USP: 378414,
				SSP: 7001296,
				RAM: [][2]uint32{{11997710, 139}, {11997711, 6}, {11997712, 119}, {11997713, 53}, {11997714, 149}, {11997715, 22}},
				Cycles: 6,
			},
		},
		{
			name: "003 SBCD D6, D6 8d06",
			init: 			cpuState{
				D:   [8]uint32{2098166968, 1628945558, 334707586, 2786388040, 1985610817, 3898992344, 2314931880, 1869881008},
				A:   [7]uint32{3671403792, 555656910, 3863757937, 2083042984, 1471077963, 335202929, 4041739897},
				PC:  14533446,
				SR:  9477,
				USP: 16134644,
				SSP: 2111596,
				RAM: [][2]uint32{{14533442, 141}, {14533443, 6}, {14533444, 251}, {14533445, 31}, {14533446, 132}, {14533447, 18}},
			},
			want: 			cpuState{
				D:   [8]uint32{2098166968, 1628945558, 334707586, 2786388040, 1985610817, 3898992344, 2314931712, 1869881008},
				A:   [7]uint32{3671403792, 555656910, 3863757937, 2083042984, 1471077963, 335202929, 4041739897},
				PC:  14533448,
				SR:  9476,
				USP: 16134644,
				SSP: 2111596,
				RAM: [][2]uint32{{14533442, 141}, {14533443, 6}, {14533444, 251}, {14533445, 31}, {14533446, 132}, {14533447, 18}},
				Cycles: 6,
			},
		},
		{
			name: "293 SBCD -(A7), -(A2) 850f",
			init: 			cpuState{
				D:   [8]uint32{3264270051, 3824684171, 3217783835, 4148394248, 2275221763, 425770907, 376494215, 2955947864},
				A:   [7]uint32{2371859870, 864167769, 2497367624, 1984749870, 3770376129, 3729513486, 3784091920},
				PC:  13819142,
				SR:  8991,
				USP: 6194026,
				SSP: 14275752,
				RAM: [][2]uint32{{13819138, 133}, {13819139, 15}, {13819140, 208}, {13819141, 88}, {14275750, 142}, {14275751, 155}, {14339654, 87}, {14339655, 234}, {13819142, 218}, {13819143, 162}},
			},
			want: 			cpuState{
				D:   [8]uint32{3264270051, 3824684171, 3217783835, 4148394248, 2275221763, 425770907, 376494215, 2955947864},
				A:   [7]uint32{2371859870, 864167769, 2497367623, 1984749870, 3770376129, 3729513486, 3784091920},
				PC:  13819144,
				SR:  8960,
				USP: 6194026,
				SSP: 14275750,
				RAM: [][2]uint32{{13819138, 133}, {13819139, 15}, {13819140, 208}, {13819141, 88}, {14275750, 142}, {14275751, 155}, {14339654, 87}, {14339655, 85}, {13819142, 218}, {13819143, 162}},
				Cycles: 18,
			},
		},
		{
			name: "574 SBCD -(A2), -(A5) 8b0a",
			init: 			cpuState{
				D:   [8]uint32{1499899934, 302911564, 2561481935, 3321813003, 3013938897, 313539985, 3265682510, 977631616},
				A:   [7]uint32{3302326740, 3691460276, 1161248734, 3605374566, 1416127520, 2476883018, 1889269110},
				PC:  3155588,
				SR:  1031,
				USP: 2400466,
				SSP: 275188,
				RAM: [][2]uint32{{3155584, 139}, {3155585, 10}, {3155586, 115}, {3155587, 82}, {3620828, 53}, {3620829, 87}, {10632264, 152}, {10632265, 250}, {3155588, 72}, {3155589, 118}},
			},
			want: 			cpuState{
				D:   [8]uint32{1499899934, 302911564, 2561481935, 3321813003, 3013938897, 313539985, 3265682510, 977631616},
				A:   [7]uint32{3302326740, 3691460276, 1161248733, 3605374566, 1416127520, 2476883017, 1889269110},
				PC:  3155590,
				SR:  1032,
				USP: 2400466,
				SSP: 275188,
				RAM: [][2]uint32{{3155584, 139}, {3155585, 10}, {3155586, 115}, {3155587, 82}, {3620828, 53}, {3620829, 87}, {10632264, 152}, {10632265, 163}, {3155588, 72}, {3155589, 118}},
				Cycles: 18,
			},
		},
		{
			name: "833 SBCD D4, D3 8704",
			init: 			cpuState{
				D:   [8]uint32{2478273600, 2622034279, 2642506917, 4079015261, 2136216385, 1595501333, 1313800311, 2188452713},
				A:   [7]uint32{118536794, 1578942645, 3097043441, 419150542, 505174621, 814562985, 2928866244},
				PC:  1179194,
				SR:  11,
				USP: 3802974,
				SSP: 15258268,
				RAM: [][2]uint32{{1179190, 135}, {1179191, 4}, {1179192, 161}, {1179193, 239}, {1179194, 169}, {1179195, 149}},
			},
			want: 			cpuState{
				D:   [8]uint32{2478273600, 2622034279, 2642506917, 4079015196, 2136216385, 1595501333, 1313800311, 2188452713},
				A:   [7]uint32{118536794, 1578942645, 3097043441, 419150542, 505174621, 814562985, 2928866244},
				PC:  1179196,
				SR:  0,
				USP: 3802974,
				SSP: 15258268,
				RAM: [][2]uint32{{1179190, 135}, {1179191, 4}, {1179192, 161}, {1179193, 239}, {1179194, 169}, {1179195, 149}},
				Cycles: 6,
			},
		},
		{
			name: "1102 SBCD -(A0), -(A3) 8708",
			init: 			cpuState{
				D:   [8]uint32{1820445032, 324196192, 3586761365, 2619553195, 841529756, 448476976, 1380359320, 2368318235},
				A:   [7]uint32{297963292, 3993032387, 2268412601, 1439390325, 4043660728, 1794737515, 1206493836},
				PC:  16709738,
				SR:  1027,
				USP: 10111938,
				SSP: 1493660,
				RAM: [][2]uint32{{16709734, 135}, {16709735, 8}, {16709736, 232}, {16709737, 66}, {12750618, 131}, {12750619, 50}, {13326964, 210}, {13326965, 28}, {16709738, 78}, {16709739, 243}},
			},
			want: 			cpuState{
				D:   [8]uint32{1820445032, 324196192, 3586761365, 2619553195, 841529756, 448476976, 1380359320, 2368318235},
				A:   [7]uint32{297963291, 3993032387, 2268412601, 1439390324, 4043660728, 1794737515, 1206493836},
				PC:  16709740,
				SR:  1032,
				USP: 10111938,
				SSP: 1493660,
				RAM: [][2]uint32{{16709734, 135}, {16709735, 8}, {16709736, 232}, {16709737, 66}, {12750618, 131}, {12750619, 50}, {13326964, 160}, {13326965, 28}, {16709738, 78}, {16709739, 243}},
				Cycles: 18,
			},
		},
		{
			name: "1382 SBCD -(A3), -(A3) 870b",
			init: 			cpuState{
				D:   [8]uint32{1208312216, 1930602212, 380866055, 2108033087, 3547702446, 750956860, 207149568, 3768662504},
				A:   [7]uint32{1773453981, 3987271134, 3401904869, 2790452614, 1506636092, 1371688653, 1518942679},
				PC:  16088546,
				SR:  1822,
				USP: 16232296,
				SSP: 8788798,
				RAM: [][2]uint32{{16088542, 135}, {16088543, 11}, {16088544, 236}, {16088545, 152}, {5434756, 211}, {5434757, 45}, {16088546, 96}, {16088547, 177}},
			},
			want: 			cpuState{
				D:   [8]uint32{1208312216, 1930602212, 380866055, 2108033087, 3547702446, 750956860, 207149568, 3768662504},
				A:   [7]uint32{1773453981, 3987271134, 3401904869, 2790452612, 1506636092, 1371688653, 1518942679},
				PC:  16088548,
				SR:  1800,
				USP: 16232296,
				SSP: 8788798,
				RAM: [][2]uint32{{16088542, 135}, {16088543, 11}, {16088544, 236}, {16088545, 152}, {5434756, 159}, {5434757, 45}, {16088546, 96}, {16088547, 177}},
				Cycles: 18,
			},
		},
		{
			name: "1657 SBCD -(A2), -(A0) 810a",
			init: 			cpuState{
				D:   [8]uint32{3507298544, 1001264588, 1898071701, 162140974, 567342378, 3220706700, 2192322154, 1143035554},
				A:   [7]uint32{2858701654, 1968872500, 1303304484, 4158533977, 3961521023, 1835996311, 1296191725},
				PC:  1588150,
				SR:  1281,
				USP: 9190480,
				SSP: 1231134,
				RAM: [][2]uint32{{1588146, 129}, {1588147, 10}, {1588148, 190}, {1588149, 210}, {11458850, 228}, {11458851, 238}, {6574932, 191}, {6574933, 148}, {1588150, 50}, {1588151, 173}},
			},
			want: 			cpuState{
				D:   [8]uint32{3507298544, 1001264588, 1898071701, 162140974, 567342378, 3220706700, 2192322154, 1143035554},
				A:   [7]uint32{2858701653, 1968872500, 1303304483, 4158533977, 3961521023, 1835996311, 1296191725},
				PC:  1588152,
				SR:  1299,
				USP: 9190480,
				SSP: 1231134,
				RAM: [][2]uint32{{1588146, 129}, {1588147, 10}, {1588148, 190}, {1588149, 210}, {11458850, 228}, {11458851, 238}, {6574932, 191}, {6574933, 64}, {1588150, 50}, {1588151, 173}},
				Cycles: 18,
			},
		},
		{
			name: "1935 SBCD -(A4), -(A0) 810c",
			init: 			cpuState{
				D:   [8]uint32{2763134075, 3648011053, 2975877757, 3482920686, 824004150, 2836209758, 2190969468, 3081161676},
				A:   [7]uint32{1877592260, 4077969759, 1814421308, 716421593, 1347351511, 1992852362, 1000314402},
				PC:  3437660,
				SR:  9737,
				USP: 691526,
				SSP: 577364,
				RAM: [][2]uint32{{3437656, 129}, {3437657, 12}, {3437658, 144}, {3437659, 252}, {5174230, 75}, {5174231, 155}, {15321282, 206}, {15321283, 176}, {3437660, 211}, {3437661, 8}},
			},
			want: 			cpuState{
				D:   [8]uint32{2763134075, 3648011053, 2975877757, 3482920686, 824004150, 2836209758, 2190969468, 3081161676},
				A:   [7]uint32{1877592259, 4077969759, 1814421308, 716421593, 1347351510, 1992852362, 1000314402},
				PC:  3437662,
				SR:  9728,
				USP: 691526,
				SSP: 577364,
				RAM: [][2]uint32{{3437656, 129}, {3437657, 12}, {3437658, 144}, {3437659, 252}, {5174230, 75}, {5174231, 155}, {15321282, 206}, {15321283, 95}, {3437660, 211}, {3437661, 8}},
				Cycles: 18,
			},
		},
		{
			name: "2215 SBCD D1, D2 8501",
			init: 			cpuState{
				D:   [8]uint32{251781113, 2359650261, 900229563, 2908096657, 3584623929, 2032445105, 3435832760, 1897714796},
				A:   [7]uint32{1388630915, 3458177734, 4244061287, 771609818, 687747575, 2361610880, 2463288699},
				PC:  7383540,
				SR:  9729,
				USP: 993736,
				SSP: 4384612,
				RAM: [][2]uint32{{7383536, 133}, {7383537, 1}, {7383538, 219}, {7383539, 160}, {7383540, 197}, {7383541, 183}},
			},
			want: 			cpuState{
				D:   [8]uint32{251781113, 2359650261, 900229510, 2908096657, 3584623929, 2032445105, 3435832760, 1897714796},
				A:   [7]uint32{1388630915, 3458177734, 4244061287, 771609818, 687747575, 2361610880, 2463288699},
				PC:  7383542,
				SR:  9753,
				USP: 993736,
				SSP: 4384612,
				RAM: [][2]uint32{{7383536, 133}, {7383537, 1}, {7383538, 219}, {7383539, 160}, {7383540, 197}, {7383541, 183}},
				Cycles: 6,
			},
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			runTest(t, tt.init, tt.want)
		})
	}
}

func TestNBCD(t *testing.T) {
	tests := []struct {
		name string
		init cpuState
		want cpuState
	}{
		{
			name: "000 NBCD (A5) 4815",
			init: cpuState{
				D:   [8]uint32{3947492722, 2101188238, 3877388413, 2880202079, 3496940104, 2080798772, 855030407, 3238153236},
				A:   [7]uint32{3346786243, 3402273506, 17325089, 1967330530, 2548317449, 3666971369, 2227404207},
				PC:  8724470,
				SR:  34589,
				USP: 8392382,
				SSP: 10983750,
				RAM: [][2]uint32{{8724466, 72}, {8724467, 21}, {8724468, 174}, {8724469, 168}, {9538280, 211}, {9538281, 158}, {8724470, 226}, {8724471, 139}},
			},
			want: cpuState{
				D:   [8]uint32{3947492722, 2101188238, 3877388413, 2880202079, 3496940104, 2080798772, 855030407, 3238153236},
				A:   [7]uint32{3346786243, 3402273506, 17325089, 1967330530, 2548317449, 3666971369, 2227404207},
				PC:  8724472,
				SR:  34585,
				USP: 8392382,
				SSP: 10983750,
				RAM: [][2]uint32{{8724466, 72}, {8724467, 21}, {8724468, 174}, {8724469, 168}, {9538280, 211}, {9538281, 251}, {8724470, 226}, {8724471, 139}},
				Cycles: 12,
			},
		},
		{
			name: "500 NBCD (d16, A1) 4829",
			init: cpuState{
				D:   [8]uint32{70152342, 1784813261, 3919101849, 2007753937, 1393095342, 2985081749, 916929108, 4161358118},
				A:   [7]uint32{1757798470, 2840526489, 2563841600, 3971062173, 529815522, 2501963399, 3039276366},
				PC:  1526928,
				SR:  8453,
				USP: 15571458,
				SSP: 5061116,
				RAM: [][2]uint32{{1526924, 72}, {1526925, 41}, {1526926, 131}, {1526927, 163}, {1526928, 179}, {1526929, 145}, {5145148, 136}, {5145149, 91}, {1526930, 58}, {1526931, 131}},
			},
			want: cpuState{
				D:   [8]uint32{70152342, 1784813261, 3919101849, 2007753937, 1393095342, 2985081749, 916929108, 4161358118},
				A:   [7]uint32{1757798470, 2840526489, 2563841600, 3971062173, 529815522, 2501963399, 3039276366},
				PC:  1526932,
				SR:  8465,
				USP: 15571458,
				SSP: 5061116,
				RAM: [][2]uint32{{1526924, 72}, {1526925, 41}, {1526926, 131}, {1526927, 163}, {1526928, 179}, {1526929, 145}, {5145148, 18}, {5145149, 91}, {1526930, 58}, {1526931, 131}},
				Cycles: 16,
			},
		},
		{
			name: "1000 NBCD (A7) 4817",
			init: cpuState{
				D:   [8]uint32{3425456517, 3378506001, 2007119008, 2379332692, 2100336854, 1403739600, 838668799, 2737300943},
				A:   [7]uint32{3091487772, 1195413189, 1800091857, 2369113421, 812703392, 2261886665, 3014117261},
				PC:  8224686,
				SR:  41742,
				USP: 10479356,
				SSP: 13747082,
				RAM: [][2]uint32{{8224682, 72}, {8224683, 23}, {8224684, 98}, {8224685, 193}, {13747082, 129}, {13747083, 194}, {8224686, 65}, {8224687, 225}},
			},
			want: cpuState{
				D:   [8]uint32{3425456517, 3378506001, 2007119008, 2379332692, 2100336854, 1403739600, 838668799, 2737300943},
				A:   [7]uint32{3091487772, 1195413189, 1800091857, 2369113421, 812703392, 2261886665, 3014117261},
				PC:  8224688,
				SR:  41745,
				USP: 10479356,
				SSP: 13747082,
				RAM: [][2]uint32{{8224682, 72}, {8224683, 23}, {8224684, 98}, {8224685, 193}, {13747082, 25}, {13747083, 194}, {8224686, 65}, {8224687, 225}},
				Cycles: 12,
			},
		},
		{
			name: "1500 NBCD (d8, A1, Xn) 4831",
			init: cpuState{
				D:   [8]uint32{4072350527, 3541140331, 3845356876, 2478513751, 3656011433, 817635394, 3109192364, 843031825},
				A:   [7]uint32{677000557, 3895230611, 2101690189, 1149624036, 2451054759, 464760283, 372879774},
				PC:  10629576,
				SR:  41487,
				USP: 9843058,
				SSP: 9111198,
				RAM: [][2]uint32{{10629572, 72}, {10629573, 49}, {10629574, 12}, {10629575, 21}, {10629576, 61}, {10629577, 125}, {15180774, 245}, {15180775, 36}, {10629578, 124}, {10629579, 43}},
			},
			want: cpuState{
				D:   [8]uint32{4072350527, 3541140331, 3845356876, 2478513751, 3656011433, 817635394, 3109192364, 843031825},
				A:   [7]uint32{677000557, 3895230611, 2101690189, 1149624036, 2451054759, 464760283, 372879774},
				PC:  10629580,
				SR:  41491,
				USP: 9843058,
				SSP: 9111198,
				RAM: [][2]uint32{{10629572, 72}, {10629573, 49}, {10629574, 12}, {10629575, 21}, {10629576, 61}, {10629577, 125}, {15180774, 245}, {15180775, 118}, {10629578, 124}, {10629579, 43}},
				Cycles: 18,
			},
		},
		{
			name: "2000 NBCD (d8, A5, Xn) 4835",
			init: cpuState{
				D:   [8]uint32{912491499, 917400088, 3793424683, 3933536407, 2649635767, 2882087297, 787638188, 2515214780},
				A:   [7]uint32{4066238975, 564310580, 3274878217, 3988183763, 3046038491, 1629312099, 1134846177},
				PC:  9225534,
				SR:  9748,
				USP: 1306188,
				SSP: 13047938,
				RAM: [][2]uint32{{9225530, 72}, {9225531, 53}, {9225532, 68}, {9225533, 137}, {9225534, 232}, {9225535, 195}, {1937314, 196}, {1937315, 129}, {9225536, 80}, {9225537, 90}},
			},
			want: cpuState{
				D:   [8]uint32{912491499, 917400088, 3793424683, 3933536407, 2649635767, 2882087297, 787638188, 2515214780},
				A:   [7]uint32{4066238975, 564310580, 3274878217, 3988183763, 3046038491, 1629312099, 1134846177},
				PC:  9225538,
				SR:  9745,
				USP: 1306188,
				SSP: 13047938,
				RAM: [][2]uint32{{9225530, 72}, {9225531, 53}, {9225532, 68}, {9225533, 137}, {9225534, 232}, {9225535, 195}, {1937314, 196}, {1937315, 24}, {9225536, 80}, {9225537, 90}},
				Cycles: 18,
			},
		},
		{
			name: "001 NBCD (d16, A3) 482b",
			init: 			cpuState{
				D:   [8]uint32{2701452019, 1718887210, 3848153212, 1306055704, 1619405738, 2272337128, 3523996414, 1728778250},
				A:   [7]uint32{3624952371, 686650425, 1048944624, 1268621106, 930441491, 2227207355, 2017024011},
				PC:  7918586,
				SR:  8200,
				USP: 16361444,
				SSP: 9703002,
				RAM: [][2]uint32{{7918582, 72}, {7918583, 43}, {7918584, 225}, {7918585, 113}, {7918586, 50}, {7918587, 10}, {10322082, 251}, {10322083, 176}, {7918588, 160}, {7918589, 19}},
			},
			want: 			cpuState{
				D:   [8]uint32{2701452019, 1718887210, 3848153212, 1306055704, 1619405738, 2272337128, 3523996414, 1728778250},
				A:   [7]uint32{3624952371, 686650425, 1048944624, 1268621106, 930441491, 2227207355, 2017024011},
				PC:  7918590,
				SR:  8217,
				USP: 16361444,
				SSP: 9703002,
				RAM: [][2]uint32{{7918582, 72}, {7918583, 43}, {7918584, 225}, {7918585, 113}, {7918586, 50}, {7918587, 10}, {10322082, 251}, {10322083, 240}, {7918588, 160}, {7918589, 19}},
				Cycles: 16,
			},
		},
		{
			name: "273 NBCD (A7)+ 481f",
			init: 			cpuState{
				D:   [8]uint32{53622541, 1216524631, 2542739946, 1823756434, 4077937992, 214407570, 74318697, 514345745},
				A:   [7]uint32{1424620422, 114072927, 4034963706, 2411335822, 2425157335, 2938283065, 1566405964},
				PC:  14088698,
				SR:  8453,
				USP: 9806272,
				SSP: 9997302,
				RAM: [][2]uint32{{14088694, 72}, {14088695, 31}, {14088696, 21}, {14088697, 226}, {9997302, 155}, {9997303, 87}, {14088698, 229}, {14088699, 101}},
			},
			want: 			cpuState{
				D:   [8]uint32{53622541, 1216524631, 2542739946, 1823756434, 4077937992, 214407570, 74318697, 514345745},
				A:   [7]uint32{1424620422, 114072927, 4034963706, 2411335822, 2425157335, 2938283065, 1566405964},
				PC:  14088700,
				SR:  8473,
				USP: 9806272,
				SSP: 9997304,
				RAM: [][2]uint32{{14088694, 72}, {14088695, 31}, {14088696, 21}, {14088697, 226}, {9997302, 255}, {9997303, 87}, {14088698, 229}, {14088699, 101}},
				Cycles: 12,
			},
		},
		{
			name: "522 NBCD (A4) 4814",
			init: 			cpuState{
				D:   [8]uint32{2148163012, 506533617, 2822763393, 3365158523, 2147518455, 3969681917, 871261891, 315330200},
				A:   [7]uint32{3904754063, 1984297816, 837841194, 2264739224, 498079776, 2301722005, 227612073},
				PC:  12461458,
				SR:  8965,
				USP: 6215830,
				SSP: 573614,
				RAM: [][2]uint32{{12461454, 72}, {12461455, 20}, {12461456, 112}, {12461457, 74}, {11540512, 241}, {11540513, 208}, {12461458, 12}, {12461459, 251}},
			},
			want: 			cpuState{
				D:   [8]uint32{2148163012, 506533617, 2822763393, 3365158523, 2147518455, 3969681917, 871261891, 315330200},
				A:   [7]uint32{3904754063, 1984297816, 837841194, 2264739224, 498079776, 2301722005, 227612073},
				PC:  12461460,
				SR:  8985,
				USP: 6215830,
				SSP: 573614,
				RAM: [][2]uint32{{12461454, 72}, {12461455, 20}, {12461456, 112}, {12461457, 74}, {11540512, 169}, {11540513, 208}, {12461458, 12}, {12461459, 251}},
				Cycles: 12,
			},
		},
		{
			name: "805 NBCD -(A3) 4823",
			init: 			cpuState{
				D:   [8]uint32{3796963856, 1547588257, 3347186489, 794051261, 3619593085, 716416886, 3095750382, 2207338369},
				A:   [7]uint32{400983636, 3533348236, 4152370674, 1294892148, 2961280110, 3089455598, 2802524114},
				PC:  12085048,
				SR:  8987,
				USP: 3661310,
				SSP: 7468412,
				RAM: [][2]uint32{{12085044, 72}, {12085045, 35}, {12085046, 119}, {12085047, 246}, {3046514, 198}, {3046515, 222}, {12085048, 216}, {12085049, 200}},
			},
			want: 			cpuState{
				D:   [8]uint32{3796963856, 1547588257, 3347186489, 794051261, 3619593085, 716416886, 3095750382, 2207338369},
				A:   [7]uint32{400983636, 3533348236, 4152370674, 1294892147, 2961280110, 3089455598, 2802524114},
				PC:  12085050,
				SR:  8985,
				USP: 3661310,
				SSP: 7468412,
				RAM: [][2]uint32{{12085044, 72}, {12085045, 35}, {12085046, 119}, {12085047, 246}, {3046514, 198}, {3046515, 187}, {12085048, 216}, {12085049, 200}},
				Cycles: 14,
			},
		},
		{
			name: "1079 NBCD (d8, A1, Xn) 4831",
			init: 			cpuState{
				D:   [8]uint32{2325831654, 3891491539, 3761471037, 2932603591, 785391194, 95538708, 2930572367, 4149350688},
				A:   [7]uint32{4072910142, 3275841435, 3627971841, 894733321, 101856147, 2997268998, 371984004},
				PC:  11937920,
				SR:  8984,
				USP: 11854056,
				SSP: 1223542,
				RAM: [][2]uint32{{11937916, 72}, {11937917, 49}, {11937918, 53}, {11937919, 41}, {11937920, 52}, {11937921, 39}, {4283018, 9}, {4283019, 211}, {11937922, 6}, {11937923, 229}},
			},
			want: 			cpuState{
				D:   [8]uint32{2325831654, 3891491539, 3761471037, 2932603591, 785391194, 95538708, 2930572367, 4149350688},
				A:   [7]uint32{4072910142, 3275841435, 3627971841, 894733321, 101856147, 2997268998, 371984004},
				PC:  11937924,
				SR:  8985,
				USP: 11854056,
				SSP: 1223542,
				RAM: [][2]uint32{{11937916, 72}, {11937917, 49}, {11937918, 53}, {11937919, 41}, {11937920, 52}, {11937921, 39}, {4283018, 9}, {4283019, 198}, {11937922, 6}, {11937923, 229}},
				Cycles: 18,
			},
		},
		{
			name: "1354 NBCD (A1) 4811",
			init: 			cpuState{
				D:   [8]uint32{3915967257, 2150630537, 386130019, 208978615, 1792131752, 3583254122, 3009158067, 1304310732},
				A:   [7]uint32{679861767, 3028707121, 2259109667, 1816710582, 2690569304, 2771789876, 3524661763},
				PC:  8281068,
				SR:  13,
				USP: 13760664,
				SSP: 15279024,
				RAM: [][2]uint32{{8281064, 72}, {8281065, 17}, {8281066, 38}, {8281067, 169}, {8808240, 253}, {8808241, 32}, {8281068, 240}, {8281069, 117}},
			},
			want: 			cpuState{
				D:   [8]uint32{3915967257, 2150630537, 386130019, 208978615, 1792131752, 3583254122, 3009158067, 1304310732},
				A:   [7]uint32{679861767, 3028707121, 2259109667, 1816710582, 2690569304, 2771789876, 3524661763},
				PC:  8281070,
				SR:  25,
				USP: 13760664,
				SSP: 15279024,
				RAM: [][2]uint32{{8281064, 72}, {8281065, 17}, {8281066, 38}, {8281067, 169}, {8808240, 253}, {8808241, 128}, {8281068, 240}, {8281069, 117}},
				Cycles: 12,
			},
		},
		{
			name: "1622 NBCD (d16, A1) 4829",
			init: 			cpuState{
				D:   [8]uint32{3753405940, 1980390612, 2041031288, 281535933, 2151094730, 1000010285, 744771982, 99454640},
				A:   [7]uint32{3123164380, 763958253, 725600316, 3494491395, 4016996612, 355314555, 1714212089},
				PC:  1739246,
				SR:  8976,
				USP: 15622276,
				SSP: 4378090,
				RAM: [][2]uint32{{1739242, 72}, {1739243, 41}, {1739244, 188}, {1739245, 128}, {1739246, 146}, {1739247, 140}, {8966252, 106}, {8966253, 19}, {1739248, 75}, {1739249, 131}},
			},
			want: 			cpuState{
				D:   [8]uint32{3753405940, 1980390612, 2041031288, 281535933, 2151094730, 1000010285, 744771982, 99454640},
				A:   [7]uint32{3123164380, 763958253, 725600316, 3494491395, 4016996612, 355314555, 1714212089},
				PC:  1739250,
				SR:  8985,
				USP: 15622276,
				SSP: 4378090,
				RAM: [][2]uint32{{1739242, 72}, {1739243, 41}, {1739244, 188}, {1739245, 128}, {1739246, 146}, {1739247, 140}, {8966252, 106}, {8966253, 134}, {1739248, 75}, {1739249, 131}},
				Cycles: 16,
			},
		},
		{
			name: "1924 NBCD D7 4807",
			init: 			cpuState{
				D:   [8]uint32{3411832904, 281701647, 1169868106, 1453583573, 3037437127, 4064664226, 555818466, 839315500},
				A:   [7]uint32{3787784271, 2226098807, 3307538341, 1299249208, 764550985, 1288036617, 3709466966},
				PC:  2173828,
				SR:  8194,
				USP: 7250300,
				SSP: 384668,
				RAM: [][2]uint32{{2173824, 72}, {2173825, 7}, {2173826, 174}, {2173827, 124}, {2173828, 224}, {2173829, 27}},
			},
			want: 			cpuState{
				D:   [8]uint32{3411832904, 281701647, 1169868106, 1453583573, 3037437127, 4064664226, 555818466, 839315566},
				A:   [7]uint32{3787784271, 2226098807, 3307538341, 1299249208, 764550985, 1288036617, 3709466966},
				PC:  2173830,
				SR:  8211,
				USP: 7250300,
				SSP: 384668,
				RAM: [][2]uint32{{2173824, 72}, {2173825, 7}, {2173826, 174}, {2173827, 124}, {2173828, 224}, {2173829, 27}},
				Cycles: 6,
			},
		},
		{
			name: "2212 NBCD -(A5) 4825",
			init: 			cpuState{
				D:   [8]uint32{492262482, 3407860815, 4237275658, 3432817256, 3053140760, 2430163852, 3473168434, 12747944},
				A:   [7]uint32{1576610275, 52216987, 79907823, 3482493375, 1777751719, 3304956145, 3677418238},
				PC:  12226464,
				SR:  9489,
				USP: 10524670,
				SSP: 16718912,
				RAM: [][2]uint32{{12226460, 72}, {12226461, 37}, {12226462, 99}, {12226463, 219}, {16621808, 232}, {16621809, 59}, {12226464, 245}, {12226465, 57}},
			},
			want: 			cpuState{
				D:   [8]uint32{492262482, 3407860815, 4237275658, 3432817256, 3053140760, 2430163852, 3473168434, 12747944},
				A:   [7]uint32{1576610275, 52216987, 79907823, 3482493375, 1777751719, 3304956144, 3677418238},
				PC:  12226466,
				SR:  9497,
				USP: 10524670,
				SSP: 16718912,
				RAM: [][2]uint32{{12226460, 72}, {12226461, 37}, {12226462, 99}, {12226463, 219}, {16621808, 177}, {16621809, 59}, {12226464, 245}, {12226465, 57}},
				Cycles: 14,
			},
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			runTest(t, tt.init, tt.want)
		})
	}
}
